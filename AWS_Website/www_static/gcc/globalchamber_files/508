;(function(){var root=this;var previousUnderscore=root._;var breaker={};var ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype;var push=ArrayProto.push,slice=ArrayProto.slice,concat=ArrayProto.concat,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty;var
nativeForEach=ArrayProto.forEach,nativeMap=ArrayProto.map,nativeReduce=ArrayProto.reduce,nativeReduceRight=ArrayProto.reduceRight,nativeFilter=ArrayProto.filter,nativeEvery=ArrayProto.every,nativeSome=ArrayProto.some,nativeIndexOf=ArrayProto.indexOf,nativeLastIndexOf=ArrayProto.lastIndexOf,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind;var _=function(obj){if(obj instanceof _)return obj;if(!(this instanceof _))return new _(obj);this._wrapped=obj;};if(typeof exports!=='undefined'){if(typeof module!=='undefined'&&module.exports){exports=module.exports=_;}
exports._=_;}else{root._=_;}
_.VERSION='1.4.4';var each=_.each=_.forEach=function(obj,iterator,context){if(obj==null)return;if(nativeForEach&&obj.forEach===nativeForEach){obj.forEach(iterator,context);}else if(obj.length===+obj.length){for(var i=0,l=obj.length;i<l;i++){if(iterator.call(context,obj[i],i,obj)===breaker)return;}}else{for(var key in obj){if(_.has(obj,key)){if(iterator.call(context,obj[key],key,obj)===breaker)return;}}}};_.map=_.collect=function(obj,iterator,context){var results=[];if(obj==null)return results;if(nativeMap&&obj.map===nativeMap)return obj.map(iterator,context);each(obj,function(value,index,list){results[results.length]=iterator.call(context,value,index,list);});return results;};var reduceError='Reduce of empty array with no initial value';_.reduce=_.foldl=_.inject=function(obj,iterator,memo,context){var initial=arguments.length>2;if(obj==null)obj=[];if(nativeReduce&&obj.reduce===nativeReduce){if(context)iterator=_.bind(iterator,context);return initial?obj.reduce(iterator,memo):obj.reduce(iterator);}
each(obj,function(value,index,list){if(!initial){memo=value;initial=true;}else{memo=iterator.call(context,memo,value,index,list);}});if(!initial)throw new TypeError(reduceError);return memo;};_.reduceRight=_.foldr=function(obj,iterator,memo,context){var initial=arguments.length>2;if(obj==null)obj=[];if(nativeReduceRight&&obj.reduceRight===nativeReduceRight){if(context)iterator=_.bind(iterator,context);return initial?obj.reduceRight(iterator,memo):obj.reduceRight(iterator);}
var length=obj.length;if(length!==+length){var keys=_.keys(obj);length=keys.length;}
each(obj,function(value,index,list){index=keys?keys[--length]:--length;if(!initial){memo=obj[index];initial=true;}else{memo=iterator.call(context,memo,obj[index],index,list);}});if(!initial)throw new TypeError(reduceError);return memo;};_.find=_.detect=function(obj,iterator,context){var result;any(obj,function(value,index,list){if(iterator.call(context,value,index,list)){result=value;return true;}});return result;};_.filter=_.select=function(obj,iterator,context){var results=[];if(obj==null)return results;if(nativeFilter&&obj.filter===nativeFilter)return obj.filter(iterator,context);each(obj,function(value,index,list){if(iterator.call(context,value,index,list))results[results.length]=value;});return results;};_.reject=function(obj,iterator,context){return _.filter(obj,function(value,index,list){return!iterator.call(context,value,index,list);},context);};_.every=_.all=function(obj,iterator,context){iterator||(iterator=_.identity);var result=true;if(obj==null)return result;if(nativeEvery&&obj.every===nativeEvery)return obj.every(iterator,context);each(obj,function(value,index,list){if(!(result=result&&iterator.call(context,value,index,list)))return breaker;});return!!result;};var any=_.some=_.any=function(obj,iterator,context){iterator||(iterator=_.identity);var result=false;if(obj==null)return result;if(nativeSome&&obj.some===nativeSome)return obj.some(iterator,context);each(obj,function(value,index,list){if(result||(result=iterator.call(context,value,index,list)))return breaker;});return!!result;};_.contains=_.include=function(obj,target){if(obj==null)return false;if(nativeIndexOf&&obj.indexOf===nativeIndexOf)return obj.indexOf(target)!=-1;return any(obj,function(value){return value===target;});};_.invoke=function(obj,method){var args=slice.call(arguments,2);var isFunc=_.isFunction(method);return _.map(obj,function(value){return(isFunc?method:value[method]).apply(value,args);});};_.pluck=function(obj,key){return _.map(obj,function(value){return value[key];});};_.where=function(obj,attrs,first){if(_.isEmpty(attrs))return first?null:[];return _[first?'find':'filter'](obj,function(value){for(var key in attrs){if(attrs[key]!==value[key])return false;}
return true;});};_.findWhere=function(obj,attrs){return _.where(obj,attrs,true);};_.max=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535){return Math.max.apply(Math,obj);}
if(!iterator&&_.isEmpty(obj))return-Infinity;var result={computed:-Infinity,value:-Infinity};each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed>=result.computed&&(result={value:value,computed:computed});});return result.value;};_.min=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535){return Math.min.apply(Math,obj);}
if(!iterator&&_.isEmpty(obj))return Infinity;var result={computed:Infinity,value:Infinity};each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed<result.computed&&(result={value:value,computed:computed});});return result.value;};_.shuffle=function(obj){var rand;var index=0;var shuffled=[];each(obj,function(value){rand=_.random(index++);shuffled[index-1]=shuffled[rand];shuffled[rand]=value;});return shuffled;};var lookupIterator=function(value){return _.isFunction(value)?value:function(obj){return obj[value];};};_.sortBy=function(obj,value,context){var iterator=lookupIterator(value);return _.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iterator.call(context,value,index,list)};}).sort(function(left,right){var a=left.criteria;var b=right.criteria;if(a!==b){if(a>b||a===void 0)return 1;if(a<b||b===void 0)return-1;}
return left.index<right.index?-1:1;}),'value');};var group=function(obj,value,context,behavior){var result={};var iterator=lookupIterator(value||_.identity);each(obj,function(value,index){var key=iterator.call(context,value,index,obj);behavior(result,key,value);});return result;};_.groupBy=function(obj,value,context){return group(obj,value,context,function(result,key,value){(_.has(result,key)?result[key]:(result[key]=[])).push(value);});};_.countBy=function(obj,value,context){return group(obj,value,context,function(result,key){if(!_.has(result,key))result[key]=0;result[key]++;});};_.sortedIndex=function(array,obj,iterator,context){iterator=iterator==null?_.identity:lookupIterator(iterator);var value=iterator.call(context,obj);var low=0,high=array.length;while(low<high){var mid=(low+high)>>>1;iterator.call(context,array[mid])<value?low=mid+1:high=mid;}
return low;};_.toArray=function(obj){if(!obj)return[];if(_.isArray(obj))return slice.call(obj);if(obj.length===+obj.length)return _.map(obj,_.identity);return _.values(obj);};_.size=function(obj){if(obj==null)return 0;return(obj.length===+obj.length)?obj.length:_.keys(obj).length;};_.first=_.head=_.take=function(array,n,guard){if(array==null)return void 0;return(n!=null)&&!guard?slice.call(array,0,n):array[0];};_.initial=function(array,n,guard){return slice.call(array,0,array.length-((n==null)||guard?1:n));};_.last=function(array,n,guard){if(array==null)return void 0;if((n!=null)&&!guard){return slice.call(array,Math.max(array.length-n,0));}else{return array[array.length-1];}};_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,(n==null)||guard?1:n);};_.compact=function(array){return _.filter(array,_.identity);};var flatten=function(input,shallow,output){each(input,function(value){if(_.isArray(value)){shallow?push.apply(output,value):flatten(value,shallow,output);}else{output.push(value);}});return output;};_.flatten=function(array,shallow){return flatten(array,shallow,[]);};_.without=function(array){return _.difference(array,slice.call(arguments,1));};_.uniq=_.unique=function(array,isSorted,iterator,context){if(_.isFunction(isSorted)){context=iterator;iterator=isSorted;isSorted=false;}
var initial=iterator?_.map(array,iterator,context):array;var results=[];var seen=[];each(initial,function(value,index){if(isSorted?(!index||seen[seen.length-1]!==value):!_.contains(seen,value)){seen.push(value);results.push(array[index]);}});return results;};_.union=function(){return _.uniq(concat.apply(ArrayProto,arguments));};_.intersection=function(array){var rest=slice.call(arguments,1);return _.filter(_.uniq(array),function(item){return _.every(rest,function(other){return _.indexOf(other,item)>=0;});});};_.difference=function(array){var rest=concat.apply(ArrayProto,slice.call(arguments,1));return _.filter(array,function(value){return!_.contains(rest,value);});};_.zip=function(){var args=slice.call(arguments);var length=_.max(_.pluck(args,'length'));var results=new Array(length);for(var i=0;i<length;i++){results[i]=_.pluck(args,""+i);}
return results;};_.object=function(list,values){if(list==null)return{};var result={};for(var i=0,l=list.length;i<l;i++){if(values){result[list[i]]=values[i];}else{result[list[i][0]]=list[i][1];}}
return result;};_.indexOf=function(array,item,isSorted){if(array==null)return-1;var i=0,l=array.length;if(isSorted){if(typeof isSorted=='number'){i=(isSorted<0?Math.max(0,l+isSorted):isSorted);}else{i=_.sortedIndex(array,item);return array[i]===item?i:-1;}}
if(nativeIndexOf&&array.indexOf===nativeIndexOf)return array.indexOf(item,isSorted);for(;i<l;i++)if(array[i]===item)return i;return-1;};_.lastIndexOf=function(array,item,from){if(array==null)return-1;var hasIndex=from!=null;if(nativeLastIndexOf&&array.lastIndexOf===nativeLastIndexOf){return hasIndex?array.lastIndexOf(item,from):array.lastIndexOf(item);}
var i=(hasIndex?from:array.length);while(i--)if(array[i]===item)return i;return-1;};_.range=function(start,stop,step){if(arguments.length<=1){stop=start||0;start=0;}
step=arguments[2]||1;var len=Math.max(Math.ceil((stop-start)/step),0);var idx=0;var range=new Array(len);while(idx<len){range[idx++]=start;start+=step;}
return range;};_.bind=function(func,context){if(func.bind===nativeBind&&nativeBind)return nativeBind.apply(func,slice.call(arguments,1));var args=slice.call(arguments,2);return function(){return func.apply(context,args.concat(slice.call(arguments)));};};_.partial=function(func){var args=slice.call(arguments,1);return function(){return func.apply(this,args.concat(slice.call(arguments)));};};_.bindAll=function(obj){var funcs=slice.call(arguments,1);if(funcs.length===0)funcs=_.functions(obj);each(funcs,function(f){obj[f]=_.bind(obj[f],obj);});return obj;};_.memoize=function(func,hasher){var memo={};hasher||(hasher=_.identity);return function(){var key=hasher.apply(this,arguments);return _.has(memo,key)?memo[key]:(memo[key]=func.apply(this,arguments));};};_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args);},wait);};_.defer=function(func){return _.delay.apply(_,[func,1].concat(slice.call(arguments,1)));};_.throttle=function(func,wait){var context,args,timeout,result;var previous=0;var later=function(){previous=new Date;timeout=null;result=func.apply(context,args);};return function(){var now=new Date;var remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0){clearTimeout(timeout);timeout=null;previous=now;result=func.apply(context,args);}else if(!timeout){timeout=setTimeout(later,remaining);}
return result;};};_.debounce=function(func,wait,immediate){var timeout,result;return function(){var context=this,args=arguments;var later=function(){timeout=null;if(!immediate)result=func.apply(context,args);};var callNow=immediate&&!timeout;clearTimeout(timeout);timeout=setTimeout(later,wait);if(callNow)result=func.apply(context,args);return result;};};_.once=function(func){var ran=false,memo;return function(){if(ran)return memo;ran=true;memo=func.apply(this,arguments);func=null;return memo;};};_.wrap=function(func,wrapper){return function(){var args=[func];push.apply(args,arguments);return wrapper.apply(this,args);};};_.compose=function(){var funcs=arguments;return function(){var args=arguments;for(var i=funcs.length-1;i>=0;i--){args=[funcs[i].apply(this,args)];}
return args[0];};};_.after=function(times,func){if(times<=0)return func();return function(){if(--times<1){return func.apply(this,arguments);}};};_.keys=nativeKeys||function(obj){if(obj!==Object(obj))throw new TypeError('Invalid object');var keys=[];for(var key in obj)if(_.has(obj,key))keys[keys.length]=key;return keys;};_.values=function(obj){var values=[];for(var key in obj)if(_.has(obj,key))values.push(obj[key]);return values;};_.pairs=function(obj){var pairs=[];for(var key in obj)if(_.has(obj,key))pairs.push([key,obj[key]]);return pairs;};_.invert=function(obj){var result={};for(var key in obj)if(_.has(obj,key))result[obj[key]]=key;return result;};_.functions=_.methods=function(obj){var names=[];for(var key in obj){if(_.isFunction(obj[key]))names.push(key);}
return names.sort();};_.extend=function(obj){each(slice.call(arguments,1),function(source){if(source){for(var prop in source){obj[prop]=source[prop];}}});return obj;};_.pick=function(obj){var copy={};var keys=concat.apply(ArrayProto,slice.call(arguments,1));each(keys,function(key){if(key in obj)copy[key]=obj[key];});return copy;};_.omit=function(obj){var copy={};var keys=concat.apply(ArrayProto,slice.call(arguments,1));for(var key in obj){if(!_.contains(keys,key))copy[key]=obj[key];}
return copy;};_.defaults=function(obj){each(slice.call(arguments,1),function(source){if(source){for(var prop in source){if(obj[prop]==null)obj[prop]=source[prop];}}});return obj;};_.clone=function(obj){if(!_.isObject(obj))return obj;return _.isArray(obj)?obj.slice():_.extend({},obj);};_.tap=function(obj,interceptor){interceptor(obj);return obj;};var eq=function(a,b,aStack,bStack){if(a===b)return a!==0||1/a==1/b;if(a==null||b==null)return a===b;if(a instanceof _)a=a._wrapped;if(b instanceof _)b=b._wrapped;var className=toString.call(a);if(className!=toString.call(b))return false;switch(className){case'[object String]':return a==String(b);case'[object Number]':return a!=+a?b!=+b:(a==0?1/a==1/b:a==+b);case'[object Date]':case'[object Boolean]':return+a==+b;case'[object RegExp]':return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase;}
if(typeof a!='object'||typeof b!='object')return false;var length=aStack.length;while(length--){if(aStack[length]==a)return bStack[length]==b;}
aStack.push(a);bStack.push(b);var size=0,result=true;if(className=='[object Array]'){size=a.length;result=size==b.length;if(result){while(size--){if(!(result=eq(a[size],b[size],aStack,bStack)))break;}}}else{var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&(aCtor instanceof aCtor)&&_.isFunction(bCtor)&&(bCtor instanceof bCtor))){return false;}
for(var key in a){if(_.has(a,key)){size++;if(!(result=_.has(b,key)&&eq(a[key],b[key],aStack,bStack)))break;}}
if(result){for(key in b){if(_.has(b,key)&&!(size--))break;}
result=!size;}}
aStack.pop();bStack.pop();return result;};_.isEqual=function(a,b){return eq(a,b,[],[]);};_.isEmpty=function(obj){if(obj==null)return true;if(_.isArray(obj)||_.isString(obj))return obj.length===0;for(var key in obj)if(_.has(obj,key))return false;return true;};_.isElement=function(obj){return!!(obj&&obj.nodeType===1);};_.isArray=nativeIsArray||function(obj){return toString.call(obj)=='[object Array]';};_.isObject=function(obj){return obj===Object(obj);};each(['Arguments','Function','String','Number','Date','RegExp'],function(name){_['is'+name]=function(obj){return toString.call(obj)=='[object '+name+']';};});if(!_.isArguments(arguments)){_.isArguments=function(obj){return!!(obj&&_.has(obj,'callee'));};}
if(typeof(/./)!=='function'){_.isFunction=function(obj){return typeof obj==='function';};}
_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj));};_.isNaN=function(obj){return _.isNumber(obj)&&obj!=+obj;};_.isBoolean=function(obj){return obj===true||obj===false||toString.call(obj)=='[object Boolean]';};_.isNull=function(obj){return obj===null;};_.isUndefined=function(obj){return obj===void 0;};_.has=function(obj,key){return hasOwnProperty.call(obj,key);};_.noConflict=function(){root._=previousUnderscore;return this;};_.identity=function(value){return value;};_.times=function(n,iterator,context){var accum=Array(n);for(var i=0;i<n;i++)accum[i]=iterator.call(context,i);return accum;};_.random=function(min,max){if(max==null){max=min;min=0;}
return min+Math.floor(Math.random()*(max-min+1));};var entityMap={escape:{'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#x27;','/':'&#x2F;'}};entityMap.unescape=_.invert(entityMap.escape);var entityRegexes={escape:new RegExp('['+_.keys(entityMap.escape).join('')+']','g'),unescape:new RegExp('('+_.keys(entityMap.unescape).join('|')+')','g')};_.each(['escape','unescape'],function(method){_[method]=function(string){if(string==null)return'';return(''+string).replace(entityRegexes[method],function(match){return entityMap[method][match];});};});_.result=function(object,property){if(object==null)return null;var value=object[property];return _.isFunction(value)?value.call(object):value;};_.mixin=function(obj){each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];push.apply(args,arguments);return result.call(this,func.apply(_,args));};});};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+'';return prefix?prefix+id:id;};_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/;var escapes={"'":"'",'\\':'\\','\r':'r','\n':'n','\t':'t','\u2028':'u2028','\u2029':'u2029'};var escaper=/\\|'|\r|\n|\t|\u2028|\u2029/g;_.template=function(text,data,settings){var render;settings=_.defaults({},settings,_.templateSettings);var matcher=new RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join('|')+'|$','g');var index=0;var source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){source+=text.slice(index,offset).replace(escaper,function(match){return'\\'+escapes[match];});if(escape){source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'";}
if(interpolate){source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'";}
if(evaluate){source+="';\n"+evaluate+"\n__p+='";}
index=offset+match.length;return match;});source+="';\n";if(!settings.variable)source='with(obj||{}){\n'+source+'}\n';source="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+
source+"return __p;\n";try{render=new Function(settings.variable||'obj','_',source);}catch(e){e.source=source;throw e;}
if(data)return render(data,_);var template=function(data){return render.call(this,data,_);};template.source='function('+(settings.variable||'obj')+'){\n'+source+'}';return template;};_.chain=function(obj){return _(obj).chain();};var result=function(obj){return this._chain?_(obj).chain():obj;};_.mixin(_);each(['pop','push','reverse','shift','sort','splice','unshift'],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;method.apply(obj,arguments);if((name=='shift'||name=='splice')&&obj.length===0)delete obj[0];return result.call(this,obj);};});each(['concat','join','slice'],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result.call(this,method.apply(this._wrapped,arguments));};});_.extend(_.prototype,{chain:function(){this._chain=true;return this;},value:function(){return this._wrapped;}});}).call(this);;;(function(k){var o=String.prototype.trim,l=function(a,b){for(var f=[];0<b;f[--b]=a);return f.join("")},c=function(a){return function(){for(var b=Array.prototype.slice.call(arguments),f=0;f<b.length;f++)b[f]=null==b[f]?"":""+b[f];return a.apply(null,b)}},m=function(){function a(a){return Object.prototype.toString.call(a).slice(8,-1).toLowerCase()}var b=function(){b.cache.hasOwnProperty(arguments[0])||(b.cache[arguments[0]]=b.parse(arguments[0]));return b.format.call(null,b.cache[arguments[0]],arguments)};b.format=function(b,n){var h=1,d=b.length,e="",c=[],i,j,g,k;for(i=0;i<d;i++)if(e=a(b[i]),"string"===e)c.push(b[i]);else if("array"===e){g=b[i];if(g[2]){e=n[h];for(j=0;j<g[2].length;j++){if(!e.hasOwnProperty(g[2][j]))throw m('[_.sprintf] property "%s" does not exist',g[2][j]);e=e[g[2][j]]}}else e=g[1]?n[g[1]]:n[h++];if(/[^s]/.test(g[8])&&"number"!=a(e))throw m("[_.sprintf] expecting number but found %s",a(e));switch(g[8]){case"b":e=e.toString(2);break;case"c":e=String.fromCharCode(e);break;case"d":e=parseInt(e,10);break;case"e":e=g[7]?e.toExponential(g[7]):e.toExponential();break;case"f":e=g[7]?parseFloat(e).toFixed(g[7]):parseFloat(e);break;case"o":e=e.toString(8);break;case"s":e=(e=""+e)&&g[7]?e.substring(0,g[7]):e;break;case"u":e=Math.abs(e);break;case"x":e=e.toString(16);break;case"X":e=e.toString(16).toUpperCase()}e=/[def]/.test(g[8])&&g[3]&&0<=e?"+"+e:e;j=g[4]?"0"==g[4]?"0":g[4].charAt(1):" ";k=g[6]-(""+e).length;j=g[6]?l(j,k):"";c.push(g[5]?e+j:j+e)}return c.join("")};b.cache={};b.parse=function(a){for(var b=[],h=[],c=0;a;){if(null!==(b=/^[^\x25]+/.exec(a)))h.push(b[0]);else if(null!==(b=/^\x25{2}/.exec(a)))h.push("%");else if(null!==(b=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(a))){if(b[2]){var c=c|1,e=[],d=b[2],i=[];if(null!==(i=/^([a-z_][a-z_\d]*)/i.exec(d)))for(e.push(i[1]);""!==(d=d.substring(i[0].length));)if(null!==(i=/^\.([a-z_][a-z_\d]*)/i.exec(d)))e.push(i[1]);else if(null!==(i=/^\[(\d+)\]/.exec(d)))e.push(i[1]);else throw"[_.sprintf] huh?";else throw"[_.sprintf] huh?";b[2]=e}else c|=2;if(3===c)throw"[_.sprintf] mixing positional and named placeholders is not (yet) supported";h.push(b)}else throw"[_.sprintf] huh?";a=a.substring(b[0].length)}return h};return b}(),d={VERSION:"2.0.0",isBlank:c(function(a){return/^\s*$/.test(a)}),stripTags:c(function(a){return a.replace(/<\/?[^>]+>/ig,"")}),capitalize:c(function(a){return a.charAt(0).toUpperCase()+a.substring(1).toLowerCase()}),chop:c(function(a,b){for(var b=1*b||0||a.length,f=[],c=0;c<a.length;)f.push(a.slice(c,c+b)),c+=b;return f}),clean:c(function(a){return d.strip(a.replace(/\s+/g," "))}),count:c(function(a,b){for(var f=0,c,d=0;d<a.length;)c=a.indexOf(b,d),0<=c&&f++,d=d+(0<=c?c:0)+b.length;return f}),chars:c(function(a){return a.split("")}),escapeHTML:c(function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}),unescapeHTML:c(function(a){return a.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&amp;/g,"&")}),escapeRegExp:c(function(a){return a.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")}),insert:c(function(a,b,f){a=a.split("");a.splice(1*b||0,0,f);return a.join("")}),include:c(function(a,b){return-1!==a.indexOf(b)}),join:c(function(a){var b=Array.prototype.slice.call(arguments);return b.join(b.shift())}),lines:c(function(a){return a.split("\n")}),reverse:c(function(a){return Array.prototype.reverse.apply((""+a).split("")).join("")}),splice:c(function(a,b,f,c){a=a.split("");a.splice(1*b||0,1*f||0,c);return a.join("")}),startsWith:c(function(a,b){return a.length>=b.length&&a.substring(0,b.length)===b}),endsWith:c(function(a,b){return a.length>=b.length&&a.substring(a.length-b.length)===b}),succ:c(function(a){var b=a.split("");b.splice(a.length-1,1,String.fromCharCode(a.charCodeAt(a.length-1)+1));return b.join("")}),titleize:c(function(a){for(var a=a.split(" "),b,f=0;f<a.length;f++)b=a[f].split(""),"undefined"!==typeof b[0]&&(b[0]=b[0].toUpperCase()),f+1===a.length?a[f]=b.join(""):a[f]=b.join("")+" ";return a.join("")}),camelize:c(function(a){return d.trim(a).replace(/(\-|_|\s)+(.)?/g,function(a,f,c){return c?c.toUpperCase():""})}),underscored:function(a){return d.trim(a).replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/\-|\s+/g,"_").toLowerCase()},dasherize:function(a){return d.trim(a).replace(/([a-z\d])([A-Z]+)/g,"$1-$2").replace(/^([A-Z]+)/,"-$1").replace(/\_|\s+/g,"-").toLowerCase()},humanize:function(a){return d.capitalize(this.underscored(a).replace(/_id$/,"").replace(/_/g," "))},trim:c(function(a,b){if(!b&&o)return o.call(a);b=b?d.escapeRegExp(b):"\\s";return a.replace(RegExp("^["+b+"]+|["+b+"]+$","g"),"")}),ltrim:c(function(a,b){b=b?d.escapeRegExp(b):"\\s";return a.replace(RegExp("^["+b+"]+","g"),"")}),rtrim:c(function(a,b){b=b?d.escapeRegExp(b):"\\s";return a.replace(RegExp("["+b+"]+$","g"),"")}),truncate:c(function(a,b,f){b=1*b||0;return a.length>b?a.slice(0,b)+(f||"..."):a}),prune:c(function(a,b,f){var c="",h="",h=0,f=f||"...",b=1*b||0;for(h in a)c+=a[h].toUpperCase()!=a[h].toLowerCase()||/[-_\d]/.test(a[h])?"A":" ";h=0===c.substring(b-1,b+1).search(/^\w\w$/)?d.rtrim(c.slice(0,b).replace(/([\W][\w]*)$/,"")):d.rtrim(c.slice(0,b));h=h.replace(/\W+$/,"");return h.length+f.length>a.length?a:a.substring(0,h.length)+f}),words:function(a,b){return(""+a).split(b||" ")},pad:c(function(a,b,f,c){var d="",d=0,b=1*b||0;f?1<f.length&&(f=f.charAt(0)):f=" ";switch(c){case"right":d=b-a.length;d=l(f,d);a+=d;break;case"both":d=b-a.length;d={left:l(f,Math.ceil(d/2)),right:l(f,Math.floor(d/2))};a=d.left+a+d.right;break;default:d=b-a.length,d=l(f,d),a=d+a}return a}),lpad:function(a,b,c){return d.pad(a,b,c)},rpad:function(a,b,c){return d.pad(a,b,c,"right")},lrpad:function(a,b,c){return d.pad(a,b,c,"both")},sprintf:m,vsprintf:function(a,b){b.unshift(a);return m.apply(null,b)},toNumber:function(a,b){var c;c=1*(1*a||0).toFixed(1*b||0)||0;return!(0===c&&"0"!==a&&0!==a)?c:Number.NaN},strRight:c(function(a,b){var c=!b?-1:a.indexOf(b);return-1!=c?a.slice(c+b.length,a.length):a}),strRightBack:c(function(a,b){var c=!b?-1:a.lastIndexOf(b);return-1!=c?a.slice(c+b.length,a.length):a}),strLeft:c(function(a,b){var c=!b?-1:a.indexOf(b);return-1!=c?a.slice(0,c):a}),strLeftBack:c(function(a,b){var c=a.lastIndexOf(b);return-1!=c?a.slice(0,c):a}),exports:function(){var a={},b;for(b in this)if(this.hasOwnProperty(b)&&!("include"==b||"contains"==b||"reverse"==b))a[b]=this[b];return a}};d.strip=d.trim;d.lstrip=d.ltrim;d.rstrip=d.rtrim;d.center=d.lrpad;d.ljust=d.lpad;d.rjust=d.rpad;d.contains=d.include;"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(module.exports=d),exports._s=d):"undefined"!==typeof k._?(k._.string=d,k._.str=k._.string):k._={string:d,str:d}})(this||window);;;if("undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");+function(a){"use strict";function b(){var a=document.createElement("bootstrap"),b={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var c in b)if(void 0!==a.style[c])return{end:b[c]};return!1}a.fn.emulateTransitionEnd=function(b){var c=!1,d=this;a(this).one("bsTransitionEnd",function(){c=!0});var e=function(){c||a(d).trigger(a.support.transition.end)};return setTimeout(e,b),this},a(function(){a.support.transition=b(),a.support.transition&&(a.event.special.bsTransitionEnd={bindType:a.support.transition.end,delegateType:a.support.transition.end,handle:function(b){return a(b.target).is(this)?b.handleObj.handler.apply(this,arguments):void 0}})})}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var c=a(this),e=c.data("bs.alert");e||c.data("bs.alert",e=new d(this)),"string"==typeof b&&e[b].call(c)})}var c='[data-dismiss="alert"]',d=function(b){a(b).on("click",c,this.close)};d.VERSION="3.2.0",d.prototype.close=function(b){function c(){f.detach().trigger("closed.bs.alert").remove()}var d=a(this),e=d.attr("data-target");e||(e=d.attr("href"),e=e&&e.replace(/.*(?=#[^\s]*$)/,""));var f=a(e);b&&b.preventDefault(),f.length||(f=d.hasClass("alert")?d:d.parent()),f.trigger(b=a.Event("close.bs.alert")),b.isDefaultPrevented()||(f.removeClass("in"),a.support.transition&&f.hasClass("fade")?f.one("bsTransitionEnd",c).emulateTransitionEnd(150):c())};var e=a.fn.alert;a.fn.alert=b,a.fn.alert.Constructor=d,a.fn.alert.noConflict=function(){return a.fn.alert=e,this},a(document).on("click.bs.alert.data-api",c,d.prototype.close)}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.button"),f="object"==typeof b&&b;e||d.data("bs.button",e=new c(this,f)),"toggle"==b?e.toggle():b&&e.setState(b)})}var c=function(b,d){this.$element=a(b),this.options=a.extend({},c.DEFAULTS,d),this.isLoading=!1};c.VERSION="3.2.0",c.DEFAULTS={loadingText:"loading..."},c.prototype.setState=function(b){var c="disabled",d=this.$element,e=d.is("input")?"val":"html",f=d.data();b+="Text",null==f.resetText&&d.data("resetText",d[e]()),d[e](null==f[b]?this.options[b]:f[b]),setTimeout(a.proxy(function(){"loadingText"==b?(this.isLoading=!0,d.addClass(c).attr(c,c)):this.isLoading&&(this.isLoading=!1,d.removeClass(c).removeAttr(c))},this),0)},c.prototype.toggle=function(){var a=!0,b=this.$element.closest('[data-toggle="buttons"]');if(b.length){var c=this.$element.find("input");"radio"==c.prop("type")&&(c.prop("checked")&&this.$element.hasClass("active")?a=!1:b.find(".active").removeClass("active")),a&&c.prop("checked",!this.$element.hasClass("active")).trigger("change")}a&&this.$element.toggleClass("active")};var d=a.fn.button;a.fn.button=b,a.fn.button.Constructor=c,a.fn.button.noConflict=function(){return a.fn.button=d,this},a(document).on("click.bs.button.data-api",'[data-toggle^="button"]',function(c){var d=a(c.target);d.hasClass("btn")||(d=d.closest(".btn")),b.call(d,"toggle"),c.preventDefault()})}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.carousel"),f=a.extend({},c.DEFAULTS,d.data(),"object"==typeof b&&b),g="string"==typeof b?b:f.slide;e||d.data("bs.carousel",e=new c(this,f)),"number"==typeof b?e.to(b):g?e[g]():f.interval&&e.pause().cycle()})}var c=function(b,c){this.$element=a(b).on("keydown.bs.carousel",a.proxy(this.keydown,this)),this.$indicators=this.$element.find(".carousel-indicators"),this.options=c,this.paused=this.sliding=this.interval=this.$active=this.$items=null,"hover"==this.options.pause&&this.$element.on("mouseenter.bs.carousel",a.proxy(this.pause,this)).on("mouseleave.bs.carousel",a.proxy(this.cycle,this))};c.VERSION="3.2.0",c.DEFAULTS={interval:5e3,pause:"hover",wrap:!0},c.prototype.keydown=function(a){switch(a.which){case 37:this.prev();break;case 39:this.next();break;default:return}a.preventDefault()},c.prototype.cycle=function(b){return b||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(a.proxy(this.next,this),this.options.interval)),this},c.prototype.getItemIndex=function(a){return this.$items=a.parent().children(".item"),this.$items.index(a||this.$active)},c.prototype.to=function(b){var c=this,d=this.getItemIndex(this.$active=this.$element.find(".item.active"));return b>this.$items.length-1||0>b?void 0:this.sliding?this.$element.one("slid.bs.carousel",function(){c.to(b)}):d==b?this.pause().cycle():this.slide(b>d?"next":"prev",a(this.$items[b]))},c.prototype.pause=function(b){return b||(this.paused=!0),this.$element.find(".next, .prev").length&&a.support.transition&&(this.$element.trigger(a.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},c.prototype.next=function(){return this.sliding?void 0:this.slide("next")},c.prototype.prev=function(){return this.sliding?void 0:this.slide("prev")},c.prototype.slide=function(b,c){var d=this.$element.find(".item.active"),e=c||d[b](),f=this.interval,g="next"==b?"left":"right",h="next"==b?"first":"last",i=this;if(!e.length){if(!this.options.wrap)return;e=this.$element.find(".item")[h]()}if(e.hasClass("active"))return this.sliding=!1;var j=e[0],k=a.Event("slide.bs.carousel",{relatedTarget:j,direction:g});if(this.$element.trigger(k),!k.isDefaultPrevented()){if(this.sliding=!0,f&&this.pause(),this.$indicators.length){this.$indicators.find(".active").removeClass("active");var l=a(this.$indicators.children()[this.getItemIndex(e)]);l&&l.addClass("active")}var m=a.Event("slid.bs.carousel",{relatedTarget:j,direction:g});return a.support.transition&&this.$element.hasClass("slide")?(e.addClass(b),e[0].offsetWidth,d.addClass(g),e.addClass(g),d.one("bsTransitionEnd",function(){e.removeClass([b,g].join(" ")).addClass("active"),d.removeClass(["active",g].join(" ")),i.sliding=!1,setTimeout(function(){i.$element.trigger(m)},0)}).emulateTransitionEnd(1e3*d.css("transition-duration").slice(0,-1))):(d.removeClass("active"),e.addClass("active"),this.sliding=!1,this.$element.trigger(m)),f&&this.cycle(),this}};var d=a.fn.carousel;a.fn.carousel=b,a.fn.carousel.Constructor=c,a.fn.carousel.noConflict=function(){return a.fn.carousel=d,this},a(document).on("click.bs.carousel.data-api","[data-slide], [data-slide-to]",function(c){var d,e=a(this),f=a(e.attr("data-target")||(d=e.attr("href"))&&d.replace(/.*(?=#[^\s]+$)/,""));if(f.hasClass("carousel")){var g=a.extend({},f.data(),e.data()),h=e.attr("data-slide-to");h&&(g.interval=!1),b.call(f,g),h&&f.data("bs.carousel").to(h),c.preventDefault()}}),a(window).on("load",function(){a('[data-ride="carousel"]').each(function(){var c=a(this);b.call(c,c.data())})})}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.collapse"),f=a.extend({},c.DEFAULTS,d.data(),"object"==typeof b&&b);!e&&f.toggle&&"show"==b&&(b=!b),e||d.data("bs.collapse",e=new c(this,f)),"string"==typeof b&&e[b]()})}var c=function(b,d){this.$element=a(b),this.options=a.extend({},c.DEFAULTS,d),this.transitioning=null,this.options.parent&&(this.$parent=a(this.options.parent)),this.options.toggle&&this.toggle()};c.VERSION="3.2.0",c.DEFAULTS={toggle:!0},c.prototype.dimension=function(){var a=this.$element.hasClass("width");return a?"width":"height"},c.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var c=a.Event("show.bs.collapse");if(this.$element.trigger(c),!c.isDefaultPrevented()){var d=this.$parent&&this.$parent.find("> .panel > .in");if(d&&d.length){var e=d.data("bs.collapse");if(e&&e.transitioning)return;b.call(d,"hide"),e||d.data("bs.collapse",null)}var f=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[f](0),this.transitioning=1;var g=function(){this.$element.removeClass("collapsing").addClass("collapse in")[f](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!a.support.transition)return g.call(this);var h=a.camelCase(["scroll",f].join("-"));this.$element.one("bsTransitionEnd",a.proxy(g,this)).emulateTransitionEnd(350)[f](this.$element[0][h])}}},c.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var b=a.Event("hide.bs.collapse");if(this.$element.trigger(b),!b.isDefaultPrevented()){var c=this.dimension();this.$element[c](this.$element[c]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse").removeClass("in"),this.transitioning=1;var d=function(){this.transitioning=0,this.$element.trigger("hidden.bs.collapse").removeClass("collapsing").addClass("collapse")};return a.support.transition?void this.$element[c](0).one("bsTransitionEnd",a.proxy(d,this)).emulateTransitionEnd(350):d.call(this)}}},c.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()};var d=a.fn.collapse;a.fn.collapse=b,a.fn.collapse.Constructor=c,a.fn.collapse.noConflict=function(){return a.fn.collapse=d,this},a(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(c){var d,e=a(this),f=e.attr("data-target")||c.preventDefault()||(d=e.attr("href"))&&d.replace(/.*(?=#[^\s]+$)/,""),g=a(f),h=g.data("bs.collapse"),i=h?"toggle":e.data(),j=e.attr("data-parent"),k=j&&a(j);h&&h.transitioning||(k&&k.find('[data-toggle="collapse"][data-parent="'+j+'"]').not(e).addClass("collapsed"),e[g.hasClass("in")?"addClass":"removeClass"]("collapsed")),b.call(g,i)})}(jQuery),+function(a){"use strict";function b(b){b&&3===b.which||(a(e).remove(),a(f).each(function(){var d=c(a(this)),e={relatedTarget:this};d.hasClass("open")&&(d.trigger(b=a.Event("hide.bs.dropdown",e)),b.isDefaultPrevented()||d.removeClass("open").trigger("hidden.bs.dropdown",e))}))}function c(b){var c=b.attr("data-target");c||(c=b.attr("href"),c=c&&/#[A-Za-z]/.test(c)&&c.replace(/.*(?=#[^\s]*$)/,""));var d=c&&a(c);return d&&d.length?d:b.parent()}function d(b){return this.each(function(){var c=a(this),d=c.data("bs.dropdown");d||c.data("bs.dropdown",d=new g(this)),"string"==typeof b&&d[b].call(c)})}var e=".dropdown-backdrop",f='[data-toggle="dropdown"]',g=function(b){a(b).on("click.bs.dropdown",this.toggle)};g.VERSION="3.2.0",g.prototype.toggle=function(d){var e=a(this);if(!e.is(".disabled, :disabled")){var f=c(e),g=f.hasClass("open");if(b(),!g){"ontouchstart"in document.documentElement&&!f.closest(".navbar-nav").length&&a('<div class="dropdown-backdrop"/>').insertAfter(a(this)).on("click",b);var h={relatedTarget:this};if(f.trigger(d=a.Event("show.bs.dropdown",h)),d.isDefaultPrevented())return;e.trigger("focus"),f.toggleClass("open").trigger("shown.bs.dropdown",h)}return!1}},g.prototype.keydown=function(b){if(/(38|40|27)/.test(b.keyCode)){var d=a(this);if(b.preventDefault(),b.stopPropagation(),!d.is(".disabled, :disabled")){var e=c(d),g=e.hasClass("open");if(!g||g&&27==b.keyCode)return 27==b.which&&e.find(f).trigger("focus"),d.trigger("click");var h=" li:not(.divider):visible a",i=e.find('[role="menu"]'+h+', [role="listbox"]'+h);if(i.length){var j=i.index(i.filter(":focus"));38==b.keyCode&&j>0&&j--,40==b.keyCode&&j<i.length-1&&j++,~j||(j=0),i.eq(j).trigger("focus")}}}};var h=a.fn.dropdown;a.fn.dropdown=d,a.fn.dropdown.Constructor=g,a.fn.dropdown.noConflict=function(){return a.fn.dropdown=h,this},a(document).on("click.bs.dropdown.data-api",b).on("click.bs.dropdown.data-api",".dropdown form",function(a){a.stopPropagation()}).on("click.bs.dropdown.data-api",f,g.prototype.toggle).on("keydown.bs.dropdown.data-api",f+', [role="menu"], [role="listbox"]',g.prototype.keydown)}(jQuery),+function(a){"use strict";function b(b,d){return this.each(function(){var e=a(this),f=e.data("bs.modal"),g=a.extend({},c.DEFAULTS,e.data(),"object"==typeof b&&b);f||e.data("bs.modal",f=new c(this,g)),"string"==typeof b?f[b](d):g.show&&f.show(d)})}var c=function(b,c){this.options=c,this.$body=a(document.body),this.$element=a(b),this.$backdrop=this.isShown=null,this.scrollbarWidth=0,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,a.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};c.VERSION="3.2.0",c.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},c.prototype.toggle=function(a){return this.isShown?this.hide():this.show(a)},c.prototype.show=function(b){var c=this,d=a.Event("show.bs.modal",{relatedTarget:b});this.$element.trigger(d),this.isShown||d.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.$body.addClass("modal-open"),this.setScrollbar(),this.escape(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',a.proxy(this.hide,this)),this.backdrop(function(){var d=a.support.transition&&c.$element.hasClass("fade");c.$element.parent().length||c.$element.appendTo(c.$body),c.$element.show().scrollTop(0),d&&c.$element[0].offsetWidth,c.$element.addClass("in").attr("aria-hidden",!1),c.enforceFocus();var e=a.Event("shown.bs.modal",{relatedTarget:b});d?c.$element.find(".modal-dialog").one("bsTransitionEnd",function(){c.$element.trigger("focus").trigger(e)}).emulateTransitionEnd(300):c.$element.trigger("focus").trigger(e)}))},c.prototype.hide=function(b){b&&b.preventDefault(),b=a.Event("hide.bs.modal"),this.$element.trigger(b),this.isShown&&!b.isDefaultPrevented()&&(this.isShown=!1,this.$body.removeClass("modal-open"),this.resetScrollbar(),this.escape(),a(document).off("focusin.bs.modal"),this.$element.removeClass("in").attr("aria-hidden",!0).off("click.dismiss.bs.modal"),a.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",a.proxy(this.hideModal,this)).emulateTransitionEnd(300):this.hideModal())},c.prototype.enforceFocus=function(){a(document).off("focusin.bs.modal").on("focusin.bs.modal",a.proxy(function(a){this.$element[0]===a.target||this.$element.has(a.target).length||this.$element.trigger("focus")},this))},c.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.bs.modal",a.proxy(function(a){27==a.which&&this.hide()},this)):this.isShown||this.$element.off("keyup.dismiss.bs.modal")},c.prototype.hideModal=function(){var a=this;this.$element.hide(),this.backdrop(function(){a.$element.trigger("hidden.bs.modal")})},c.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},c.prototype.backdrop=function(b){var c=this,d=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var e=a.support.transition&&d;if(this.$backdrop=a('<div class="modal-backdrop '+d+'" />').appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",a.proxy(function(a){a.target===a.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus.call(this.$element[0]):this.hide.call(this))},this)),e&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!b)return;e?this.$backdrop.one("bsTransitionEnd",b).emulateTransitionEnd(150):b()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var f=function(){c.removeBackdrop(),b&&b()};a.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",f).emulateTransitionEnd(150):f()}else b&&b()},c.prototype.checkScrollbar=function(){document.body.clientWidth>=window.innerWidth||(this.scrollbarWidth=this.scrollbarWidth||this.measureScrollbar())},c.prototype.setScrollbar=function(){var a=parseInt(this.$body.css("padding-right")||0,10);this.scrollbarWidth&&this.$body.css("padding-right",a+this.scrollbarWidth)},c.prototype.resetScrollbar=function(){this.$body.css("padding-right","")},c.prototype.measureScrollbar=function(){var a=document.createElement("div");a.className="modal-scrollbar-measure",this.$body.append(a);var b=a.offsetWidth-a.clientWidth;return this.$body[0].removeChild(a),b};var d=a.fn.modal;a.fn.modal=b,a.fn.modal.Constructor=c,a.fn.modal.noConflict=function(){return a.fn.modal=d,this},a(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(c){var d=a(this),e=d.attr("href"),f=a(d.attr("data-target")||e&&e.replace(/.*(?=#[^\s]+$)/,"")),g=f.data("bs.modal")?"toggle":a.extend({remote:!/#/.test(e)&&e},f.data(),d.data());d.is("a")&&c.preventDefault(),f.one("show.bs.modal",function(a){a.isDefaultPrevented()||f.one("hidden.bs.modal",function(){d.is(":visible")&&d.trigger("focus")})}),b.call(f,g,this)})}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.tooltip"),f="object"==typeof b&&b;(e||"destroy"!=b)&&(e||d.data("bs.tooltip",e=new c(this,f)),"string"==typeof b&&e[b]())})}var c=function(a,b){this.type=this.options=this.enabled=this.timeout=this.hoverState=this.$element=null,this.init("tooltip",a,b)};c.VERSION="3.2.0",c.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},c.prototype.init=function(b,c,d){this.enabled=!0,this.type=b,this.$element=a(c),this.options=this.getOptions(d),this.$viewport=this.options.viewport&&a(this.options.viewport.selector||this.options.viewport);for(var e=this.options.trigger.split(" "),f=e.length;f--;){var g=e[f];if("click"==g)this.$element.on("click."+this.type,this.options.selector,a.proxy(this.toggle,this));else if("manual"!=g){var h="hover"==g?"mouseenter":"focusin",i="hover"==g?"mouseleave":"focusout";this.$element.on(h+"."+this.type,this.options.selector,a.proxy(this.enter,this)),this.$element.on(i+"."+this.type,this.options.selector,a.proxy(this.leave,this))}}this.options.selector?this._options=a.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},c.prototype.getDefaults=function(){return c.DEFAULTS},c.prototype.getOptions=function(b){return b=a.extend({},this.getDefaults(),this.$element.data(),b),b.delay&&"number"==typeof b.delay&&(b.delay={show:b.delay,hide:b.delay}),b},c.prototype.getDelegateOptions=function(){var b={},c=this.getDefaults();return this._options&&a.each(this._options,function(a,d){c[a]!=d&&(b[a]=d)}),b},c.prototype.enter=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data("bs."+this.type);return c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c)),clearTimeout(c.timeout),c.hoverState="in",c.options.delay&&c.options.delay.show?void(c.timeout=setTimeout(function(){"in"==c.hoverState&&c.show()},c.options.delay.show)):c.show()},c.prototype.leave=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data("bs."+this.type);return c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c)),clearTimeout(c.timeout),c.hoverState="out",c.options.delay&&c.options.delay.hide?void(c.timeout=setTimeout(function(){"out"==c.hoverState&&c.hide()},c.options.delay.hide)):c.hide()},c.prototype.show=function(){var b=a.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(b);var c=a.contains(document.documentElement,this.$element[0]);if(b.isDefaultPrevented()||!c)return;var d=this,e=this.tip(),f=this.getUID(this.type);this.setContent(),e.attr("id",f),this.$element.attr("aria-describedby",f),this.options.animation&&e.addClass("fade");var g="function"==typeof this.options.placement?this.options.placement.call(this,e[0],this.$element[0]):this.options.placement,h=/\s?auto?\s?/i,i=h.test(g);i&&(g=g.replace(h,"")||"top"),e.detach().css({top:0,left:0,display:"block"}).addClass(g).data("bs."+this.type,this),this.options.container?e.appendTo(this.options.container):e.insertAfter(this.$element);var j=this.getPosition(),k=e[0].offsetWidth,l=e[0].offsetHeight;if(i){var m=g,n=this.$element.parent(),o=this.getPosition(n);g="bottom"==g&&j.top+j.height+l-o.scroll>o.height?"top":"top"==g&&j.top-o.scroll-l<0?"bottom":"right"==g&&j.right+k>o.width?"left":"left"==g&&j.left-k<o.left?"right":g,e.removeClass(m).addClass(g)}var p=this.getCalculatedOffset(g,j,k,l);this.applyPlacement(p,g);var q=function(){d.$element.trigger("shown.bs."+d.type),d.hoverState=null};a.support.transition&&this.$tip.hasClass("fade")?e.one("bsTransitionEnd",q).emulateTransitionEnd(150):q()}},c.prototype.applyPlacement=function(b,c){var d=this.tip(),e=d[0].offsetWidth,f=d[0].offsetHeight,g=parseInt(d.css("margin-top"),10),h=parseInt(d.css("margin-left"),10);isNaN(g)&&(g=0),isNaN(h)&&(h=0),b.top=b.top+g,b.left=b.left+h,a.offset.setOffset(d[0],a.extend({using:function(a){d.css({top:Math.round(a.top),left:Math.round(a.left)})}},b),0),d.addClass("in");var i=d[0].offsetWidth,j=d[0].offsetHeight;"top"==c&&j!=f&&(b.top=b.top+f-j);var k=this.getViewportAdjustedDelta(c,b,i,j);k.left?b.left+=k.left:b.top+=k.top;var l=k.left?2*k.left-e+i:2*k.top-f+j,m=k.left?"left":"top",n=k.left?"offsetWidth":"offsetHeight";d.offset(b),this.replaceArrow(l,d[0][n],m)},c.prototype.replaceArrow=function(a,b,c){this.arrow().css(c,a?50*(1-a/b)+"%":"")},c.prototype.setContent=function(){var a=this.tip(),b=this.getTitle();a.find(".tooltip-inner")[this.options.html?"html":"text"](b),a.removeClass("fade in top bottom left right")},c.prototype.hide=function(){function b(){"in"!=c.hoverState&&d.detach(),c.$element.trigger("hidden.bs."+c.type)}var c=this,d=this.tip(),e=a.Event("hide.bs."+this.type);return this.$element.removeAttr("aria-describedby"),this.$element.trigger(e),e.isDefaultPrevented()?void 0:(d.removeClass("in"),a.support.transition&&this.$tip.hasClass("fade")?d.one("bsTransitionEnd",b).emulateTransitionEnd(150):b(),this.hoverState=null,this)},c.prototype.fixTitle=function(){var a=this.$element;(a.attr("title")||"string"!=typeof a.attr("data-original-title"))&&a.attr("data-original-title",a.attr("title")||"").attr("title","")},c.prototype.hasContent=function(){return this.getTitle()},c.prototype.getPosition=function(b){b=b||this.$element;var c=b[0],d="BODY"==c.tagName;return a.extend({},"function"==typeof c.getBoundingClientRect?c.getBoundingClientRect():null,{scroll:d?document.documentElement.scrollTop||document.body.scrollTop:b.scrollTop(),width:d?a(window).width():b.outerWidth(),height:d?a(window).height():b.outerHeight()},d?{top:0,left:0}:b.offset())},c.prototype.getCalculatedOffset=function(a,b,c,d){return"bottom"==a?{top:b.top+b.height,left:b.left+b.width/2-c/2}:"top"==a?{top:b.top-d,left:b.left+b.width/2-c/2}:"left"==a?{top:b.top+b.height/2-d/2,left:b.left-c}:{top:b.top+b.height/2-d/2,left:b.left+b.width}},c.prototype.getViewportAdjustedDelta=function(a,b,c,d){var e={top:0,left:0};if(!this.$viewport)return e;var f=this.options.viewport&&this.options.viewport.padding||0,g=this.getPosition(this.$viewport);if(/right|left/.test(a)){var h=b.top-f-g.scroll,i=b.top+f-g.scroll+d;h<g.top?e.top=g.top-h:i>g.top+g.height&&(e.top=g.top+g.height-i)}else{var j=b.left-f,k=b.left+f+c;j<g.left?e.left=g.left-j:k>g.width&&(e.left=g.left+g.width-k)}return e},c.prototype.getTitle=function(){var a,b=this.$element,c=this.options;return a=b.attr("data-original-title")||("function"==typeof c.title?c.title.call(b[0]):c.title)},c.prototype.getUID=function(a){do a+=~~(1e6*Math.random());while(document.getElementById(a));return a},c.prototype.tip=function(){return this.$tip=this.$tip||a(this.options.template)},c.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},c.prototype.validate=function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},c.prototype.enable=function(){this.enabled=!0},c.prototype.disable=function(){this.enabled=!1},c.prototype.toggleEnabled=function(){this.enabled=!this.enabled},c.prototype.toggle=function(b){var c=this;b&&(c=a(b.currentTarget).data("bs."+this.type),c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c))),c.tip().hasClass("in")?c.leave(c):c.enter(c)},c.prototype.destroy=function(){clearTimeout(this.timeout),this.hide().$element.off("."+this.type).removeData("bs."+this.type)};var d=a.fn.tooltip;a.fn.tooltip=b,a.fn.tooltip.Constructor=c,a.fn.tooltip.noConflict=function(){return a.fn.tooltip=d,this}}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.popover"),f="object"==typeof b&&b;(e||"destroy"!=b)&&(e||d.data("bs.popover",e=new c(this,f)),"string"==typeof b&&e[b]())})}var c=function(a,b){this.init("popover",a,b)};if(!a.fn.tooltip)throw new Error("Popover requires tooltip.js");c.VERSION="3.2.0",c.DEFAULTS=a.extend({},a.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),c.prototype=a.extend({},a.fn.tooltip.Constructor.prototype),c.prototype.constructor=c,c.prototype.getDefaults=function(){return c.DEFAULTS},c.prototype.setContent=function(){var a=this.tip(),b=this.getTitle(),c=this.getContent();a.find(".popover-title")[this.options.html?"html":"text"](b),a.find(".popover-content").empty()[this.options.html?"string"==typeof c?"html":"append":"text"](c),a.removeClass("fade top bottom left right in"),a.find(".popover-title").html()||a.find(".popover-title").hide()},c.prototype.hasContent=function(){return this.getTitle()||this.getContent()},c.prototype.getContent=function(){var a=this.$element,b=this.options;return a.attr("data-content")||("function"==typeof b.content?b.content.call(a[0]):b.content)},c.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")},c.prototype.tip=function(){return this.$tip||(this.$tip=a(this.options.template)),this.$tip};var d=a.fn.popover;a.fn.popover=b,a.fn.popover.Constructor=c,a.fn.popover.noConflict=function(){return a.fn.popover=d,this}}(jQuery),+function(a){"use strict";function b(c,d){var e=a.proxy(this.process,this);this.$body=a("body"),this.$scrollElement=a(a(c).is("body")?window:c),this.options=a.extend({},b.DEFAULTS,d),this.selector=(this.options.target||"")+" .nav li > a",this.offsets=[],this.targets=[],this.activeTarget=null,this.scrollHeight=0,this.$scrollElement.on("scroll.bs.scrollspy",e),this.refresh(),this.process()}function c(c){return this.each(function(){var d=a(this),e=d.data("bs.scrollspy"),f="object"==typeof c&&c;e||d.data("bs.scrollspy",e=new b(this,f)),"string"==typeof c&&e[c]()})}b.VERSION="3.2.0",b.DEFAULTS={offset:10},b.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)},b.prototype.refresh=function(){var b="offset",c=0;a.isWindow(this.$scrollElement[0])||(b="position",c=this.$scrollElement.scrollTop()),this.offsets=[],this.targets=[],this.scrollHeight=this.getScrollHeight();var d=this;this.$body.find(this.selector).map(function(){var d=a(this),e=d.data("target")||d.attr("href"),f=/^#./.test(e)&&a(e);return f&&f.length&&f.is(":visible")&&[[f[b]().top+c,e]]||null}).sort(function(a,b){return a[0]-b[0]}).each(function(){d.offsets.push(this[0]),d.targets.push(this[1])})},b.prototype.process=function(){var a,b=this.$scrollElement.scrollTop()+this.options.offset,c=this.getScrollHeight(),d=this.options.offset+c-this.$scrollElement.height(),e=this.offsets,f=this.targets,g=this.activeTarget;if(this.scrollHeight!=c&&this.refresh(),b>=d)return g!=(a=f[f.length-1])&&this.activate(a);if(g&&b<=e[0])return g!=(a=f[0])&&this.activate(a);for(a=e.length;a--;)g!=f[a]&&b>=e[a]&&(!e[a+1]||b<=e[a+1])&&this.activate(f[a])},b.prototype.activate=function(b){this.activeTarget=b,a(this.selector).parentsUntil(this.options.target,".active").removeClass("active");var c=this.selector+'[data-target="'+b+'"],'+this.selector+'[href="'+b+'"]',d=a(c).parents("li").addClass("active");d.parent(".dropdown-menu").length&&(d=d.closest("li.dropdown").addClass("active")),d.trigger("activate.bs.scrollspy")};var d=a.fn.scrollspy;a.fn.scrollspy=c,a.fn.scrollspy.Constructor=b,a.fn.scrollspy.noConflict=function(){return a.fn.scrollspy=d,this},a(window).on("load.bs.scrollspy.data-api",function(){a('[data-spy="scroll"]').each(function(){var b=a(this);c.call(b,b.data())})})}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.tab");e||d.data("bs.tab",e=new c(this)),"string"==typeof b&&e[b]()})}var c=function(b){this.element=a(b)};c.VERSION="3.2.0",c.prototype.show=function(){var b=this.element,c=b.closest("ul:not(.dropdown-menu)"),d=b.data("target");if(d||(d=b.attr("href"),d=d&&d.replace(/.*(?=#[^\s]*$)/,"")),!b.parent("li").hasClass("active")){var e=c.find(".active:last a")[0],f=a.Event("show.bs.tab",{relatedTarget:e});if(b.trigger(f),!f.isDefaultPrevented()){var g=a(d);this.activate(b.closest("li"),c),this.activate(g,g.parent(),function(){b.trigger({type:"shown.bs.tab",relatedTarget:e})})}}},c.prototype.activate=function(b,c,d){function e(){f.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),b.addClass("active"),g?(b[0].offsetWidth,b.addClass("in")):b.removeClass("fade"),b.parent(".dropdown-menu")&&b.closest("li.dropdown").addClass("active"),d&&d()}var f=c.find("> .active"),g=d&&a.support.transition&&f.hasClass("fade");g?f.one("bsTransitionEnd",e).emulateTransitionEnd(150):e(),f.removeClass("in")};var d=a.fn.tab;a.fn.tab=b,a.fn.tab.Constructor=c,a.fn.tab.noConflict=function(){return a.fn.tab=d,this},a(document).on("click.bs.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(c){c.preventDefault(),b.call(a(this),"show")})}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.affix"),f="object"==typeof b&&b;e||d.data("bs.affix",e=new c(this,f)),"string"==typeof b&&e[b]()})}var c=function(b,d){this.options=a.extend({},c.DEFAULTS,d),this.$target=a(this.options.target).on("scroll.bs.affix.data-api",a.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",a.proxy(this.checkPositionWithEventLoop,this)),this.$element=a(b),this.affixed=this.unpin=this.pinnedOffset=null,this.checkPosition()};c.VERSION="3.2.0",c.RESET="affix affix-top affix-bottom",c.DEFAULTS={offset:0,target:window},c.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(c.RESET).addClass("affix");var a=this.$target.scrollTop(),b=this.$element.offset();return this.pinnedOffset=b.top-a},c.prototype.checkPositionWithEventLoop=function(){setTimeout(a.proxy(this.checkPosition,this),1)},c.prototype.checkPosition=function(){if(this.$element.is(":visible")){var b=a(document).height(),d=this.$target.scrollTop(),e=this.$element.offset(),f=this.options.offset,g=f.top,h=f.bottom;"object"!=typeof f&&(h=g=f),"function"==typeof g&&(g=f.top(this.$element)),"function"==typeof h&&(h=f.bottom(this.$element));var i=null!=this.unpin&&d+this.unpin<=e.top?!1:null!=h&&e.top+this.$element.height()>=b-h?"bottom":null!=g&&g>=d?"top":!1;if(this.affixed!==i){null!=this.unpin&&this.$element.css("top","");var j="affix"+(i?"-"+i:""),k=a.Event(j+".bs.affix");this.$element.trigger(k),k.isDefaultPrevented()||(this.affixed=i,this.unpin="bottom"==i?this.getPinnedOffset():null,this.$element.removeClass(c.RESET).addClass(j).trigger(a.Event(j.replace("affix","affixed"))),"bottom"==i&&this.$element.offset({top:b-this.$element.height()-h}))}}};var d=a.fn.affix;a.fn.affix=b,a.fn.affix.Constructor=c,a.fn.affix.noConflict=function(){return a.fn.affix=d,this},a(window).on("load",function(){a('[data-spy="affix"]').each(function(){var c=a(this),d=c.data();d.offset=d.offset||{},d.offsetBottom&&(d.offset.bottom=d.offsetBottom),d.offsetTop&&(d.offset.top=d.offsetTop),b.call(c,d)})})}(jQuery);;;!function(e,n,t){var o=e();e.fn.dropdownHover=function(t){return"ontouchstart"in document?this:(o=o.add(this.parent()),this.each(function(){function r(e){d.parents(".navbar").find(".navbar-toggle").is(":visible")||(n.clearTimeout(a),n.clearTimeout(i),i=n.setTimeout(function(){o.find(":focus").blur(),f.instantlyCloseOthers===!0&&o.removeClass("open"),n.clearTimeout(i),d.attr("aria-expanded","true"),s.addClass("open"),d.trigger(h)},f.hoverDelay))}var a,i,d=e(this),s=d.parent(),l={delay:500,hoverDelay:0,instantlyCloseOthers:!0},u={delay:e(this).data("delay"),hoverDelay:e(this).data("hover-delay"),instantlyCloseOthers:e(this).data("close-others")},h="show.bs.dropdown",c="hide.bs.dropdown",f=e.extend(!0,{},l,t,u);s.hover(function(e){return s.hasClass("open")||d.is(e.target)?void r(e):!0},function(){n.clearTimeout(i),a=n.setTimeout(function(){d.attr("aria-expanded","false"),s.removeClass("open"),d.trigger(c)},f.delay)}),d.hover(function(e){return s.hasClass("open")||s.is(e.target)?void r(e):!0}),d.click(function(e){var t=d.attr("href"),o=d.attr("target");"#"!=t&&("_blank"==o?n.open(t,"_blank"):n.location.href=t)}),s.find(".dropdown-submenu").each(function(){var t,o=e(this);o.hover(function(){n.clearTimeout(t),o.children(".dropdown-menu").show(),o.siblings().children(".dropdown-menu").hide()},function(){var e=o.children(".dropdown-menu");t=n.setTimeout(function(){e.hide()},f.delay)})})}))},e(document).ready(function(){e('[data-hover="dropdown"]').dropdownHover()})}(jQuery,window);;;!function(e){function n(n,s,t){if(t)return"object"!=typeof n&&(n={}),n;n=e.extend(!0,{},e[a].defaults,n);for(var i=["position","zposition","modal","moveBackground"],o=0,l=i.length;l>o;o++)"undefined"!=typeof n[i[o]]&&(e[a].deprecated('The option "'+i[o]+'"',"offCanvas."+i[o]),n.offCanvas=n.offCanvas||{},n.offCanvas[i[o]]=n[i[o]]);return n}function s(n){n=e.extend(!0,{},e[a].configuration,n);for(var s=["panel","list","selected","label","spacer"],t=0,i=s.length;i>t;t++)"undefined"!=typeof n[s[t]+"Class"]&&(e[a].deprecated('The configuration option "'+s[t]+'Class"',"classNames."+s[t]),n.classNames[s[t]]=n[s[t]+"Class"]);if("undefined"!=typeof n.counterClass&&(e[a].deprecated('The configuration option "counterClass"',"classNames.counters.counter"),n.classNames.counters=n.classNames.counters||{},n.classNames.counters.counter=n.counterClass),"undefined"!=typeof n.collapsedClass&&(e[a].deprecated('The configuration option "collapsedClass"',"classNames.labels.collapsed"),n.classNames.labels=n.classNames.labels||{},n.classNames.labels.collapsed=n.collapsedClass),"undefined"!=typeof n.header)for(var s=["panelHeader","panelNext","panelPrev"],t=0,i=s.length;i>t;t++)"undefined"!=typeof n.header[s[t]+"Class"]&&(e[a].deprecated('The configuration option "header.'+s[t]+'Class"',"classNames.header."+s[t]),n.classNames.header=n.classNames.header||{},n.classNames.header[s[t]]=n.header[s[t]+"Class"]);for(var s=["pageNodetype","pageSelector","menuWrapperSelector","menuInjectMethod"],t=0,i=s.length;i>t;t++)"undefined"!=typeof n[s[t]]&&(e[a].deprecated('The configuration option "'+s[t]+'"',"offCanvas."+s[t]),n.offCanvas=n.offCanvas||{},n.offCanvas[s[t]]=n[s[t]]);return n}function t(){r=!0,c.$wndw=e(window),c.$html=e("html"),c.$body=e("body"),e.each([o,l,d],function(e,n){n.add=function(e){e=e.split(" ");for(var s in e)n[e[s]]=n.mm(e[s])}}),o.mm=function(e){return"mm-"+e},o.add("wrapper menu inline panel nopanel list nolist subtitle selected label spacer current highest hidden opened subopened subopen fullsubopen subclose"),o.umm=function(e){return"mm-"==e.slice(0,3)&&(e=e.slice(3)),e},l.mm=function(e){return"mm-"+e},l.add("parent"),d.mm=function(e){return e+".mm"},d.add("toggle open close setSelected transitionend webkitTransitionEnd mousedown mouseup touchstart touchmove touchend scroll resize click keydown keyup"),e[a]._c=o,e[a]._d=l,e[a]._e=d,e[a].glbl=c}var a="mmenu",i="4.5.5";if(!e[a]){var o={},l={},d={},r=!1,c={$wndw:null,$html:null,$body:null};e[a]=function(e,s,t){return this.$menu=e,this.opts=s,this.conf=t,this.vars={},this.opts=n(this.opts,this.conf,this.$menu),this._initMenu(),this._init(this.$menu.children(this.conf.panelNodetype)),this},e[a].version=i,e[a].addons=[],e[a].uniqueId=0,e[a].defaults={classes:"",slidingSubmenus:!0,onClick:{setSelected:!0}},e[a].configuration={panelNodetype:"ul, ol, div",transitionDuration:400,openingInterval:25,classNames:{panel:"Panel",selected:"Selected",label:"Label",spacer:"Spacer"}},e[a].prototype={_init:function(n){n=n.not("."+o.nopanel),n=this._initPanels(n),n=this._initLinks(n),n=this._bindCustomEvents(n);for(var s=0;s<e[a].addons.length;s++)"function"==typeof this["_init_"+e[a].addons[s]]&&this["_init_"+e[a].addons[s]](n);this._update()},_initMenu:function(){this.opts.offCanvas&&this.conf.clone&&(this.$menu=this.$menu.clone(!0),this.$menu.add(this.$menu.find("*")).filter("[id]").each(function(){e(this).attr("id",o.mm(e(this).attr("id")))})),this.$menu.contents().each(function(){3==e(this)[0].nodeType&&e(this).remove()}),this.$menu.parent().addClass(o.wrapper);var n=[o.menu];n.push(o.mm(this.opts.slidingSubmenus?"horizontal":"vertical")),this.opts.classes&&n.push(this.opts.classes),this.$menu.addClass(n.join(" "))},_initPanels:function(n){var s=this;this.__findAddBack(n,"ul, ol").not("."+o.nolist).addClass(o.list);var t=this.__findAddBack(n,"."+o.list).find("> li");this.__refactorClass(t,this.conf.classNames.selected,"selected"),this.__refactorClass(t,this.conf.classNames.label,"label"),this.__refactorClass(t,this.conf.classNames.spacer,"spacer"),t.off(d.setSelected).on(d.setSelected,function(n,s){n.stopPropagation(),t.removeClass(o.selected),"boolean"!=typeof s&&(s=!0),s&&e(this).addClass(o.selected)}),this.__refactorClass(this.__findAddBack(n,"."+this.conf.classNames.panel),this.conf.classNames.panel,"panel"),n.add(this.__findAddBack(n,"."+o.list).children().children().filter(this.conf.panelNodetype).not("."+o.nopanel)).addClass(o.panel);var a=this.__findAddBack(n,"."+o.panel),i=e("."+o.panel,this.$menu);a.each(function(){var n=e(this),t=n.attr("id")||s.__getUniqueId();n.attr("id",t)}),a.each(function(){var n=e(this),t=n.is("ul, ol")?n:n.find("ul ,ol").first(),a=n.parent(),i=a.find("> a, > span"),d=a.closest("."+o.panel);if(a.parent().is("."+o.list)){n.data(l.parent,a);var r=e('<a class="'+o.subopen+'" href="#'+n.attr("id")+'" />').insertBefore(i);i.is("a")||r.addClass(o.fullsubopen),s.opts.slidingSubmenus&&t.prepend('<li class="'+o.subtitle+'"><a class="'+o.subclose+'" href="#'+d.attr("id")+'">'+i.text()+"</a></li>")}});var r=this.opts.slidingSubmenus?d.open:d.toggle;if(i.each(function(){var n=e(this),s=n.attr("id");e('a[href="#'+s+'"]',i).off(d.click).on(d.click,function(e){e.preventDefault(),n.trigger(r)})}),this.opts.slidingSubmenus){var c=this.__findAddBack(n,"."+o.list).find("> li."+o.selected);c.parents("li").removeClass(o.selected).end().add(c.parents("li")).each(function(){var n=e(this),s=n.find("> ."+o.panel);s.length&&(n.parents("."+o.panel).addClass(o.subopened),s.addClass(o.opened))}).closest("."+o.panel).addClass(o.opened).parents("."+o.panel).addClass(o.subopened)}else{var c=e("li."+o.selected,i);c.parents("li").removeClass(o.selected).end().add(c.parents("li")).addClass(o.opened)}var u=i.filter("."+o.opened);return u.length||(u=a.first()),u.addClass(o.opened).last().addClass(o.current),this.opts.slidingSubmenus&&a.not(u.last()).addClass(o.hidden).end().appendTo(this.$menu),a},_initLinks:function(n){var s=this;return this.__findAddBack(n,"."+o.list).find("> li > a").not("."+o.subopen).not("."+o.subclose).not('[rel="external"]').not('[target="_blank"]').off(d.click).on(d.click,function(n){var t=e(this),a=t.attr("href")||"";s.__valueOrFn(s.opts.onClick.setSelected,t)&&t.parent().trigger(d.setSelected);var i=s.__valueOrFn(s.opts.onClick.preventDefault,t,"#"==a.slice(0,1));i&&n.preventDefault(),s.__valueOrFn(s.opts.onClick.blockUI,t,!i)&&c.$html.addClass(o.blocking),s.__valueOrFn(s.opts.onClick.close,t,i)&&s.$menu.triggerHandler(d.close)}),n},_bindCustomEvents:function(n){var s=this;return n.off(d.toggle+" "+d.open+" "+d.close).on(d.toggle+" "+d.open+" "+d.close,function(e){e.stopPropagation()}),this.opts.slidingSubmenus?n.on(d.open,function(){return s._openSubmenuHorizontal(e(this))}):n.on(d.toggle,function(){var n=e(this);return n.triggerHandler(n.parent().hasClass(o.opened)?d.close:d.open)}).on(d.open,function(){return e(this).parent().addClass(o.opened),"open"}).on(d.close,function(){return e(this).parent().removeClass(o.opened),"close"}),n},_openSubmenuHorizontal:function(n){if(n.hasClass(o.current))return!1;var s=e("."+o.panel,this.$menu),t=s.filter("."+o.current);return s.removeClass(o.highest).removeClass(o.current).not(n).not(t).addClass(o.hidden),n.hasClass(o.opened)?t.addClass(o.highest).removeClass(o.opened).removeClass(o.subopened):(n.addClass(o.highest),t.addClass(o.subopened)),n.removeClass(o.hidden).addClass(o.current),setTimeout(function(){n.removeClass(o.subopened).addClass(o.opened)},this.conf.openingInterval),"open"},_update:function(e){if(this.updates||(this.updates=[]),"function"==typeof e)this.updates.push(e);else for(var n=0,s=this.updates.length;s>n;n++)this.updates[n].call(this,e)},__valueOrFn:function(e,n,s){return"function"==typeof e?e.call(n[0]):"undefined"==typeof e&&"undefined"!=typeof s?s:e},__refactorClass:function(e,n,s){e.filter("."+n).removeClass(n).addClass(o[s])},__findAddBack:function(e,n){return e.find(n).add(e.filter(n))},__transitionend:function(e,n,s){var t=!1,a=function(){t||n.call(e[0]),t=!0};e.one(d.transitionend,a),e.one(d.webkitTransitionEnd,a),setTimeout(a,1.1*s)},__getUniqueId:function(){return o.mm(e[a].uniqueId++)}},e.fn[a]=function(i,o){return r||t(),i=n(i,o),o=s(o),this.each(function(){var n=e(this);n.data(a)||n.data(a,new e[a](n,i,o))})},e[a].support={touch:"ontouchstart"in window.document},e[a].debug=function(){},e[a].deprecated=function(e,n){"undefined"!=typeof console&&"undefined"!=typeof console.warn&&console.warn("MMENU: "+e+" is deprecated, use "+n+" instead.")}}}(jQuery);!function(e){function o(o){return("top"==o.position||"bottom"==o.position)&&("back"==o.zposition||"next"==o.zposition)&&(e[s].deprecated('Using position "'+o.position+'" in combination with zposition "'+o.zposition+'"','zposition "front"'),o.zposition="front"),o}function t(e){return"string"!=typeof e.pageSelector&&(e.pageSelector="> "+e.pageNodetype),e}function n(){c=!0,p=e[s]._c,a=e[s]._d,r=e[s]._e,p.add("offcanvas modal background opening blocker page"),a.add("style"),r.add("opening opened closing closed setPage"),l=e[s].glbl,l.$allMenus=(l.$allMenus||e()).add(this.$menu),l.$wndw.on(r.keydown,function(e){return l.$html.hasClass(p.opened)&&9==e.keyCode?(e.preventDefault(),!1):void 0});var o=0;l.$wndw.on(r.resize,function(e,t){if(t||l.$html.hasClass(p.opened)){var n=l.$wndw.height();(t||n!=o)&&(o=n,l.$page.css("minHeight",n))}})}var s="mmenu",i="offCanvas";e[s].prototype["_init_"+i]=function(){if(this.opts[i]&&!this.vars[i+"_added"]){this.vars[i+"_added"]=!0,c||n(),this.opts[i]=o(this.opts[i]),this.conf[i]=t(this.conf[i]);var e=this.opts[i],s=this.conf[i],a=[p.offcanvas];"boolean"!=typeof this.vars.opened&&(this.vars.opened=!1),"left"!=e.position&&a.push(p.mm(e.position)),"back"!=e.zposition&&a.push(p.mm(e.zposition)),this.$menu.addClass(a.join(" ")).parent().removeClass(p.wrapper),this[i+"_initPage"](l.$page),this[i+"_initBlocker"](),this[i+"_initOpenClose"](),this[i+"_bindCustomEvents"](),this.$menu[s.menuInjectMethod+"To"](s.menuWrapperSelector)}},e[s].addons.push(i),e[s].defaults[i]={position:"left",zposition:"back",modal:!1,moveBackground:!0},e[s].configuration[i]={pageNodetype:"div",pageSelector:null,menuWrapperSelector:"body",menuInjectMethod:"prepend"},e[s].prototype.open=function(){if(this.vars.opened)return!1;var e=this;return this._openSetup(),setTimeout(function(){e._openFinish()},this.conf.openingInterval),"open"},e[s].prototype._openSetup=function(){l.$allMenus.not(this.$menu).trigger(r.close),l.$page.data(a.style,l.$page.attr("style")||""),l.$wndw.trigger(r.resize,[!0]);var e=[p.opened];this.opts[i].modal&&e.push(p.modal),this.opts[i].moveBackground&&e.push(p.background),"left"!=this.opts[i].position&&e.push(p.mm(this.opts[i].position)),"back"!=this.opts[i].zposition&&e.push(p.mm(this.opts[i].zposition)),this.opts.classes&&e.push(this.opts.classes),l.$html.addClass(e.join(" ")),this.vars.opened=!0,this.$menu.addClass(p.current+" "+p.opened)},e[s].prototype._openFinish=function(){var e=this;this.__transitionend(l.$page,function(){e.$menu.trigger(r.opened)},this.conf.transitionDuration),l.$html.addClass(p.opening),this.$menu.trigger(r.opening)},e[s].prototype.close=function(){if(!this.vars.opened)return!1;var e=this;return this.__transitionend(l.$page,function(){e.$menu.removeClass(p.current).removeClass(p.opened),l.$html.removeClass(p.opened).removeClass(p.modal).removeClass(p.background).removeClass(p.mm(e.opts[i].position)).removeClass(p.mm(e.opts[i].zposition)),e.opts.classes&&l.$html.removeClass(e.opts.classes),l.$page.attr("style",l.$page.data(a.style)),e.vars.opened=!1,e.$menu.trigger(r.closed)},this.conf.transitionDuration),l.$html.removeClass(p.opening),this.$menu.trigger(r.closing),"close"},e[s].prototype[i+"_initBlocker"]=function(){var o=this;l.$blck||(l.$blck=e('<div id="'+p.blocker+'" />').appendTo(l.$body)),l.$blck.off(r.touchstart).on(r.touchstart,function(e){e.preventDefault(),e.stopPropagation(),l.$blck.trigger(r.mousedown)}).on(r.mousedown,function(e){e.preventDefault(),l.$html.hasClass(p.modal)||o.close()})},e[s].prototype[i+"_initPage"]=function(o){o||(o=e(this.conf[i].pageSelector,l.$body),o.length>1&&(e[s].debug("Multiple nodes found for the page-node, all nodes are wrapped in one <"+this.conf[i].pageNodetype+">."),o=o.wrapAll("<"+this.conf[i].pageNodetype+" />").parent())),o.addClass(p.page),l.$page=o},e[s].prototype[i+"_initOpenClose"]=function(){var o=this,t=this.$menu.attr("id");t&&t.length&&(this.conf.clone&&(t=p.umm(t)),e('a[href="#'+t+'"]').off(r.click).on(r.click,function(e){e.preventDefault(),o.open()}));var t=l.$page.attr("id");t&&t.length&&e('a[href="#'+t+'"]').on(r.click,function(e){e.preventDefault(),o.close()})},e[s].prototype[i+"_bindCustomEvents"]=function(){var e=this,o=r.open+" "+r.opening+" "+r.opened+" "+r.close+" "+r.closing+" "+r.closed+" "+r.setPage;this.$menu.off(o).on(o,function(e){e.stopPropagation()}),this.$menu.on(r.open,function(){e.open()}).on(r.close,function(){e.close()}).on(r.setPage,function(o,t){e[i+"_initPage"](t),e[i+"_initOpenClose"]()})};var p,a,r,l,c=!1}(jQuery);!function(t){function n(t){return t}function a(t){return t}function i(){d=!0,o=t[r]._c,e=t[r]._d,u=t[r]._e,o.add("buttonbar"),c=t[r].glbl}var r="mmenu",s="buttonbars";t[r].prototype["_init_"+s]=function(r){d||i();var e=this.vars[s+"_added"];this.vars[s+"_added"]=!0,e||(this.opts[s]=n(this.opts[s]),this.conf[s]=a(this.conf[s])),this.opts[s],this.conf[s],this.__refactorClass(t("div",r),this.conf.classNames[s].buttonbar,"buttonbar"),t("div."+o.buttonbar,r).each(function(){var n=t(this),a=n.children().not("input"),i=n.children().filter("input");n.addClass(o.buttonbar+"-"+a.length),i.each(function(){var n=t(this),i=a.filter('label[for="'+n.attr("id")+'"]');i.length&&n.insertBefore(i)})})},t[r].addons.push(s),t[r].defaults[s]={},t[r].configuration.classNames[s]={buttonbar:"Buttonbar"};var o,e,u,c,d=!1}(jQuery);!function(t){function e(e){return"boolean"==typeof e&&(e={add:e,update:e}),"object"!=typeof e&&(e={}),e=t.extend(!0,{},t[o].defaults[s],e)}function n(t){return t}function a(){i=!0,d=t[o]._c,r=t[o]._d,u=t[o]._e,d.add("counter search noresultsmsg"),r.add("updatecounter"),c=t[o].glbl}var o="mmenu",s="counters";t[o].prototype["_init_"+s]=function(o){i||a();var u=this.vars[s+"_added"];this.vars[s+"_added"]=!0,u||(this.opts[s]=e(this.opts[s]),this.conf[s]=n(this.conf[s]));var c=this,h=this.opts[s];this.conf[s],this.__refactorClass(t("em",o),this.conf.classNames[s].counter,"counter"),h.add&&o.each(function(){var e=t(this).data(r.parent);e&&(e.find("> em."+d.counter).length||e.prepend(t('<em class="'+d.counter+'" />')))}),h.update&&o.each(function(){var e=t(this),n=e.data(r.parent);if(n){var a=n.find("> em."+d.counter);a.length&&(e.is("."+d.list)||(e=e.find("> ."+d.list)),e.length&&!e.data(r.updatecounter)&&(e.data(r.updatecounter,!0),c._update(function(){var t=e.children().not("."+d.label).not("."+d.subtitle).not("."+d.hidden).not("."+d.search).not("."+d.noresultsmsg);a.html(t.length)})))}})},t[o].addons.push(s),t[o].defaults[s]={add:!1,update:!1},t[o].configuration.classNames[s]={counter:"Counter"};var d,r,u,c,i=!1}(jQuery);!function(e){function t(e,t,n){return t>e&&(e=t),e>n&&(e=n),e}function n(t){return"boolean"==typeof t&&(t={open:t}),"object"!=typeof t&&(t={}),t=e.extend(!0,{},e[s].defaults[i],t)}function o(e){return e}function a(){c=!0,r=e[s]._c,p=e[s]._d,f=e[s]._e,r.add("dragging"),d=e[s].glbl}var s="mmenu",i="dragOpen";e[s].prototype["_init_"+i]=function(){if("function"==typeof Hammer&&this.opts.offCanvas&&!this.vars[i+"_added"]){this.vars[i+"_added"]=!0,c||a(),this.opts[i]=n(this.opts[i]),this.conf[i]=o(this.conf[i]);var p=this,h=this.opts[i],m=this.conf[i];if(h.open){if(Hammer.VERSION<2)return e[s].deprecated("Older version of the Hammer library","version 2 or newer"),!1;var u,g,l,v,_={},w=0,b=!1,y=!1,$=0,x=0;switch(this.opts.offCanvas.position){case"left":case"right":_.events="panleft panright",_.typeLower="x",_.typeUpper="X",y="width";break;case"top":case"bottom":_.events="panup pandown",_.typeLower="y",_.typeUpper="Y",y="height"}switch(this.opts.offCanvas.position){case"left":case"top":_.negative=!1;break;case"right":case"bottom":_.negative=!0}switch(this.opts.offCanvas.position){case"left":_.open_dir="right",_.close_dir="left";break;case"right":_.open_dir="left",_.close_dir="right";break;case"top":_.open_dir="down",_.close_dir="up";break;case"bottom":_.open_dir="up",_.close_dir="down"}var C=this.__valueOrFn(h.pageNode,this.$menu,d.$page);"string"==typeof C&&(C=e(C));var k=d.$page;switch(this.opts.offCanvas.zposition){case"front":k=this.$menu;break;case"next":k=k.add(this.$menu)}var S=new Hammer(C[0]);S.on("panstart",function(e){switch(v=e.center[_.typeLower],p.opts.offCanvas.position){case"right":case"bottom":v>=d.$wndw[y]()-h.maxStartPos&&(w=1);break;default:v<=h.maxStartPos&&(w=1)}b=_.open_dir}).on(_.events+" panend",function(e){w>0&&e.preventDefault()}).on(_.events,function(e){if(u=e["delta"+_.typeUpper],_.negative&&(u=-u),u!=$&&(b=u>=$?_.open_dir:_.close_dir),$=u,$>h.threshold&&1==w){if(d.$html.hasClass(r.opened))return;w=2,p._openSetup(),p.$menu.trigger(f.opening),d.$html.addClass(r.dragging),x=t(d.$wndw[y]()*m[y].perc,m[y].min,m[y].max)}2==w&&(g=t($,10,x)-("front"==p.opts.offCanvas.zposition?x:0),_.negative&&(g=-g),l="translate"+_.typeUpper+"("+g+"px )",k.css({"-webkit-transform":"-webkit-"+l,transform:l}))}).on("panend",function(){2==w&&(d.$html.removeClass(r.dragging),k.css("transform",""),p[b==_.open_dir?"_openFinish":"close"]()),w=0})}}},e[s].addons.push(i),e[s].defaults[i]={open:!1,maxStartPos:100,threshold:50},e[s].configuration[i]={width:{perc:.8,min:140,max:440},height:{perc:.8,min:140,max:880}};var r,p,f,d,c=!1}(jQuery);!function(t){function s(t){return t}function o(t){return t}function n(){c=!0,e=t[i]._c,f=t[i]._d,r=t[i]._e,e.add("fixed-top fixed-bottom"),d=t[i].glbl}var i="mmenu",a="fixedElements";t[i].prototype["_init_"+a]=function(){if(this.opts.offCanvas){c||n();var i=this.vars[a+"_added"];if(this.vars[a+"_added"]=!0,i||(this.opts[a]=s(this.opts[a]),this.conf[a]=o(this.conf[a])),this.opts[a],this.conf[a],this.__refactorClass(t("div, span, a",d.$page),this.conf.classNames[a].fixedTop,"fixed-top"),this.__refactorClass(t("div, span, a",d.$page),this.conf.classNames[a].fixedBottom,"fixed-bottom"),!i){var f,p;this.$menu.on(r.opening,function(){var s=t(window).scrollTop(),o=d.$page.height()-s-d.$wndw.height();f=t("."+e["fixed-top"]),p=t("."+e["fixed-bottom"]),f.css({"-webkit-transform":"translateY( "+s+"px )",transform:"translateY( "+s+"px )"}),p.css({"-webkit-transform":"translateY( -"+o+"px )",transform:"translateY( -"+o+"px )"})}).on(r.closed,function(){f.add(p).css({"-webkit-transform":"none",transform:"none"})})}}},t[i].addons.push(a),t[i].defaults[a]={},t[i].configuration.classNames[a]={fixedTop:"FixedTop",fixedBottom:"FixedBottom"};var e,f,r,d,c=!1}(jQuery);!function(t){function o(o){return"boolean"==typeof o&&(o={add:o,update:o}),"object"!=typeof o&&(o={}),o=t.extend(!0,{},t[a].defaults[s],o)}function n(t){return t}function e(){h=!0,i=t[a]._c,d=t[a]._d,r=t[a]._e,i.add("footer hasfooter"),f=t[a].glbl}var a="mmenu",s="footer";t[a].prototype["_init_"+s]=function(a){h||e();var d=this.vars[s+"_added"];this.vars[s+"_added"]=!0,d||(this.opts[s]=o(this.opts[s]),this.conf[s]=n(this.conf[s]));var f=this,u=this.opts[s];if(this.conf[s],!d&&u.add){var c=u.content?u.content:u.title;t('<div class="'+i.footer+'" />').appendTo(this.$menu).append(c)}var p=t("div."+i.footer,this.$menu);p.length&&(this.$menu.addClass(i.hasfooter),u.update&&a.each(function(){var o=t(this),n=t("."+f.conf.classNames[s].panelFooter,o),e=n.html();e||(e=u.title);var a=function(){p[e?"show":"hide"](),p.html(e)};o.on(r.open,a),o.hasClass(i.current)&&a()}),"function"==typeof this._init_buttonbars&&this._init_buttonbars(p))},t[a].addons.push(s),t[a].defaults[s]={add:!1,content:!1,title:"",update:!1},t[a].configuration.classNames[s]={panelFooter:"Footer"};var i,d,r,f,h=!1}(jQuery);!function(e){function t(t){return"boolean"==typeof t&&(t={add:t,update:t}),"object"!=typeof t&&(t={}),t=e.extend(!0,{},e[s].defaults[r],t)}function a(e){return e}function n(){l=!0,i=e[s]._c,o=e[s]._d,h=e[s]._e,i.add("header hasheader prev next title"),d=e[s].glbl}var s="mmenu",r="header";e[s].prototype["_init_"+r]=function(s){l||n();var o=this.vars[r+"_added"];this.vars[r+"_added"]=!0,o||(this.opts[r]=t(this.opts[r]),this.conf[r]=a(this.conf[r]));var c=this,f=this.opts[r];if(this.conf[r],!o&&f.add){var p=f.content?f.content:'<a class="'+i.prev+'" href="#"></a><span class="'+i.title+'"></span><a class="'+i.next+'" href="#"></a>';e('<div class="'+i.header+'" />').prependTo(this.$menu).append(p)}var u=e("div."+i.header,this.$menu);if(u.length){if(this.$menu.addClass(i.hasheader),f.update){var v=u.find("."+i.title),m=u.find("."+i.prev),_=u.find("."+i.next),g=!1;d.$page&&(g="#"+d.$page.attr("id")),o||m.add(_).off(h.click).on(h.click,function(t){t.preventDefault(),t.stopPropagation();var a=e(this).attr("href");"#"!==a&&(g&&a==g?c.$menu.trigger(h.close):e(a,c.$menu).trigger(h.open))}),s.each(function(){var t=e(this),a=e("."+c.conf.classNames[r].panelHeader,t),n=e("."+c.conf.classNames[r].panelPrev,t),s=e("."+c.conf.classNames[r].panelNext,t),o=a.html(),d=n.attr("href"),l=s.attr("href");o||(o=e("."+i.subclose,t).html()),o||(o=f.title),d||(d=e("."+i.subclose,t).attr("href"));var p=n.html(),u=s.html(),g=function(){v[o?"show":"hide"](),v.html(o),m[d?"attr":"removeAttr"]("href",d),m[d||p?"show":"hide"](),m.html(p),_[l?"attr":"removeAttr"]("href",l),_[l||u?"show":"hide"](),_.html(u)};t.on(h.open,g),t.hasClass(i.current)&&g()})}"function"==typeof this._init_buttonbars&&this._init_buttonbars(u)}},e[s].addons.push(r),e[s].defaults[r]={add:!1,content:!1,title:"Menu",update:!1},e[s].configuration.classNames[r]={panelHeader:"Header",panelNext:"Next",panelPrev:"Prev"};var i,o,h,d,l=!1}(jQuery);!function(l){function a(a){return"boolean"==typeof a&&(a={collapse:a}),"object"!=typeof a&&(a={}),a=l.extend(!0,{},l[o].defaults[t],a)}function e(l){return l}function s(){i=!0,n=l[o]._c,d=l[o]._d,c=l[o]._e,n.add("collapsed"),d.add("updatelabel"),p=l[o].glbl}var o="mmenu",t="labels";l[o].prototype["_init_"+t]=function(o){i||s();var p=this.vars[t+"_added"];this.vars[t+"_added"]=!0,p||(this.opts[t]=a(this.opts[t]),this.conf[t]=e(this.conf[t]));var u=this.opts[t];this.conf[t],u.collapse&&(this.__refactorClass(l("li",this.$menu),this.conf.classNames[t].collapsed,"collapsed"),l("."+n.label,o).each(function(){var a=l(this),e=a.nextUntil("."+n.label,"all"==u.collapse?null:"."+n.collapsed);"all"==u.collapse&&(a.addClass(n.opened),e.removeClass(n.collapsed)),e.length&&(a.data(d.updatelabel)||(a.data(d.updatelabel,!0),a.wrapInner("<span />"),a.prepend('<a href="#" class="'+n.subopen+" "+n.fullsubopen+'" />')),a.find("a."+n.subopen).off(c.click).on(c.click,function(l){l.preventDefault(),a.toggleClass(n.opened),e[a.hasClass(n.opened)?"removeClass":"addClass"](n.collapsed)}))}))},l[o].addons.push(t),l[o].defaults[t]={collapse:!1},l[o].configuration.classNames[t]={collapsed:"Collapsed"};var n,d,c,p,i=!1}(jQuery);!function(e){function s(e){switch(e){case 9:case 16:case 17:case 18:case 37:case 38:case 39:case 40:return!0}return!1}function n(s){return"boolean"==typeof s&&(s={add:s,search:s}),"object"!=typeof s&&(s={}),s=e.extend(!0,{},e[r].defaults[o],s),"boolean"!=typeof s.showLinksOnly&&(s.showLinksOnly="menu"==s.addTo),s}function t(e){return e}function a(){c=!0,i=e[r]._c,l=e[r]._d,d=e[r]._e,i.add("search hassearch noresultsmsg noresults nosubresults"),d.add("search reset change"),h=e[r].glbl}var r="mmenu",o="searchfield";e[r].prototype["_init_"+o]=function(r){c||a();var h=this.vars[o+"_added"];this.vars[o+"_added"]=!0,h||(this.opts[o]=n(this.opts[o]),this.conf[o]=t(this.conf[o]));var u=this,f=this.opts[o];if(this.conf[o],f.add){switch(f.addTo){case"menu":var p=this.$menu;break;case"panels":var p=r;break;default:var p=e(f.addTo,this.$menu).filter("."+i.panel)}p.length&&p.each(function(){var s=e(this),n=s.is("."+i.list)?"li":"div";if(!s.children(n+"."+i.search).length){if(s.is("."+i.menu))var t=u.$menu,a="prependTo";else var t=s.children().first(),a=t.is("."+i.subtitle)?"insertAfter":"insertBefore";e("<"+n+' class="'+i.search+'" />').append('<input placeholder="'+f.placeholder+'" type="text" autocomplete="off" />')[a](t)}f.noResults&&(s.is("."+i.menu)&&(s=s.children("."+i.panel).first()),n=s.is("."+i.list)?"li":"div",s.children(n+"."+i.noresultsmsg).length||e("<"+n+' class="'+i.noresultsmsg+'" />').html(f.noResults).appendTo(s))})}if(this.$menu.children("div."+i.search).length&&this.$menu.addClass(i.hassearch),f.search){var v=e("."+i.search,this.$menu);v.length&&v.each(function(){var n=e(this);if("menu"==f.addTo)var t=e("."+i.panel,u.$menu),a=u.$menu;else var t=n.closest("."+i.panel),a=t;var r=n.children("input"),o=u.__findAddBack(t,"."+i.list).children("li"),h=o.filter("."+i.label),c=o.not("."+i.subtitle).not("."+i.label).not("."+i.search).not("."+i.noresultsmsg),p="> a";f.showLinksOnly||(p+=", > span"),r.off(d.keyup+" "+d.change).on(d.keyup,function(e){s(e.keyCode)||n.trigger(d.search)}).on(d.change,function(){n.trigger(d.search)}),n.off(d.reset+" "+d.search).on(d.reset+" "+d.search,function(e){e.stopPropagation()}).on(d.reset,function(){n.trigger(d.search,[""])}).on(d.search,function(s,n){"string"==typeof n?r.val(n):n=r.val(),n=n.toLowerCase(),t.scrollTop(0),c.add(h).addClass(i.hidden),c.each(function(){var s=e(this);e(p,s).text().toLowerCase().indexOf(n)>-1&&s.add(s.prevAll("."+i.label).first()).removeClass(i.hidden)}),e(t.get().reverse()).each(function(s){var n=e(this),t=n.data(l.parent);if(t){var a=n.add(n.find("> ."+i.list)).find("> li").not("."+i.subtitle).not("."+i.search).not("."+i.noresultsmsg).not("."+i.label).not("."+i.hidden);a.length?t.removeClass(i.hidden).removeClass(i.nosubresults).prevAll("."+i.label).first().removeClass(i.hidden):"menu"==f.addTo&&(n.hasClass(i.opened)&&setTimeout(function(){t.trigger(d.open)},1.5*(s+1)*u.conf.openingInterval),t.addClass(i.nosubresults))}}),a[c.not("."+i.hidden).length?"removeClass":"addClass"](i.noresults),u._update()})})}},e[r].addons.push(o),e[r].defaults[o]={add:!1,addTo:"menu",search:!1,placeholder:"Search",noResults:"No results found."};var i,l,d,h,c=!1}(jQuery);!function(t){function e(t){return t}function s(t){return t}function c(){r=!0,n=t[i]._c,o=t[i]._d,l=t[i]._e,n.add("toggle check"),h=t[i].glbl}var i="mmenu",a="toggles";t[i].prototype["_init_"+a]=function(i){r||c();var o=this.vars[a+"_added"];this.vars[a+"_added"]=!0,o||(this.opts[a]=e(this.opts[a]),this.conf[a]=s(this.conf[a]));var l=this;this.opts[a],this.conf[a],this.__refactorClass(t("input",i),this.conf.classNames[a].toggle,"toggle"),this.__refactorClass(t("input",i),this.conf.classNames[a].check,"check"),t("input."+n.toggle,i).add("input."+n.check,i).each(function(){var e=t(this),s=e.closest("li"),c=e.hasClass(n.toggle)?"toggle":"check",i=e.attr("id")||l.__getUniqueId();s.children('label[for="'+i+'"]').length||(e.attr("id",i),s.prepend(e),t('<label for="'+i+'" class="'+n[c]+'"></label>').insertBefore(s.children().last()))})},t[i].addons.push(a),t[i].defaults[a]={},t[i].configuration.classNames[a]={toggle:"Toggle",check:"Check"};var n,o,l,h,r=!1}(jQuery);;;(function(a){function b(a,b,c){switch(arguments.length){case 2:return null!=a?a:b;case 3:return null!=a?a:null!=b?b:c;default:throw new Error("Implement me")}}function c(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function d(a,b){function c(){mb.suppressDeprecationWarnings===!1&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+a)}var d=!0;return j(function(){return d&&(c(),d=!1),b.apply(this,arguments)},b)}function e(a,b){return function(c){return m(a.call(this,c),b)}}function f(a,b){return function(c){return this.lang().ordinal(a.call(this,c),b)}}function g(){}function h(a){z(a),j(this,a)}function i(a){var b=s(a),c=b.year||0,d=b.quarter||0,e=b.month||0,f=b.week||0,g=b.day||0,h=b.hour||0,i=b.minute||0,j=b.second||0,k=b.millisecond||0;this._milliseconds=+k+1e3*j+6e4*i+36e5*h,this._days=+g+7*f,this._months=+e+3*d+12*c,this._data={},this._bubble()}function j(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return b.hasOwnProperty("toString")&&(a.toString=b.toString),b.hasOwnProperty("valueOf")&&(a.valueOf=b.valueOf),a}function k(a){var b,c={};for(b in a)a.hasOwnProperty(b)&&Ab.hasOwnProperty(b)&&(c[b]=a[b]);return c}function l(a){return 0>a?Math.ceil(a):Math.floor(a)}function m(a,b,c){for(var d=""+Math.abs(a),e=a>=0;d.length<b;)d="0"+d;return(e?c?"+":"":"-")+d}function n(a,b,c,d){var e=b._milliseconds,f=b._days,g=b._months;d=null==d?!0:d,e&&a._d.setTime(+a._d+e*c),f&&hb(a,"Date",gb(a,"Date")+f*c),g&&fb(a,gb(a,"Month")+g*c),d&&mb.updateOffset(a,f||g)}function o(a){return"[object Array]"===Object.prototype.toString.call(a)}function p(a){return"[object Date]"===Object.prototype.toString.call(a)||a instanceof Date}function q(a,b,c){var d,e=Math.min(a.length,b.length),f=Math.abs(a.length-b.length),g=0;for(d=0;e>d;d++)(c&&a[d]!==b[d]||!c&&u(a[d])!==u(b[d]))&&g++;return g+f}function r(a){if(a){var b=a.toLowerCase().replace(/(.)s$/,"$1");a=bc[a]||cc[b]||b}return a}function s(a){var b,c,d={};for(c in a)a.hasOwnProperty(c)&&(b=r(c),b&&(d[b]=a[c]));return d}function t(b){var c,d;if(0===b.indexOf("week"))c=7,d="day";else{if(0!==b.indexOf("month"))return;c=12,d="month"}mb[b]=function(e,f){var g,h,i=mb.fn._lang[b],j=[];if("number"==typeof e&&(f=e,e=a),h=function(a){var b=mb().utc().set(d,a);return i.call(mb.fn._lang,b,e||"")},null!=f)return h(f);for(g=0;c>g;g++)j.push(h(g));return j}}function u(a){var b=+a,c=0;return 0!==b&&isFinite(b)&&(c=b>=0?Math.floor(b):Math.ceil(b)),c}function v(a,b){return new Date(Date.UTC(a,b+1,0)).getUTCDate()}function w(a,b,c){return bb(mb([a,11,31+b-c]),b,c).week}function x(a){return y(a)?366:365}function y(a){return a%4===0&&a%100!==0||a%400===0}function z(a){var b;a._a&&-2===a._pf.overflow&&(b=a._a[tb]<0||a._a[tb]>11?tb:a._a[ub]<1||a._a[ub]>v(a._a[sb],a._a[tb])?ub:a._a[vb]<0||a._a[vb]>23?vb:a._a[wb]<0||a._a[wb]>59?wb:a._a[xb]<0||a._a[xb]>59?xb:a._a[yb]<0||a._a[yb]>999?yb:-1,a._pf._overflowDayOfYear&&(sb>b||b>ub)&&(b=ub),a._pf.overflow=b)}function A(a){return null==a._isValid&&(a._isValid=!isNaN(a._d.getTime())&&a._pf.overflow<0&&!a._pf.empty&&!a._pf.invalidMonth&&!a._pf.nullInput&&!a._pf.invalidFormat&&!a._pf.userInvalidated,a._strict&&(a._isValid=a._isValid&&0===a._pf.charsLeftOver&&0===a._pf.unusedTokens.length)),a._isValid}function B(a){return a?a.toLowerCase().replace("_","-"):a}function C(a,b){return b._isUTC?mb(a).zone(b._offset||0):mb(a).local()}function D(a,b){return b.abbr=a,zb[a]||(zb[a]=new g),zb[a].set(b),zb[a]}function E(a){delete zb[a]}function F(a){var b,c,d,e,f=0,g=function(a){if(!zb[a]&&Bb)try{require("./lang/"+a)}catch(b){}return zb[a]};if(!a)return mb.fn._lang;if(!o(a)){if(c=g(a))return c;a=[a]}for(;f<a.length;){for(e=B(a[f]).split("-"),b=e.length,d=B(a[f+1]),d=d?d.split("-"):null;b>0;){if(c=g(e.slice(0,b).join("-")))return c;if(d&&d.length>=b&&q(e,d,!0)>=b-1)break;b--}f++}return mb.fn._lang}function G(a){return a.match(/\[[\s\S]/)?a.replace(/^\[|\]$/g,""):a.replace(/\\/g,"")}function H(a){var b,c,d=a.match(Fb);for(b=0,c=d.length;c>b;b++)d[b]=hc[d[b]]?hc[d[b]]:G(d[b]);return function(e){var f="";for(b=0;c>b;b++)f+=d[b]instanceof Function?d[b].call(e,a):d[b];return f}}function I(a,b){return a.isValid()?(b=J(b,a.lang()),dc[b]||(dc[b]=H(b)),dc[b](a)):a.lang().invalidDate()}function J(a,b){function c(a){return b.longDateFormat(a)||a}var d=5;for(Gb.lastIndex=0;d>=0&&Gb.test(a);)a=a.replace(Gb,c),Gb.lastIndex=0,d-=1;return a}function K(a,b){var c,d=b._strict;switch(a){case"Q":return Rb;case"DDDD":return Tb;case"YYYY":case"GGGG":case"gggg":return d?Ub:Jb;case"Y":case"G":case"g":return Wb;case"YYYYYY":case"YYYYY":case"GGGGG":case"ggggg":return d?Vb:Kb;case"S":if(d)return Rb;case"SS":if(d)return Sb;case"SSS":if(d)return Tb;case"DDD":return Ib;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return Mb;case"a":case"A":return F(b._l)._meridiemParse;case"X":return Pb;case"Z":case"ZZ":return Nb;case"T":return Ob;case"SSSS":return Lb;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"ww":case"WW":return d?Sb:Hb;case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"W":case"e":case"E":return Hb;case"Do":return Qb;default:return c=new RegExp(T(S(a.replace("\\","")),"i"))}}function L(a){a=a||"";var b=a.match(Nb)||[],c=b[b.length-1]||[],d=(c+"").match(_b)||["-",0,0],e=+(60*d[1])+u(d[2]);return"+"===d[0]?-e:e}function M(a,b,c){var d,e=c._a;switch(a){case"Q":null!=b&&(e[tb]=3*(u(b)-1));break;case"M":case"MM":null!=b&&(e[tb]=u(b)-1);break;case"MMM":case"MMMM":d=F(c._l).monthsParse(b),null!=d?e[tb]=d:c._pf.invalidMonth=b;break;case"D":case"DD":null!=b&&(e[ub]=u(b));break;case"Do":null!=b&&(e[ub]=u(parseInt(b,10)));break;case"DDD":case"DDDD":null!=b&&(c._dayOfYear=u(b));break;case"YY":e[sb]=mb.parseTwoDigitYear(b);break;case"YYYY":case"YYYYY":case"YYYYYY":e[sb]=u(b);break;case"a":case"A":c._isPm=F(c._l).isPM(b);break;case"H":case"HH":case"h":case"hh":e[vb]=u(b);break;case"m":case"mm":e[wb]=u(b);break;case"s":case"ss":e[xb]=u(b);break;case"S":case"SS":case"SSS":case"SSSS":e[yb]=u(1e3*("0."+b));break;case"X":c._d=new Date(1e3*parseFloat(b));break;case"Z":case"ZZ":c._useUTC=!0,c._tzm=L(b);break;case"dd":case"ddd":case"dddd":d=F(c._l).weekdaysParse(b),null!=d?(c._w=c._w||{},c._w.d=d):c._pf.invalidWeekday=b;break;case"w":case"ww":case"W":case"WW":case"d":case"e":case"E":a=a.substr(0,1);case"gggg":case"GGGG":case"GGGGG":a=a.substr(0,2),b&&(c._w=c._w||{},c._w[a]=u(b));break;case"gg":case"GG":c._w=c._w||{},c._w[a]=mb.parseTwoDigitYear(b)}}function N(a){var c,d,e,f,g,h,i,j;c=a._w,null!=c.GG||null!=c.W||null!=c.E?(g=1,h=4,d=b(c.GG,a._a[sb],bb(mb(),1,4).year),e=b(c.W,1),f=b(c.E,1)):(j=F(a._l),g=j._week.dow,h=j._week.doy,d=b(c.gg,a._a[sb],bb(mb(),g,h).year),e=b(c.w,1),null!=c.d?(f=c.d,g>f&&++e):f=null!=c.e?c.e+g:g),i=cb(d,e,f,h,g),a._a[sb]=i.year,a._dayOfYear=i.dayOfYear}function O(a){var c,d,e,f,g=[];if(!a._d){for(e=Q(a),a._w&&null==a._a[ub]&&null==a._a[tb]&&N(a),a._dayOfYear&&(f=b(a._a[sb],e[sb]),a._dayOfYear>x(f)&&(a._pf._overflowDayOfYear=!0),d=Z(f,0,a._dayOfYear),a._a[tb]=d.getUTCMonth(),a._a[ub]=d.getUTCDate()),c=0;3>c&&null==a._a[c];++c)a._a[c]=g[c]=e[c];for(;7>c;c++)a._a[c]=g[c]=null==a._a[c]?2===c?1:0:a._a[c];a._d=(a._useUTC?Z:Y).apply(null,g),null!=a._tzm&&a._d.setUTCMinutes(a._d.getUTCMinutes()+a._tzm)}}function P(a){var b;a._d||(b=s(a._i),a._a=[b.year,b.month,b.day,b.hour,b.minute,b.second,b.millisecond],O(a))}function Q(a){var b=new Date;return a._useUTC?[b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate()]:[b.getFullYear(),b.getMonth(),b.getDate()]}function R(a){if(a._f===mb.ISO_8601)return void V(a);a._a=[],a._pf.empty=!0;var b,c,d,e,f,g=F(a._l),h=""+a._i,i=h.length,j=0;for(d=J(a._f,g).match(Fb)||[],b=0;b<d.length;b++)e=d[b],c=(h.match(K(e,a))||[])[0],c&&(f=h.substr(0,h.indexOf(c)),f.length>0&&a._pf.unusedInput.push(f),h=h.slice(h.indexOf(c)+c.length),j+=c.length),hc[e]?(c?a._pf.empty=!1:a._pf.unusedTokens.push(e),M(e,c,a)):a._strict&&!c&&a._pf.unusedTokens.push(e);a._pf.charsLeftOver=i-j,h.length>0&&a._pf.unusedInput.push(h),a._isPm&&a._a[vb]<12&&(a._a[vb]+=12),a._isPm===!1&&12===a._a[vb]&&(a._a[vb]=0),O(a),z(a)}function S(a){return a.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(a,b,c,d,e){return b||c||d||e})}function T(a){return a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function U(a){var b,d,e,f,g;if(0===a._f.length)return a._pf.invalidFormat=!0,void(a._d=new Date(0/0));for(f=0;f<a._f.length;f++)g=0,b=j({},a),b._pf=c(),b._f=a._f[f],R(b),A(b)&&(g+=b._pf.charsLeftOver,g+=10*b._pf.unusedTokens.length,b._pf.score=g,(null==e||e>g)&&(e=g,d=b));j(a,d||b)}function V(a){var b,c,d=a._i,e=Xb.exec(d);if(e){for(a._pf.iso=!0,b=0,c=Zb.length;c>b;b++)if(Zb[b][1].exec(d)){a._f=Zb[b][0]+(e[6]||" ");break}for(b=0,c=$b.length;c>b;b++)if($b[b][1].exec(d)){a._f+=$b[b][0];break}d.match(Nb)&&(a._f+="Z"),R(a)}else a._isValid=!1}function W(a){V(a),a._isValid===!1&&(delete a._isValid,mb.createFromInputFallback(a))}function X(b){var c=b._i,d=Cb.exec(c);c===a?b._d=new Date:d?b._d=new Date(+d[1]):"string"==typeof c?W(b):o(c)?(b._a=c.slice(0),O(b)):p(c)?b._d=new Date(+c):"object"==typeof c?P(b):"number"==typeof c?b._d=new Date(c):mb.createFromInputFallback(b)}function Y(a,b,c,d,e,f,g){var h=new Date(a,b,c,d,e,f,g);return 1970>a&&h.setFullYear(a),h}function Z(a){var b=new Date(Date.UTC.apply(null,arguments));return 1970>a&&b.setUTCFullYear(a),b}function $(a,b){if("string"==typeof a)if(isNaN(a)){if(a=b.weekdaysParse(a),"number"!=typeof a)return null}else a=parseInt(a,10);return a}function _(a,b,c,d,e){return e.relativeTime(b||1,!!c,a,d)}function ab(a,b,c){var d=rb(Math.abs(a)/1e3),e=rb(d/60),f=rb(e/60),g=rb(f/24),h=rb(g/365),i=d<ec.s&&["s",d]||1===e&&["m"]||e<ec.m&&["mm",e]||1===f&&["h"]||f<ec.h&&["hh",f]||1===g&&["d"]||g<=ec.dd&&["dd",g]||g<=ec.dm&&["M"]||g<ec.dy&&["MM",rb(g/30)]||1===h&&["y"]||["yy",h];return i[2]=b,i[3]=a>0,i[4]=c,_.apply({},i)}function bb(a,b,c){var d,e=c-b,f=c-a.day();return f>e&&(f-=7),e-7>f&&(f+=7),d=mb(a).add("d",f),{week:Math.ceil(d.dayOfYear()/7),year:d.year()}}function cb(a,b,c,d,e){var f,g,h=Z(a,0,1).getUTCDay();return h=0===h?7:h,c=null!=c?c:e,f=e-h+(h>d?7:0)-(e>h?7:0),g=7*(b-1)+(c-e)+f+1,{year:g>0?a:a-1,dayOfYear:g>0?g:x(a-1)+g}}function db(b){var c=b._i,d=b._f;return null===c||d===a&&""===c?mb.invalid({nullInput:!0}):("string"==typeof c&&(b._i=c=F().preparse(c)),mb.isMoment(c)?(b=k(c),b._d=new Date(+c._d)):d?o(d)?U(b):R(b):X(b),new h(b))}function eb(a,b){var c,d;if(1===b.length&&o(b[0])&&(b=b[0]),!b.length)return mb();for(c=b[0],d=1;d<b.length;++d)b[d][a](c)&&(c=b[d]);return c}function fb(a,b){var c;return"string"==typeof b&&(b=a.lang().monthsParse(b),"number"!=typeof b)?a:(c=Math.min(a.date(),v(a.year(),b)),a._d["set"+(a._isUTC?"UTC":"")+"Month"](b,c),a)}function gb(a,b){return a._d["get"+(a._isUTC?"UTC":"")+b]()}function hb(a,b,c){return"Month"===b?fb(a,c):a._d["set"+(a._isUTC?"UTC":"")+b](c)}function ib(a,b){return function(c){return null!=c?(hb(this,a,c),mb.updateOffset(this,b),this):gb(this,a)}}function jb(a){mb.duration.fn[a]=function(){return this._data[a]}}function kb(a,b){mb.duration.fn["as"+a]=function(){return+this/b}}function lb(a){"undefined"==typeof ender&&(nb=qb.moment,qb.moment=a?d("Accessing Moment through the global scope is deprecated, and will be removed in an upcoming release.",mb):mb)}for(var mb,nb,ob,pb="2.7.0",qb="undefined"!=typeof global?global:this,rb=Math.round,sb=0,tb=1,ub=2,vb=3,wb=4,xb=5,yb=6,zb={},Ab={_isAMomentObject:null,_i:null,_f:null,_l:null,_strict:null,_tzm:null,_isUTC:null,_offset:null,_pf:null,_lang:null},Bb="undefined"!=typeof module&&module.exports,Cb=/^\/?Date\((\-?\d+)/i,Db=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,Eb=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,Fb=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|X|zz?|ZZ?|.)/g,Gb=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,Hb=/\d\d?/,Ib=/\d{1,3}/,Jb=/\d{1,4}/,Kb=/[+\-]?\d{1,6}/,Lb=/\d+/,Mb=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,Nb=/Z|[\+\-]\d\d:?\d\d/gi,Ob=/T/i,Pb=/[\+\-]?\d+(\.\d{1,3})?/,Qb=/\d{1,2}/,Rb=/\d/,Sb=/\d\d/,Tb=/\d{3}/,Ub=/\d{4}/,Vb=/[+-]?\d{6}/,Wb=/[+-]?\d+/,Xb=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Yb="YYYY-MM-DDTHH:mm:ssZ",Zb=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],$b=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],_b=/([\+\-]|\d\d)/gi,ac=("Date|Hours|Minutes|Seconds|Milliseconds".split("|"),{Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6}),bc={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",Q:"quarter",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},cc={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},dc={},ec={s:45,m:45,h:22,dd:25,dm:45,dy:345},fc="DDD w W M D d".split(" "),gc="M D H h m s w W".split(" "),hc={M:function(){return this.month()+1},MMM:function(a){return this.lang().monthsShort(this,a)},MMMM:function(a){return this.lang().months(this,a)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(a){return this.lang().weekdaysMin(this,a)},ddd:function(a){return this.lang().weekdaysShort(this,a)},dddd:function(a){return this.lang().weekdays(this,a)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return m(this.year()%100,2)},YYYY:function(){return m(this.year(),4)},YYYYY:function(){return m(this.year(),5)},YYYYYY:function(){var a=this.year(),b=a>=0?"+":"-";return b+m(Math.abs(a),6)},gg:function(){return m(this.weekYear()%100,2)},gggg:function(){return m(this.weekYear(),4)},ggggg:function(){return m(this.weekYear(),5)},GG:function(){return m(this.isoWeekYear()%100,2)},GGGG:function(){return m(this.isoWeekYear(),4)},GGGGG:function(){return m(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return u(this.milliseconds()/100)},SS:function(){return m(u(this.milliseconds()/10),2)},SSS:function(){return m(this.milliseconds(),3)},SSSS:function(){return m(this.milliseconds(),3)},Z:function(){var a=-this.zone(),b="+";return 0>a&&(a=-a,b="-"),b+m(u(a/60),2)+":"+m(u(a)%60,2)},ZZ:function(){var a=-this.zone(),b="+";return 0>a&&(a=-a,b="-"),b+m(u(a/60),2)+m(u(a)%60,2)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},X:function(){return this.unix()},Q:function(){return this.quarter()}},ic=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"];fc.length;)ob=fc.pop(),hc[ob+"o"]=f(hc[ob],ob);for(;gc.length;)ob=gc.pop(),hc[ob+ob]=e(hc[ob],2);for(hc.DDDD=e(hc.DDD,3),j(g.prototype,{set:function(a){var b,c;for(c in a)b=a[c],"function"==typeof b?this[c]=b:this["_"+c]=b},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(a){return this._months[a.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(a){return this._monthsShort[a.month()]},monthsParse:function(a){var b,c,d;for(this._monthsParse||(this._monthsParse=[]),b=0;12>b;b++)if(this._monthsParse[b]||(c=mb.utc([2e3,b]),d="^"+this.months(c,"")+"|^"+this.monthsShort(c,""),this._monthsParse[b]=new RegExp(d.replace(".",""),"i")),this._monthsParse[b].test(a))return b},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(a){return this._weekdays[a.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(a){return this._weekdaysShort[a.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(a){return this._weekdaysMin[a.day()]},weekdaysParse:function(a){var b,c,d;for(this._weekdaysParse||(this._weekdaysParse=[]),b=0;7>b;b++)if(this._weekdaysParse[b]||(c=mb([2e3,1]).day(b),d="^"+this.weekdays(c,"")+"|^"+this.weekdaysShort(c,"")+"|^"+this.weekdaysMin(c,""),this._weekdaysParse[b]=new RegExp(d.replace(".",""),"i")),this._weekdaysParse[b].test(a))return b},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(a){var b=this._longDateFormat[a];return!b&&this._longDateFormat[a.toUpperCase()]&&(b=this._longDateFormat[a.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(a){return a.slice(1)}),this._longDateFormat[a]=b),b},isPM:function(a){return"p"===(a+"").toLowerCase().charAt(0)},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(a,b,c){return a>11?c?"pm":"PM":c?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(a,b){var c=this._calendar[a];return"function"==typeof c?c.apply(b):c},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(a,b,c,d){var e=this._relativeTime[c];return"function"==typeof e?e(a,b,c,d):e.replace(/%d/i,a)},pastFuture:function(a,b){var c=this._relativeTime[a>0?"future":"past"];return"function"==typeof c?c(b):c.replace(/%s/i,b)},ordinal:function(a){return this._ordinal.replace("%d",a)},_ordinal:"%d",preparse:function(a){return a},postformat:function(a){return a},week:function(a){return bb(a,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}}),mb=function(b,d,e,f){var g;return"boolean"==typeof e&&(f=e,e=a),g={},g._isAMomentObject=!0,g._i=b,g._f=d,g._l=e,g._strict=f,g._isUTC=!1,g._pf=c(),db(g)},mb.suppressDeprecationWarnings=!1,mb.createFromInputFallback=d("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to https://github.com/moment/moment/issues/1407 for more info.",function(a){a._d=new Date(a._i)}),mb.min=function(){var a=[].slice.call(arguments,0);return eb("isBefore",a)},mb.max=function(){var a=[].slice.call(arguments,0);return eb("isAfter",a)},mb.utc=function(b,d,e,f){var g;return"boolean"==typeof e&&(f=e,e=a),g={},g._isAMomentObject=!0,g._useUTC=!0,g._isUTC=!0,g._l=e,g._i=b,g._f=d,g._strict=f,g._pf=c(),db(g).utc()},mb.unix=function(a){return mb(1e3*a)},mb.duration=function(a,b){var c,d,e,f=a,g=null;return mb.isDuration(a)?f={ms:a._milliseconds,d:a._days,M:a._months}:"number"==typeof a?(f={},b?f[b]=a:f.milliseconds=a):(g=Db.exec(a))?(c="-"===g[1]?-1:1,f={y:0,d:u(g[ub])*c,h:u(g[vb])*c,m:u(g[wb])*c,s:u(g[xb])*c,ms:u(g[yb])*c}):(g=Eb.exec(a))&&(c="-"===g[1]?-1:1,e=function(a){var b=a&&parseFloat(a.replace(",","."));return(isNaN(b)?0:b)*c},f={y:e(g[2]),M:e(g[3]),d:e(g[4]),h:e(g[5]),m:e(g[6]),s:e(g[7]),w:e(g[8])}),d=new i(f),mb.isDuration(a)&&a.hasOwnProperty("_lang")&&(d._lang=a._lang),d},mb.version=pb,mb.defaultFormat=Yb,mb.ISO_8601=function(){},mb.momentProperties=Ab,mb.updateOffset=function(){},mb.relativeTimeThreshold=function(b,c){return ec[b]===a?!1:(ec[b]=c,!0)},mb.lang=function(a,b){var c;return a?(b?D(B(a),b):null===b?(E(a),a="en"):zb[a]||F(a),c=mb.duration.fn._lang=mb.fn._lang=F(a),c._abbr):mb.fn._lang._abbr},mb.langData=function(a){return a&&a._lang&&a._lang._abbr&&(a=a._lang._abbr),F(a)},mb.isMoment=function(a){return a instanceof h||null!=a&&a.hasOwnProperty("_isAMomentObject")},mb.isDuration=function(a){return a instanceof i},ob=ic.length-1;ob>=0;--ob)t(ic[ob]);mb.normalizeUnits=function(a){return r(a)},mb.invalid=function(a){var b=mb.utc(0/0);return null!=a?j(b._pf,a):b._pf.userInvalidated=!0,b},mb.parseZone=function(){return mb.apply(null,arguments).parseZone()},mb.parseTwoDigitYear=function(a){return u(a)+(u(a)>68?1900:2e3)},j(mb.fn=h.prototype,{clone:function(){return mb(this)},valueOf:function(){return+this._d+6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().lang("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){var a=mb(this).utc();return 0<a.year()&&a.year()<=9999?I(a,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):I(a,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var a=this;return[a.year(),a.month(),a.date(),a.hours(),a.minutes(),a.seconds(),a.milliseconds()]},isValid:function(){return A(this)},isDSTShifted:function(){return this._a?this.isValid()&&q(this._a,(this._isUTC?mb.utc(this._a):mb(this._a)).toArray())>0:!1},parsingFlags:function(){return j({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(){return this.zone(0)},local:function(){return this.zone(0),this._isUTC=!1,this},format:function(a){var b=I(this,a||mb.defaultFormat);return this.lang().postformat(b)},add:function(a,b){var c;return c="string"==typeof a&&"string"==typeof b?mb.duration(isNaN(+b)?+a:+b,isNaN(+b)?b:a):"string"==typeof a?mb.duration(+b,a):mb.duration(a,b),n(this,c,1),this},subtract:function(a,b){var c;return c="string"==typeof a&&"string"==typeof b?mb.duration(isNaN(+b)?+a:+b,isNaN(+b)?b:a):"string"==typeof a?mb.duration(+b,a):mb.duration(a,b),n(this,c,-1),this},diff:function(a,b,c){var d,e,f=C(a,this),g=6e4*(this.zone()-f.zone());return b=r(b),"year"===b||"month"===b?(d=432e5*(this.daysInMonth()+f.daysInMonth()),e=12*(this.year()-f.year())+(this.month()-f.month()),e+=(this-mb(this).startOf("month")-(f-mb(f).startOf("month")))/d,e-=6e4*(this.zone()-mb(this).startOf("month").zone()-(f.zone()-mb(f).startOf("month").zone()))/d,"year"===b&&(e/=12)):(d=this-f,e="second"===b?d/1e3:"minute"===b?d/6e4:"hour"===b?d/36e5:"day"===b?(d-g)/864e5:"week"===b?(d-g)/6048e5:d),c?e:l(e)},from:function(a,b){return mb.duration(this.diff(a)).lang(this.lang()._abbr).humanize(!b)},fromNow:function(a){return this.from(mb(),a)},calendar:function(a){var b=a||mb(),c=C(b,this).startOf("day"),d=this.diff(c,"days",!0),e=-6>d?"sameElse":-1>d?"lastWeek":0>d?"lastDay":1>d?"sameDay":2>d?"nextDay":7>d?"nextWeek":"sameElse";return this.format(this.lang().calendar(e,this))},isLeapYear:function(){return y(this.year())},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(a){var b=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=a?(a=$(a,this.lang()),this.add({d:a-b})):b},month:ib("Month",!0),startOf:function(a){switch(a=r(a)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===a?this.weekday(0):"isoWeek"===a&&this.isoWeekday(1),"quarter"===a&&this.month(3*Math.floor(this.month()/3)),this},endOf:function(a){return a=r(a),this.startOf(a).add("isoWeek"===a?"week":a,1).subtract("ms",1)},isAfter:function(a,b){return b="undefined"!=typeof b?b:"millisecond",+this.clone().startOf(b)>+mb(a).startOf(b)},isBefore:function(a,b){return b="undefined"!=typeof b?b:"millisecond",+this.clone().startOf(b)<+mb(a).startOf(b)},isSame:function(a,b){return b=b||"ms",+this.clone().startOf(b)===+C(a,this).startOf(b)},min:d("moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(a){return a=mb.apply(null,arguments),this>a?this:a}),max:d("moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(a){return a=mb.apply(null,arguments),a>this?this:a}),zone:function(a,b){var c=this._offset||0;return null==a?this._isUTC?c:this._d.getTimezoneOffset():("string"==typeof a&&(a=L(a)),Math.abs(a)<16&&(a=60*a),this._offset=a,this._isUTC=!0,c!==a&&(!b||this._changeInProgress?n(this,mb.duration(c-a,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,mb.updateOffset(this,!0),this._changeInProgress=null)),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){return this._tzm?this.zone(this._tzm):"string"==typeof this._i&&this.zone(this._i),this},hasAlignedHourOffset:function(a){return a=a?mb(a).zone():0,(this.zone()-a)%60===0},daysInMonth:function(){return v(this.year(),this.month())},dayOfYear:function(a){var b=rb((mb(this).startOf("day")-mb(this).startOf("year"))/864e5)+1;return null==a?b:this.add("d",a-b)},quarter:function(a){return null==a?Math.ceil((this.month()+1)/3):this.month(3*(a-1)+this.month()%3)},weekYear:function(a){var b=bb(this,this.lang()._week.dow,this.lang()._week.doy).year;return null==a?b:this.add("y",a-b)},isoWeekYear:function(a){var b=bb(this,1,4).year;return null==a?b:this.add("y",a-b)},week:function(a){var b=this.lang().week(this);return null==a?b:this.add("d",7*(a-b))},isoWeek:function(a){var b=bb(this,1,4).week;return null==a?b:this.add("d",7*(a-b))},weekday:function(a){var b=(this.day()+7-this.lang()._week.dow)%7;return null==a?b:this.add("d",a-b)},isoWeekday:function(a){return null==a?this.day()||7:this.day(this.day()%7?a:a-7)},isoWeeksInYear:function(){return w(this.year(),1,4)},weeksInYear:function(){var a=this._lang._week;return w(this.year(),a.dow,a.doy)},get:function(a){return a=r(a),this[a]()},set:function(a,b){return a=r(a),"function"==typeof this[a]&&this[a](b),this},lang:function(b){return b===a?this._lang:(this._lang=F(b),this)}}),mb.fn.millisecond=mb.fn.milliseconds=ib("Milliseconds",!1),mb.fn.second=mb.fn.seconds=ib("Seconds",!1),mb.fn.minute=mb.fn.minutes=ib("Minutes",!1),mb.fn.hour=mb.fn.hours=ib("Hours",!0),mb.fn.date=ib("Date",!0),mb.fn.dates=d("dates accessor is deprecated. Use date instead.",ib("Date",!0)),mb.fn.year=ib("FullYear",!0),mb.fn.years=d("years accessor is deprecated. Use year instead.",ib("FullYear",!0)),mb.fn.days=mb.fn.day,mb.fn.months=mb.fn.month,mb.fn.weeks=mb.fn.week,mb.fn.isoWeeks=mb.fn.isoWeek,mb.fn.quarters=mb.fn.quarter,mb.fn.toJSON=mb.fn.toISOString,j(mb.duration.fn=i.prototype,{_bubble:function(){var a,b,c,d,e=this._milliseconds,f=this._days,g=this._months,h=this._data;h.milliseconds=e%1e3,a=l(e/1e3),h.seconds=a%60,b=l(a/60),h.minutes=b%60,c=l(b/60),h.hours=c%24,f+=l(c/24),h.days=f%30,g+=l(f/30),h.months=g%12,d=l(g/12),h.years=d},weeks:function(){return l(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*u(this._months/12)},humanize:function(a){var b=+this,c=ab(b,!a,this.lang());return a&&(c=this.lang().pastFuture(b,c)),this.lang().postformat(c)},add:function(a,b){var c=mb.duration(a,b);return this._milliseconds+=c._milliseconds,this._days+=c._days,this._months+=c._months,this._bubble(),this},subtract:function(a,b){var c=mb.duration(a,b);return this._milliseconds-=c._milliseconds,this._days-=c._days,this._months-=c._months,this._bubble(),this},get:function(a){return a=r(a),this[a.toLowerCase()+"s"]()},as:function(a){return a=r(a),this["as"+a.charAt(0).toUpperCase()+a.slice(1)+"s"]()},lang:mb.fn.lang,toIsoString:function(){var a=Math.abs(this.years()),b=Math.abs(this.months()),c=Math.abs(this.days()),d=Math.abs(this.hours()),e=Math.abs(this.minutes()),f=Math.abs(this.seconds()+this.milliseconds()/1e3);return this.asSeconds()?(this.asSeconds()<0?"-":"")+"P"+(a?a+"Y":"")+(b?b+"M":"")+(c?c+"D":"")+(d||e||f?"T":"")+(d?d+"H":"")+(e?e+"M":"")+(f?f+"S":""):"P0D"}});for(ob in ac)ac.hasOwnProperty(ob)&&(kb(ob,ac[ob]),jb(ob.toLowerCase()));kb("Weeks",6048e5),mb.duration.fn.asMonths=function(){return(+this-31536e6*this.years())/2592e6+12*this.years()},mb.lang("en",{ordinal:function(a){var b=a%10,c=1===u(a%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th";return a+c}}),Bb?module.exports=mb:"function"==typeof define&&define.amd?(define("moment",function(a,b,c){return c.config&&c.config()&&c.config().noGlobal===!0&&(qb.moment=nb),mb}),lb(!0)):lb()}).call(this);;;var JSON;if(!JSON){JSON={};}
(function(){"use strict";function f(n){return n<10?'0'+n:n;}
if(typeof Date.prototype.toJSON!=='function'){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+'-'+
f(this.getUTCMonth()+1)+'-'+
f(this.getUTCDate())+'T'+
f(this.getUTCHours())+':'+
f(this.getUTCMinutes())+':'+
f(this.getUTCSeconds())+'Z':null;};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf();};}
var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==='string'?c:'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4);})+'"':'"'+string+'"';}
function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==='object'&&typeof value.toJSON==='function'){value=value.toJSON(key);}
if(typeof rep==='function'){value=rep.call(holder,key,value);}
switch(typeof value){case'string':return quote(value);case'number':return isFinite(value)?String(value):'null';case'boolean':case'null':return String(value);case'object':if(!value){return'null';}
gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==='[object Array]'){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||'null';}
v=partial.length===0?'[]':gap?'[\n'+gap+partial.join(',\n'+gap)+'\n'+mind+']':'['+partial.join(',')+']';gap=mind;return v;}
if(rep&&typeof rep==='object'){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==='string'){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}
v=partial.length===0?'{}':gap?'{\n'+gap+partial.join(',\n'+gap)+'\n'+mind+'}':'{'+partial.join(',')+'}';gap=mind;return v;}}
if(typeof JSON.stringify!=='function'){JSON.stringify=function(value,replacer,space){var i;gap='';indent='';if(typeof space==='number'){for(i=0;i<space;i+=1){indent+=' ';}}else if(typeof space==='string'){indent=space;}
rep=replacer;if(replacer&&typeof replacer!=='function'&&(typeof replacer!=='object'||typeof replacer.length!=='number')){throw new Error('JSON.stringify');}
return str('',{'':value});};}
if(typeof JSON.parse!=='function'){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==='object'){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v;}else{delete value[k];}}}}
return reviver.call(holder,key,value);}
text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return'\\u'+
('0000'+a.charCodeAt(0).toString(16)).slice(-4);});}
if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,'@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']').replace(/(?:^|:|,)(?:\s*\[)+/g,''))){j=eval('('+text+')');return typeof reviver==='function'?walk({'':j},''):j;}
throw new SyntaxError('JSON.parse');};}}());;;(function($){$.formatCurrency={};$.formatCurrency.regions=[];$.formatCurrency.regions[""]={symbol:"$",positiveFormat:"%s%n",negativeFormat:"(%s%n)",decimalSymbol:".",digitGroupSymbol:",",groupDigits:true};$.fn.formatCurrency=function(destination,settings){if(arguments.length==1&&typeof destination!=="string"){settings=destination;destination=false}var defaults={name:"formatCurrency",colorize:false,region:"",global:true,roundToDecimalPlace:2,eventOnDecimalsEntered:false};defaults=$.extend(defaults,$.formatCurrency.regions[""]);settings=$.extend(defaults,settings);if(settings.region.length>0){settings=$.extend(settings,getRegionOrCulture(settings.region))}settings.regex=generateRegex(settings);return this.each(function(){$this=$(this);var num="0";num=$this[$this.is("input, select, textarea")?"val":"html"]();if(num.search("\\(")>=0){num="-"+num}if(num===""||(num==="-"&&settings.roundToDecimalPlace===-1)){return}if(isNaN(num)){num=num.replace(settings.regex,"");if(num===""||(num==="-"&&settings.roundToDecimalPlace===-1)){return}if(settings.decimalSymbol!="."){num=num.replace(settings.decimalSymbol,".")}if(isNaN(num)){num="0"}}var numParts=String(num).split(".");var isPositive=(num==Math.abs(num));var hasDecimals=(numParts.length>1);var decimals=(hasDecimals?numParts[1].toString():"0");var originalDecimals=decimals;num=Math.abs(numParts[0]);num=isNaN(num)?0:num;if(settings.roundToDecimalPlace>=0){decimals=parseFloat("1."+decimals);decimals=decimals.toFixed(settings.roundToDecimalPlace);if(decimals.substring(0,1)=="2"){num=Number(num)+1}decimals=decimals.substring(2)}num=String(num);if(settings.groupDigits){for(var i=0;i<Math.floor((num.length-(1+i))/3);i++){num=num.substring(0,num.length-(4*i+3))+settings.digitGroupSymbol+num.substring(num.length-(4*i+3))}}if((hasDecimals&&settings.roundToDecimalPlace==-1)||settings.roundToDecimalPlace>0){num+=settings.decimalSymbol+decimals}var format=isPositive?settings.positiveFormat:settings.negativeFormat;var money=format.replace(/%s/g,settings.symbol);money=money.replace(/%n/g,num);var $destination=$([]);if(!destination){$destination=$this}else{$destination=$(destination)}$destination[$destination.is("input, select, textarea")?"val":"html"](money);if(hasDecimals&&settings.eventOnDecimalsEntered&&originalDecimals.length>settings.roundToDecimalPlace){$destination.trigger("decimalsEntered",originalDecimals)}if(settings.colorize){$destination.css("color",isPositive?"black":"red")}})};$.fn.toNumber=function(settings){var defaults=$.extend({name:"toNumber",region:"",global:true},$.formatCurrency.regions[""]);settings=jQuery.extend(defaults,settings);if(settings.region.length>0){settings=$.extend(settings,getRegionOrCulture(settings.region))}settings.regex=generateRegex(settings);return this.each(function(){var method=$(this).is("input, select, textarea")?"val":"html";$(this)[method]($(this)[method]().replace("(","(-").replace(settings.regex,""))})};$.fn.asNumber=function(settings){var defaults=$.extend({name:"asNumber",region:"",parse:true,parseType:"Float",global:true},$.formatCurrency.regions[""]);settings=jQuery.extend(defaults,settings);if(settings.region.length>0){settings=$.extend(settings,getRegionOrCulture(settings.region))}settings.regex=generateRegex(settings);settings.parseType=validateParseType(settings.parseType);var method=$(this).is("input, select, textarea")?"val":"html";var num=$(this)[method]();num=num?num:"";num=num.replace("(","(-");num=num.replace(settings.regex,"");if(!settings.parse){return num}if(num.length==0){num="0"}if(settings.decimalSymbol!="."){num=num.replace(settings.decimalSymbol,".")}return window["parse"+settings.parseType](num)};function getRegionOrCulture(region){var regionInfo=$.formatCurrency.regions[region];if(regionInfo){return regionInfo}else{if(/(\w+)-(\w+)/g.test(region)){var culture=region.replace(/(\w+)-(\w+)/g,"$1");return $.formatCurrency.regions[culture]}}return null}function validateParseType(parseType){switch(parseType.toLowerCase()){case"int":return"Int";case"float":return"Float";default:throw"invalid parseType"}}function generateRegex(settings){if(settings.symbol===""){return new RegExp("[^\\d"+settings.decimalSymbol+"-]","g")}else{var symbol=settings.symbol.replace("$","\\$").replace(".","\\.");return new RegExp(symbol+"|[^\\d"+settings.decimalSymbol+"-]","g")}}})(jQuery);;;(function($){$.Placeholder={settings:{color:"rgb(169,169,169)",dataName:"original-font-color"},init:function(settings){if(settings)
{$.extend($.Placeholder.settings,settings);}
var getContent=function(element){return $(element).val();};var setContent=function(element,content){$(element).val(content);};var getPlaceholder=function(element){return $(element).attr("placeholder");};var isContentEmpty=function(element){var content=getContent(element);return(content.length===0)||content==getPlaceholder(element);};var setPlaceholderStyle=function(element){$(element).data($.Placeholder.settings.dataName,$(element).css("color"));$(element).css("color",$.Placeholder.settings.color);};var clearPlaceholderStyle=function(element){$(element).css("color",$(element).data($.Placeholder.settings.dataName));$(element).removeData($.Placeholder.settings.dataName);};var showPlaceholder=function(element){setContent(element,getPlaceholder(element));setPlaceholderStyle(element);};var hidePlaceholder=function(element){if($(element).data($.Placeholder.settings.dataName)){setContent(element,"");clearPlaceholderStyle(element);}};var inputFocused=function(){if(isContentEmpty(this)){hidePlaceholder(this);}};var inputBlurred=function(){if(isContentEmpty(this)){showPlaceholder(this);}};var parentFormSubmitted=function(){if(isContentEmpty(this)){hidePlaceholder(this);}};$("textarea, input[type='text']").each(function(index,element){if($(element).attr("placeholder")){$(element).focus(inputFocused);$(element).blur(inputBlurred);$(element).bind("parentformsubmitted",parentFormSubmitted);$(element).trigger("blur");$(element).parents("form").submit(function(){$(element).trigger("parentformsubmitted");});}});return this;}}})(jQuery);;;$(document).ready(function(){var isInputSupported='placeholder'in document.createElement('input'),isTextareaSupported='placeholder'in document.createElement('textarea');if(!isInputSupported||!isTextareaSupported){$.Placeholder.init();$('[placeholder]').addClass('legacyPlaceholder');}});;(function(k,e,i,j){k.fn.caret=function(b,l){var a,c,f=this[0],d=k.browser.msie;if(typeof b==="object"&&typeof b.start==="number"&&typeof b.end==="number"){a=b.start;c=b.end}else if(typeof b==="number"&&typeof l==="number"){a=b;c=l}else if(typeof b==="string")if((a=f.value.indexOf(b))>-1)c=a+b[e];else a=null;else if(Object.prototype.toString.call(b)==="[object RegExp]"){b=b.exec(f.value);if(b!=null){a=b.index;c=a+b[0][e]}}if(typeof a!="undefined"){if(d){d=this[0].createTextRange();d.collapse(true);d.moveStart("character",a);d.moveEnd("character",c-a);d.select()}else{this[0].selectionStart=a;this[0].selectionEnd=c}this[0].focus();return this}else{if(d){c=document.selection;if(this[0].tagName.toLowerCase()!="textarea"){d=this.val();a=c[i]()[j]();a.moveEnd("character",d[e]);var g=a.text==""?d[e]:d.lastIndexOf(a.text);a=c[i]()[j]();a.moveStart("character",-d[e]);var h=a.text[e]}else{a=c[i]();c=a[j]();c.moveToElementText(this[0]);c.setEndPoint("EndToEnd",a);g=c.text[e]-a.text[e];h=g+a.text[e]}}else{g=f.selectionStart;h=f.selectionEnd}a=f.value.substring(g,h);return{start:g,end:h,text:a,replace:function(m){return f.value.substring(0,g)+m+f.value.substring(h,f.value[e])}}}}})(jQuery,"length","createRange","duplicate");;;(function($){var reEscape=new RegExp('(\\'+['/','.','*','+','?','|','(',')','[',']','{','}','\\'].join('|\\')+')','g');function fnFormatResult(value,data,currentValue){var pattern='('+currentValue.replace(reEscape,'\\$1')+')';return value.replace(new RegExp(pattern,'gi'),'<strong>$1<\/strong>');}
function Autocomplete(el,options){this.el=$(el);this.el.attr('autocomplete','off');this.suggestions=[];this.data=[];this.badQueries=[];this.selectedIndex=-1;this.currentValue=this.el.val();this.intervalId=0;this.cachedResponse=[];this.onChangeInterval=100;this.ignoreValueChange=false;this.serviceUrl=options.serviceUrl;this.isLocal=false;this.options={autoSubmit:false,minChars:1,maxHeight:300,deferRequestBy:0,width:0,highlight:true,params:{},fnFormatResult:fnFormatResult,delimiter:null,zIndex:9999};this.initialize();this.setOptions(options);}
$.fn.autocomplete_v2=function(options){return new Autocomplete(this.get(0)||$('<input />'),options);};Autocomplete.prototype={killerFn:null,initialize:function(){var me,uid,autocompleteElId;me=this;uid=Math.floor(Math.random()*0x100000).toString(16);autocompleteElId='Autocomplete_'+uid;this.killerFn=function(e){if($(e.target).parents('.autocomplete').size()===0){me.killSuggestions();me.disableKillerFn();}};if(!this.options.width){this.options.width=this.el.width();}
this.mainContainerId='AutocompleteContainter_'+uid;$('<div id="'+this.mainContainerId+'" style="position:absolute;z-index:9999;"><div class="autocomplete-w1"><div class="autocomplete" id="'+autocompleteElId+'" style="display:none; width:300px;"></div></div></div>').appendTo('body');this.container=$('#'+autocompleteElId);this.fixPosition();if(window.opera){this.el.keypress(function(e){me.onKeyPress(e);});}else{this.el.keydown(function(e){me.onKeyPress(e);});}
this.el.keyup(function(e){me.onKeyUp(e);});this.el.blur(function(){me.enableKillerFn();});this.el.focus(function(){me.fixPosition();});},setOptions:function(options){var o=this.options;$.extend(o,options);if(o.lookup){this.isLocal=true;if($.isArray(o.lookup)){o.lookup={suggestions:o.lookup,data:[]};}}
$('#'+this.mainContainerId).css({zIndex:o.zIndex});this.container.css({maxHeight:o.maxHeight+'px',width:o.width});},clearCache:function(){this.cachedResponse=[];this.badQueries=[];},disable:function(){this.disabled=true;},enable:function(){this.disabled=false;},fixPosition:function(){var offset=this.el.offset();$('#'+this.mainContainerId).css({top:(offset.top+this.el.innerHeight())+'px',left:offset.left+'px'});},enableKillerFn:function(){var me=this;$(document).bind('click',me.killerFn);},disableKillerFn:function(){var me=this;$(document).unbind('click',me.killerFn);},killSuggestions:function(){var me=this;this.stopKillSuggestions();this.intervalId=window.setInterval(function(){me.hide();me.stopKillSuggestions();},300);},stopKillSuggestions:function(){window.clearInterval(this.intervalId);},onKeyPress:function(e){if(this.disabled||!this.enabled){return;}
switch(e.keyCode){case 27:this.el.val(this.currentValue);this.hide();break;case 9:case 13:if(this.selectedIndex===-1){if(e.keyCode===13&&this.suggestions&&this.suggestions.length>0){this.selectedIndex=0;}else{this.hide();return;}}
this.select(this.selectedIndex);if(e.keyCode===9){return;}
break;case 38:this.moveUp();break;case 40:this.moveDown();break;default:return;}
e.stopImmediatePropagation();e.preventDefault();},onKeyUp:function(e){if(this.disabled){return;}
switch(e.keyCode){case 38:case 40:return;}
clearInterval(this.onChangeInterval);if(this.currentValue!==this.el.val()){if(this.options.deferRequestBy>0){var me=this;this.onChangeInterval=setInterval(function(){me.onValueChange();},this.options.deferRequestBy);}else{this.onValueChange();}}},onValueChange:function(){clearInterval(this.onChangeInterval);this.currentValue=this.el.val();var q=this.getQuery(this.currentValue);this.selectedIndex=-1;if(this.ignoreValueChange){this.ignoreValueChange=false;return;}
if(q===''||q.length<this.options.minChars){this.hide();}else{this.getSuggestions(q);}},getQuery:function(val){var d,arr;d=this.options.delimiter;if(!d){return $.trim(val);}
arr=val.split(d);return $.trim(arr[arr.length-1]);},getSuggestionsLocal:function(q){var ret,arr,len,val,i;arr=this.options.lookup;len=arr.suggestions.length;ret={suggestions:[],data:[]};q=q.toLowerCase();for(i=0;i<len;i++){val=arr.suggestions[i];if(val.toLowerCase().indexOf(q)===0){ret.suggestions.push(val);ret.data.push(arr.data[i]);}}
return ret;},getSuggestions:function(q){var cr,me;cr=this.isLocal?this.getSuggestionsLocal(q):this.cachedResponse[q];if(cr&&$.isArray(cr.suggestions)){this.suggestions=cr.suggestions;this.data=cr.data;this.suggest();}else if(!this.isBadQuery(q)){me=this;me.options.params.query=q;$.get(this.serviceUrl,me.options.params,function(txt){me.processResponse(txt);},'text');}},isBadQuery:function(q){var i=this.badQueries.length;while(i--){if(q.indexOf(this.badQueries[i])===0){return true;}}
return false;},hide:function(){this.enabled=false;this.selectedIndex=-1;this.container.hide();},suggest:function(){if(this.suggestions.length===0){this.hide();return;}
var me,len,div,f,v,i,s,mOver,mClick;me=this;me.selectedIndex=0;len=this.suggestions.length;f=this.options.fnFormatResult;v=this.getQuery(this.currentValue);mOver=function(xi){return function(){me.activate(xi);};};mClick=function(xi){return function(){me.select(xi);};};this.container.hide().empty();for(i=0;i<len;i++){s=this.suggestions[i];div=$((me.selectedIndex===i?'<div class="selected"':'<div')+' title="'+s+'">'+f(s,this.data[i],v)+'</div>');div.mouseover(mOver(i));div.click(mClick(i));this.container.append(div);}
this.enabled=true;this.container.show();},processResponse:function(text){var response;try{response=eval('('+text+')');}catch(err){return;}
if(!$.isArray(response.data)){response.data=[];}
if(!this.options.noCache){this.cachedResponse[response.query]=response;if(response.suggestions.length===0){this.badQueries.push(response.query);}}
if(response.query===this.getQuery(this.currentValue)){if(this.options.fnDecorateResponse){response=this.options.fnDecorateResponse(response);}
this.suggestions=response.suggestions;this.data=response.data;this.decorate_
this.suggest();}},activate:function(index){var divs,activeItem;divs=this.container.children();if(this.selectedIndex!==-1&&divs.length>this.selectedIndex){$(divs.get(this.selectedIndex)).removeClass();}
this.selectedIndex=index;if(this.selectedIndex!==-1&&divs.length>this.selectedIndex){activeItem=divs.get(this.selectedIndex);$(activeItem).addClass('selected');}
return activeItem;},deactivate:function(div,index){div.className='';if(this.selectedIndex===index){this.selectedIndex=-1;}},select:function(i){var selectedValue,f;selectedValue=this.suggestions[i];if(selectedValue){this.el.val(selectedValue);if(this.options.autoSubmit){f=this.el.parents('form');if(f.length>0){f.get(0).submit();}}
this.ignoreValueChange=true;this.hide();this.onSelect(i);}},moveUp:function(){if(this.selectedIndex===-1){return;}
if(this.selectedIndex===0){this.container.children().get(0).className='';this.selectedIndex=-1;this.el.val(this.currentValue);return;}
this.adjustScroll(this.selectedIndex-1);},moveDown:function(){if(this.selectedIndex===(this.suggestions.length-1)){return;}
this.adjustScroll(this.selectedIndex+1);},adjustScroll:function(i){var activeItem,offsetTop,upperBound,lowerBound;activeItem=this.activate(i);offsetTop=activeItem.offsetTop;upperBound=this.container.scrollTop();lowerBound=upperBound+this.options.maxHeight-25;if(offsetTop<upperBound){this.container.scrollTop(offsetTop);}else if(offsetTop>lowerBound){this.container.scrollTop(offsetTop-this.options.maxHeight+25);}
this.el.val(this.getValue(this.suggestions[i]));},onSelect:function(i){var me,fn,s,d;me=this;fn=me.options.onSelect;s=me.suggestions[i];d=me.data[i];me.el.val(me.getValue(s));if($.isFunction(fn)){fn(s,d,me.el);}},getValue:function(value){var del,currVal,arr,me;me=this;del=me.options.delimiter;if(!del){return value;}
currVal=me.currentValue;arr=currVal.split(del);if(arr.length===1){return value;}
return currVal.substr(0,currVal.length-arr[arr.length-1].length)+value;}};}(jQuery));;;(function($,p){var i,m=Array.prototype.slice,r=decodeURIComponent,a=$.param,c,l,v,b=$.bbq=$.bbq||{},q,u,j,e=$.event.special,d="hashchange",A="querystring",D="fragment",y="elemUrlAttr",g="location",k="href",t="src",x=/^.*\?|#.*$/g,w=/^.*\#/,h,C={};function E(F){return typeof F==="string"}function B(G){var F=m.call(arguments,1);return function(){return G.apply(this,F.concat(m.call(arguments)))}}function n(F){return F.replace(/^[^#]*#?(.*)$/,"$1")}function o(F){return F.replace(/(?:^[^?#]*\?([^#]*).*$)?.*/,"$1")}function f(H,M,F,I,G){var O,L,K,N,J;if(I!==i){K=F.match(H?/^([^#]*)\#?(.*)$/:/^([^#?]*)\??([^#]*)(#?.*)/);J=K[3]||"";if(G===2&&E(I)){L=I.replace(H?w:x,"")}else{N=l(K[2]);I=E(I)?l[H?D:A](I):I;L=G===2?I:G===1?$.extend({},I,N):$.extend({},N,I);L=a(L);if(H){L=L.replace(h,r)}}O=K[1]+(H?"#":L||!K[1]?"?":"")+L+J}else{O=M(F!==i?F:p[g][k])}return O}a[A]=B(f,0,o);a[D]=c=B(f,1,n);c.noEscape=function(G){G=G||"";var F=$.map(G.split(""),encodeURIComponent);h=new RegExp(F.join("|"),"g")};c.noEscape(",/");$.deparam=l=function(I,F){var H={},G={"true":!0,"false":!1,"null":null};$.each(I.replace(/\+/g," ").split("&"),function(L,Q){var K=Q.split("="),P=r(K[0]),J,O=H,M=0,R=P.split("]["),N=R.length-1;if(/\[/.test(R[0])&&/\]$/.test(R[N])){R[N]=R[N].replace(/\]$/,"");R=R.shift().split("[").concat(R);N=R.length-1}else{N=0}if(K.length===2){J=r(K[1]);if(F){J=J&&!isNaN(J)?+J:J==="undefined"?i:G[J]!==i?G[J]:J}if(N){for(;M<=N;M++){P=R[M]===""?O.length:R[M];O=O[P]=M<N?O[P]||(R[M+1]&&isNaN(R[M+1])?{}:[]):J}}else{if($.isArray(H[P])){H[P].push(J)}else{if(H[P]!==i){H[P]=[H[P],J]}else{H[P]=J}}}}else{if(P){H[P]=F?i:""}}});return H};function z(H,F,G){if(F===i||typeof F==="boolean"){G=F;F=a[H?D:A]()}else{F=E(F)?F.replace(H?w:x,""):F}return l(F,G)}l[A]=B(z,0);l[D]=v=B(z,1);$[y]||($[y]=function(F){return $.extend(C,F)})({a:k,base:k,iframe:t,img:t,input:t,form:"action",link:k,script:t});j=$[y];function s(I,G,H,F){if(!E(H)&&typeof H!=="object"){F=H;H=G;G=i}return this.each(function(){var L=$(this),J=G||j()[(this.nodeName||"").toLowerCase()]||"",K=J&&L.attr(J)||"";L.attr(J,a[I](K,H,F))})}$.fn[A]=B(s,A);$.fn[D]=B(s,D);b.pushState=q=function(I,F){if(E(I)&&/^#/.test(I)&&F===i){F=2}var H=I!==i,G=c(p[g][k],H?I:{},H?F:2);p[g][k]=G+(/#/.test(G)?"":"#")};b.getState=u=function(F,G){return F===i||typeof F==="boolean"?v(F):v(G)[F]};b.removeState=function(F){var G={};if(F!==i){G=u();$.each($.isArray(F)?F:arguments,function(I,H){delete G[H]})}q(G,2)};e[d]=$.extend(e[d],{add:function(F){var H;function G(J){var I=J[D]=c();J.getState=function(K,L){return K===i||typeof K==="boolean"?l(I,K):l(I,L)[K]};H.apply(this,arguments)}if($.isFunction(F)){H=F;return G}else{H=F.handler;F.handler=G}}})})(jQuery,this);(function($,i,b){var j,k=$.event.special,c="location",d="hashchange",l="href",f=$.browser,g=document.documentMode,h=f.msie&&(g===b||g<8),e="on"+d in i&&!h;function a(m){m=m||i[c][l];return m.replace(/^[^#]*#?(.*)$/,"$1")}$[d+"Delay"]=100;k[d]=$.extend(k[d],{setup:function(){if(e){return false}$(j.start)},teardown:function(){if(e){return false}$(j.stop)}});j=(function(){var m={},r,n,o,q;function p(){o=q=function(s){return s};if(h){n=$('<iframe src="javascript:0"/>').hide().insertAfter("body")[0].contentWindow;q=function(){return a(n.document[c][l])};o=function(u,s){if(u!==s){var t=n.document;t.open().close();t[c].hash="#"+u}};o(a())}}m.start=function(){if(r){return}var t=a();o||p();(function s(){var v=a(),u=q(t);if(v!==t){o(t=v,u);$(i).trigger(d)}else{if(u!==t){i[c][l]=i[c][l].replace(/#.*/,"")+"#"+u}}r=setTimeout(s,$[d+"Delay"])})()};m.stop=function(){if(!n){r&&clearTimeout(r);r=0}};return m})()})(jQuery,this);;;(function($){$.extend($.fn,{livequery:function(type,fn,fn2){var self=this,q;if($.isFunction(type))
fn2=fn,fn=type,type=undefined;$.each($.livequery.queries,function(i,query){if(self.selector==query.selector&&self.context==query.context&&type==query.type&&(!fn||fn.$lqguid==query.fn.$lqguid)&&(!fn2||fn2.$lqguid==query.fn2.$lqguid))
return(q=query)&&false;});q=q||new $.livequery(this.selector,this.context,type,fn,fn2);q.stopped=false;q.run();return this;},expire:function(type,fn,fn2){var self=this;if($.isFunction(type))
fn2=fn,fn=type,type=undefined;$.each($.livequery.queries,function(i,query){if(self.selector==query.selector&&self.context==query.context&&(!type||type==query.type)&&(!fn||fn.$lqguid==query.fn.$lqguid)&&(!fn2||fn2.$lqguid==query.fn2.$lqguid)&&!this.stopped)
$.livequery.stop(query.id);});return this;}});$.livequery=function(selector,context,type,fn,fn2){this.selector=selector;this.context=context||document;this.type=type;this.fn=fn;this.fn2=fn2;this.elements=[];this.stopped=false;this.id=$.livequery.queries.push(this)-1;fn.$lqguid=fn.$lqguid||$.livequery.guid++;if(fn2)fn2.$lqguid=fn2.$lqguid||$.livequery.guid++;return this;};$.livequery.prototype={stop:function(){var query=this;if(this.type)
this.elements.unbind(this.type,this.fn);else if(this.fn2)
this.elements.each(function(i,el){query.fn2.apply(el);});this.elements=[];this.stopped=true;},run:function(){if(this.stopped)return;var query=this;var oEls=this.elements,els=$(this.selector,this.context),nEls=els.not(oEls);this.elements=els;if(this.type){nEls.bind(this.type,this.fn);if(oEls.length>0)
$.each(oEls,function(i,el){if($.inArray(el,els)<0)
$.event.remove(el,query.type,query.fn);});}
else{nEls.each(function(){query.fn.apply(this);});if(this.fn2&&oEls.length>0)
$.each(oEls,function(i,el){if($.inArray(el,els)<0)
query.fn2.apply(el);});}}};$.extend($.livequery,{guid:0,queries:[],queue:[],running:false,timeout:null,checkQueue:function(){if($.livequery.running&&$.livequery.queue.length){var length=$.livequery.queue.length;while(length--)
$.livequery.queries[$.livequery.queue.shift()].run();}},pause:function(){$.livequery.running=false;},play:function(){$.livequery.running=true;$.livequery.run();},registerPlugin:function(){$.each(arguments,function(i,n){if(!$.fn[n])return;var old=$.fn[n];$.fn[n]=function(){var r=old.apply(this,arguments);$.livequery.run();return r;}});},run:function(id){if(id!=undefined){if($.inArray(id,$.livequery.queue)<0)
$.livequery.queue.push(id);}
else
$.each($.livequery.queries,function(id){if($.inArray(id,$.livequery.queue)<0)
$.livequery.queue.push(id);});if($.livequery.timeout)clearTimeout($.livequery.timeout);$.livequery.timeout=setTimeout($.livequery.checkQueue,20);},stop:function(id){if(id!=undefined)
$.livequery.queries[id].stop();else
$.each($.livequery.queries,function(id){$.livequery.queries[id].stop();});}});$.livequery.registerPlugin('append','prepend','after','before','wrap','attr','removeAttr','addClass','removeClass','toggleClass','empty','remove');$(function(){$.livequery.play();});var init=$.prototype.init;$.prototype.init=function(a,c){var r=init.apply(this,arguments);if(a&&a.selector)
r.context=a.context,r.selector=a.selector;if(typeof a=='string')
r.context=c||document,r.selector=a;return r;};$.prototype.init.prototype=$.prototype;})(jQuery);;;
(function($,w,undefined){w.footable={options:{delay:100,breakpoints:{phone:480,tablet:1024},parsers:{alpha:function(cell){return $(cell).data('value')||$.trim($(cell).text());},numeric:function(cell){var val=$(cell).data('value')||$(cell).text().replace(/[^0-9.\-]/g,'');val=parseFloat(val);if(isNaN(val))val=0;return val;}},addRowToggle:true,calculateWidthOverride:null,toggleSelector:' > tbody > tr:not(.footable-row-detail)',columnDataSelector:'> thead > tr:last-child > th, > thead > tr:last-child > td',detailSeparator:':',toggleHTMLElement:'<span />',createGroupedDetail:function(data){var groups={'_none':{'name':null,'data':[]}};for(var i=0;i<data.length;i++){var groupid=data[i].group;if(groupid!==null){if(!(groupid in groups))
groups[groupid]={'name':data[i].groupName||data[i].group,'data':[]};groups[groupid].data.push(data[i]);}else{groups._none.data.push(data[i]);}}
return groups;},createDetail:function(element,data,createGroupedDetail,separatorChar,classes){var groups=createGroupedDetail(data);for(var group in groups){if(groups[group].data.length===0)continue;if(group!=='_none')element.append('<div class="'+classes.detailInnerGroup+'">'+groups[group].name+'</div>');for(var j=0;j<groups[group].data.length;j++){var separator=(groups[group].data[j].name)?separatorChar:'';element.append('<div class="'+classes.detailInnerRow+'"><div class="'+classes.detailInnerName+'">'+groups[group].data[j].name+separator+'</div><div class="'+classes.detailInnerValue+'">'+groups[group].data[j].display+'</div></div>');}}},classes:{main:'footable',loading:'footable-loading',loaded:'footable-loaded',toggle:'footable-toggle',disabled:'footable-disabled',detail:'footable-row-detail',detailCell:'footable-row-detail-cell',detailInner:'footable-row-detail-inner',detailInnerRow:'footable-row-detail-row',detailInnerGroup:'footable-row-detail-group',detailInnerName:'footable-row-detail-name',detailInnerValue:'footable-row-detail-value',detailShow:'footable-detail-show'},triggers:{initialize:'footable_initialize',resize:'footable_resize',redraw:'footable_redraw',toggleRow:'footable_toggle_row',expandFirstRow:'footable_expand_first_row',expandAll:'footable_expand_all',collapseAll:'footable_collapse_all'},events:{alreadyInitialized:'footable_already_initialized',initializing:'footable_initializing',initialized:'footable_initialized',resizing:'footable_resizing',resized:'footable_resized',redrawn:'footable_redrawn',breakpoint:'footable_breakpoint',columnData:'footable_column_data',rowDetailUpdating:'footable_row_detail_updating',rowDetailUpdated:'footable_row_detail_updated',rowCollapsed:'footable_row_collapsed',rowExpanded:'footable_row_expanded',rowRemoved:'footable_row_removed',reset:'footable_reset'},debug:false,log:null},version:{major:0,minor:5,toString:function(){return w.footable.version.major+'.'+w.footable.version.minor;},parse:function(str){version=/(\d+)\.?(\d+)?\.?(\d+)?/.exec(str);return{major:parseInt(version[1],10)||0,minor:parseInt(version[2],10)||0,patch:parseInt(version[3],10)||0};}},plugins:{_validate:function(plugin){if(!$.isFunction(plugin)){if(w.footable.options.debug===true)console.error('Validation failed, expected type "function", received type "{0}".',typeof plugin);return false;}
var p=new plugin();if(typeof p['name']!=='string'){if(w.footable.options.debug===true)console.error('Validation failed, plugin does not implement a string property called "name".',p);return false;}
if(!$.isFunction(p['init'])){if(w.footable.options.debug===true)console.error('Validation failed, plugin "'+p['name']+'" does not implement a function called "init".',p);return false;}
if(w.footable.options.debug===true)console.log('Validation succeeded for plugin "'+p['name']+'".',p);return true;},registered:[],register:function(plugin,options){if(w.footable.plugins._validate(plugin)){w.footable.plugins.registered.push(plugin);if(typeof options==='object')$.extend(true,w.footable.options,options);}},load:function(instance){var loaded=[],registered,i;for(i=0;i<w.footable.plugins.registered.length;i++){try{registered=w.footable.plugins.registered[i];loaded.push(new registered(instance));}catch(err){if(w.footable.options.debug===true)console.error(err);}}
return loaded;},init:function(instance){for(var i=0;i<instance.plugins.length;i++){try{instance.plugins[i]['init'](instance);}catch(err){if(w.footable.options.debug===true)console.error(err);}}}}};var instanceCount=0;$.fn.footable=function(options){options=options||{};var o=$.extend(true,{},w.footable.options,options);return this.each(function(){instanceCount++;var footable=new Footable(this,o,instanceCount);$(this).data('footable',footable);});};function Timer(){var t=this;t.id=null;t.busy=false;t.start=function(code,milliseconds){if(t.busy){return;}
t.stop();t.id=setTimeout(function(){code();t.id=null;t.busy=false;},milliseconds);t.busy=true;};t.stop=function(){if(t.id!==null){clearTimeout(t.id);t.id=null;t.busy=false;}};}
function Footable(t,o,id){var ft=this;ft.id=id;ft.table=t;ft.options=o;ft.breakpoints=[];ft.breakpointNames='';ft.columns={};ft.plugins=w.footable.plugins.load(ft);var opt=ft.options,cls=opt.classes,evt=opt.events,trg=opt.triggers,indexOffset=0;ft.timers={resize:new Timer(),register:function(name){ft.timers[name]=new Timer();return ft.timers[name];}};ft.init=function(){var $window=$(w),$table=$(ft.table);w.footable.plugins.init(ft);if($table.hasClass(cls.loaded)){ft.raise(evt.alreadyInitialized);return;}
ft.raise(evt.initializing);$table.addClass(cls.loading);$table.find(opt.columnDataSelector).each(function(){var data=ft.getColumnData(this);ft.columns[data.index]=data;});for(var name in opt.breakpoints){ft.breakpoints.push({'name':name,'width':opt.breakpoints[name]});ft.breakpointNames+=(name+' ');}
ft.breakpoints.sort(function(a,b){return a['width']-b['width'];});$table.unbind(trg.initialize).bind(trg.initialize,function(){$table.removeData('footable_info');$table.data('breakpoint','');$table.trigger(trg.resize);$table.removeClass(cls.loading);$table.addClass(cls.loaded).addClass(cls.main);ft.raise(evt.initialized);}).unbind(trg.redraw).bind(trg.redraw,function(){ft.redraw();}).unbind(trg.resize).bind(trg.resize,function(){ft.resize();}).unbind(trg.expandFirstRow).bind(trg.expandFirstRow,function(){$table.find(opt.toggleSelector).first().not('.'+cls.detailShow).trigger(trg.toggleRow);}).unbind(trg.expandAll).bind(trg.expandAll,function(){$table.find(opt.toggleSelector).not('.'+cls.detailShow).trigger(trg.toggleRow);}).unbind(trg.collapseAll).bind(trg.collapseAll,function(){$table.find('.'+cls.detailShow).trigger(trg.toggleRow);});$table.trigger(trg.initialize);$window.bind('resize.footable',function(){ft.timers.resize.stop();ft.timers.resize.start(function(){ft.raise(trg.resize);},opt.delay);});};ft.addRowToggle=function(){if(!opt.addRowToggle)return;var $table=$(ft.table),hasToggleColumn=false;$table.find('span.'+cls.toggle).remove();for(var c in ft.columns){var col=ft.columns[c];if(col.toggle){hasToggleColumn=true;var selector='> tbody > tr:not(.'+cls.detail+',.'+cls.disabled+') > td:nth-child('+(parseInt(col.index,10)+1)+')';$table.find(selector).not('.'+cls.detailCell).prepend($(opt.toggleHTMLElement).addClass(cls.toggle));return;}}
if(!hasToggleColumn){$table.find('> tbody > tr:not(.'+cls.detail+',.'+cls.disabled+') > td:first-child').not('.'+cls.detailCell).prepend($(opt.toggleHTMLElement).addClass(cls.toggle));}};ft.setColumnClasses=function(){$table=$(ft.table);for(var c in ft.columns){var col=ft.columns[c];if(col.className!==null){var selector='',first=true;$.each(col.matches,function(m,match){if(!first)selector+=', ';selector+='> tbody > tr:not(.'+cls.detail+') > td:nth-child('+(parseInt(match,10)+1)+')';first=false;});$table.find(selector).not('.'+cls.detailCell).addClass(col.className);}}};ft.bindToggleSelectors=function(){var $table=$(ft.table);if(!ft.hasAnyBreakpointColumn())return;$table.find(opt.toggleSelector).unbind(trg.toggleRow).bind(trg.toggleRow,function(e){var $row=$(this).is('tr')?$(this):$(this).parents('tr:first');ft.toggleDetail($row);});$table.find(opt.toggleSelector).unbind('click.footable').bind('click.footable',function(e){if($table.is('.breakpoint')&&$(e.target).is('td,.'+cls.toggle)){$(this).trigger(trg.toggleRow);}});};ft.parse=function(cell,column){var parser=opt.parsers[column.type]||opt.parsers.alpha;return parser(cell);};ft.getColumnData=function(th){var $th=$(th),hide=$th.data('hide'),index=$th.index();hide=hide||'';hide=jQuery.map(hide.split(','),function(a){return jQuery.trim(a);});var data={'index':index,'hide':{},'type':$th.data('type')||'alpha','name':$th.data('name')||$.trim($th.text()),'ignore':$th.data('ignore')||false,'toggle':$th.data('toggle')||false,'className':$th.data('class')||null,'matches':[],'names':{},'group':$th.data('group')||null,'groupName':null};if(data.group!==null){var $group=$(ft.table).find('> thead > tr.footable-group-row > th[data-group="'+data.group+'"], > thead > tr.footable-group-row > td[data-group="'+data.group+'"]').first();data.groupName=ft.parse($group,{'type':'alpha'});}
var pcolspan=parseInt($th.prev().attr('colspan')||0,10);indexOffset+=pcolspan>1?pcolspan-1:0;var colspan=parseInt($th.attr('colspan')||0,10),curindex=data.index+indexOffset;if(colspan>1){var names=$th.data('names');names=names||'';names=names.split(',');for(var i=0;i<colspan;i++){data.matches.push(i+curindex);if(i<names.length)data.names[i+curindex]=names[i];}}else{data.matches.push(curindex);}
data.hide['default']=($th.data('hide')==="all")||($.inArray('default',hide)>=0);var hasBreakpoint=false;for(var name in opt.breakpoints){data.hide[name]=($th.data('hide')==="all")||($.inArray(name,hide)>=0);hasBreakpoint=hasBreakpoint||data.hide[name];}
data.hasBreakpoint=hasBreakpoint;var e=ft.raise(evt.columnData,{'column':{'data':data,'th':th}});return e.column.data;};ft.getViewportWidth=function(){return window.innerWidth||(document.body?document.body.offsetWidth:0);};ft.calculateWidth=function($table,info){if(jQuery.isFunction(opt.calculateWidthOverride)){return opt.calculateWidthOverride($table,info);}
if(info.viewportWidth<info.width)info.width=info.viewportWidth;if(info.parentWidth<info.width)info.width=info.parentWidth;return info;};ft.hasBreakpointColumn=function(breakpoint){for(var c in ft.columns){if(ft.columns[c].hide[breakpoint]){if(ft.columns[c].ignore){continue;}
return true;}}
return false;};ft.hasAnyBreakpointColumn=function(){for(var c in ft.columns){if(ft.columns[c].hasBreakpoint){return true;}}
return false;};ft.resize=function(){var $table=$(ft.table);if(!$table.is(':visible')){return;}
if(!ft.hasAnyBreakpointColumn()){return;}
var info={'width':$table.width(),'viewportWidth':ft.getViewportWidth(),'parentWidth':$table.parent().width()};info=ft.calculateWidth($table,info);var pinfo=$table.data('footable_info');$table.data('footable_info',info);ft.raise(evt.resizing,{'old':pinfo,'info':info});if(!pinfo||(pinfo&&pinfo.width&&pinfo.width!==info.width)){var current=null,breakpoint;for(var i=0;i<ft.breakpoints.length;i++){breakpoint=ft.breakpoints[i];if(breakpoint&&breakpoint.width&&info.width<=breakpoint.width){current=breakpoint;break;}}
var breakpointName=(current===null?'default':current['name']),hasBreakpointFired=ft.hasBreakpointColumn(breakpointName),previousBreakpoint=$table.data('breakpoint');$table.data('breakpoint',breakpointName).removeClass('default breakpoint').removeClass(ft.breakpointNames).addClass(breakpointName+(hasBreakpointFired?' breakpoint':''));if(breakpointName!==previousBreakpoint){$table.trigger(trg.redraw);ft.raise(evt.breakpoint,{'breakpoint':breakpointName,'info':info});}}
ft.raise(evt.resized,{'old':pinfo,'info':info});};ft.redraw=function(){ft.addRowToggle();ft.bindToggleSelectors();ft.setColumnClasses();var $table=$(ft.table),breakpointName=$table.data('breakpoint'),hasBreakpointFired=ft.hasBreakpointColumn(breakpointName);$table.find('> tbody > tr:not(.'+cls.detail+')').data('detail_created',false).end().find('> thead > tr:last-child > th').each(function(){var data=ft.columns[$(this).index()],selector='',first=true;$.each(data.matches,function(m,match){if(!first){selector+=', ';}
var count=match+1;selector+='> tbody > tr:not(.'+cls.detail+') > td:nth-child('+count+')';selector+=', > tfoot > tr:not(.'+cls.detail+') > td:nth-child('+count+')';selector+=', > colgroup > col:nth-child('+count+')';first=false;});selector+=', > thead > tr[data-group-row="true"] > th[data-group="'+data.group+'"]';var $column=$table.find(selector).add(this);if(breakpointName!==''){if(data.hide[breakpointName]===false)$column.addClass('footable-visible').show();else $column.removeClass('footable-visible').hide();}
if($table.find('> thead > tr.footable-group-row').length===1){var $groupcols=$table.find('> thead > tr:last-child > th[data-group="'+data.group+'"]:visible, > thead > tr:last-child > th[data-group="'+data.group+'"]:visible'),$group=$table.find('> thead > tr.footable-group-row > th[data-group="'+data.group+'"], > thead > tr.footable-group-row > td[data-group="'+data.group+'"]'),groupspan=0;$.each($groupcols,function(){groupspan+=parseInt($(this).attr('colspan')||1,10);});if(groupspan>0)$group.attr('colspan',groupspan).show();else $group.hide();}}).end().find('> tbody > tr.'+cls.detailShow).each(function(){ft.createOrUpdateDetailRow(this);});$table.find('> tbody > tr.'+cls.detailShow+':visible').each(function(){var $next=$(this).next();if($next.hasClass(cls.detail)){if(!hasBreakpointFired)$next.hide();else $next.show();}});$table.find('> thead > tr > th.footable-last-column, > tbody > tr > td.footable-last-column').removeClass('footable-last-column');$table.find('> thead > tr > th.footable-first-column, > tbody > tr > td.footable-first-column').removeClass('footable-first-column');$table.find('> thead > tr, > tbody > tr').find('> th.footable-visible:last, > td.footable-visible:last').addClass('footable-last-column').end().find('> th.footable-visible:first, > td.footable-visible:first').addClass('footable-first-column');ft.raise(evt.redrawn);};ft.toggleDetail=function(row){var $row=(row.jquery)?row:$(row),$next=$row.next();if($row.hasClass(cls.detailShow)){$row.removeClass(cls.detailShow);if($next.hasClass(cls.detail))$next.hide();ft.raise(evt.rowCollapsed,{'row':$row[0]});}else{ft.createOrUpdateDetailRow($row[0]);$row.addClass(cls.detailShow).next().show();ft.raise(evt.rowExpanded,{'row':$row[0]});}};ft.removeRow=function(row){var $row=(row.jquery)?row:$(row);if($row.hasClass(cls.detail)){$row=$row.prev();}
var $next=$row.next();if($row.data('detail_created')===true){$next.remove();}
$row.remove();ft.raise(evt.rowRemoved);};ft.appendRow=function(row){var $row=(row.jquery)?row:$(row);$(ft.table).find('tbody').append($row);ft.redraw();};ft.getColumnFromTdIndex=function(index){var result=null;for(var column in ft.columns){if($.inArray(index,ft.columns[column].matches)>=0){result=ft.columns[column];break;}}
return result;};ft.createOrUpdateDetailRow=function(actualRow){var $row=$(actualRow),$next=$row.next(),$detail,values=[];if($row.data('detail_created')===true)return true;if($row.is(':hidden'))return false;ft.raise(evt.rowDetailUpdating,{'row':$row,'detail':$next});$row.find('> td:hidden').each(function(){var index=$(this).index(),column=ft.getColumnFromTdIndex(index),name=column.name;if(column.ignore===true)return true;if(index in column.names)name=column.names[index];values.push({'name':name,'value':ft.parse(this,column),'display':$.trim($(this).html()),'group':column.group,'groupName':column.groupName});return true;});if(values.length===0)return false;var colspan=$row.find('> td:visible').length;var exists=$next.hasClass(cls.detail);if(!exists){$next=$('<tr class="'+cls.detail+'"><td class="'+cls.detailCell+'"><div class="'+cls.detailInner+'"></div></td></tr>');$row.after($next);}
$next.find('> td:first').attr('colspan',colspan);$detail=$next.find('.'+cls.detailInner).empty();opt.createDetail($detail,values,opt.createGroupedDetail,opt.detailSeparator,cls);$row.data('detail_created',true);ft.raise(evt.rowDetailUpdated,{'row':$row,'detail':$next});return!exists;};ft.raise=function(eventName,args){if(ft.options.debug===true&&$.isFunction(ft.options.log))ft.options.log(eventName,'event');args=args||{};var def={'ft':ft};$.extend(true,def,args);var e=$.Event(eventName,def);if(!e.ft){$.extend(true,e,def);}
$(ft.table).trigger(e);return e;};ft.reset=function(){var $table=$(ft.table);$table.removeData('footable_info').data('breakpoint','').removeClass(cls.loading).removeClass(cls.loaded);$table.find(opt.toggleSelector).unbind(trg.toggleRow).unbind('click.footable');$table.find('> tbody > tr').removeClass(cls.detailShow);$table.find('> tbody > tr.'+cls.detail).remove();ft.raise(evt.reset);};ft.init();return ft;}})(jQuery,window);;;(function(){var root=this;var previousBackbone=root.Backbone;var slice=Array.prototype.slice;var splice=Array.prototype.splice;var Backbone;if(typeof exports!=='undefined'){Backbone=exports;}else{Backbone=root.Backbone={};}
Backbone.VERSION='0.9.2';var _=root._;if(!_&&(typeof require!=='undefined'))_=require('underscore');var $=root.jQuery||root.Zepto||root.ender;Backbone.setDomLibrary=function(lib){$=lib;};Backbone.noConflict=function(){root.Backbone=previousBackbone;return this;};Backbone.emulateHTTP=false;Backbone.emulateJSON=false;var eventSplitter=/\s+/;var Events=Backbone.Events={on:function(events,callback,context){var calls,event,node,tail,list;if(!callback)return this;events=events.split(eventSplitter);calls=this._callbacks||(this._callbacks={});while(event=events.shift()){list=calls[event];node=list?list.tail:{};node.next=tail={};node.context=context;node.callback=callback;calls[event]={tail:tail,next:list?list.next:node};}
return this;},off:function(events,callback,context){var event,calls,node,tail,cb,ctx;if(!(calls=this._callbacks))return;if(!(events||callback||context)){delete this._callbacks;return this;}
events=events?events.split(eventSplitter):_.keys(calls);while(event=events.shift()){node=calls[event];delete calls[event];if(!node||!(callback||context))continue;tail=node.tail;while((node=node.next)!==tail){cb=node.callback;ctx=node.context;if((callback&&cb!==callback)||(context&&ctx!==context)){this.on(event,cb,ctx);}}}
return this;},trigger:function(events){var event,node,calls,tail,args,all,rest;if(!(calls=this._callbacks))return this;all=calls.all;events=events.split(eventSplitter);rest=slice.call(arguments,1);while(event=events.shift()){if(node=calls[event]){tail=node.tail;while((node=node.next)!==tail){node.callback.apply(node.context||this,rest);}}
if(node=all){tail=node.tail;args=[event].concat(rest);while((node=node.next)!==tail){node.callback.apply(node.context||this,args);}}}
return this;}};Events.bind=Events.on;Events.unbind=Events.off;var Model=Backbone.Model=function(attributes,options){var defaults;attributes||(attributes={});if(options&&options.parse)attributes=this.parse(attributes);if(defaults=getValue(this,'defaults')){attributes=_.extend({},defaults,attributes);}
if(options&&options.collection)this.collection=options.collection;this.attributes={};this._escapedAttributes={};this.cid=_.uniqueId('c');this.changed={};this._silent={};this._pending={};this.set(attributes,{silent:true});this.changed={};this._silent={};this._pending={};this._previousAttributes=_.clone(this.attributes);this.initialize.apply(this,arguments);};_.extend(Model.prototype,Events,{changed:null,_silent:null,_pending:null,idAttribute:'id',initialize:function(){},toJSON:function(options){return _.clone(this.attributes);},get:function(attr){return this.attributes[attr];},escape:function(attr){var html;if(html=this._escapedAttributes[attr])return html;var val=this.get(attr);return this._escapedAttributes[attr]=_.escape(val==null?'':''+val);},has:function(attr){return this.get(attr)!=null;},set:function(key,value,options){var attrs,attr,val;if(_.isObject(key)||key==null){attrs=key;options=value;}else{attrs={};attrs[key]=value;}
options||(options={});if(!attrs)return this;if(attrs instanceof Model)attrs=attrs.attributes;if(options.unset)for(attr in attrs)attrs[attr]=void 0;if(!this._validate(attrs,options))return false;if(this.idAttribute in attrs)this.id=attrs[this.idAttribute];var changes=options.changes={};var now=this.attributes;var escaped=this._escapedAttributes;var prev=this._previousAttributes||{};for(attr in attrs){val=attrs[attr];if(!_.isEqual(now[attr],val)||(options.unset&&_.has(now,attr))){delete escaped[attr];(options.silent?this._silent:changes)[attr]=true;}
options.unset?delete now[attr]:now[attr]=val;if(!_.isEqual(prev[attr],val)||(_.has(now,attr)!=_.has(prev,attr))){this.changed[attr]=val;if(!options.silent)this._pending[attr]=true;}else{delete this.changed[attr];delete this._pending[attr];}}
if(!options.silent)this.change(options);return this;},unset:function(attr,options){(options||(options={})).unset=true;return this.set(attr,null,options);},clear:function(options){(options||(options={})).unset=true;return this.set(_.clone(this.attributes),options);},fetch:function(options){options=options?_.clone(options):{};var model=this;var success=options.success;options.success=function(resp,status,xhr){if(!model.set(model.parse(resp,xhr),options))return false;if(success)success(model,resp);};options.error=Backbone.wrapError(options.error,model,options);return(this.sync||Backbone.sync).call(this,'read',this,options);},save:function(key,value,options){var attrs,current;if(_.isObject(key)||key==null){attrs=key;options=value;}else{attrs={};attrs[key]=value;}
options=options?_.clone(options):{};if(options.wait){if(!this._validate(attrs,options))return false;current=_.clone(this.attributes);}
var silentOptions=_.extend({},options,{silent:true});if(attrs&&!this.set(attrs,options.wait?silentOptions:options)){return false;}
var model=this;var success=options.success;options.success=function(resp,status,xhr){var serverAttrs=model.parse(resp,xhr);if(options.wait){delete options.wait;serverAttrs=_.extend(attrs||{},serverAttrs);}
if(!model.set(serverAttrs,options))return false;if(success){success(model,resp);}else{model.trigger('sync',model,resp,options);}};options.error=Backbone.wrapError(options.error,model,options);var method=this.isNew()?'create':'update';var xhr=(this.sync||Backbone.sync).call(this,method,this,options);if(options.wait)this.set(current,silentOptions);return xhr;},destroy:function(options){options=options?_.clone(options):{};var model=this;var success=options.success;var triggerDestroy=function(){model.trigger('destroy',model,model.collection,options);};if(this.isNew()){triggerDestroy();return false;}
options.success=function(resp){if(options.wait)triggerDestroy();if(success){success(model,resp);}else{model.trigger('sync',model,resp,options);}};options.error=Backbone.wrapError(options.error,model,options);var xhr=(this.sync||Backbone.sync).call(this,'delete',this,options);if(!options.wait)triggerDestroy();return xhr;},url:function(){var base=getValue(this,'urlRoot')||getValue(this.collection,'url')||urlError();if(this.isNew())return base;return base+(base.charAt(base.length-1)=='/'?'':'/')+encodeURIComponent(this.id);},parse:function(resp,xhr){return resp;},clone:function(){return new this.constructor(this.attributes);},isNew:function(){return this.id==null;},change:function(options){options||(options={});var changing=this._changing;this._changing=true;for(var attr in this._silent)this._pending[attr]=true;var changes=_.extend({},options.changes,this._silent);this._silent={};for(var attr in changes){this.trigger('change:'+attr,this,this.get(attr),options);}
if(changing)return this;while(!_.isEmpty(this._pending)){this._pending={};this.trigger('change',this,options);for(var attr in this.changed){if(this._pending[attr]||this._silent[attr])continue;delete this.changed[attr];}
this._previousAttributes=_.clone(this.attributes);}
this._changing=false;return this;},hasChanged:function(attr){if(!arguments.length)return!_.isEmpty(this.changed);return _.has(this.changed,attr);},changedAttributes:function(diff){if(!diff)return this.hasChanged()?_.clone(this.changed):false;var val,changed=false,old=this._previousAttributes;for(var attr in diff){if(_.isEqual(old[attr],(val=diff[attr])))continue;(changed||(changed={}))[attr]=val;}
return changed;},previous:function(attr){if(!arguments.length||!this._previousAttributes)return null;return this._previousAttributes[attr];},previousAttributes:function(){return _.clone(this._previousAttributes);},isValid:function(){return!this.validate(this.attributes);},_validate:function(attrs,options){if(options.silent||!this.validate)return true;attrs=_.extend({},this.attributes,attrs);var error=this.validate(attrs,options);if(!error)return true;if(options&&options.error){options.error(this,error,options);}else{this.trigger('error',this,error,options);}
return false;}});var Collection=Backbone.Collection=function(models,options){options||(options={});if(options.model)this.model=options.model;if(options.comparator)this.comparator=options.comparator;this._reset();this.initialize.apply(this,arguments);if(models)this.reset(models,{silent:true,parse:options.parse});};_.extend(Collection.prototype,Events,{model:Model,initialize:function(){},toJSON:function(options){return this.map(function(model){return model.toJSON(options);});},add:function(models,options){var i,index,length,model,cid,id,cids={},ids={},dups=[];options||(options={});models=_.isArray(models)?models.slice():[models];for(i=0,length=models.length;i<length;i++){if(!(model=models[i]=this._prepareModel(models[i],options))){throw new Error("Can't add an invalid model to a collection");}
cid=model.cid;id=model.id;if(cids[cid]||this._byCid[cid]||((id!=null)&&(ids[id]||this._byId[id]))){dups.push(i);continue;}
cids[cid]=ids[id]=model;}
i=dups.length;while(i--){models.splice(dups[i],1);}
for(i=0,length=models.length;i<length;i++){(model=models[i]).on('all',this._onModelEvent,this);this._byCid[model.cid]=model;if(model.id!=null)this._byId[model.id]=model;}
this.length+=length;index=options.at!=null?options.at:this.models.length;splice.apply(this.models,[index,0].concat(models));if(this.comparator)this.sort({silent:true});if(options.silent)return this;for(i=0,length=this.models.length;i<length;i++){if(!cids[(model=this.models[i]).cid])continue;options.index=i;model.trigger('add',model,this,options);}
return this;},remove:function(models,options){var i,l,index,model;options||(options={});models=_.isArray(models)?models.slice():[models];for(i=0,l=models.length;i<l;i++){model=this.getByCid(models[i])||this.get(models[i]);if(!model)continue;delete this._byId[model.id];delete this._byCid[model.cid];index=this.indexOf(model);this.models.splice(index,1);this.length--;if(!options.silent){options.index=index;model.trigger('remove',model,this,options);}
this._removeReference(model);}
return this;},push:function(model,options){model=this._prepareModel(model,options);this.add(model,options);return model;},pop:function(options){var model=this.at(this.length-1);this.remove(model,options);return model;},unshift:function(model,options){model=this._prepareModel(model,options);this.add(model,_.extend({at:0},options));return model;},shift:function(options){var model=this.at(0);this.remove(model,options);return model;},get:function(id){if(id==null)return void 0;return this._byId[id.id!=null?id.id:id];},getByCid:function(cid){return cid&&this._byCid[cid.cid||cid];},at:function(index){return this.models[index];},where:function(attrs){if(_.isEmpty(attrs))return[];return this.filter(function(model){for(var key in attrs){if(attrs[key]!==model.get(key))return false;}
return true;});},sort:function(options){options||(options={});if(!this.comparator)throw new Error('Cannot sort a set without a comparator');var boundComparator=_.bind(this.comparator,this);if(this.comparator.length==1){this.models=this.sortBy(boundComparator);}else{this.models.sort(boundComparator);}
if(!options.silent)this.trigger('reset',this,options);return this;},pluck:function(attr){return _.map(this.models,function(model){return model.get(attr);});},reset:function(models,options){models||(models=[]);options||(options={});for(var i=0,l=this.models.length;i<l;i++){this._removeReference(this.models[i]);}
this._reset();this.add(models,_.extend({silent:true},options));if(!options.silent)this.trigger('reset',this,options);return this;},fetch:function(options){options=options?_.clone(options):{};if(options.parse===undefined)options.parse=true;var collection=this;var success=options.success;options.success=function(resp,status,xhr){collection[options.add?'add':'reset'](collection.parse(resp,xhr),options);if(success)success(collection,resp);};options.error=Backbone.wrapError(options.error,collection,options);return(this.sync||Backbone.sync).call(this,'read',this,options);},create:function(model,options){var coll=this;options=options?_.clone(options):{};model=this._prepareModel(model,options);if(!model)return false;if(!options.wait)coll.add(model,options);var success=options.success;options.success=function(nextModel,resp,xhr){if(options.wait)coll.add(nextModel,options);if(success){success(nextModel,resp);}else{nextModel.trigger('sync',model,resp,options);}};model.save(null,options);return model;},parse:function(resp,xhr){return resp;},chain:function(){return _(this.models).chain();},_reset:function(options){this.length=0;this.models=[];this._byId={};this._byCid={};},_prepareModel:function(model,options){options||(options={});if(!(model instanceof Model)){var attrs=model;options.collection=this;model=new this.model(attrs,options);if(!model._validate(model.attributes,options))model=false;}else if(!model.collection){model.collection=this;}
return model;},_removeReference:function(model){if(this==model.collection){delete model.collection;}
model.off('all',this._onModelEvent,this);},_onModelEvent:function(event,model,collection,options){if((event=='add'||event=='remove')&&collection!=this)return;if(event=='destroy'){this.remove(model,options);}
if(model&&event==='change:'+model.idAttribute){delete this._byId[model.previous(model.idAttribute)];this._byId[model.id]=model;}
this.trigger.apply(this,arguments);}});var methods=['forEach','each','map','reduce','reduceRight','find','detect','filter','select','reject','every','all','some','any','include','contains','invoke','max','min','sortBy','sortedIndex','toArray','size','first','initial','rest','last','without','indexOf','shuffle','lastIndexOf','isEmpty','groupBy'];_.each(methods,function(method){Collection.prototype[method]=function(){return _[method].apply(_,[this.models].concat(_.toArray(arguments)));};});var Router=Backbone.Router=function(options){options||(options={});if(options.routes)this.routes=options.routes;this._bindRoutes();this.initialize.apply(this,arguments);};var namedParam=/:\w+/g;var splatParam=/\*\w+/g;var escapeRegExp=/[-[\]{}()+?.,\\^$|#\s]/g;_.extend(Router.prototype,Events,{initialize:function(){},route:function(route,name,callback){Backbone.history||(Backbone.history=new History);if(!_.isRegExp(route))route=this._routeToRegExp(route);if(!callback)callback=this[name];Backbone.history.route(route,_.bind(function(fragment){var args=this._extractParameters(route,fragment);callback&&callback.apply(this,args);this.trigger.apply(this,['route:'+name].concat(args));Backbone.history.trigger('route',this,name,args);},this));return this;},navigate:function(fragment,options){Backbone.history.navigate(fragment,options);},_bindRoutes:function(){if(!this.routes)return;var routes=[];for(var route in this.routes){routes.unshift([route,this.routes[route]]);}
for(var i=0,l=routes.length;i<l;i++){this.route(routes[i][0],routes[i][1],this[routes[i][1]]);}},_routeToRegExp:function(route){route=route.replace(escapeRegExp,'\\$&').replace(namedParam,'([^\/]+)').replace(splatParam,'(.*?)');return new RegExp('^'+route+'$');},_extractParameters:function(route,fragment){return route.exec(fragment).slice(1);}});var History=Backbone.History=function(){this.handlers=[];_.bindAll(this,'checkUrl');};var routeStripper=/^[#\/]/;var isExplorer=/msie [\w.]+/;History.started=false;_.extend(History.prototype,Events,{interval:50,getHash:function(windowOverride){var loc=windowOverride?windowOverride.location:window.location;var match=loc.href.match(/#(.*)$/);return match?match[1]:'';},getFragment:function(fragment,forcePushState){if(fragment==null){if(this._hasPushState||forcePushState){fragment=window.location.pathname;var search=window.location.search;if(search)fragment+=search;}else{fragment=this.getHash();}}
if(!fragment.indexOf(this.options.root))fragment=fragment.substr(this.options.root.length);return fragment.replace(routeStripper,'');},start:function(options){if(History.started)throw new Error("Backbone.history has already been started");History.started=true;this.options=_.extend({},{root:'/'},this.options,options);this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var fragment=this.getFragment();var docMode=document.documentMode;var oldIE=(isExplorer.exec(navigator.userAgent.toLowerCase())&&(!docMode||docMode<=7));if(oldIE){this.iframe=$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo('body')[0].contentWindow;this.navigate(fragment);}
if(this._hasPushState){$(window).bind('popstate',this.checkUrl);}else if(this._wantsHashChange&&('onhashchange'in window)&&!oldIE){$(window).bind('hashchange',this.checkUrl);}else if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval);}
this.fragment=fragment;var loc=window.location;var atRoot=loc.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!atRoot){this.fragment=this.getFragment(null,true);window.location.replace(this.options.root+'#'+this.fragment);return true;}else if(this._wantsPushState&&this._hasPushState&&atRoot&&loc.hash){this.fragment=this.getHash().replace(routeStripper,'');window.history.replaceState({},document.title,loc.protocol+'//'+loc.host+this.options.root+this.fragment);}
if(!this.options.silent){return this.loadUrl();}},stop:function(){$(window).unbind('popstate',this.checkUrl).unbind('hashchange',this.checkUrl);clearInterval(this._checkUrlInterval);History.started=false;},route:function(route,callback){this.handlers.unshift({route:route,callback:callback});},checkUrl:function(e){var current=this.getFragment();if(current==this.fragment&&this.iframe)current=this.getFragment(this.getHash(this.iframe));if(current==this.fragment)return false;if(this.iframe)this.navigate(current);this.loadUrl()||this.loadUrl(this.getHash());},loadUrl:function(fragmentOverride){var fragment=this.fragment=this.getFragment(fragmentOverride);var matched=_.any(this.handlers,function(handler){if(handler.route.test(fragment)){handler.callback(fragment);return true;}});return matched;},navigate:function(fragment,options){if(!History.started)return false;if(!options||options===true)options={trigger:options};var frag=(fragment||'').replace(routeStripper,'');if(this.fragment==frag)return;if(this._hasPushState){if(frag.indexOf(this.options.root)!=0)frag=this.options.root+frag;this.fragment=frag;window.history[options.replace?'replaceState':'pushState']({},document.title,frag);}else if(this._wantsHashChange){this.fragment=frag;this._updateHash(window.location,frag,options.replace);if(this.iframe&&(frag!=this.getFragment(this.getHash(this.iframe)))){if(!options.replace)this.iframe.document.open().close();this._updateHash(this.iframe.location,frag,options.replace);}}else{window.location.assign(this.options.root+fragment);}
if(options.trigger)this.loadUrl(fragment);},_updateHash:function(location,fragment,replace){if(replace){location.replace(location.toString().replace(/(javascript:|#).*$/,'')+'#'+fragment);}else{location.hash=fragment;}}});var View=Backbone.View=function(options){this.cid=_.uniqueId('view');this._configure(options||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents();};var delegateEventSplitter=/^(\S+)\s*(.*)$/;var viewOptions=['model','collection','el','id','attributes','className','tagName'];_.extend(View.prototype,Events,{tagName:'div',$:function(selector){return this.$el.find(selector);},initialize:function(){},render:function(){return this;},remove:function(){this.$el.remove();return this;},make:function(tagName,attributes,content){var el=document.createElement(tagName);if(attributes)$(el).attr(attributes);if(content)$(el).html(content);return el;},setElement:function(element,delegate){if(this.$el)this.undelegateEvents();this.$el=(element instanceof $)?element:$(element);this.el=this.$el[0];if(delegate!==false)this.delegateEvents();return this;},delegateEvents:function(events){if(!(events||(events=getValue(this,'events'))))return;this.undelegateEvents();for(var key in events){var method=events[key];if(!_.isFunction(method))method=this[events[key]];if(!method)throw new Error('Method "'+events[key]+'" does not exist');var match=key.match(delegateEventSplitter);var eventName=match[1],selector=match[2];method=_.bind(method,this);eventName+='.delegateEvents'+this.cid;if(selector===''){this.$el.bind(eventName,method);}else{this.$el.delegate(selector,eventName,method);}}},undelegateEvents:function(){this.$el.unbind('.delegateEvents'+this.cid);},_configure:function(options){if(this.options)options=_.extend({},this.options,options);for(var i=0,l=viewOptions.length;i<l;i++){var attr=viewOptions[i];if(options[attr])this[attr]=options[attr];}
this.options=options;},_ensureElement:function(){if(!this.el){var attrs=getValue(this,'attributes')||{};if(this.id)attrs.id=this.id;if(this.className)attrs['class']=this.className;this.setElement(this.make(this.tagName,attrs),false);}else{this.setElement(this.el,false);}}});var extend=function(protoProps,classProps){var child=inherits(this,protoProps,classProps);child.extend=this.extend;return child;};Model.extend=Collection.extend=Router.extend=View.extend=extend;var methodMap={'create':'POST','update':'PUT','delete':'DELETE','read':'GET'};Backbone.sync=function(method,model,options){var type=methodMap[method];options||(options={});var params={type:type,dataType:'json'};if(!options.url){params.url=getValue(model,'url')||urlError();}
if(!options.data&&model&&(method=='create'||method=='update')){params.contentType='application/json';params.data=JSON.stringify(model.toJSON());}
if(Backbone.emulateJSON){params.contentType='application/x-www-form-urlencoded';params.data=params.data?{model:params.data}:{};}
if(Backbone.emulateHTTP){if(type==='PUT'||type==='DELETE'){if(Backbone.emulateJSON)params.data._method=type;params.type='POST';params.beforeSend=function(xhr){xhr.setRequestHeader('X-HTTP-Method-Override',type);};}}
if(params.type!=='GET'&&!Backbone.emulateJSON){params.processData=false;}
return $.ajax(_.extend(params,options));};Backbone.wrapError=function(onError,originalModel,options){return function(model,resp){resp=model===originalModel?resp:model;if(onError){onError(originalModel,resp,options);}else{originalModel.trigger('error',originalModel,resp,options);}};};var ctor=function(){};var inherits=function(parent,protoProps,staticProps){var child;if(protoProps&&protoProps.hasOwnProperty('constructor')){child=protoProps.constructor;}else{child=function(){parent.apply(this,arguments);};}
_.extend(child,parent);ctor.prototype=parent.prototype;child.prototype=new ctor();if(protoProps)_.extend(child.prototype,protoProps);if(staticProps)_.extend(child,staticProps);child.prototype.constructor=child;child.__super__=parent.prototype;return child;};var getValue=function(object,prop){if(!(object&&object[prop]))return null;return _.isFunction(object[prop])?object[prop]():object[prop];};var urlError=function(){throw new Error('A "url" property or function must be specified');};}).call(this);;;var featherOnLoaded=false;function featherEditorInstance(img,src,onSaveSuccessFunction,options){if(options===undefined)options={};ss_require(['//dme0ih8comzn4.cloudfront.net/imaging/v3/editor.js'],function(module){var featherEditor=new Aviary.Feather({apiKey:'b4c9b9bca8c94cb48883e3abe84a8c04',onSave:function(imageID,newURL){var img=document.getElementById(imageID);img.src=newURL;featherEditor.showWaitIndicator();fetchAndUpload(newURL,onSaveSuccessFunction,featherEditor);},onLoad:function(){featherOnLoaded=true;launchFeatherEditor();}});function launchFeatherEditor(){basic_options={'image':img,'url':src,'maxSize':2000};for(var attrname in basic_options){options[attrname]=basic_options[attrname];}
featherEditor.launch(options);}
if(featherOnLoaded){launchFeatherEditor();}});}
function fetchAndUpload(url,onSaveSuccessFunction,featherEditor){$.ajax({url:"/silkcon/fetch_and_upload",type:"POST",data:{file_url:url},success:function(data)
{onSaveSuccessFunction(data);featherEditor.close();},error:function(jqXHR,textStatus,errorThrown)
{alert('Failed to save and store the image. Please contact a SilkStart support agent: support@silkstart.com. * Error: '+errorThrown);}});};;(function($){$.ss={"enable_datepickers":function(container,options){var settings={'validate_on_close':true};$.extend(true,settings,options);$('.date_input',container).datepicker({dateFormat:'dd M yy',onClose:function(){if(settings.validate_on_close){$(this).valid();}}});},"dialog":{"input":function(title,callback,initial_value){var content=$('<div class="">').append($('<input type="text">').val(initial_value||''));$('<div>').ssdialog({'content':{'html':content,'refresh_on_show':true},'title':title,'focus_input':true,'buttons':{'Save':null,'OK':function(namespace){var value=this.data(namespace).container.find('input').val().trim();if(!value){alert("Please enter a value.");}else{callback=_.bind(callback,{"value":value});callback();this[namespace]('hide');}}}});},"message":function(title,message,callback){$('<div>').ssdialog({'content':{'html':"<span>"+message+"</span>",'refresh_on_show':true},'title':title,'buttons':{'Save':null,'Cancel':null,'OK':function(namespace){if(callback){callback();}
this[namespace]('hide');}}});},"confirm":function(title,message,callback,ok_button_text,cancel_button_text){ok_button_text=ok_button_text||"OK";cancel_button_text=cancel_button_text||"Cancel";var buttons={'Save':null,'Cancel':null};buttons[cancel_button_text]=function(namespace){if(callback){callback=_.bind(callback,{"confirmed":false});callback();}
this[namespace]('hide');};buttons[ok_button_text]=function(namespace){if(callback){callback=_.bind(callback,{"confirmed":true});callback();}
this[namespace]('hide');};$('<div>').ssdialog({'content':{'html':"<span>"+message+"</span>",'refresh_on_show':true},'title':title,'buttons':buttons});}},"wysiwyg":{"create":function($input,options){ss_require(['/res/js/os/jquery-wysiwyg/jquery.wysiwyg.js'],function(module){ss_require(['/res/js/os/jquery-wysiwyg/controls/wysiwyg.link.js','/res/js/os/jquery-wysiwyg/controls/wysiwyg.image.js'],function(module){options=options||{};var settings={"callback_fun":null,"use_wysiwyg_blur_callback":true,"hide_html_and_formatting":false};$.extend(true,settings,options);var wysiwyg_blur_fun=function(event,wysiwyg_data){var $element=wysiwyg_data.element;if($element.hasClass('focus_shadow')){wysiwyg_data.element.removeClass('focus_shadow');if(settings.callback_fun){settings.callback_fun(event,wysiwyg_data);}}};var frames;var $document=$(document);var unique_id=$.ss.util.unique_id();var wysiwyg_focus_fun=function(event,wysiwyg_data){var $element=wysiwyg_data.element;if(!$element.data("unique_wysiwyg_id")){$element.data("unique_wysiwyg_id",unique_id);}
var remove_fun_key="ss_wysiwyg_blur_hack_fun_"+unique_id;if(!$document.data(remove_fun_key)){$document.data(remove_fun_key,true);$element.addClass('focus_shadow');$document.bind('ss_wysiwyg_blur',function(event,data){if(!data||!data.unique_id||($element.data("unique_wysiwyg_id")!==data.unique_id)){if($element.hasClass('focus_shadow')){wysiwyg_blur_fun(event,wysiwyg_data);}}});}
if(!$document.data("has_wysiwyg_blur")){$document.data("has_wysiwyg_blur",true);$document.click(function(event){var $container=$(event.target).closest(".wysiwyg");if(!($(event.target).siblings(".wysiwyg").height()===23)){if($container.length){if(!($container.is('form')||$container.hasClass("ui-dialog-content")||$container.hasClass("ui-widget-content"))){$document.trigger('ss_wysiwyg_blur',{"unique_id":$container.data("unique_wysiwyg_id")});}}else if($(event.target).is(":visible")){$document.trigger('ss_wysiwyg_blur');}}});}
$document.trigger('ss_wysiwyg_blur',{"unique_id":$element.data("unique_wysiwyg_id")});$element.addClass('focus_shadow');};var events={'click':wysiwyg_focus_fun,'keyup':wysiwyg_focus_fun};if(settings.use_wysiwyg_blur_callback){events.blur=wysiwyg_blur_fun;}
var controls={insertImage:false,insertTable:false,h1:false,h2:false,h3:false,html:{visible:true},code:false};if(settings.hide_html_and_formatting){controls.html={visible:false};controls.removeFormat=false;}
$input.wysiwyg({controls:controls,autoGrow:true,css:$('head link[rel="stylesheet"]').first().attr('href'),initialContent:"",iFrameClass:"wysiwyg_iframe",events:events});_.each(window.frames,function(frame){if(frame){try{frame.document.documentElement.style.backgroundImage='none';frame.document.documentElement.style.backgroundColor='#FFF';}
catch(e){}}});});});}},"util":{"within_box":function(x,y,$elem){var options=options||{};var settings={"use_outer":true,"include_margin":false};var offset=$elem.offset();var left=offset.left;var right=left+$elem.width();var top=offset.top;var bottom=top+$elem.height();var inside=(x>left&&x<right)&&(y>top&&y<bottom);return inside;},"unique_id":function(){return"ss_unique_id_"+$.ss.util.unique_number();},"unique_number":function(){var $document=$(document);var old_unique_id=$document.data('ss_unique_id');if(old_unique_id===undefined){old_unique_id=-1;}
var new_unique_id=old_unique_id+1;$document.data('ss_unique_id',new_unique_id);return new_unique_id;},"clone":function(to_clone,deep){if(deep===undefined){deep=false;}
return $.extend(deep,{},to_clone);},"truncate_text":function(text,lines,css){var $tester=$('<div>').hide().css(css).css({'position':'fixed','left':-10000,'top':-10000});$('body').append($tester);text=text.trim();var height=$tester.height();var lines_so_far=0;var text_so_far="";var too_big=false;var words=text.split(' ');for(var i in words){var word=words[i];if(i!==0){text_so_far+=(' '+word);}else{text_so_far=word;}
$tester.text(text_so_far);if($tester.height()>height){height=$tester.height();lines_so_far+=1;}
if(lines_so_far>lines){too_big=true;break;}}
while(too_big){text_so_far=text_so_far.substr(0,text_so_far.length-words[i].length-1);$tester.text(text_so_far+'...');i-=1;if($tester.height()<height){text_so_far+='...';too_big=false;}}
$tester.remove();return text_so_far;},"escape":function(value){return value.replace(new RegExp("&","g"),"&amp;").replace(new RegExp(">","g"),"&gt;").replace(new RegExp("<","g"),"&lt;").replace(new RegExp("\"","g"),"&quot;");},"unescape":function(value){return value.replace(new RegExp("&amp;","g"),"&").replace(new RegExp("&gt;","g"),">").replace(new RegExp("&lt;","g"),"<").replace(new RegExp("&quot;","g"),"\"");}}};})(jQuery);;;(function($){var namespace='ssdialog';var loadingHtml="<div class='loading'></div>";var methods={'init':function(options){return this.each(function(){var $this=$(this);var data=$this.data(namespace);var settings={'show_on_initialize':true,'destroy_on_close':true,'title':'','width':400,'dynamic_width':false,'height':'auto','modal':true,'resizable':false,'refresh_after_save':false,'save_url':window.location.pathname,'save_callback':null,'success_callback':null,'failure_callback':null,'close_callback':null,'open_callback':null,'load_callback':null,'focus_input':false,'save_on_enter':false,'use_self':false,'realign_on_table_draw':false,'ajax_type':'PUT','buttons':{},'button_classes':[],'content':{'html':loadingHtml,'url':null,'preload':false,'refresh_on_show':true,'disabled':false,'data_for_load':{}}};var buttons;if($.isArray(options.buttons)){buttons=options.buttons;}else{var cancel_button_label=options.cancel_button_label||'Cancel';var save_button_label=options.save_button_label||'Save';settings.buttons[cancel_button_label]=function(){$this[namespace]('hide');};settings.buttons[save_button_label]=function(){$this[namespace]('save');};}
$.extend(true,settings,options);if(!$.isArray(options.buttons)){buttons={};for(var key in settings["buttons"]){var fun=settings["buttons"][key];if(fun){fun=_.bind(fun,$this,namespace);buttons[key]=fun;}}}
settings["buttons"]=buttons;if(!data){var $container;if(settings.use_self){$container=$this;$container.addClass(namespace);$container.html(settings.content.html);}else{$container=$('<div/>',{'class':namespace,'html':settings['content']['html']});}
$container.dialog({'autoOpen':false,'close':function(event,ui){if(settings['destroy_on_close']){$this[namespace]('destroy');}
if(settings['close_callback']){settings['close_callback'](arguments);}},'title':settings['title'],'width':settings['width'],'height':settings['height'],'modal':settings['modal'],'resizable':settings['resizable'],'buttons':settings['buttons'],'position':"center",'open':function(){$(this).parent().find(".ui-dialog-buttonset button:not(:last-child,.danger,.success)").addClass('default');$(this).parent().find(".ui-dialog-buttonset button").removeClass("ui-button").removeClass("ui-state-default");for(var i=0;i<settings['button_classes'].length;i++){var class_string=settings['button_classes'][i];$(this).parent().find(".ui-dialog-buttonset button:nth-child("+(i+1)+")").addClass(class_string);}
if(settings['realign_on_table_draw']){$container.on('draw',function(){$container.dialog('option','position','center');});}
if(settings['open_callback']){settings['open_callback'](arguments,$this);}}});$this.bind('click.'+namespace,function(event){$this[namespace]('show');});$this.data(namespace,{'showing':false,'container':$container,'settings':settings});if(settings['content']['preload']&&settings['content']['url']){$this[namespace]('load');}}
if(settings['show_on_initialize']){$this[namespace]('show');}});},'show':function(refresh_on_show){return this.each(function(){var $this=$(this);var data=$this.data(namespace);if(!data['showing']){data['showing']=true;$this.data(namespace,data);var should_refresh;if(refresh_on_show!==undefined){should_refresh=refresh_on_show;}else{should_refresh=data['settings']['content']['refresh_on_show']&&data['settings']['content']['url'];}
if(should_refresh){$this[namespace]('load');}
data['container'].dialog('open');}
var $dialoggy=$('.ui-dialog');$dialoggy.position({my:"center",at:"center",of:window});});},'hide':function(){return this.each(function(){var $this=$(this);var data=$this.data(namespace);if(data&&data['showing']){data['showing']=false;$this.data(namespace,data);data['container'].dialog('close');}});},get_container:function(){var $this=$(this);var data=$this.data(namespace);var $container=data['container'];return $container;},'load':function(new_url){return this.each(function(){var $this=$(this);var data=$this.data(namespace);if(new_url){data.settings.content.url=new_url;}
var url=data['settings']['content']['url'];var data_for_load=data['settings']['content']['data_for_load'];var disabled=data['settings']['content']['disabled'];var focus_input=data['settings']['focus_input'];var save_on_enter=data['settings']['save_on_enter'];var dynamic_width=data['settings']['dynamic_width'];if(url){var $container=data['container'];$container.html(loadingHtml);var _load_function=function(response,status,xhr){data['container'].dialog('option','position','center');if(dynamic_width){var $dialog=$container.parent();var fudge_factor=23;var new_width=$container.children().width()+fudge_factor;var old_width=$dialog.width();var old_left=parseInt($dialog.css('left'),10);var new_left=old_left-((new_width-old_width)/2);$dialog.width(new_width);$dialog.css('left',new_left+'px');}
if(disabled){$container.append("<div class='disabling_div'></div>");}
if(focus_input){$container.find('input[type="text"], textarea').first().focus();}
if(save_on_enter){$container.find('input[type="text"], textarea').keydown(function(event){var code=(event.keyCode?event.keyCode:event.which);if(code==$.ui.keyCode.ENTER){event.preventDefault();$this[namespace]('save');}});}
if(data['settings']['load_callback']){data['settings']['load_callback'](data);}};var data_for_load_empty=false;if($.type(data_for_load)=="string"&&data_for_load.length==0){data_for_load_empty=true;}else if($.type(data_for_load)=="object"&&$.isEmptyObject(data_for_load)){data_for_load_empty=true;}
if(data_for_load_empty){$container.load(url,_load_function);}else{$container.load(url,data_for_load,_load_function);}}else{$.error("No URL supplied for dialog.");}});},'save':function(){return this.each(function(){var $this=$(this);var data=$this.data(namespace);var $container=data['container'];var $form=$container.find('form');if($form.length){var validator=$form.validate({ignore:':hidden',focusInvalid:true});if(!$form.valid()){validator.focusInvalid();return;}}
var form_data=ss.fn.common.serialize_form($form);$container.children().hide();$container.append(loadingHtml);$container.dialog('option','position','center');var $buttons=$container.parent().find('button');$buttons.attr('disabled',true);var success=function(server_data,textStatus,jqXHR){if(data['settings']['refresh_after_save']){window.location.reload();}else{$buttons.attr('disabled',false);$this[namespace]('hide');}
if(data['settings']['success_callback']){var callback=_.bind(data['settings']['success_callback'],this);callback(server_data,textStatus,jqXHR);}};var error=function(server_data,textStatus,jqXHR){if(data['settings']['failure_callback']){var callback=_.bind(data['settings']['failure_callback'],this);callback(server_data,textStatus,jqXHR);}else{$buttons.attr('disabled',false);$this[namespace]('hide');alert("We're sorry, but there was an error saving your changes. Please try again later.");}};if(data.settings.save_callback){data.settings.save_callback({container:$container,dialog:$this[namespace],data:form_data,success:success,error:error});}else{$.ajax({'url':data['settings']['save_url'],'type':data['settings']['ajax_type'],'data':form_data,'success':success,'error':error});}});},'destroy':function(){return this.each(function(){var $this=$(this);$this.data(namespace)['container'].empty();$this.removeData(namespace);$this.unbind("."+namespace);});},'show_loading':function(){var data=$(this).data(namespace);var $container=data['container'];$container.html(loadingHtml);$container.dialog('option','position','center');},'disable_buttons':function(){var data=$(this).data(namespace);var $container=data['container'];var $button_pane=$container.siblings('.ui-dialog-buttonpane');$button_pane.find('button').prop('disabled',true);}};$.fn[namespace]=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments);}else{$.error('Method '+method+' does not exist on jQuery.'+namespace);}};$(document).on('click','a.ssdialog_default',{},function(event){event.preventDefault();var $target=$(event.target);var url=$target.prop('href');$('<div>').ssdialog({'title':'Contact Information','realign_on_table_draw':true,'width':'auto','content':{'url':url},'cancel_button_label':'OK','buttons':{"Save":null}});});$(document).on('ss_message_dialog',function(event,title,message){$.ss.dialog.message(title,message);});})(jQuery);;;(function($){$(document).on('click','[type="checkbox"].select_all_event_admin',function(){var $this=$(this);var $checkboxes=$this.parent().parent().find('.permissions_table').find('[type="checkbox"]');var should_select=$this.prop('checked');$checkboxes.prop('checked',should_select);});$(document).on('click','[type="checkbox"].event_admin',function(){var should_select=!$('input.event_admin[type=checkbox]:not(:checked)').length
$('[type="checkbox"].select_all_event_admin').prop('checked',should_select);});})(jQuery);;;(function($){$.fn.ss_icon_menu=function(options){var settings=$.extend({});return this.each(function(){var $this=$(this);var data=$this.data('ss_icon_menu');if(!data){var open_class="icon_menu_open";var row_class="row_selected";var $row=$this.closest("tr");var $icon=$('<a href="#"><img class="action_button" src="/res/img/v2/icons/gear_16.png"></a>');$icon.click(function(event){event.preventDefault();$this.toggleClass(open_class);$row.toggleClass(row_class);var $image=$icon.find('img');var $box=$this.find('ul');$box.position({of:$icon,my:'left top',at:'right top',offset:'3 -5'});});$(document).click(function(event){var $target=$(event.target);var target_in_menu=$this.find($target).length||$this[0]==$target[0];var target_in_menu_link=$target.closest('a').closest('ul').closest('.ss_icon_menu').length;if(!target_in_menu||target_in_menu_link){$this.removeClass(open_class);$row.removeClass(row_class);$this.trigger("ss_icon_menu_closed");}});$this.prepend($icon);$this.data('ss_icon_menu',{'initialized':true});}});};$(".ss_icon_menu").livequery(function(){$(this).ss_icon_menu();});})(jQuery);;;(function($){$.fn.ss_tags=function(options){var settings=$.extend({});return this.each(function(){var $this=$(this);var data=$this.data('ss_tags');var asset_type=$this.data('asset_type');if(!data){var $input=$('<input type="text" data-asset_type="'+asset_type+'" class="form-control">');var $hidden_input=$this.find('input');$hidden_input.prop("value","");$this.prepend($input);var tag_values='';var input_box_values='';var build_combined_values=function(){var comma=tag_values.length&&input_box_values.length?',':'';return tag_values+comma+input_box_values;};var tag_values_add=function(value){var original=tag_values;var prefix=original.length?',':'';tag_values=original+prefix+value;$hidden_input.prop('value',build_combined_values());};var tag_values_remove=function(value){var original=tag_values;var split=original.split(value);var new_val='';for(var i in split){var split_val=split[i];if(split_val[0]==","){split_val=split_val.substr(1,split_val.length);}
new_val+=split_val;}
if(new_val[new_val.length-1]==','){new_val=new_val.substr(0,split_val.length-1);}
tag_values=new_val;$hidden_input.prop('value',build_combined_values());};var last_added='';var input_change=function(event){input_box_values=$input.prop("value");$hidden_input.prop('value',build_combined_values());};$input.keyup(input_change);$input.change(input_change);var prepare_tag_close_fun=function($tag){$tag.find('.tag_action_remove').click(function(event){event.stopPropagation();$tag.remove();var id=$tag.attr("data-tag_id");tag_values_remove(id);});};$this.find('.tag').each(function(i,elem){var $tag=$(elem);tag_values_add($tag.attr("data-tag_id"));prepare_tag_close_fun($tag);});var autocomplete=SS.widgets.autocomplete_tag({input:$input,on_select:function(id,tag_html){var values=$input.val()||'',to_insert=values?id+','+values:id;input_box_values='';tag_values_add(id);var $tag=$(tag_html);prepare_tag_close_fun($tag);$input.after($tag).val('').focus();}});autocomplete.init();$this.data('ss_tags',{'initialized':true});}});};$(".ss_tags").livequery(function(){$(this).ss_tags();});})(jQuery);;;(function($){$.fn.ss_check_replace=function(options){var settings=$.extend({});return this.each(function(){var $this=$(this);var data=$this.data('ss_check_replace');if(!data){$this.data('ss_check_replace',{'initialized':true});var $on=$this.children(".on");var $off=$this.children(".off");var $input=$this.children("input");var update_view=function(){var checked=$input.prop("checked");$on.toggle(checked);$off.toggle(!checked);$input.hide();};var simulate_click=function(event){event.preventDefault();$input.click();update_view();};$on.click(simulate_click);$off.click(simulate_click);$this.replaceWith($this.children());update_view();}});};$(".ss_check_replace").livequery(function(){$(this).ss_check_replace();});})(jQuery);;;(function($){$(document).on("click",".field_duplicator_button",function(event){var $target=$(event.target);var $container=$target.siblings(".field_duplicator_container");var $sample=$container.find(".duplicatable").last();if(!$sample.length){$sample=$container.find(".duplicatable_template");}
var $duplicate=$sample.clone();if($duplicate.hasClass('duplicatable_template')){$duplicate.removeClass('duplicatable_template');$duplicate.addClass('duplicatable');$duplicate.find('select').attr('name',$sample.data('name'));}
if($duplicate.hasClass("ensure_unique_name")){var $input=$duplicate.find('input');var new_name=$input.attr("name")+$.ss.util.unique_number();$input.attr("name",new_name);}
$duplicate.find('input').prop("value","");$sample.after($duplicate);var min_fields=$container.data("min_fields");var field_count=$container.find(".duplicatable").length;if(field_count>min_fields){$container.find(".duplicatable_remove").show();}});$(document).on("click",".duplicatable_remove",function(event){var $target=$(event.target);var $container=$target.closest(".field_duplicator_container");var min_fields=$container.data("min_fields");var $duplicatable=$target.closest(".duplicatable");$duplicatable.remove();var field_count=$container.find(".duplicatable").length;if(field_count<=min_fields){$container.find(".duplicatable_remove").hide();}});})(jQuery);;;(function($){$(document).on("change",".poll_vote_choice",function(event){var $target=$(event.target);var $poll_container=$target.closest(".poll_container");var hide_results=$poll_container.data("hide_results");if(!hide_results){var $poll_choices=$target.closest(".poll_choices").find(".choice");var $choice=$target.closest(".choice_container").find(".choice");var vote=$target.prop("checked");if($target.prop("type")=="radio"){var $old_voted_for=$poll_choices.filter(function(i){return $(this).data("voted_for");});$old_voted_for.data("votes",$old_voted_for.data("votes")-1);$old_voted_for.data("voted_for",false);}
var old_count=$choice.data("votes");if(vote){$choice.data("votes",old_count+1);$choice.data("voted_for",true);}else{$choice.data("votes",old_count-1);$choice.data("voted_for",false);}
var total_votes=0;$poll_choices.map(function(i,elem){total_votes+=$(elem).data('votes');})
$poll_choices.map(function(i,elem){var $current_choice=$(elem);var choice_votes=$current_choice.data("votes");var vote_text=choice_votes+" vote"+(choice_votes==1?'':'s');var bar_width=total_votes==0?0:(choice_votes/total_votes)*100;$current_choice.find(".progress").prop("title",vote_text);$current_choice.find(".bar").css("width",bar_width+"%");});}
var $form=$poll_container.find("form");var data=$form.serialize();$.ajax({type:'POST',url:"/polls/"+$poll_container.data("poll_id")+"/vote",data:data});});$(document).on('click','a.poll_results_dialog',{},function(event){event.preventDefault();var $target=$(event.target);var url=$target.prop('href');$('<div>').ssdialog({'title':'Poll Results','realign_on_table_draw':true,'width':'auto','content':{'url':url},'cancel_button_label':'OK','buttons':{"Save":null}});});$(document).on('click','a.poll_open_close',function(event){event.preventDefault();var $target=$(event.target);var url=$target.prop('href');$.post(url,function(){window.location=window.location;});});})(jQuery);;;var SS=SS?(function(){console.error('Namespace already exists.');return SS;}()):{};SS.models={};SS.controllers={};SS.widgets={};SS.bb={};SS.bb.models={};SS.bb.views={};SS.safe_data=function(element){var data=$(element).data();_.each(data,function(value,key){if(value>100000){data[key]=$(element).attr('data-'+key);}});return data;};$(document).ready(function(){if(!$.browser){$.browser={msie:false,safari:false};}
SS.page.models={};_.each(SS.page.config,function(model,key){_.each(model,function(spec,name){SS.page.models[name]=SS.models[key](spec);});});_.each(SS.controllers,function(controller,key){controller.init();});});;;SS.model=function(spec,my){var self={};my.ajax_error=function(action_failed,data){return function(jqXHR,text_status){$(document).trigger('ss_ajax_error',[action_failed,text_status,data,jqXHR]);};};return self;};;;SS.models.user=function(spec,my){var self;my=my||{};self=SS.models.item(spec,my);self.save_settings=function(data){$.ajax({url:spec.url+'/settings',type:'PUT',data:data,error:my.ajax_error('user settings edit',data),success:function(response){$(document).trigger('ss_profile_settings_saved',[response]);}});};self.follow=function(){$.ajax({url:spec.url+'/follow',type:'PUT',error:my.ajax_error('user follow')});};self.unfollow=function(){$.ajax({url:spec.url+'/follow',type:'DELETE',error:my.ajax_error('user unfollow')});};self.message=function(field_mapper){var params={target_user_id:spec.id,'message:subject':field_mapper['message_subject'],'message:body':field_mapper['message_body'],message_id:'',target_type:'user'};$.ajax({url:'/messages',type:'POST',data:params,error:my.ajax_error('user message',params)});};self.send_email=function(field_mapper){var params={target_user_id:spec.id,subject:field_mapper['message_subject'],body:field_mapper['message_body'],first_name:field_mapper['first_name'],last_name:field_mapper['last_name'],email:field_mapper['reply_email'],};$.ajax({url:'/notification/send_email_message',type:'POST',data:params,error:my.ajax_error('user email message',params)});};self.enable=function(){var params={state:'active'};$.ajax({url:spec.url+'/update_state',type:'PUT',data:params,error:my.ajax_error('user enable',params)});};self.disable=function(){$.ajax({url:spec.url,type:'DELETE',error:my.ajax_error('user delete')});};self.reset_password=function(success){var params={user_id:spec.id};$.ajax({url:'/auth/admin_password_reset',type:'PUT',data:params,success:success,error:my.ajax_error('user reset password')});};self.unlink=function(network){$.ajax({url:'/social/ajax_unlink_'+network,type:'PUT',error:my.ajax_error('user unlink',{network:network}),success:function(){$(document).trigger('ss_profile_unlinked');}});};self.link=function(network){var params={network:network},share=function(){$.ajax({url:'/social/ajax_share_joined',type:'PUT',data:params,error:my.ajax_error('user link',params),success:function(){$(document).trigger('ss_profile_linked');}});};if(network==='facebook'){$.ajax({url:'/social/ajax_linked',type:'PUT',data:params,error:my.ajax_error('user link',params),success:function(){$(document).trigger('ss_profile_linked');}});}else{$(document).trigger('ss_profile_linked');}};self.cancel_membership=function(membership_info_id){$.ajax({url:spec.url+'/cancel_membership',type:'POST',data:{'membership_info_id':membership_info_id},error:my.ajax_error('user settings edit',membership_info_id),success:function(response){$(document).trigger('ss_profile_membership_cancelled',[response]);}});};self.clear_professional_history=function(){$.ajax({url:spec.url+'/clear_professional_history',type:'POST',error:my.ajax_error('user clear professional history')});};self.delete_profile_img=function(){var params={user_id:spec.owner_id};$.ajax({url:spec.url+'/delete_profile_img',type:'POST',data:params,success:function(){window.location.reload();},error:my.ajax_error('user delete profile img')});};return self;};;;SS.models.item_clump=function(spec,my){var self,latest_request_id=0,namespace_params=function(){var namespaced_params={};_.each(spec,function(value,key){if(key==='sub_filters'){_.each(value,function(sub_value,sub_key){if(sub_key===spec.asset_type||sub_key==='all'){_.each(sub_value,function(sub_filter_value,sub_filter_key){namespaced_params['item_clump:'+sub_filter_key]=sub_filter_value;});}});}else{namespaced_params['item_clump:'+key]=value;}});return namespaced_params;};my=my||{};spec.url='/activityfeed/item_clump';spec.skip=0;self=SS.model(spec,my);self.filter=function(filters){var this_request_id;latest_request_id+=1;this_request_id=latest_request_id;spec.skip=0;_.each(filters,function(value,key){spec[key]=value;});_.each(spec.sub_filters,function(asset_sub_filter,asset_type){if(!(asset_type===spec.asset_type||asset_type==='all')){delete spec.sub_filters[asset_type];}});$.ajax({url:spec.url,type:'GET',data:namespace_params(),success:function(content){if(this_request_id===latest_request_id){$(document).trigger('ss_item_clump_updated',[spec.id,content]);}},error:my.ajax_error('item clump filter',namespace_params())});};self.add_older=function(limit){var amount_to_add=spec.limit||limit||15,this_request_id;latest_request_id+=1;this_request_id=latest_request_id;spec.skip=spec.skip+amount_to_add;spec.limit=limit;$.ajax({url:spec.url,type:'GET',data:namespace_params(),success:function(content){if(this_request_id===latest_request_id){$(document).trigger('ss_item_clump_added_older',[spec.id,content]);}},error:my.ajax_error('item clump add older items',namespace_params())});};self.get_params=function(){return namespace_params();};return self;};;;SS.models.item=function(spec,my){var self;my=my||{};self=SS.model(spec,my);self.get=function(key){return spec[key];};self.create=function(id,data,type,parent_url){var url=spec.url;if(url==='/resumes'){url='/cvs';}
$.ajax({url:url,type:'POST',data:data,success:function(data){if(!id){$(document).trigger('ss_item_created',[data,type,parent_url]);}else{$(document).trigger('ss_item_clump_items_added',[id,data]);}
if(spec.url=='/documents')
self.reload_course_document();},error:my.ajax_error('item create',{data:data})});};self.reload_course_document=function(){var course_url=$('#content').data('url');var document_panel=$('.course_page #secondary_content .activity .dynamic_document_panel');if(document_panel.length>0){$.ajax({url:course_url+'/ajax_document_panel_html',type:'PUT',success:function(response){document_panel.html(response.success.document_html);},error:my.ajax_error('item create')});}}
self.remove=function(full_delete,reason){var url,reasonParam;if(full_delete){url=spec.url+'/destroy';}else{reasonParam=reason?'?reason='+encodeURIComponent(reason):'';url=spec.url+'/remove'+reasonParam;}
full_delete=full_delete||false;$.ajax({url:url,type:'DELETE',success:function(response){$(document).trigger('ss_item_removed',[response.redirect_url]);},error:my.ajax_error('item delete')});};self.edit=function(data,inline){$.ajax({url:spec.url,type:'PUT',data:data,success:function(response){$(document).trigger('ss_item_saved',[inline,response.redirect_url]);},error:my.ajax_error('item edit',data)});};self.like=function(){$.ajax({url:spec.url+'/like',type:'PUT',error:my.ajax_error('item like')});};self.unlike=function(){$.ajax({url:spec.url+'/unlike',type:'PUT',error:my.ajax_error('item unlike')});};self.share=function(targets,message){var params={targets:targets,message:message};$.ajax({url:spec.url+'/share',type:'PUT',data:params,error:my.ajax_error('item share',params)});};self.post_comment=function(comment){var params={comment:comment};$.ajax({url:spec.url+'/post_comment',type:'PUT',data:params,error:my.ajax_error('item comment',params)});};self.remove_comment=function(comment_id){var params={};$.ajax({url:spec.url+'/comments/'+comment_id,type:'DELETE',data:params,error:my.ajax_error('item remove comment',params)});};self.add_tag=function(tag){var params={tag:tag};$.ajax({url:spec.url+'/add_tag',type:'GET',data:params,error:my.ajax_error('item add tags',params)});};self.remove_tag=function(tag){var params={tag:tag};$.ajax({url:spec.url+'/remove_tag',type:'PUT',data:params,error:my.ajax_error('item remove tag',params)});};self.add_relation=function(item_id,relation_id,direction){var params={};$.ajax({url:spec.url+'/relations/'+relation_id+'/'+direction+'/'+item_id,type:'PUT',data:params,error:my.ajax_error('item add relation',params)});};self.remove_relation=function(item_id,relation_id,direction){var params={};$.ajax({url:spec.url+'/relations/'+relation_id+'/'+direction+'/'+item_id,type:'DELETE',data:params,error:my.ajax_error('item remove relation',params)});};self.update_state=function(state,reason){var params={state:state,reason:reason};$.ajax({url:spec.url+'/update_state',type:'PUT',data:params,success:function(data){window.location=spec.url;},error:my.ajax_error('item update state',params)});};self.publish=function(){var urlToRedirectTo=spec.url+'?just_published=True';$.ajax({url:spec.url+'/publish',type:'POST',data:{},success:function(data){window.location=urlToRedirectTo;},error:my.ajax_error('item publish',{})});};self.is_new=function(){return spec.id?false:true;};return self;};;;SS.models.group=function(spec,my){var self;my=my||{};self=SS.models.item(spec,my);self.create=function(){$.ajax({url:'/chapters',type:'POST',error:my.ajax_error('group create')});};self.join=function(){$.ajax({url:spec.url+'/join',type:'PUT',success:function(){$(document).trigger('ss_group_joined_left');},error:my.ajax_error('group join')});};self.join_request=function(){$.ajax({url:spec.url+'/join',type:'PUT',error:my.ajax_error('group join request')});};self.leave=function(){$.ajax({url:spec.url+'/leave',type:'DELETE',success:function(){$(document).trigger('ss_group_joined_left');},error:my.ajax_error('group leave')});};self.message_all=function(field_mapper){var params={chapter_id:spec.id,'message:subject':field_mapper['message_subject'],'message:body':field_mapper['message_body']};$.ajax({url:spec.url+'/send_group_message',type:'PUT',data:params,error:my.ajax_error('group message members',params)});};self.invite_users=function(targets,email_targets,dialog){var params={targets:targets,email_targets:email_targets,group_invite_personalization:$('input[name="group_invite_personalization"]',dialog).val()};$.ajax({url:spec.url+'/invite',type:'PUT',data:params,error:my.ajax_error('group invite users',params)});};self.add_leader=function(user_id){var params={user_id:user_id};$.ajax({url:spec.url+'/add_leader',type:'POST',data:params,error:my.ajax_error('group add leader',params)});};self.remove_leader=function(user_id){var params={user_id:user_id};$.ajax({url:spec.url+'/remove_leader',type:'POST',data:params,error:my.ajax_error('group remove leader',params)});};self.accept_member=function(user_id){var params={user_id:user_id};$.ajax({url:spec.url+'/approve_pending_member',type:'POST',data:params,error:my.ajax_error('group accept pending member',params)});};self.reject_member=function(user_id){var params={user_id:user_id};$.ajax({url:spec.url+'/reject_pending_member',type:'POST',data:params,error:my.ajax_error('group reject pending member',params)});};self.add_member=function(user_id){var params={user_id:user_id};$.ajax({url:spec.url+'/add_member',type:'POST',data:params,error:my.ajax_error('group add member',params)});};self.remove_member=function(user_id){var params={user_id:user_id};$.ajax({url:spec.url+'/remove_member',type:'POST',data:params,error:my.ajax_error('group remove member',params)});};return self;};;;SS.models.company=function(spec,my){var self;my=my||{};self=SS.models.item(spec,my);self.create=function(data){$.ajax({url:'/companies',type:'POST',data:data,error:my.ajax_error('company create'),success:function(){$(document).trigger('ss_company_saved');}});};self.add_member=function(user_id){var params={user_id:user_id};$.ajax({url:spec.url+'/add_member',type:'POST',data:params,success:function(){$(document).trigger('ss_company_member_added');},error:my.ajax_error('company add member',params)});};self.remove_member=function(user_id){var params={user_id:user_id};$.ajax({url:spec.url+'/remove_member',type:'POST',data:params,error:my.ajax_error('company remove member',params)});};self.join_company=function(user_id){var params={user_id:user_id};$.ajax({url:spec.url+'/add_member',type:'POST',data:params,error:my.ajax_error('user join company',params),success:function(){$(document).trigger('ss_company_joined');}});};self.message=function(field_mapper){var params={target_user_id:spec.id,'message:subject':field_mapper['message_subject'],'message:body':field_mapper['message_body'],message_id:'',target_type:'company'};$.ajax({url:'/messages',type:'POST',data:params,error:my.ajax_error('company message',params)});};self.join_request=function(){$.ajax({url:spec.url+'/join',type:'PUT',error:my.ajax_error('company join request')});};self.leave=function(){$.ajax({url:spec.url+'/leave',type:'DELETE',success:function(){$(document).trigger('ss_company_joined_left');self.confirmation_dialog();},error:my.ajax_error('company leave')});};self.confirmation_dialog=function(){$('<div>').ssdialog({'title':'You have left the company','content':{'html':"<div class='alert alert-info center'>You have successfully left the company.<div>"},'save_url':null,'buttons':{'Save':null,'Cancel':null,"Close":function(namespace){this[namespace]('hide');}}});};return self;};;;SS.models.event=function(spec,my){var self;my=my||{};self=SS.models.item(spec,my);self.create=function(){$.ajax({url:'/events',type:'POST',error:my.ajax_error('event create')});};self.rsvp=function(){$.ajax({url:spec.url+'/rsvp',type:'POST',success:function(){},error:my.ajax_error('event rsvp')});};self.rsvp_user=function(url,user_id,rsvp_by_email,event_name,button_context,button_namespace){var params={'curr_user:id':user_id}
$.ajax({url:url+'/rsvp_user',data:params,type:'POST',success:function(){if(!rsvp_by_email){$('.create_new_user').removeAttr('disabled');$('admin_payment_manually_register_cancel').removeAttr('disabled');$('admin_payment_rsvp_user').removeAttr('disabled');$('admin_payment_rsvp_user_make_another').removeAttr('disabled');window.location=url}else{button_context[button_namespace]('hide');self.rsvp_message('success',event_name);}},error:my.ajax_error('event rsvp')});};self.rsvp_new_user=function(url,first_name,last_name,email,phone,rsvp_by_email,event_name,button_context,button_namespace){var params={'new_user:first_name':first_name,'new_user:last_name':last_name,'new_user:email':email,'new_user:phone':phone}
$.ajax({url:url+'/rsvp_user',data:params,type:'POST',success:function(namespace){if(!rsvp_by_email){$('.create_new_user').removeAttr('disabled');$('admin_payment_manually_register_cancel').removeAttr('disabled');$('admin_payment_rsvp_user').removeAttr('disabled');$('admin_payment_rsvp_user_make_another').removeAttr('disabled');window.location=url}
else{button_context[button_namespace]('hide');self.rsvp_message('success',event_name);}},error:my.ajax_error('event rsvp')});};self.unrsvp=function(){$.ajax({url:spec.url+'/unrsvp',type:'DELETE',success:function(){$(document).trigger('ss_event_rsvped_unrsvped');},error:my.ajax_error('event unrsvp')});};self.message_attendees=function(field_mapper){var params={event_id:spec.id,'message:subject':field_mapper['message_subject'],'message:body':field_mapper['message_body']};$.ajax({url:spec.url+'/message_attendees',type:'PUT',data:params,error:my.ajax_error('event message attendees',params)});};self.message_session_attendees=function(field_mapper,session_id){var params={event_id:spec.id,'message:subject':field_mapper['message_subject'],'message:body':field_mapper['message_body']};$.ajax({url:'/sessions/'+session_id+'/message_session_attendees',type:'PUT',data:params,error:my.ajax_error('event message session attendees',params)});};self.invite_users=function(targets,email_targets,dialog){var params={targets:targets,email_targets:email_targets,event_invite_personalization:$('input[name="event_invite_personalization"]',dialog).val()};$.ajax({url:spec.url+'/invite',type:'PUT',data:params,error:my.ajax_error('group invite users',params)});};self.invite_users_by_prev_events=function(targets,dialog){var params={targets:targets,event_invite_personalization:$('input[name="event_invite_personalization"]',dialog).val()};$.ajax({url:spec.url+'/invite_by_event',type:'PUT',data:params,error:my.ajax_error('group invite users by event',params)});};self.invite_users_by_groups=function(targets,dialog){var params={targets:targets,event_invite_personalization:$('input[name="event_invite_personalization"]',dialog).val()};$.ajax({url:spec.url+'/invite_to_event_by_group',type:'PUT',data:params,error:my.ajax_error('group invite users by groups',params)});};self.delete_attendee=function(id,dialog){var params={attendee_id:id};var popup=dialog;$.ajax({url:spec.url+'/ajax_delete_attendee',type:'POST',data:params,success:function(response){$(popup).closest('.ui-dialog').find('.ui-dialog-buttonset button :contains("Confirm")').parent().hide();$(popup).closest('.ui-dialog').find('.ui-dialog-buttonset button').attr('disabled',false);$(popup).text(response.message);},error:my.ajax_error('delete_attendee',params)});};self.user_not_attending=function(){$.ajax({url:spec.url+'/user_not_attending',type:'POST',error:'user_not_attending'});};return self;};;;SS.models.place=function(spec,my){var self;my=my||{};self=SS.models.item(spec,my);self.create=function(data){$.ajax({url:'/places',type:'POST',data:data,error:my.ajax_error('place create'),success:function(response){$(document).trigger('ss_place_created',[response]);}});};self.join=function(){$.ajax({url:spec.url+'/join',type:'PUT',success:function(){$(document).trigger('ss_place_joined_left');},error:my.ajax_error('place join')});};self.leave=function(){$.ajax({url:spec.url+'/leave',type:'DELETE',success:function(){$(document).trigger('ss_place_joined_left');},error:my.ajax_error('place leave')});};return self;};;;SS.models.tag=function(spec,my){var self;my=my||{};self=SS.models.item(spec,my);spec.url='/tags/'+spec.id;self.get=function(key){return spec[key];};self.follow=function(){$.ajax({url:spec.url+'/follow',type:'PUT',error:my.ajax_error('tag follow')});};self.unfollow=function(){$.ajax({url:spec.url+'/follow',type:'DELETE',error:my.ajax_error('tag follow')});};return self;};;;SS.models.proposal=function(spec,my){var self;my=my||{};self=SS.models.item(spec,my);self.accept=function(){$.ajax({url:spec.url+'/accept',type:'PUT',error:my.ajax_error('proposal accept')});};self.reject=function(){$.ajax({url:spec.url+'/reject',type:'PUT',error:my.ajax_error('proposal reject')});};return self;};;;SS.models.customization=function(spec,my){var self;my=my||{};self=SS.model(spec,my);self.get=function(key){return spec[key];};self.edit=function(data){$.ajax({url:spec.url,type:'PUT',data:data,success:function(){$(document).trigger('ss_item_saved');},error:my.ajax_error('item edit',data)});};return self;};;;SS.models.admin_payment=function(spec,my){var self;my=my||{};self=SS.model(spec,my);self.get=function(key){return spec[key];};self.get_ticket_information=function(data){var url='/admin_payment/get_ticket_information';$.ajax({url:url,type:'POST',data:data,success:function(response){$(document).trigger('ss_admin_payment_ticket_information_fetched',[response]);},error:my.ajax_error('item edit',data)});};self.get_outstanding_balances=function(user_id,success){var url='/admin_payment/get_outstanding_balances';$.ajax({url:url,type:'POST',data:{user_id:user_id},success:success,error:my.ajax_error('item edit',user_id)});};self.submit_payment=function(data,success){var url='/admin_payment/submit_payment';$.ajax({url:url,type:'POST',data:data,success:success,error:my.ajax_error('item edit',data)});};self.submit_online_payment=function(data,success){var url='/admin_payment/submit_online_payment';$.ajax({url:url,type:'POST',data:data,success:function(response){$(document).trigger('ss_online_payment_submitted',[response]);},error:my.ajax_error('item edit',data)});};return self;};;;SS.models.network=function(spec,my){var self;my=my||{};self=SS.models.item(spec,my);self.invite_users=function(email_targets,dialog){var params={email_targets:email_targets,network_invite_personalization:$('.network_invite_personalization',dialog).val()};$.ajax({url:'/network/invite',type:'PUT',data:params,error:my.ajax_error('group invite users',params)});};return self;};;;SS.controller=function(my){my.get_item_element=function($element){return $element.closest('.item');};my.get_model_object=function($element){var $item_element=$element.hasClass('item')?$element:my.get_item_element($element);var data=$item_element.data();var data_type=(data.type=='topic')?'tag':data.type;var complex_items=['user','company','group','event','place','proposal','payment','report','course','tag'];var type=_.include(complex_items,data_type)?data_type:'item';if($item_element.attr('data-id')){data.id=$item_element.attr('data-id');}
if(type==='course')
type='event';return SS.models[type](data);};my.get_plural=function(text){if(_.str.endsWith(text,'y')){return _.str.splice(text,text.length-1,1,'ies');}else if(_.str.endsWith(text,'s')){return text+'es';}else{return text+'s';}};my.text_url_to_link=function(text){return text.replace(/(\b(https?|ftp|file):\/\/[\-A-Z0-9+&@#\/%?=~_|!:,.;]*[\-A-Z0-9+&@#\/%=~_|])/ig,'<a href="$1">$1</a>');};my.newlines_to_br=function(text){return text.replace(/\n/g,'<br>');};my.clean_quotes=function(text){return text.replace(/&#39;/g,"'").replace(/&#34;/g,'"');};my.name_value_array_to_object=function(array){var object={};_.each(array,function(item){object[item.name]=item.value;});return object;};my.queued_items={};my.queue_to_run=function(key,func,delay){if(!delay){delay=500;}
var now=new Date().getTime(),target_time=now+delay;my.queued_items[key]={func:func,target_time:target_time};window.setTimeout(my.run_queued,delay);};my.run_queued=function(){var now=new Date().getTime(),queued_item,i,func;for(i in my.queued_items){queued_item=my.queued_items[i];if(now>=queued_item.target_time){func=queued_item.func;delete my.queued_items[i];func();}}};my.submit_form=function($form,$this_element,submit_function,root_element){if($form.valid()){submit_function();$(root_element).html('<div class="loading"></div>');}else{$('<div />',{'class':'error'}).html('Your required fields are not valid. Please review.').insertAfter($this_element).delay(1000).fadeOut();}};return{};};;;SS.controllers.item_clump=(function(){var self,my={},root_element='.item_clump',number_of_auto_loads=0,only_auto_load=false,get_item_clump_element=function(id){var clump=$('#'+id+'_item_clump');if(clump.length){return clump;}else{return $('#'+id);}},load_older=function(id){var clump_element=get_item_clump_element(id),older_items_element=$('.item_clump_show_more',clump_element),limit=clump_element.data('item_clump_limit');$(older_items_element).after('<li class="list-group-item item_clump_loading_more loading"></li>');$(older_items_element).remove();SS.page.models[id].add_older(limit);};self=SS.controller(my);self.init=function(new_root_element){if(new_root_element!==undefined){root_element=new_root_element;}
$(document).scroll(function(){if(number_of_auto_loads<2||only_auto_load){if($(window).scrollTop()+$(window).height()>=$(document).height()-100){if($('.item_clump_show_more',root_element).length){load_older($(root_element).data('item_clump_id'));number_of_auto_loads+=1;}}}});$(root_element+', .list-group').parent().delegate('.item_clump_show_more','click',function(){only_auto_load=true;load_older($(this).parent().data('item_clump_id'));});$('.item_clump_table').delegate('.item_clump_table_show_more','click',function(event){var $clump_wrapper=$(event.target).closest('.item_clump_table');var id=$clump_wrapper.data('item_clump_id');SS.page.models[id].add_older();var $add_more=$(this);$add_more.hide();$add_more.after('<div class="item_clump_loading_more loading"></div>');});$(document).bind('ss_item_clump_filters_changed',function(event,id,filters){var clump_element=get_item_clump_element(id);$('.item_clump_show_more',clump_element).remove();SS.page.models[id].filter(filters);$(clump_element).html('<div class="item_clump_loading_update loading"></div>');});$(document).bind('ss_item_clump_sub_filters_changed',function(event,id,data){var clump_element=get_item_clump_element(id),filters={};filters={};filters.sub_filters=data;$('.item_clump_show_more',clump_element).remove();SS.page.models[id].filter(filters);$(clump_element).html('<div class="item_clump_loading_update loading"></div>');});$(document).bind('ss_item_clump_updated',function(event,id,clump_content){var clump_element=get_item_clump_element(id);$(clump_element).siblings('.item_clump_loading_new_item').remove();$(clump_element).after(clump_content.html).remove();number_of_auto_loads=0;});$(document).bind('ss_item_clump_items_added',function(event,id,item_added){var clump_element=get_item_clump_element(id);$('.notice',clump_element).remove();$('.item_clump_loading_new_item').remove();if(SS.app.current_network.enable_share_popup=='true'){$(item_added).hide().prependTo(clump_element).slideDown(700).trigger('ss_item_created');}else{$(item_added).prependTo(clump_element);}});$(document).bind('ss_item_clump_added_older',function(event,id,older_items){var clump_element=get_item_clump_element(id);if(clump_element.is('.item_clump_table')){clump_element.find('.item_clump_loading_more').hide();if(_.string.strip(older_items.html)===''){}else{var $older_items=$(older_items.html);clump_element.find('table').append(older_items.html);clump_element.find('.item_clump_table_show_more').show();}}else{$('.item_clump_loading_more',clump_element).remove();$(clump_element).append(older_items.html);}});$(document).bind('ss_ajax_error',function(event,action_attempted,error_text){$(root_element).siblings('.item_clump_loading_new_item').remove();});};return self;}());;;SS.controllers.item_clump_filters=(function(){var self,my={},root_element='.item_clump_filters';self=SS.controller(my);self.init=function(new_root_element){if(new_root_element!==undefined){root_element=new_root_element;}
$(root_element).delegate('a','click',function(){var group=$(this).closest('ul'),action=$(this).data('action'),filters={};if(ss.config.THEME!='version2_classic'&&ss.config.PARENT_THEME!='version2_classic'){$('.active',group).removeClass('active');$(this).parent().addClass('active');}else{$('.selected',group).removeClass('selected');$(this).addClass('selected');}
if($(group).hasClass('asset_type')){filters.asset_type=action;}else{filters.sort_type=action;}
$(document).trigger('ss_item_clump_filters_changed',[$(group).closest('.filters').data('item_clump_id'),filters]);});$(root_element).delegate('.clump_filter','change',function(){var name=$(this).attr('name'),value=$(this).val(),filters={};filters[name]=value;safe_log('Clump filter changed',filters);$(document).trigger('ss_item_clump_filters_changed',[$(this).closest('.filters').data('item_clump_id'),filters]);});};return self;}());;;SS.controllers.item_clump_sub_filters=(function(){var self,my={},root_element='.item_clump_sub_filters',filter_input_change=function($this_element){var $filters_element=$this_element.closest('.item_clump_sub_filters'),item_clump_id=$filters_element.data('item_clump_id')||'item_cluster',data_array=$('.sub_filters_section:not(.unavailable) form',$filters_element).serializeArray()||[],asset_type=$this_element.closest('.sub_filters_section').data('asset_type'),data_object={};if(asset_type){data_object[asset_type]={};_.each(data_array,function(filter){data_object[asset_type][filter.name]=filter.value;});}
safe_log('ss_item_clump_sub_filters_changed',[item_clump_id,data_object]);$(document).trigger('ss_item_clump_sub_filters_changed',[item_clump_id,data_object]);};self=SS.controller(my);self.init=function(new_root_element){if(new_root_element!==undefined){root_element=new_root_element;}
$(root_element).delegate('input','click',function(){$(this).select();});$(root_element).delegate('select','change',function(){filter_input_change($(this));});var filterable_field_changed=_.debounce(function(event){var changed_item=this;safe_log('filters changed',event);my.queue_to_run('filter',function(){var $input=$(event.target);var item_clump_id=$input.data('clump_id');var asset_id=$input.data('asset_id');var data_object={};var params={};params[$input.attr('name')]=$input.val();data_object[asset_id]=params;safe_log('ss_item_clump_sub_filters_changed',[item_clump_id,data_object]);$(document).trigger('ss_item_clump_sub_filters_changed',[item_clump_id,data_object]);});},200);$(document).delegate('.item_clump_filterable_field','keypress',filterable_field_changed);$(document).delegate('.item_clump_filterable_field','change',filterable_field_changed);$(root_element).delegate('input','keypress',function(){var changed_item=this;safe_log('filters changed');my.queue_to_run('filter',function(){filter_input_change($(changed_item));});});$(root_element).delegate('form','submit',function(event){event.preventDefault();});$(document).bind('ss_item_clump_filters_changed',function(event,clump_id,filters){var $sub_filters_element=$('#'+clump_id+'_item_clump_sub_filters');if(filters.asset_type){$('.sub_filters_section',$sub_filters_element).addClass('unavailable');$('.sub_filters_section[data-asset_type="'+filters.asset_type+'"]',$sub_filters_element).removeClass('unavailable').find('form').trigger('reset');}});};return self;}());;;SS.controllers.post_new=(function(){var self,my={},root_element='.post_new',post_form,options={discussion:{form_text:'Start a discussion',form_include:'<div class="form-group"><label>Discussion title:</label><input class="required form-control" type="text" name="discussion:title"></div>'+'<div class="form-group"><label>Discussion content:</label><textarea class="form-control" name="discussion:summary"></textarea></div>'},offer:{form_text:'Post an offer',form_include:'<label>Offer title:</label><input class="required" type="text" name="offer:title">'+'<div class="post_form_two_input">'+'<div><label>Member rate:</label><input class="number required" type="text" name="offer:exclusive_rate"></div>'+'<div><label>Normal non-member rate:</label><input class="number required" type="text" name="offer:market_rate"></div>'+'</div>'+'<label>Offer details:</label><textarea name="offer:description"></textarea>'},request:{form_text:'Post a request',form_include:'<div class="form-group"><label>Request title - what do you need?</label><input class="required form-control" type="text" name="request:title"></div>'+'<div class="form-group"><label>Request details:</label><textarea class="form-control" name="request:summary"></textarea></div>'+'<input type="hidden" name="request:discussion_type" value="request">'},document:{form_text:'Post a document',form_include:'<div class="form-group"><label>Document title:</label><input class="required form-control" type="text" name="document:name"></div>'+'<div class="form-group"><div><label>File to upload:</label></div>'+'<div><iframe class="post_form_file_upload" src="/upload_iframe/file"></iframe></div></div>'+'<input class="required" type="hidden" name="document:file">'+'<div class="form-group"><label>Document description:</label><textarea class="form-control" name="document:description"></textarea></div>'},video:{form_text:'Embed a video',form_include:'<div class="form-group"><label>Video title:</label><input class="required form-control" type="text" name="video:title"></div>'+'<div class="form-group"><label>Video URL:</label><input class="required url form-control" type="text" name="video:video_url"></div>'+'<div class="form-group"><label>Video description:</label><textarea class="form-control" name="video:summary"></textarea></div>'},image:{form_text:'Post an image',form_include:'<div class="form-group"><label>Image title:</label><input class="required form-control" type="text" name="image:name"></div>'+'<div class="form-group"><div><label>Image File:</label></div>'+'<div><iframe class="post_form_file_upload" src="/upload_iframe/file"></iframe></div></div>'+'<input class="required" type="hidden" name="image:image">'+'<div class="form-group"><label>Image description:</label><textarea class="form-control" name="image:description"></textarea></div>'},poll:{form_text:'Post a poll',form_include:'<div class="poll_edit_container">'+'<div class="form-group"><label>Ask a Question:</label>'+'<input class="required form-control" type="text" name="poll:question"></div>'+'<div class=" field_duplicator_container poll_questions_container" data-min_fields="2">'+'<div class="form-group input-group duplicatable ensure_unique_name choice_container">'+'<input placeholder="enter an option" class="form-control required choice_field" type="text" name="choices:'+$.ss.util.unique_id()+'">'+'<span class="duplicatable_remove remove_list_row input-group-btn"><button class="btn btn-danger" type="button"><i class="fa fa-times"></i></button></span>'+'</div>'+'<div class="form-group input-group duplicatable ensure_unique_name choice_container">'+'<input placeholder="enter an option" class="required form-control choice_field" type="text" name="choices:'+$.ss.util.unique_id()+'">'+'<span class="duplicatable_remove remove_list_row input-group-btn"><button class="btn btn-danger" type="button"><i class="fa fa-times"></i></button></span>'+'</div>'+'</div>'+'<button class="btn btn-success add_option_button field_duplicator_button" type="button">Add an Option</button>'+'</div>',post_as_company:false,disable_tags:true,submit_row_classes:"poll_submit_row",submit_row:'<div class="checkbox"><label><input type="checkbox" name="poll:hide_results"><span class="text_for_input_in_label">Hide Poll Results</span></label></div>'+'<div class="checkbox"><label><input type="checkbox" name="poll:allow_multiple_choices"><span class="text_for_input_in_label">Allow Multiple Choices</span></label></div>'+'<div class="form-group poll_date_label_and_field">'+'<label class="no_inner_input">Poll End Date:</label>'+'<div class="input_and_error">'+'<input type="text" name="poll:end_date" class="input_box form-control date_input date no_past_date hasDatepicker" id="'+$.ss.util.unique_id()+'">'+'</div>'+'</div>'},link:{form_text:'Post a link',form_include:'<div class="form-group"><label>Link title:</label><input class="required form-control" type="text" name="link:title"></div>'+'<div class="form-group"><label>Link URL:</label><input class="required form-control url" type="text" name="link:link_url"></div>'+'<div class="form-group"><label>Link description:</label><textarea class="form-control" name="link:summary"></textarea></div>'}},option_selected,get_tags_add_input_width=function(){var tags_width=_.reduce($('.tag',post_form),function(memo,tag){return memo+$(tag).outerWidth(true);},0),input_width=$(post_form).width()-tags_width-2;return input_width>50?input_width:50;},init_tags=function(){var autocomplete=SS.widgets.autocomplete_tag({input:$('.post_form_tags',post_form),on_select:function(id,tag_html){var values=$('.post_form_tag_values',post_form).val()||'',to_insert=values?id+','+values:id;$('.post_form_tag_values',post_form).val(to_insert);$('.post_form_tags',post_form).before(tag_html).width(get_tags_add_input_width()).val('').focus();}});autocomplete.init();},expand_post_form=function(){var form_html,submit_row,post_as_company=$(root_element).data('post_as_company');if(!$(post_form).hasClass('expanded')){$(post_form).empty().addClass('expanded');var option_disable_tags=options[option_selected]['disable_tags']==null?false:options[option_selected]['disable_tags'];if(!option_disable_tags){var tag_html='<div class="form-group tags-form-group"><label>Tags:</label>'+'<input class="post_form_tag_values" type="hidden" name="selected_text">'+'<input class="post_form_tags ui-widget form-control" type="text">'+'</div>';}else{var tag_html='';}
var sticky_html='';if(ss_context.network_admin){sticky_html='<div class="checkbox">'+'<label>'+'<input type="checkbox" name="'+option_selected+':sticky_flag" /> Sticky'+'</label>'+'</div>';}
form_html='<form class="post_form_form">'+
options[option_selected].form_include+
tag_html+
sticky_html+'</form>';$(post_form).html(form_html);if(!option_disable_tags){init_tags();}
$('input:first',post_form).focus();submit_row=$('<div />',{'class':'post_form_submit_row'});var option_post_as_company=options[option_selected]['post_as_company']==null?true:options[option_selected]['post_as_company'];if(post_as_company&&option_post_as_company){$('<div />',{'class':'checkbox'}).appendTo(submit_row).append($('<label />')).append($('<input />',{type:'checkbox'})).append('<span class="text_for_input_in_label">Post as your company</span>');}
var extra_submit_row=options[option_selected]['submit_row'];var extra_submit_row_classes=options[option_selected]['submit_row_classes']||'';if(extra_submit_row){submit_row.append('<div class="extra_submit_row_container '+extra_submit_row_classes+'"><form class="extra_submit_row_form">'+extra_submit_row+'</form></div>');}
submit_row.append($('<button />',{'class':'btn btn-primary button post_form_submit',type:'button'}).text(options[option_selected].form_text));$(post_form).append(submit_row);$('.post_form_form',post_form).validate({focusInvalid:false});if(options[option_selected].form_initializer){options[option_selected].form_initializer();}
$('.post_form_input',post_form).focus();$(document).bind('ss_file_uploaded',function(event,file_id){var $file_input=$('input[name="document:file"]',post_form);if($file_input.length){$file_input.val(file_id);$file_input.valid();}});$(document).bind('ss_file_uploaded',function(event,file_id){var $file_input=$('input[name="image:image"]',post_form);if($file_input.length){$file_input.val(file_id);$file_input.valid();}});}},contract_post_form=function(){if($(post_form).hasClass('expanded')){$(post_form).empty().removeClass('expanded');$(post_form).html('<div class="form-group"><input class="post_form_input_capture form-control" type="text" value=" '+options[option_selected].form_text+'"></div>');}};self=SS.controller(my);self.init=function(new_root_element){if(new_root_element!==undefined){root_element=new_root_element;}
var $first_option;post_form=$('.post_form',root_element);$first_option=$('.post_choices li:first',root_element);$first_option.addClass('active');option_selected=$first_option.find('a').data('option');if(option_selected){$('.post_form_input_capture',post_form).val(' '+options[option_selected].form_text);}
$('.post_choices',root_element).delegate('a','click',function(event){var this_option=$(this).data('option');if(this_option===option_selected){if($(post_form).hasClass('expanded')){contract_post_form();}else{expand_post_form();}}else{$('.active',root_element).removeClass('active').next('.post_new_nub').remove();$(this).parent('li').addClass('active');option_selected=this_option;contract_post_form();expand_post_form();}});$(root_element).delegate('.post_form_input_capture','click',function(event){expand_post_form();});$(root_element).delegate('.post_form_submit','click',function(event){var item=SS.models.item({url:'/'+option_selected+'s'}),tag_values=$('.post_form_tag_values',post_form).val(),extra_tag_values=$('.post_form_tags',post_form).val(),form_data,item_clump_id,item_clump_params={},post_as_company=!!$('.post_form_post_as_company input:checked',post_form).length&&$(root_element).data('post_as_company');if($('.post_form_form',post_form).valid()){$('.post_form_tag_values',post_form).val(tag_values+','+extra_tag_values);form_data=$('.post_form_form',root_element).serialize();if(post_as_company){form_data+="&post_as_company=True";}
var extra_submit_row_form=$(".extra_submit_row_form");if(extra_submit_row_form.length){form_data+=("&"+extra_submit_row_form.serialize());}
item_clump_id=$(this).closest('.post_new').data('item_clump_id');item_clump_params=SS.page.models[item_clump_id].get_params();form_data+='&'+$.param(item_clump_params);item.create(item_clump_id,form_data);$(root_element).after('<div class="item_clump_loading_new_item loading"></div>');contract_post_form();}});$(post_form).delegate('.tag .tag_action_remove','click',function(){var tag_id=$(this).closest('.tag').data('tag_id'),tag_values=$('.post_form_tag_values',post_form).val(),tag_values_array=tag_values.split(','),tag_values_array_good=_.reject(tag_values_array,function(tag){return tag===tag_id;}),tag_values_good=tag_values_array_good.join(',');$('.post_form_tag_values',post_form).val(tag_values_good);$(this).closest('.tag').remove();$('.post_form_tags',post_form).width(get_tags_add_input_width()).val('').focus();});};return self;}());;;SS.controllers.items=(function(){var my={},self=SS.controller(my),root_element="#main",comment_template=_.template('<li class="comment list-group-item"><div class="row"><div class="comment_pic col-xs-3 col-sm-1"><%= user_pic %></div>'+'<div class="comment_main col-xs-9 col-sm-11"><div class="comment_body"><a class="comment_owner" href="<%= user_link %>"><%= user_name %></a> <%= comment %></div>'+'<div class="comment_date_actions">1 second ago</div></div></div></li>'),text_url_to_link=my.text_url_to_link,newlines_to_br=my.newlines_to_br,clean_quotes=my.clean_quotes,has_post_button=function(element){return($('.button',element).length>0)?true:false;},has_likes=function(element){return($('.likes',element).length>0)?true:false;},toggle_actions_in_group=function($this_element){var $action_group_element=$this_element.closest('.item_action_group'),targets=$this_element.data('target');$action_group_element.find('button, a').hide();_.each(targets,function(target){$('.item_action_'+target,$action_group_element).show().removeClass('unavailable');});},toggle_actions_in_company=function($this_element){var $action_company_element=$this_element.closest('.item_action_company'),targets=$this_element.data('target');$action_company_element.find('button, a').hide();_.each(targets,function(target){$('.item_action_'+target,$action_company_element).show().removeClass('unavailable');});},freeze_dialog_size=function(dialog_element){var $dialog_content=$('.ui-dialog-content');$dialog_content.css({width:$dialog_content.width(),height:$dialog_content.height()});},disable_dialog_buttons=function(dialog_element){$(dialog_element).closest('.ui-dialog').find('.ui-dialog-buttonset button').attr('disabled',true);},like_unlike=function($this_element,action){var $item_element=my.get_item_element($this_element),item=my.get_model_object($item_element),liked_by_initial=$('.likes',$item_element).data('likes')||[],liked_by=(action==='like')?[[SS.app.current_user.name,SS.app.current_user.url]].concat(liked_by_initial):_.reject(liked_by_initial,function(person){return person[0]===SS.app.current_user.name;}),other_likes_amount=liked_by.length-2,has_comments=!!$('.comment',$item_element).length,has_likes=!!liked_by.length,has_comment_reply=!!$('.comment_reply',$item_element).length,can_comment=!item.get('disallows_comments'),like_text=function(){if(!liked_by||liked_by.length<=1){return'<a href="'+liked_by[0][1]+'">'+liked_by[0][0]+'</a> likes this.';}else if(liked_by.length===2){return'<a href="'+liked_by[0][1]+'">'+liked_by[0][0]+'</a> and <a href="'+liked_by[1][1]+'">'+liked_by[1][0]+'</a> like this.';}else if(liked_by.length<5){return _.reduce(liked_by.slice(0,liked_by.length-1),function(memo,person){return memo+'<a href="'+person[1]+'">'+person[0]+'</a>, ';},'')+' and <a href="'+_.last(liked_by)[1]+'">'+_.last(liked_by)[0]+'</a> like this.';}else{return'<a href="'+liked_by[0][1]+'">'+liked_by[0][0]+'</a>, <a href="'+liked_by[1][1]+'">'+liked_by[1][0]+'</a>, and <a class="likes_others">'+other_likes_amount+' other people</a> like this.';}};item[action]();$('.likes',$item_element).remove();if(has_comments||has_likes||has_comment_reply){if(has_comments||has_comment_reply){if(has_likes){$('.comment_nub',$item_element).after('<li class="likes list-group-item">'+like_text()+'</li>');$('.likes',$item_element).data('likes',liked_by);}}else{$('.item_main',$item_element).append('<ul class="comments list-group"><li class="comment_nub"></li><li class="likes list-group-item">'+like_text()+'</li></ul>');if(can_comment){$('.comments',$item_element).append('<li class="comment_reply list-group-item"><textarea class="comment_box">Post a comment</textarea></li>');}
$('.likes',$item_element).data('likes',liked_by);}}else{$('.comments',$item_element).remove();}
$('.item_action_like',$item_element).toggleClass('available');$('.item_action_unlike',$item_element).toggleClass('available');},create_comments_base=function($item_element){var $main=$('.item_main',$item_element);if(!$main.length){safe_log('Could not find ".item_main"');}
$main.append('<ul class="comments list-group"><li class="comment_nub"></li></ul>');},create_comment_form=function($item_element){$('.comments',$item_element).append('<li class="comment_reply list-group-item"><textarea class="comment_box" type="text">Post a comment</textarea><br/><button class="button btn btn-primary" type="button">Post Comment</button></li>');},expand_comment_form=function($this_element){var comment_reply,$item_element=my.get_item_element($this_element),$comment_box=$('.comment_box',$item_element);if($comment_box.val()==='Post a comment'){comment_reply=$('.comment_reply',$item_element);if(!has_post_button(comment_reply)){$('.comment_box',comment_reply).after('<button class="button btn btn-primary" type="button">Post Comment</button>');}
$('.button',comment_reply).show();$comment_box.val('').addClass('expanded').focus();}},contract_comment_form=function($item_element){var $comment_box=$('.comment_box',$item_element);if(!$comment_box.val()){$('.comment_reply .button',$item_element).hide();$comment_box.removeClass('expanded').val('Post a comment');}},add_comment=function($item_element,comment){$('.comment_reply',$item_element).before(comment_template({user_pic:SS.app.current_user.comment_pic,user_name:SS.app.current_user.name,user_link:SS.app.current_user.url,comment:comment}));},share=function($item_element){var item=my.get_model_object($item_element),item_type=item.get('type'),set_char_count=function(){var count_text='',char_count=$('.share_dialog_message').val().length;if($('.share_dialog input[value="twitter"]:checked').length){if(140-char_count<0){count_text=char_count+' ('+Math.abs(140-char_count)+' over)';}else{count_text=char_count+' ('+(140-char_count)+' left)';}}else{count_text=char_count;}
$('.share_dialog_count').text(count_text);},share_dialog_content='<textarea class="share_dialog_message">loading text... please wait</textarea><div>'+'<div>Characters: <span class="share_dialog_count">0</span></div>'+'<label><img alt="" src="/res/img/v2/icons/facebook.png"><input type="checkbox" checked value="facebook">Facebook</label>'+'<label><img alt="" src="/res/img/v2/icons/twitter.png"><input type="checkbox" checked value="twitter">Twitter</label>'+'</div>',share_dialog=SS.widgets.dialog({type:'share',content:share_dialog_content,title:'Share this '+item_type+' with friends!',buttons:{Share:function(){var share_to=_.map($('.share_dialog input:checked'),function(input){return $(input).val();});item.share(share_to,$('.share_dialog .share_dialog_message').val());freeze_dialog_size(this);$(this).html('Sharing...');_.delay(function(){$('.share_dialog').trigger('dialogclose');},300);disable_dialog_buttons(this);}}});share_dialog.init();$.ajax({url:item.get('url')+'/get_share_text',type:'GET',success:function(share_text){$('.share_dialog').find('textarea').text(clean_quotes(share_text));set_char_count();}});$('.share_dialog_message').bind('keyup paste blur focus',function(){set_char_count();});set_char_count();},user_dialog=function(users,title){var users_html=_.reduce(users,function(memo,person){return memo+'<a href="'+person[1]+'">'+person[0]+'</a>';},''),users_dialog_widget=SS.widgets.dialog({type:'users',content:users_html,title:title,buttons:{Close:function(){$(this).trigger('dialogclose');}}});users_dialog_widget.init();},change_user_counter=function($item_element,change){var num_users=+$('.num_users',$item_element).first().text();$('.num_users',$item_element).text(num_users+change);},follow_unfollow=function($this_element,action){var $item_element=my.get_item_element($this_element),user=my.get_model_object($item_element),num_change=action==='follow'?1:-1;user[action]();change_user_counter($item_element,num_change);toggle_actions_in_group($this_element);},get_tags_and_input_width=function($item_element){var $item_tags=$('.item_tags',$item_element),tags_width,input_width;if($item_tags.length){tags_width=_.reduce($('.tag',$item_tags),function(memo,tag){return memo+$(tag).outerWidth(true)+1;},0);input_width=$item_tags.width()-tags_width-3;return input_width>70?input_width:70;}else{return'100%';}},tag=function($this_element){var $item_element=my.get_item_element($this_element),$tags_input_initial=$('.item_add_tags_input',$item_element),$tags_input,$item_tags=$('.item_tags',$item_element),$asset_type=$($this_element).data('asset_type'),autocomplete,item=my.get_model_object($item_element),input_html='<input class="form-control item_add_tags_input ui-widget" type="text">',input_width=get_tags_and_input_width($item_element),on_select_callback=function(id,tag_html){item.add_tag(id);$.ajax({url:"/topic/add_asset_type",type:"POST",data:{asset_type:$asset_type,topic_id:id}});$('.item_add_tags_input',$item_element).before(tag_html).width(get_tags_and_input_width($item_element)).val('').focus();};if($tags_input_initial.length){$tags_input_initial.focus();}else{if($item_tags.length){$item_tags.append(input_html);}else{$('<div />',{'class':'item_tags'}).insertBefore($this_element.closest('.item_interaction_actions').parent()).append(input_html);}
$tags_input=$('.item_add_tags_input',$item_element);$tags_input.width(input_width);$tags_input.data('asset_type',$asset_type);autocomplete=SS.widgets.autocomplete_tag({input:$tags_input,on_select:on_select_callback});autocomplete.init();$tags_input.focus();}},make_reject_handler=function(){return function(event){var $item_element=my.get_item_element($(this));var item=my.get_model_object($item_element);var item_type=item.get('type');var msg='Reverting this '+item_type+' will place it back to the draft state and a '
+'notification sent to the poster.  Please give a reason for rejecting this '+item_type
+' (it will be passed to the poster)<br>';if(item_type==='job'){msg='Clicking Request Revision will place this '+item_type
+' back in the draft state and send a notification to the poster. If you provide a reason, it will be included in the notification email.';}
var content=msg+'<textarea class="reject_handler_box form-control"></textarea>';var title='Request Revisions';var confirm_dialog=SS.widgets.dialog({type:'confirm',content:content,title:title,buttons:{Cancel:function(){$('.confirm_dialog').trigger('dialogclose');},Send:function(){var reason=$('.reject_handler_box',this).val();item.update_state('draft',reason);if($item_element.hasClass('item_view_table')){$item_element.closest('tr').slideUp(500,function(){$item_element.closest('tr').remove();});}else{$item_element.slideUp(500,function(){$item_element.remove();});}
freeze_dialog_size(this);$(this).html('Reverting...');_.delay(function(){$('.confirm_dialog').trigger('dialogclose');},300);disable_dialog_buttons(this);}}});confirm_dialog.init();};},make_delete_handler=function(full_delete){return function(event){var $item_element=my.get_item_element($(this));var item=my.get_model_object($item_element);var item_type=item.get('type');item_type=item_type.replace(/_/g,' ');if(item_type=='user'){var content="You will not be able to restore this record and all the history related to this record. Are you sure you want to do this?";var title="Delete "+item.get('name')+" from the Database";}else if(item_type=='job'){var content='Clicking Remove and Delete will completely remove this job from the database and send a notification to the poster. Deleting jobs is permanent. If you provide a reason, it will be included in the notification email.'
+'<br><textarea class="remove_handler_box form-control"></textarea>';var title='Remove and Delete';}else{var name=', '+item.get('name')+',';if(item_type=='transaction'){name='';}
var content='Would you like to remove this '+item_type+name+' from the database? Removal of the '
+item_type+' is permanent.  You may optionally give a reason for the removal in the field below.<br>'
+'<textarea class="remove_handler_box form-control"></textarea>';var title='Delete this '+item_type;}
var confirm_dialog=SS.widgets.dialog({type:'confirm',content:content,title:title,buttons:{Cancel:function(){$('.confirm_dialog').trigger('dialogclose');},Delete:function(){var reason=$('.remove_handler_box',this).val();item.remove(full_delete,reason);if($item_element.hasClass('item_view_table')){$item_element.closest('tr').slideUp(500,function(){$item_element.closest('tr').remove();});}else{$item_element.slideUp(500,function(){$item_element.remove();});}
freeze_dialog_size(this);$(this).html('Deleting...');_.delay(function(){$('.confirm_dialog').trigger('dialogclose');},300);disable_dialog_buttons(this);}}});confirm_dialog.init();$(".ui-button-text:contains('Delete')").parent().addClass('danger');};};self.init=function(new_root_element){if(new_root_element!==undefined){root_element=new_root_element;}
$(root_element).delegate('.item_action_follow','click',function(event){follow_unfollow($(this),'follow');});$(root_element).delegate('.item_action_unfollow','click',function(event){follow_unfollow($(this),'unfollow');});$(root_element).delegate('.item_action_delete','click',make_delete_handler(false));$(root_element).delegate('.item_action_reject','click',make_reject_handler());$(root_element).delegate('.item_action_destroy','click',make_delete_handler(true));$(document).bind('ss_group_joined_left ss_event_rsvped_unrsvped ss_place_joined_left',function(){if($('#content').hasClass('item_view_single')){window.location=window.location;}});$(document).on('click','.item_action_cpage_clone_button',function(event){event.preventDefault();var $target=$(event.target);var url=$target.prop('href');$('<div>').ssdialog({title:'Clone this Custom Page',save_url:url,width:'auto',content:{html:"<form>"+"<div class='form-group'><label>Name: </label><input class='form-control required' name='name'></input></div>"+"<div class='form-group'><label>Description: </label><textarea name='description'></textarea></div>"+"</form>"},save_button_label:'Clone',success_callback:function(data){if(data.success){window.location=data.edit_url;}else{alert("We're sorry, but there was a problem completing your action. Please try again later.");}}});});$(root_element).delegate('.item_pic','click',function(){var image_dialog,img_source=$(this).find('img').attr('src').replace('=','').replace('/100x100',''),new_image_ending;if(_.startsWith(img_source,'/image/')){new_image_ending='/280x280';}else if(_.startsWith(img_source,'/res')){new_image_ending='';}else{new_image_ending='=/280x280';}
if(my.get_item_element($(this)).hasClass('item_view_single item_view_complex')){image_dialog=SS.widgets.dialog({type:'image',content:'<img src="'+img_source+new_image_ending+'" alt="Loading...">',title:'Embiggened Image',buttons:{Close:function(){$('.image_dialog').trigger('dialogclose');}}});image_dialog.init();}});$(root_element).delegate('.item','ss_item_created',function(event){share(my.get_item_element($(this)));event.stopPropagation();});$(root_element).delegate('.item_action_user_send_message','click',function(event){var $item_element=my.get_item_element($(this));var target_user=my.get_model_object($item_element);var subject=($item_element.data('subject'))?$item_element.data('subject'):'';var title=($item_element.data('title'))?$item_element.data('title'):'Send '+target_user.get('name')+' a Message';var message_dialog=SS.widgets.dialog_message({title:title,subject:subject,send_function:target_user.message});message_dialog.init();});$(root_element).delegate('.item_action_user_send_email','click',function(event){var $item_element=my.get_item_element($(this));var target_user=my.get_model_object($item_element);var message_dialog=SS.widgets.message_email_form({title:'Send '+target_user.get('name')+' an Email',subject:'',send_function:target_user.send_email});message_dialog.init();});$(root_element).delegate('.item_action_user_send_collection_message','click',function(event){var $item_element=my.get_item_element($(this)),target_user=my.get_model_object($item_element),message_dialog=SS.widgets.dialog_message({title:'Send '+target_user.get('name')+' a Message',subject:'RE: Outstanding Balance',send_function:target_user.message});message_dialog.init({'focus_selector':'.message_body'});});$(root_element).delegate('.item_action_user_disable','click',function(event){var target=my.get_model_object($(this));target.disable();toggle_actions_in_group($(this));});$(root_element).delegate('.item_action_user_enable','click',function(event){var target=my.get_model_object($(this));target.enable();toggle_actions_in_group($(this));});$(root_element).delegate('.item_action_user_reset_password','click',function(event){var $item_element=my.get_item_element($(this)),user=my.get_model_object($item_element),confirm_dialog=SS.widgets.dialog({type:'confirm',content:'The following email will be sent: <div class="dialog_message_preview">'+'<h4>Your password has been reset</h4>Dear '+user.get('name')+',<br><br>Your password has been reset.<br><br>'+'Your new password is: NEWPASSWORD.<br><br>Thank you, '+SS.app.current_network.name+' Team </div>',title:'Reset Password',buttons:{Cancel:function(){$('.confirm_dialog').trigger('dialogclose');},"Reset Password":function(){var $dialog=$(this);$dialog.html('Reseting Password...');disable_dialog_buttons(this);user.reset_password(function(response){$dialog.html(response);});}}});confirm_dialog.init();});$(root_element).delegate('.item_action_user_renewal_help','click',function(event){event.preventDefault();$.ss.dialog.message("What to do...","Engage this member.<br/>Invite them personally to a special event, look at their history, what do they like to attend?<br/>Send them a message, make it personal.<br/>Give them a gift, make them feel special.<br/><br/>All too often, membership organizations see each member as a number. Engage them as a friend.");});$(root_element).delegate('.item_action_company_join_request','click',function(){var $item_element=my.get_item_element($(this)),target_company=my.get_model_object($item_element);target_company.join_request();$(this).after($('<div />',{'class':'notice'}).text('Join request has been sent.')).remove();});$(root_element).delegate('.item_action_company_leave','click',function(){var $item_element=my.get_item_element($(this)),target_company=my.get_model_object($item_element),context=$(this);$item_element.ssdialog({'title':'Wait a second!','content':{'html':"<div class='alert alert-danger center'>Are you sure you want to leave the company?</div>"},'save_url':null,'open_callback':function(){$(".ui-button-text:contains('Confirm')").parent().removeClass('default').addClass('danger');},'buttons':{'Save':null,'Cancel':null,"Close":function(namespace){this[namespace]('hide');},'Confirm':function(namespace){toggle_actions_in_company($(this));target_company.leave();context.closest('.dropdown_div').hide();context.after($('<div />',{'class':'notice'}).text('You have left the company.')).remove();this[namespace]('hide');}}});});$(root_element).delegate('.item_action_group_join','click',function(){var $item_element=my.get_item_element($(this)),target_group=my.get_model_object($item_element);change_user_counter($item_element,1);toggle_actions_in_group($(this));target_group.join();});$(root_element).delegate('.item_action_group_join_request','click',function(){var $item_element=my.get_item_element($(this)),target_group=my.get_model_object($item_element);target_group.join_request();$(this).after($('<div />',{'class':'notice'}).text('Join request has been sent.')).remove();});$(root_element).delegate('.item_action_group_leave','click',function(){var $item_element=my.get_item_element($(this)),target_group=my.get_model_object($item_element);change_user_counter($item_element,-1);toggle_actions_in_group($(this));target_group.leave();});$(root_element).delegate('.item_action_group_message_all','click',function(){var target=my.get_model_object($(this)),message_dialog=SS.widgets.dialog_message({title:'Send a Message to All Members',subject:'',send_function:target.message_all});message_dialog.init();});$(root_element).delegate('.item_action_group_invite_people','click',function(){var $item_element=my.get_item_element($(this)),target_group=my.get_model_object($item_element),group_name=target_group.get('name'),invite_dialog=SS.widgets.dialog({type:'group_invite',content:$('#group_invite_view').html(),title:'Invite People to Join '+group_name,buttons:{'Send Invite':function(){var that=this;target_group.invite_users($('.group_invite_targets_value',this).val(),$('.group_invite_targets_email',this).val(),this);freeze_dialog_size(this);$(this).html('Sending...');_.delay(function(){$(that).trigger('dialogclose');},500);disable_dialog_buttons(this);}}}),autocomplete=null;invite_dialog.init();$('.group_invite_dialog').delegate('.group_invite_user_remove','click',function(){var user_id=$(this).closest('div').data('user_id'),user_values=$('.group_invite_dialog .group_invite_targets_value').val(),user_values_array=user_values.split(','),user_values_array_good=_.reject(user_values_array,function(user){return user===user_id;}),user_values_good=user_values_array_good.join(',');$('.group_invite_dialog .group_invite_targets_value').val(user_values_good);$(this).closest('div').remove();});autocomplete=SS.widgets.autocomplete_user({input:$('.group_invite_dialog .group_invite_targets'),on_select:function(user){var user_html='<div data-user_id="'+user.id+'">'+'<a href="'+user.url+'">'+user.name+'</a> '+'<span class="group_invite_user_remove" title="Remove user">x</span>'+'</div>',values=$('.group_invite_dialog .group_invite_targets_value').val()||'',to_insert=values?user.id+','+values:user.id;$('.group_invite_dialog .group_invite_targets_value').val(to_insert);$('.group_invite_dialog .group_invite_targets').val('').focus();$('.group_invite_dialog .group_invite_targets_display').append(user_html);}});autocomplete.init();});$(root_element).delegate('.item_action_group_invite_people_by_membership','click',function(){var $item_element=my.get_item_element($(this)),target_group=my.get_model_object($item_element),group_name=target_group.get('name'),invite_dialog=SS.widgets.dialog({type:'group_invite',content:$('#group_invite_view').html(),title:'Invite People to Join '+group_name,buttons:{'Send Invite':function(){var that=this;target_group.invite_users($('.group_invite_targets_value',this).val(),$('.group_invite_targets_email',this).val(),this);freeze_dialog_size(this);$(this).html('Sending...');_.delay(function(){$(that).trigger('dialogclose');},500);disable_dialog_buttons(this);}}}),autocomplete=null;invite_dialog.init();$('.group_invite_dialog').delegate('.group_invite_user_remove','click',function(){var user_id=$(this).closest('div').data('user_id'),user_values=$('.group_invite_dialog .group_invite_targets_value').val(),user_values_array=user_values.split(','),user_values_array_good=_.reject(user_values_array,function(user){return user===user_id;}),user_values_good=user_values_array_good.join(',');$('.group_invite_dialog .group_invite_targets_value').val(user_values_good);$(this).closest('div').remove();});autocomplete=SS.widgets.autocomplete_user({input:$('.group_invite_dialog .group_invite_targets'),on_select:function(user){var user_html='<div data-user_id="'+user.id+'">'+'<a href="'+user.url+'">'+user.name+'</a> '+'<span class="group_invite_user_remove" title="Remove user">x</span>'+'</div>',values=$('.group_invite_dialog .group_invite_targets_value').val()||'',to_insert=values?user.id+','+values:user.id;$('.group_invite_dialog .group_invite_targets_value').val(to_insert);$('.group_invite_dialog .group_invite_targets').val('').focus();$('.group_invite_dialog .group_invite_targets_display').append(user_html);}});autocomplete.init();});$(root_element).delegate('.group_action_add_leader','click',function(event){var autocomplete,$add_leader_button=$(this),$group_leaders=$add_leader_button.closest('.group_leaders'),group=my.get_model_object($group_leaders),on_select=function(user){var leader_html='<li class="list-group-item" data-user_id="'+user.id+'">'+'<div class="row">'+'<div class="col-xs-3"><a href="'+user.url+'"><img src="'+user.icon.src+'" width="48" height="48"></a></div>'+'<div class="col-xs-9 leader-details">'+'<div class="group_leader_name"><a href="'+user.url+'">'+user.name+'</a></div>'+'<div class="group_action_remove_leader" title="Remove leader"></div>'+'</div>'+'</div>'+'</li>';group.add_leader(user.id);$('.group_leader_add_input').remove();$add_leader_button.show();$('ul',$group_leaders).append(leader_html);};$('<input type="text" class="group_leader_add_input form-control">').insertAfter($add_leader_button).focus();autocomplete=SS.widgets.autocomplete_user({input:$('.group_leaders .group_leader_add_input'),on_select:on_select});autocomplete.init();$add_leader_button.hide();});$(root_element).delegate('.group_action_remove_leader','click',function(event){var $group_leader_element=$(this).closest('li'),group=my.get_model_object($group_leader_element);group.remove_leader($group_leader_element.data('user_id'));$group_leader_element.fadeOut();});$(root_element).delegate('.group_action_accept_member','click',function(event){var $user_element=$(this).closest('li'),group=my.get_model_object($user_element);group.accept_member($user_element.data('user_id'));$user_element.html('<div class="notice">Member Accepted</div>').delay(2000).slideUp();});$(root_element).delegate('.group_action_reject_member','click',function(event){var $user_element=$(this).closest('li'),group=my.get_model_object($user_element);group.reject_member($user_element.data('user_id'));$user_element.slideUp();});var toggle_button_group_action=function($this_element,attending){if($('#content .not_attending').length===0){$('.item_view_complex').before("<div class='not_attending alert alert-danger' style='display:none;'><b>You've indicated that you are not attending this event.</b></div>");}
if($('#content .attending').length===0){$('.item_view_complex').before("<div class='attending alert alert-success' style='display:none;'><b>Congratulations! You've successfully registered for this event.</b></div>");}
if(attending){$('#content .not_attending').fadeOut('500',function(){$('#content .attending').fadeIn();});}else{$('#content .attending').fadeOut('500',function(){$('#content .not_attending').fadeIn();});}
$this_element.addClass('active');$this_element.siblings().removeClass('active');};$(root_element).delegate('.item_action_attending','click',function(){var target_event=my.get_model_object($(this));toggle_button_group_action($(this),true);target_event.rsvp();});$(root_element).delegate('.item_action_not_attending','click',function(){var target_event=my.get_model_object($(this),false);toggle_button_group_action($(this));target_event.user_not_attending();});$(root_element).delegate('.item_action_event_message_course_attendees','click',function(){var target=my.get_model_object($(this)),message_dialog=SS.widgets.dialog_message({title:'Send a Message to All Attendees',subject:'',send_function:target.message_attendees});message_dialog.init();});$(root_element).delegate('.item_action_event_message_attendees','click',function(){var target=my.get_model_object($(this));var id=target.get('id');window.location='/onepage/group_email/new?event_id='+id;});$(root_element).delegate('.item_action_event_message_session_attendees','click',function(){var session_id=$(this).data('session_id');var target=my.get_model_object($(this));var message_session_attendees=function(field_mapper){return target.message_session_attendees(field_mapper,session_id);};var message_dialog=SS.widgets.dialog_message({title:'Send a Message to Session Attendees ( Registered Users Only )',subject:'',send_function:message_session_attendees});message_dialog.init();});$(root_element).delegate('.item_action_attendees','click',function(event){event.preventDefault();var $target=$(this);var url=$target.prop('href');var confirm_delete_participant=function(attendee_id,firstName,lastName){var name=firstName+' '+lastName;var completed=false;var cancel_dialog=SS.widgets.dialog({type:'delete_attendee',content:'Are you sure you want to remove the registration for '+name,title:'Delete an Attendee',buttons:{'Cancel':function(){if(!completed){$(this).trigger('dialogclose');}
else{window.location.reload();}},'Confirm':function(){var that=this;freeze_dialog_size(this);target_event.delete_attendee(attendee_id,this);disable_dialog_buttons(this);$(this).closest('.ui-dialog').find('.ui-dialog-buttonset button :contains("Cancel")').text("Refresh");completed=true;}}});cancel_dialog.init();};var show_attendees_callback=function(jquery_args,target){var event=jquery_args[0];var ui=jquery_args[1];$(event.target).delegate('.item_ticket_action_cancel','click',function(event){var attendeeId=$(event.target).attr('data_attendee_id');var firstName=$(event.target).attr('data_first_name');var lastName=$(event.target).attr('data_last_name');confirm_delete_participant.call(this,attendeeId,firstName,lastName);});};var $item_element=my.get_item_element($(this));var target_event=my.get_model_object($item_element),event_name=target_event.get('name'),permaid=$item_element.data('permaid');$target.ssdialog({'title':'Attendees/Invitees List','width':document.documentElement.offsetWidth,'content':{'url':url},'save_url':null,'buttons':{'Save':null,'Cancel':null,"Close":function(namespace){this[namespace]('hide');},'Download CSV':function(){var download_url=$item_element.data('url')+"/attendees_export/"+permaid+".csv";window.location=download_url;}},'open_callback':show_attendees_callback});});$(document).on('click','.action_buttons .dropdown_button',function(event){event.preventDefault();var $target=$(event.target);var $container=$target.closest(".action_buttons");var $dropdown=$container.find(".dropdown_div");$dropdown.toggle();$target.closest(".dropdown_button").toggleClass("menu_open");$dropdown.position({of:$target,my:"left top",at:"left bottom"});});$(document).click(function(e){var current_dropdown_div=$(e.target).parent().closest('.action_buttons').find('.dropdown_div:visible')
if(!$(e.target).closest('.action_buttons').find('.dropdown_action_div').length){$('.action_buttons .dropdown_div').hide();$('.action_buttons .dropdown_button').removeClass("menu_open");}
$.each($('.action_buttons .dropdown_div:visible'),function(index,dropdown_div){var a=current_dropdown_div;if(a.get(0)!==dropdown_div){$(dropdown_div).hide();}});});$(root_element).delegate('.dropdown_div li','click',function(event){var $container=$(event.target).closest('.dropdown_div');$container.hide();});if(!$("#site").data('clicked_dropdown')){$(document).click(function(e){var button=document.getElementById('dropdown_button_menu');if(button){var top=$('#dropdown_button_menu').position().top;var left=$('#dropdown_button_menu').position().left;var height=$('#dropdown_button_menu').height();var width=$('#dropdown_button_menu').width();if($(e.target).closest('#search_and_account .dropdown_button').length>0){if($('.account_dropdown:visible').length==0){$('.account_dropdown').css({'left':left-369+width,'top':top+height+7});$('.account_dropdown').show();$('.dropdown_button_activated').css({'left':left-1,'top':top-1});$('.dropdown_button_activated').show()
$('.dropdown_button_activated_back_layer').css({'left':left-1,'top':top-1});$('.dropdown_button_activated_back_layer').show()}else{$('.account_dropdown').hide();$('.dropdown_button_activated').hide();}}else if($(e.target).closest('.account_dropdown').length>0){}else{$('.account_dropdown').hide();$('.dropdown_button_activated').hide();$('.dropdown_button_activated_back_layer').hide();}}
var login_button=document.getElementById('login_button')||document.getElementById('login_button_digibc');var digibc=false
if(document.getElementById('login_button_digibc')){digibc=true}
if(login_button){if($(e.target).closest('.sign_in_button').length>0){e.preventDefault();if($('.sign_in_dropdown:visible').length==0){$('.sign_in_dropdown').show();$('.sign_in_button_activated').show();$('.sign_in_button_activated_back_layer').show();var top=$('.sign_in_ul').position().top;var left=$('.sign_in_ul').position().left-$('.sign_in_dropdown').width()+$('.sign_in_ul').width()-31;var height=$('.sign_in_ul').height();var button_top=$(login_button).position().top;var button_left=login_button.offsetLeft+2;var sign_in_dropdown_left=button_left-$('.sign_in_dropdown').width()+$(login_button).width()-11-2;if(digibc){$('.sign_in_dropdown').css({'left':sign_in_dropdown_left-24,'top':top+height-7});$('.sign_in_button_activated').css({'left':button_left-6,'top':button_top-4});$('.sign_in_button_activated_back_layer').css({'left':button_left-6,'top':button_top-4});}else{$('.sign_in_dropdown').css({'left':sign_in_dropdown_left,'top':top+height-5});$('.sign_in_button_activated').css({'left':button_left-3,'top':button_top-1});$('.sign_in_button_activated_back_layer').css({'left':button_left-3,'top':button_top-1});}}else{$('.sign_in_dropdown').hide();$('.sign_in_button_activated').hide();$('.sign_in_button_activated_back_layer').hide();}}else if($(e.target).closest('.sign_in_dropdown').length>0){}else{$('.sign_in_dropdown').hide();$('.sign_in_button_activated').hide();$('.sign_in_button_activated_back_layer').hide();}}});$("#site").data('clicked_dropdown',true);}
$('#site').delegate('.item_action_submit_sign_in_form','click',function(){var form=$(this).closest('form');$(form).submit();});$('.sign_in_dropdown').keypress(function(event){if(event.keyCode==13){var form_dropdown=$('#login_form_dropdown:visible');if(form_dropdown.length==0)
form_dropdown=$('#loginForm');$(form_dropdown).submit();}});$(root_element).delegate('.item_action_delete_attendee','click',function(){var $item_element=my.get_item_element($(this));var target_event=my.get_model_object($item_element),invite_dialog=SS.widgets.dialog({type:'delete_attendee',content:'<label>Put attendee id in here:</label>'+'<input type="text" class="attende_id form-control">'+'<div class="delete_result">',title:'Delete an Attendee',buttons:{'Close':function(){$(this).trigger('dialogclose');},'Confirm':function(){var that=this;freeze_dialog_size(this);target_event.delete_attendee($('.attende_id',this).val(),this);disable_dialog_buttons(this);}}});invite_dialog.init();});$(root_element).delegate('.item_action_invite_to_network','click',function(){var $item_element=my.get_item_element($(this));var model=SS.models.network(),invite_dialog=SS.widgets.dialog({type:'network_invite',content:'<label>Email Address (separate by commas):</label>'+'<input type="text" class="network_invite_targets_email form-control">'+'<label>Add a Message:</label>'+'<textarea class="network_invite_personalization field form-control" placeholder="...enter your custom message here"></textarea>'+'',title:'Invite to '+SS.app.current_network.name,buttons:{'Send Invite':function(){var that=this;model.invite_users($('.network_invite_targets_email',this).val(),this);freeze_dialog_size(this);$(this).html('Sending...');_.delay(function(){$(that).trigger('dialogclose');},500);disable_dialog_buttons(this);}}});invite_dialog.init();});$('html').delegate('.item_action_bulk_network_invite','click',function(event){event.preventDefault();var invite_type=$(event.target).data('invite_type');var invite_id=$(event.target).data('invite_id');$('<div class="form-popup">').ssdialog({'title':'Invite Members','width':800,use_self:true,'content':{'url':'/network/bulk_invite_popup?invite_type='+invite_type+'&invite_id='+(invite_id||'')},'load_callback':function(){$.ss.wysiwyg.create($(".network_bulk_invite_personalization"));if($('.ssdialog:visible .number_of_people').data('number')<1){$('.ui-dialog-buttonpane:visible').find(".ui-button-text:contains('Send Invite')").parent().prop('disabled',true);}
if(!$('.alert.alert-warning').length>0){$('.ui-dialog-buttonpane:visible').find(".ui-button-text:contains('Continue')").parent().hide();}},'save_url':'/network/save_bulk_invite','buttons':{'Save':null,'Continue':function(namespace){$('.continue_failed_job').val('something');this[namespace]('save');},'Save Invite':function(namespace){this[namespace]('save');$('input.completed[data-id=send_invite]').prop('checked',true).change();}}});});$(document).delegate('.toggle-bulk-invite-params','change',function(event){var statuses=[];_.each($('.invite-user-status'),function(checkbox){if($(checkbox).prop('checked')){statuses.push($(checkbox).val());}});var include_has_last_login=$('.include-has-last-login').prop('checked');var data={statuses:statuses,include_has_last_login:include_has_last_login};$.get('/network/get_user_count_for_bulk_invite',data,function(data){user_count=data['users'];$('.number-of-people').text(user_count+' people');});});$(root_element).delegate('.item_action_course_invite','click',function(event){event.preventDefault();var $target=$(this);var invite_type=$(event.target).data('invite_type');var url=$(event.target).data('url');var $item_element=my.get_item_element($(this));var target_course=my.get_model_object($item_element);var course_name=target_course.get('name');$target.ssdialog({'title':'Invite Students','width':600,'content':{'url':url+'?invite_type='+invite_type},'load_callback':function(){$.ss.wysiwyg.create($(".course_invite_personalization"));if($('.ssdialog:visible .number_of_people').data('number')<1){$('.ui-dialog-buttonpane:visible').find(".ui-button-text:contains('Send Invite')").parent().prop('disabled',true);}},'success_callback':function(response){var success_count=response.success.success_count;var failure_count=response.success.failure_count;var success_unit='student';var failure_unit='student'
if(success_count>1){success_unit='students';}
if(failure_count>1){failure_unit='students';}
var html='<div class="alert alert-success">'+success_count+' '+success_unit+' invited.</div>';if(failure_count){html+='<div class="alert alert-error">'+failure_count+' '+failure_unit+' were failed to be invited.</div>';}
success_function(html);},'save_url':$item_element.data('url')+'/send_invite_to_students','buttons':{'Save':null,'Send Invite':function(namespace){this[namespace]('save');}}});var success_function=function(content_html){$('<div>').ssdialog({'title':'Invite Students','width':600,'content':{'html':content_html},'buttons':{'Save':null,'Cancel':null,'OK':function(namespace){this[namespace]('hide');$('input.course_invitation_sent_js').prop('checked',true);}}});}});$(root_element).delegate('.item_action_event_invite_by_membership','click',function(event){event.preventDefault();var $target=$(this);var url=$target.prop('href'),$item_element=my.get_item_element($(this)),target_event=my.get_model_object($item_element),event_name=target_event.get('name'),total_member_selected=0;var popup=new ss.views.InviteByMembershipPopup({url:url,save_url:'/events/'+$item_element.data('permaid')+'/invite_plan_users',});});function check_duplicate(object_type,id){var element_rows=$('.event_invite_targets_display').children();if(object_type=='group')
element_rows=$('.group_invite_targets_display').children();for(var count=0;count<element_rows.length;count++){if($(element_rows[count]).data(object_type+'_id')==id)
return true;}
return false;}
$(root_element).delegate('.item_action_event_invite_by_prev_event','click',function(){var $item_element=my.get_item_element($(this)),target_event=my.get_model_object($item_element),event_name=target_event.get('name'),invite_dialog=SS.widgets.dialog({type:'event_invite',content:'<label>Invite by Event Name</label>'+'<div class="event_invite_targets_display"></div>'+'<input type="text" class="event_invite_targets form-control"><input class="event_invite_targets_value" type="hidden">'+'<label>Send a Custom Message:</label>'+'<div class="event_invite_personalization ckeditor_input" name="event_invite_personalization" style="display:none"></div>',title:'Invite from Previous Event',buttons:{'Send Invite':function(){var that=this;target_event.invite_users_by_prev_events($('.event_invite_targets_value',this).val(),this);freeze_dialog_size(this);$(this).html('Sending...');_.delay(function(){$(that).trigger('dialogclose');},500);disable_dialog_buttons(this);}}}),autocomplete=null;invite_dialog.init();$('.event_invite_dialog').delegate('.event_invite_user_remove','click',function(){var user_id=$(this).closest('div').data('user_id'),user_values=$('.event_invite_dialog .event_invite_targets_value').val(),user_values_array=user_values.split(','),user_values_array_good=_.reject(user_values_array,function(user){return user===user_id;}),user_values_good=user_values_array_good.join(',');$('.event_invite_dialog .event_invite_targets_value').val(user_values_good);$(this).closest('div').remove();});autocomplete=SS.widgets.autocomplete_event({input:$('.event_invite_dialog .event_invite_targets'),on_select:function(event){var event_html='<div class="element_row" data-event_id="'+event.id+'"data-count = "'+event.attendee_count+'">'+'<a href="'+event.url+'">'+event.name+'</a> '+'<span class="event_invite_user_remove" title="Remove user">x</span>'+'</div>',values=$('.event_invite_dialog .event_invite_targets_value').val()||'',to_insert=values?event.id+','+values:event.id;if(!check_duplicate('event',event.id)){$('.event_invite_dialog .event_invite_targets_value').val(to_insert);$('.event_invite_dialog .event_invite_targets').val('').focus();$('.event_invite_dialog .event_invite_targets_display').append(event_html);}}});autocomplete.init();});$(root_element).delegate('.item_action_event_invite_by_group','click',function(){var $item_element=my.get_item_element($(this)),target_event=my.get_model_object($item_element),event_name=target_event.get('name'),invite_dialog=SS.widgets.dialog({type:'event_invite',content:'<label>Invite by Group Name</label>'+'<div class="group_invite_targets_display"></div>'+'<input type="text" class="group_invite_targets form-control"><input class="group_invite_targets_value" type="hidden">'+'<label>Send a Custom Message:</label>'+'<div class="event_invite_personalization ckeditor_input" name="event_invite_personalization" style="display:none"></div>',title:'Invite a Group',buttons:{'Send Invite':function(){var that=this;target_event.invite_users_by_groups($('.group_invite_targets_value',this).val(),this);freeze_dialog_size(this);$(this).html('Sending...');_.delay(function(){$(that).trigger('dialogclose');},500);disable_dialog_buttons(this);}}}),autocomplete=null;invite_dialog.init();$('.event_invite_dialog').delegate('.group_invite_user_remove','click',function(){var user_id=$(this).closest('div').data('user_id'),user_values=$('.event_invite_dialog .group_invite_targets_value').val(),user_values_array=user_values.split(','),user_values_array_good=_.reject(user_values_array,function(user){return user===user_id;}),user_values_good=user_values_array_good.join(',');$('.event_invite_dialog .group_invite_targets_value').val(user_values_good);$(this).closest('div').remove();});var autocomplete_group=SS.widgets.autocomplete_group({input:$('.event_invite_dialog .group_invite_targets'),on_select:function(group){var group_html='<div class="element_row" data-group_id="'+group.id+'"data-count = "'+group.member_count+'">'+'<a href="'+group.url+'">'+group.name+'</a> '+'<span class="group_invite_user_remove" title="Remove user">x</span>'+'</div>',values=$('.event_invite_dialog .group_invite_targets_value').val()||'',to_insert=values?group.id+','+values:group.id;if(!check_duplicate('group',group.id)){$('.event_invite_dialog .group_invite_targets_value').val(to_insert);$('.event_invite_dialog .group_invite_targets').val('').focus();$('.event_invite_dialog .group_invite_targets_display').append(group_html);}}});autocomplete_group.init();});SS.invite_users=function(event,$item_element_param){var $item_element=$item_element_param||my.get_item_element($(this)),target_event=my.get_model_object($item_element),event_name=target_event.get('name'),invite_dialog=SS.widgets.dialog({type:'event_invite',content:'<label>Invite by Name</label>'+'<div class="event_invite_targets_display"></div>'+'<input type="text" class="event_invite_targets form-control"><input class="event_invite_targets_value" type="hidden">'+'<label>Invite by Email Address (separate by commas)</label>'+'<input type="text" class="event_invite_targets_email form-control">'+'<label>Send a Custom Message:</label>'+'<div class="event_invite_personalization ckeditor_input" name="event_invite_personalization" style="display:none"></div>',title:'Invite People to Attend "'+event_name+'"',buttons:{'Send Invite':function(){var that=this;target_event.invite_users($('.event_invite_targets_value',this).val(),$('.event_invite_targets_email',this).val(),this);freeze_dialog_size(this);$(this).html('Sending...');_.delay(function(){$(that).trigger('dialogclose');},500);disable_dialog_buttons(this);}}}),autocomplete=null;invite_dialog.init();$('.event_invite_dialog').delegate('.event_invite_user_remove','click',function(){var user_id=$(this).closest('div').data('user_id'),user_values=$('.event_invite_dialog .event_invite_targets_value').val(),user_values_array=user_values.split(','),user_values_array_good=_.reject(user_values_array,function(user){return user===user_id;}),user_values_good=user_values_array_good.join(',');$('.event_invite_dialog .event_invite_targets_value').val(user_values_good);$(this).closest('div').remove();});autocomplete=SS.widgets.autocomplete_user({input:$('.event_invite_dialog .event_invite_targets'),on_select:function(user){var user_html='<div data-user_id="'+user.id+'">'+'<a href="'+user.url+'">'+user.name+'</a> '+'<span class="event_invite_user_remove" title="Remove user">x</span>'+'</div>',values=$('.event_invite_dialog .event_invite_targets_value').val()||'',to_insert=values?user.id+','+values:user.id;if(!check_duplicate('user',user.id)){$('.event_invite_dialog .event_invite_targets_value').val(to_insert);$('.event_invite_dialog .event_invite_targets').val('').focus();$('.event_invite_dialog .event_invite_targets_display').append(user_html);}}});autocomplete.init();};$(root_element).delegate('.item_action_event_invite','click',SS.invite_users);$(root_element).delegate('.item_action_event_edit_admin','click',function(event){event.preventDefault();var $target=$(this);var url=$target.prop('href');var admin_title=$target.data('admin_title')||'Event Admins';$target.ssdialog({'title':admin_title,'width':340,'content':{'url':url},'refresh_after_save':true});});$(root_element).delegate('.item_action_place_join','click',function(){var $item_element=my.get_item_element($(this)),target=my.get_model_object($item_element);change_user_counter($item_element,1);target.join();toggle_actions_in_group($(this));});$(root_element).delegate('.item_action_place_leave','click',function(){var $item_element=my.get_item_element($(this)),target=my.get_model_object($item_element);change_user_counter($item_element,-1);target.leave();toggle_actions_in_group($(this));});$(root_element).delegate('.item_action_message_reply ','click',function(){var $item_element=my.get_item_element($(this)),message=my.get_model_object($item_element),owner_id=message.get('owner_id'),owner_type=message.get('owner_type'),owner=SS.models[owner_type]({id:owner_id}),message_dialog=SS.widgets.dialog_message({title:'Reply to message "'+message.get('name')+'"',subject:'Re: '+message.get('name'),send_function:owner.message});message_dialog.init();$('.message_dialog').find('.message_subject').val('Re: '+clean_quotes(message.get('name')));});$(root_element).delegate('.item_action_accept_proposal','click',function(){var $item_element=my.get_item_element($(this)),proposal=my.get_model_object($item_element),$feed_element=$item_element.closest('.item_clump');$item_element.find('.item_content').prepend('<div class="item_proposal_accepted">Accepted</div>');_.each($feed_element.find('.item[data-type="proposal"]:not([data-id="'+proposal.get('id')+'"])'),function(proposal_element){var $proposal_element=$(proposal_element);if($proposal_element.find('.item_proposal_rejected').length<1){$proposal_element.find('.item_content').prepend('<div class="item_proposal_rejected">Rejected</div>');$proposal_element.find('.item_actions').hide();}});proposal.accept();toggle_actions_in_group($(this));});$(root_element).delegate('.item_action_reject_proposal','click',function(){var $item_element=my.get_item_element($(this)),proposal=my.get_model_object($item_element);$item_element.find('.item_content').prepend('<div class="item_proposal_rejected">Rejected</div>');proposal.reject();toggle_actions_in_group($(this));});$(root_element).delegate('.item_action_job_apply','click',function(event){var job=my.get_model_object($(this)),owner_id=job.get('owner_id'),owner_type=job.get('owner_type'),owner=SS.models[owner_type]({id:owner_id}),message_dialog=SS.widgets.dialog_message({title:'Apply to the Job: '+job.get('name'),subject:'Re: Job Posting - '+job.get('name'),send_function:owner.message});message_dialog.init();});$(root_element).delegate('.item_action_job_close','click',function(event){var $item_element=my.get_item_element($(this)),job=my.get_model_object($item_element);job.update_state('inactive');$item_element.find('.item_byline').text('Job Closed');toggle_actions_in_group($(this));});$(root_element).delegate('.item_action_job_open','click',function(event){var $item_element=my.get_item_element($(this)),job=my.get_model_object($item_element);job.update_state('active');$item_element.find('.item_byline').text('');toggle_actions_in_group($(this));});$(root_element).delegate('.item_action_tag','click',function(){tag($(this));});$(root_element).delegate('.item_action_share','click',function(){share(my.get_item_element($(this)));});$(root_element).delegate('.item_action_like','click',function(){like_unlike($(this),'like');});$(root_element).delegate('.item_action_unlike','click',function(){like_unlike($(this),'unlike');});$(root_element).delegate('.item_likes_others','click',function(event){var $item_element=my.get_item_element($(this)),liked_by=$('.likes',$item_element).data('likes');user_dialog(liked_by,'This post was liked by:');});$(root_element).delegate('.item_action_comment','click',function(event){var $item_element=my.get_item_element($(this));event.stopPropagation();if($('.comment_box',$item_element).length<1){if(!has_likes($item_element)){create_comments_base($item_element);}
create_comment_form($item_element);}
expand_comment_form($(this));});$(root_element).delegate('.item_join_users','click',function(event){var users=$(this).data('users');user_dialog(users,'Users who joined:');});$('.item_tags',root_element).delegate('.tag_action_remove','click',function(){var $item_element=my.get_item_element($(this)),$tag_element=$(this).closest('.tag'),item=my.get_model_object($item_element);item.remove_tag($tag_element.data('tag_id'));$tag_element.remove();if($('.item_add_tags_input',$item_element).length){$('.item_add_tags_input',$item_element).width(get_tags_and_input_width($item_element)).focus();}});$(root_element).delegate('.comment_box','click',function(event){event.stopPropagation();expand_comment_form($(this));});$(root_element).delegate('.comment_reply .button','click',function(event){var $item_element=my.get_item_element($(this)),item=my.get_model_object($item_element),$reply_input=$('.comment_box',$(this).closest('.comment_reply')),comment_text=$reply_input.val(),comment=newlines_to_br(text_url_to_link(_.string.escapeHTML(_.string.trim(comment_text))));event.stopPropagation();if(comment){item.post_comment(comment_text);$reply_input.val('');contract_comment_form($item_element);add_comment($item_element,comment);}});$(root_element).delegate('.comment_action_delete','click',function(event){var item=my.get_model_object($(this)),comment_id=$(this).closest('.comment').data('comment_id');item.remove_comment(comment_id);$(this).closest('.comment').slideUp();});$(document).bind('click',function(event){if(event.which===1){_.each($('.item'),function(item){contract_comment_form(item);});}});$(root_element).delegate('.submit_category_search_form','click',function(){$(this).closest('form').submit();});$(root_element).delegate('.publish_item_js','click',function(event){var item=my.get_model_object($(this));$(event.target).prop('disabled',true);$(event.target).closest('.top_alert').find('.loading_cover').show();$(event.target).append(' <i class="fa fa-cog fa-spin"></i>')
item.publish();});$(root_element).delegate('.update_state_active','click',function(event){var item=my.get_model_object($(this));item.update_state('active');});$(root_element).delegate('.update_state_pending','click',function(event){var item=my.get_model_object($(this));var result=item.update_state('pending');result=result;});$(root_element).delegate('.update_state_archived','click',function(event){var item=my.get_model_object($(this));item.update_state('archived');});};return self;}());;;SS.controllers.nav=(function(){var self,my={},root_element='nav';self=SS.controller(my);self.init=function(new_root_element){if(new_root_element!==undefined){root_element=new_root_element;}
$(root_element).delegate('a','click',function(){$('.selected',root_element).removeClass('selected');$(this).addClass('selected');});};return self;}());;;SS.controllers.search_box=(function(){var self,my={},root_element='#search_box';self=SS.controller(my);self.init=function(new_root_element){if(new_root_element!==undefined){root_element=new_root_element;}
$(root_element).bind('click',function(){$(this).select();});};return self;}());;;SS.controllers.error=(function(){var self,my={},add_error=function(action_attempted,error_text,data,jqXHR){var error='<div class="error_title"><img src="/res/img/v2/icons/error.png"> Error:</div><div>',debug_url=jqXHR.getResponseHeader('X-Debug-URL'),warn_text=jqXHR.getResponseHeader('warn-text');if(warn_text){error+=warn_text;}else{error+='Action attempted: '+action_attempted+'.';if(error_text){error+=' Error text: '+error_text;}else{error+=' Action failed.';}
if(data){error+='<div>Data sent:</div>';if(data.constructor===String){error+='<div>'+data+'</div>';}else{_.each(data,function(value,key){error+='<div>'+key+': '+value+'</div>';});}}}
if(debug_url){error+='<div><a target="_blank" href="'+debug_url+'">Debug</a></div>';}
error+='</div><div><a class="error_action_dismiss">dismiss</a></div>';$('#main_content').prepend('<div class="error">'+error+'</div>');$('div.loading').replaceWith('<div class="error">'+error+'</div>');};self=SS.controller(my);self.init=function(new_root_element){var root_element;if(new_root_element!==undefined){root_element=new_root_element;}
$(document).bind('ss_ajax_error',function(event,action_attempted,error_text,data,jqXHR){add_error(action_attempted,error_text,data,jqXHR);});$('#main_content').delegate('.error_action_dismiss','click',function(){$(this).closest('.error').slideUp();});};return self;}());;;SS.controllers.advanced=(function(){var self,root_element="footer",my={},toggle=function(this_element,action){var to_change=$(this_element).data('value');$.ajax({url:'/test/'+action,type:'GET',data:{value:to_change},success:function(){window.location=window.location;}});};self=SS.controller(my);self.init=function(new_root_element){if(new_root_element!==undefined){root_element=new_root_element;}
$('.toggle_advanced').bind('click',function(event){event.preventDefault();event.stopPropagation();toggle(this,'toggle_advanced');});$('.toggle_version').bind('click',function(event){event.preventDefault();event.stopPropagation();toggle(this,'toggle_version');});$('.toggle_admin').bind('click',function(event){event.preventDefault();event.stopPropagation();toggle(this,'toggle_admin');});$('.refresh_css').bind('click',function(event){event.preventDefault();event.stopPropagation();$('link[href^="/css/sass"]').each(function(index,link){var $css=$(link);$css.attr('href',$css.attr('href')+'?x');});});$('html').on('click','.reverse-polarity',function(event){safe_log('Reversing Polarity');ss_require(['/res/js/os/Raptorize-Kit/jquery.raptorize.1.0.js'],function(module){$(event.target).raptorize();});});};return self;}());;;SS.controllers.tags=(function(){var self,my={};self=SS.controller(my);var root_el=ss.config.THEME_CONFIG.root_element_selector;self.init=function(new_root_element){var root_element;if(new_root_element!==undefined){root_element=new_root_element;}
$(root_el).delegate('.tag input','click',function(event){var $tag_follow=$(this),$tag_element=$tag_follow.closest('.tag'),tag_offset=$tag_element.offset(),tag_id=$tag_element.data('tag_id'),tag=SS.models.tag({id:tag_id}),bubble_message;if($tag_follow.is(':checked')){tag.follow();$tag_follow.attr('title','Unfollow');bubble_message='Tag Followed';}else{tag.unfollow();$tag_follow.attr('title','Follow');bubble_message='Tag Unfollowed';}
$tag_element.toggleClass('followed');$('<div class="tag_bubble_message">'+bubble_message+'</div>').insertAfter(root_el).hide();$('.tag_bubble_message').offset({left:tag_offset.left,top:tag_offset.top+$tag_element.outerHeight()}).show().delay(300).fadeOut(700,function(){$(this).remove();});});};return self;}());;;SS.controllers.map=(function(){var self,my={},map,root_element='',markers=[],overlays=[],clear_overlays=function(){_.each(overlays,function(overlay,key){overlay.setMap(null);});overlays=[];},add_marker=function(info){var target=new google.maps.LatLng(info.geo[1],info.geo[0]),marker=new google.maps.Marker({position:target,map:map,title:info.title}),infowindow=new google.maps.InfoWindow({content:$(info.window_html).get(0)});google.maps.event.addListener(marker,'click',function(){clear_overlays();infowindow.open(map,marker);overlays.push(infowindow);});markers.push(marker);},add_markers=function(infos){_.each(infos,function(info,key){add_marker(info);});},clear_markers=function(){_.each(markers,function(marker,key){marker.setMap(null);});markers=[];};self=SS.controller(my);self.init=function(new_root_element){if(new_root_element!==undefined){return;}
$(document).bind('ss_map_view_changed',function(event,bounds){var filters={'geo:north':bounds.getNorthEast().lat(),'geo:south':bounds.getSouthWest().lat(),'geo:west':bounds.getSouthWest().lng(),'geo:east':bounds.getNorthEast().lng()};$(document).trigger('ss_item_clump_filters_changed',['search_feed',filters]);});$(document).bind('ss_item_clump_updated',function(event,item_clump_id,data){if(map){clear_markers();add_markers(data.items);}});$(document).bind('ss_item_clump_added_older',function(event,item_clump_id,data){if(map){add_markers(data.items);}});$(document).bind('ss_map_created',function(event,the_map){var refresh_search;map=the_map;google.maps.event.addListener(map,'idle',function(){$(document).trigger('ss_map_view_changed',map.getBounds());});});};return self;}());;;SS.controllers.more=(function(){var self,my={},root_element='#body';self=SS.controller(my);self.init=function(new_root_element){if(new_root_element!==undefined){root_element=new_root_element;}
$(root_element).delegate('.see_more','click',function(){var $container=$(this).parent();$('.content_short',$container).remove();$('.content_all',$container).show();$(this).remove();});$(root_element).delegate('.see_all','click',function(){var $container=$(this).parent('ul');$('.hidden',$container).css('opacity',100);$('.hidden',$container).removeClass('hidden');$(this).remove();});};return self;}());;;SS.controllers.settings=(function(){var self,my={},root_element='.profile_edit';self=SS.controller(my);self.init=function(new_root_element){if(new_root_element!==undefined){root_element=new_root_element;}
if(false){$(root_element).delegate('input[name="notifications:all"]','click',function(){var inputs,change_to;if($(this).is(':checked')){inputs=$(this).closest('form').find('input').not('[name="notifications:all"], :checked');change_to=true;}else{inputs=$(this).closest('form').find('input:checked').not('[name="notifications:all"]');change_to=false;}
_.each(inputs,function(input){$(input).prop('checked',change_to);});});$(root_element).delegate('input[name!="notifications:all"]','click',function(){if(!$(this).is(':checked')){$(this).closest('form').find('input[name="notifications:all"]').prop('checked',false);}else{if(_.all($('input[name!="notifications:all"]',root_element),function(input){return $(input).is(':checked');})){$(this).closest('form').find('input[name="notifications:all"]').prop('checked',true);}}});}};return self;}());;;SS.controllers.item_edit=(function(){var self,my={},root_element='.item_edit',update_relationship_count=function($section_element,change){var follow_count=+$('h4 .relationship_edit_panel_count',$section_element).text();$('h4 .relationship_edit_panel_count',$section_element).text(follow_count+change);},init_relationship_add=function($relationship_edit_panel){var rel_data=$relationship_edit_panel.data(),type=rel_data.type,$relationship_add_input=$relationship_edit_panel.find('.relationship_edit_panel_add'),relationship_add_autocomplete=SS.widgets['autocomplete_'+type]({input:$relationship_add_input,on_select:function(info){var item=my.get_model_object($(root_element)),template=_.template(''+'<li class="item list-group-item">'+'<div class="clearfix">'+'<div class="item_pic add-group-member-pic img-thumbnail pull-left">'+'<input type="hidden" name="relation:'+rel_data.relation_id+':'+rel_data.direction+'" value="<%= id %>">'+'<a href="<%= url %>" title="<%= name %>"><img src="<%= icon.src %>"></a>'+'</div>'+'<div class="relationship_edit_panel_item_info pull-left">'+'<div class="item_title followed-name" title="<%= name %>"><a href="<%= url %>"><%= name %></a></div>'+'<button type="button" class="btn btn-danger relationship_edit_panel_action_remove">'+rel_data.disconnect_method_text+'</button>'+'</div>'+'</div>'+'</li>');if(!item.is_new()){item.add_relation(info.id,rel_data.relation_id,rel_data.direction);}
update_relationship_count($relationship_edit_panel,1);$relationship_edit_panel.find('.notice').remove();$(template(info)).data(info).hide().appendTo($relationship_edit_panel.find('ul')).fadeIn();$relationship_add_input.val('').select();}});relationship_add_autocomplete.init();};self=SS.controller(my);self.init=function(new_root_element){if(new_root_element!==undefined){root_element=new_root_element;}
var company_autocomplete,tag_autocomplete,user_follow_autocomplete,$user_follow_input_element=$('.profile_edit_user_follow',root_element),$tag_input_element=$('.profile_edit_tag_add',root_element),$item_edit_company_autocomplete=$('.item_edit_company_autocomplete',root_element),item_edit_company_autocomplete,$item_edit_event_autocomplete=$('.item_edit_event_autocomplete',root_element),item_edit_event_autocomplete,$item_edit_group_autocomplete=$('.item_edit_group_autocomplete',root_element),item_edit_group_autocomplete,$item_edit_user_autocomplete=$('.item_edit_user_autocomplete',root_element),item_edit_user_autocomplete,$item_edit_category_autocomplete=$('.item_edit_category_autocomplete',root_element),item_edit_category_autocomplete;$('.profile_edit_form',root_element).validate({ignore:':hidden',focusInvalid:false,onfocusout:false,onkeyup:false});if($item_edit_category_autocomplete.length){item_edit_category_autocomplete=SS.widgets.autocomplete_category({input:$item_edit_category_autocomplete,on_select:function(category_params){if($('.select_company_type').length>0){$('.select_company_type').hide();$('.select_company_type').find('select').val('');}
$item_edit_category_autocomplete.val(category_params.id);$item_edit_category_autocomplete.after('<div class="autocomplete_choice btn btn-default btn-sm"><span class="category_name">'+category_params.name+'</span> <span class="autocomplete_choice_remove red">&times;</span></div>').hide();}});item_edit_category_autocomplete.init();}
if($item_edit_company_autocomplete.length){item_edit_company_autocomplete=SS.widgets.autocomplete_company({input:$item_edit_company_autocomplete,on_select:function(company_params){$item_edit_company_autocomplete.siblings('input').val(company_params.id);var company_selected_html='<div class="user_autocomplete_selected autocomplete_choice">'+'<span class="company_name label label-default">'+
company_params.name+'</span>&nbsp;&nbsp;'+'<span class="label label-danger autocomplete_choice_remove">&times;</span>'+'</div>';$item_edit_company_autocomplete.after(company_selected_html).hide();}});item_edit_company_autocomplete.init();}
if($item_edit_group_autocomplete.length){item_edit_group_autocomplete=SS.widgets.autocomplete_group({input:$item_edit_group_autocomplete,on_select:function(group_params){$item_edit_group_autocomplete.siblings('input').val(group_params.id);$item_edit_group_autocomplete.after('<div class="autocomplete_choice"><span class="group_name">'+group_params.name+'</span> <span class="autocomplete_choice_remove">&times;</span></div>').hide();}});item_edit_group_autocomplete.init();}
if($item_edit_user_autocomplete.length){item_edit_user_autocomplete=SS.widgets.autocomplete_user({input:$item_edit_user_autocomplete,on_select:function(params){$item_edit_user_autocomplete.siblings('input').val(params.id);var $autocomplete_div=$('<div class="user_autocomplete_selected autocomplete_choice"></div>');var $autocomplete_title=$('<span class="user_name label label-default"></span>&nbsp;&nbsp;');var $autocomplete_x=$('<span class="label label-danger autocomplete_choice_remove">&times;</span>');var autocomplete_data={"user_full_name":params.full_name,"user_email":params.email,"user_phone":params.phone,"user_address":params.address};$autocomplete_title.text(params.name);$autocomplete_div.append($autocomplete_title).append($autocomplete_x);$autocomplete_div.data(autocomplete_data);$item_edit_user_autocomplete.after($autocomplete_div).hide();}});item_edit_user_autocomplete.init();}
$('.item_edit_user_list_autocomplete',root_element).livequery(function(){var $this=$(this);var input_name=$this.attr('inputname');item_edit_user_autocomplete=SS.widgets.autocomplete_user({input:$this,on_select:function(params){var $new_input=$('<input/>',{type:'hidden',name:input_name,value:params.id});var $new_choice=$('<div class="autocomplete_choice"><span class="autocomplete_choice_list_remove">&times;</span> '+params.name+'</div>');$new_choice.append($new_input);$this.parent().append($new_choice);$this.prop('value','');}});item_edit_user_autocomplete.init();});$item_edit_event_autocomplete.livequery(function(){item_edit_event_autocomplete=SS.widgets.autocomplete_event({input:$(this),on_select:function(params,event){event.target.value=params.id;$(event.target).after('<div class="autocomplete_choice"><span class="event_name">'+params.name+'</span> <span class="autocomplete_choice_remove">&times;</span></div>').hide();$(event.target).parent().parent().find('.error.custom').hide();}});item_edit_event_autocomplete.init();});$('.autocomplete_choice_remove').livequery('click',function(){var $field_section=$(this).closest('.field_section');$field_section.find('.ui-autocomplete-input').show();$field_section.find('.autocomplete_choice').remove();$field_section.find('input').val('');if($('.select_company_type:hidden').length>0)
$('.select_company_type').show();});$(document).on('click','.autocomplete_choice_list_remove',function(event){event.preventDefault();$(this).closest('.autocomplete_choice').remove();});$(root_element).delegate('.item_edit_clear_professional_history','click',function(){var user=my.get_model_object($(root_element));user.clear_professional_history();$('.professional_experience',root_element).remove();});$(root_element).delegate('.binding_post_on_someones_behalf','change',function(){var $span=$('input[name="post_as_company"]',root_element).closest('label').find('span');if($span.text()==="your"){$span.text("the user's");}else{$span.text('your');}});if($('.company_edit_autocomplete',root_element).length){company_autocomplete=SS.widgets.autocomplete_company({input:$('.company_edit_autocomplete',root_element),on_select:function(company_params){var company=SS.models.company(company_params),user=my.get_model_object($('#content'));$('.item_edit_section',root_element).html('<div class="loading"></div>');company.join_company(user.get('id'));}});company_autocomplete.init();}
if($tag_input_element.length){tag_autocomplete=SS.widgets.autocomplete_tag({input:$tag_input_element,on_select:function(tag_id,tag_html){var tag=SS.models.tag({id:tag_id});tag.follow();$('.tag_list',root_element).append(tag_html);$tag_input_element.val('').focus();},hide_remove_button:true,auto_follow:true});tag_autocomplete.init();$(root_element).delegate('.tag input','click',function(){$(this).closest('.tag').fadeOut();});}
$.each($('.relationship_edit_panel',root_element),function(){init_relationship_add($(this));});var confirmation_helper=function(context,confirm_fun){var ok_text=$(context).data("ok_text")||"OK";$.ss.dialog.confirm("Send Group Email","Are you sure you want to send this group email?",function(){if(this.confirmed){confirm_fun();}},"Send");};var update_ckeditors=function($form){$form.find('[type=hidden]').each(function(index,hidden){var $hidden=$(hidden);var $editor=$hidden.data('ckeditor');if($editor){$editor.update_hidden();}});};$(root_element).delegate('.item_edit_action_save','click',function(){var $form=$('.item_edit_form',root_element);update_ckeditors($form);var data=$form.serialize(),item=my.get_model_object($(root_element));data+='&'+$(this).attr("data-status");var context=this;var submit_fun=function(){my.submit_form($form,$(context),function(){item.edit(data);},root_element);};if($(this).hasClass("ask_confirmation")){confirmation_helper(context,submit_fun);}else{submit_fun();}});$(root_element).delegate('.item_edit_action_create','click',function(){var $form=$('.item_edit_form',root_element);update_ckeditors($form);var data=$form.serialize(),type=my.get_model_object($(root_element)).get('type'),item=SS.models.item({url:'/'+my.get_plural(type)}),parent_id=$form.find('input[name="parent_context"]').val(),parent_type=$form.find('input[name="parent_type"]').val(),parent_url=parent_id?'/'+my.get_plural(parent_type)+'/'+parent_id:undefined;data+='&'+$(this).attr("data-status");var context=this;var submit_fun=function(){my.submit_form($form,$(context),function(){item.create(false,data,type,parent_url);},root_element);};if($(this).hasClass("ask_confirmation")){confirmation_helper(context,submit_fun);}else{submit_fun();}});$(document).bind('ss_item_saved',function(event,inline,redirect_url){if(!inline){if(redirect_url){window.location=redirect_url;}else{window.location.reload(true);}}});$(document).bind('ss_item_created',function(event,data,type,parent_url){var item_url=$(data).data('url');if(data.url){window.location=data.url;}else if(item_url){window.location=item_url;}else if(parent_url){window.location=parent_url;}else{window.location='/'+my.get_plural(type);}});$(document).bind('ss_item_removed',function(event,redirect_url){window.location=redirect_url;});$(document).bind('ss_company_member_added ss_company_joined ss_profile_unlinked ss_profile_linked ss_profile_membership_cancelled',function(){window.location=window.location;});$(document).bind('ss_profile_settings_saved',function(event,response){if(response.error){$(root_element).html(response.error);}else if(response.redirect_to){window.location=response.redirect_to;}else{window.location=window.location;}});$(root_element).delegate('.profile_settings_action_cancel_membership','click',function(){var membership_info_id=$(this).data('membership_info_id'),user=my.get_model_object($('#content'));user.cancel_membership(membership_info_id);$(root_element).html('<div class="loading"></div>');});$(root_element).delegate('.profile_settings_action_save','click',function(){var $profile_edit_form=$('.profile_edit_form'),data=$profile_edit_form.serialize(),user=my.get_model_object($('#content'));if($profile_edit_form.valid()){user.save_settings(data);$(root_element).html('<div class="loading"></div>');}});$(root_element).delegate('.relationship_edit_panel_action_remove','click',function(){var $item_element=my.get_item_element($(this)),item=my.get_model_object($(root_element)),$section_element=$item_element.closest('.relationship_edit_panel'),rel_data=$section_element.data(),target_data=$item_element.data();update_relationship_count($section_element,-1);if(!item.is_new()){item.remove_relation(target_data.id,rel_data.relation_id,rel_data.direction);}
$item_element.fadeOut();});$(root_element).delegate('.company_edit_action_remove_member','click',function(){var $member_element=$(this).closest('li'),target_user=my.get_model_object($member_element),company=my.get_model_object($('#content'));company.remove_member(target_user.get('id'));$member_element.slideUp(function(){$member_element.remove();});});$(root_element).delegate('.company_edit_action_add_member','click',function(){var
company=my.get_model_object($(root_element)),$li_element=$(this).closest('li'),autocomplete;$(this).remove();$li_element.html('<label>Select User to Add:</label> <input type="text" class="company_edit_action_add_member_input">');$('input',$li_element).focus();autocomplete=SS.widgets.autocomplete_user({input:$('.company_edit_action_add_member_input'),on_select:function(user_info){company.add_member(user_info.id);$li_element.html('<div class="loading"></div>');}});autocomplete.init();});$('.field_type').livequery('change',function(){$('.option_list',$(this).closest('.field_info')).attr('option_type',$(this).val());});$(root_element).delegate('.create_new_user','click',function(){$('.binding_create_a_new_user').val('True').change();});$(root_element).delegate('.choose_existing_user','click',function(){$('.binding_create_a_new_user').val('').change();});$(root_element).delegate('.display_item_edit_upload','click',function(e){var url=$('#content').data('url');var $clickable_div=$(this).find('.clickable_div');var display_key=$clickable_div.data('display_key');var strings_to_check=[/http[s]?:\/\/(www\.)?youtube\.com\/watch\?v=([\w\d-]+)/,/http[s]?:\/\/(www\.)?youtu\.be\/([\w\d-]+)/,/http[s]?:\/\/(www\.)?youtube\.com\/v\/([\w\d-]+)/,/http[s]?:\/\/(www\.)?youtube\.com\/user\/[\w\d\?\=]+#p\/u\/\d+\/([\w\d-]+)/,/http[s]?:\/\/(www\.)?vimeo\.com\/(\d+)/];var title;if(display_key=='left'){title='Choose a Photo or Video';}else{title='Choose a Photo';}
$(this).ssdialog({'title':title,'save_url':url,'width':get_dialog_width(),'buttons':{'Save':function(namespace){var upload_section=$('.binding_upload_type').val();var index;var valid_link=false;var video_url=$('.item_display_video_url').val();$('.item_display_video_url').parent().find('.error').remove();if(upload_section=='2'){for(index in strings_to_check){if(video_url.match(strings_to_check[index])){valid_link=true;}}
if(valid_link){this[namespace]('save');}else{$('.item_display_video_url').after('<div class="error">Invalid Video URL.</div>');}}else{this[namespace]('save');}}},'refresh_after_save':true,'content':{'url':url+'/render_edit_upload_dialog?name='+display_key}});});$(root_element).delegate('.company_edit_company_type','click',function(e){$('.binding_company_types').removeAttr('disabled');});};return self;}());;;SS.controllers.permissions=(function(){var self,my={},root_element='.permissions_table',update_options=function($this_element,check_options){var data=$this_element.data(),start_selector='input[data-user_type="'+data.user_type+'"]',selector;$(start_selector).prop('checked',false);if(data.category){selector=start_selector+'[data-categories~="'+data.category+'"]';}else{selector=start_selector;}
$(selector).prop('checked',check_options);};self=SS.controller(my);self.init=function(new_root_element){if(new_root_element!==undefined){root_element=new_root_element;}
$('.permission_action_clear_all',root_element).bind('click',function(){update_options($(this),false);});$('.permission_action_check_all',root_element).bind('click',function(){update_options($(this),true);});$('.permission_action_check_category',root_element).bind('click',function(){update_options($(this),true);});};return self;}());;;SS.controllers.setup=(function(){var self,my={},root_element='.setup';self=SS.controller(my);self.init=function(new_root_element){if(new_root_element!==undefined){root_element=new_root_element;}
var company_autocomplete;if($('.setup_company_autocomplete',root_element).length){company_autocomplete=SS.widgets.autocomplete_company({input:$('.setup_company_autocomplete',root_element),on_select:function(company_params){var company=SS.models.company(company_params),user=my.get_model_object($('#content'));$('.setup_main_section',root_element).html('<div class="loading"></div>');company.join_company(user.get('id'));}});company_autocomplete.init();}
$(root_element).delegate('.setup_disclaimer_next','click',function(){var $checkbox=$('.disclaimer_checkbox',root_element);if($checkbox.is(':checked')){window.location="/setup/disclaimer_signed";}else{$checkbox.closest('label').addClass('error').change(function(){$(this).removeClass('error');});}});$(root_element).delegate('.setup_disclaimer_step_button','click',function(event){event.preventDefault();var $checkbox=$('.disclaimer_checkbox',root_element);if($checkbox.is(':checked')){var $form=$('form',root_element);$form.append($('<input />',{type:'hidden',name:'redirect_url',value:$(this).attr('href')}));$form.submit();}else{$checkbox.closest('label').addClass('error').change(function(){$(this).removeClass('error');});}});$(root_element).delegate('.setup_next','click',function(event){var $form=$('form:not(form form)',root_element);var included_classes=['setup_profile','setup_basic','setup_notification','setup_privacy','setup_custom','setup_mailing_address','setup_company']
var content_has_class=false;$.each(included_classes,function(key,value){if(_.indexOf(included_classes,value)>-1){content_has_class=true}});if(content_has_class&&$form.is(':visible')){event.preventDefault();$form.append($('<input />',{type:'hidden',name:'redirect_url',value:$(this).attr('href')}));$form.submit();}});$(root_element).delegate('.setup_action_new_company','click',function(){$('.setup_company_pick',root_element).hide();$('.setup_form').show();});};return self;}());;;SS.controllers.social=(function(){var self,my={},root_element='.social';self=SS.controller(my);self.init=function(new_root_element){if(new_root_element!==undefined){root_element=new_root_element;}
$(root_element).delegate('.social_action_unlink','click',function(){var $box_element=$(this).closest('.social_box'),network=$box_element.data('social_network'),user=my.get_model_object($('#content'));$('.'+network+'-connected').hide();$('.'+network+'-not-connected').show();user.unlink(network);});};self.facebook_link=function(){var user=my.get_model_object($('#content'));user.link('facebook');$('.facebook-not-connected').hide();$('.facebook-connected').show();};return self;}());;;SS.controllers.calendar=(function(){var self,my={},root_element='.calendar',event_type;self=SS.controller(my);self.init=function(new_root_element){if(new_root_element!==undefined){return;}
var $calendar=$(root_element),event_src;var category;var category_query='';if($calendar.length){event_src=$(root_element).data('event_src');category=$(root_element).data('event_category');if(category){category_query='?event_category='+category;}
var set_view;if($(window).width()<768){set_view='agendaList';}else{set_view='month';}
ss_require(["/res/js/os/fullcalendar.min.js"],function(util){$(root_element).fullCalendar({defaultView:set_view,editable:false,header:{left:'prev,next today',center:'title',right:'month,basicWeek,basicDay,agendaList'},windowResize:function(view){var current_view=$(this).fullCalendar('getView');if(current_view.name!='agendaList'&&$(window).width()<768){$(this).fullCalendar('changeView','agendaList');}},events:'/event/ajax_'+event_src+category_query,timeFormat:'h:mm A',loading:function(is_loading,view){if(!is_loading){_.each($('span.fc-event-time',root_element),function(time){var $time=$(time);if($time.text()==='12am'){$time.remove();}});}}});});}};return self;}());;;SS.controllers.customizations=(function(){var self,my={},root_element='.customization',submit_form=function($form,$this_element,submit_function){if($form.valid()){submit_function();$(root_element).html('<div class="loading"></div>');}else{$('<div />',{'class':'error'}).html('Your required fields are not valid. Please review.').insertAfter($this_element).delay(1000).fadeOut();}};self=SS.controller(my);self.init=function(new_root_element){if(new_root_element!==undefined){root_element=new_root_element;}
$(root_element).delegate('.customization_edit_action_save','click',function(){var $form=$('.customization_form',root_element),data=$form.serialize(),item=my.get_model_object($(root_element));submit_form($form,$(this),function(){item.edit(data);});});};return self;}());;;SS.controllers.data_table=(function(){var self,my={},root_element='.data_table',header_index=function(th){return $(th).data('column_index');};self=SS.controller(my);self.init=function(new_root_element){if(new_root_element!==undefined){root_element=new_root_element;}
$(root_element).delegate('.export_transactions','click',function(event){var transaction_export_dialog=$('<div>').ssdialog({'content':{'html':'<div class="center margin_bottom">Please select a date range to download a list of transactions. Please note,</br> all transactions will be downloaded between those dates.</div>'+'<div class="label_beside margin_left"><div class="field"><label>From Date:</label><input type="text" class="date date_input hasDatepicker trs_exp_date" id="trs_from_date" name="from_date"></div>'+'<div class="field"><label>To Date:</label><input type="text" class="date date_input hasDatepicker trs_exp_date" id="trs_to_date" name="to_date"></div></div>','refresh_on_show':true},'title':'Download Transactions','buttons':{'Save':null,'Download':function(namespace){var $container=this.data(namespace).container;var from_date=$container.find('#trs_from_date').val();var to_date=$container.find('#trs_to_date').val();var $form=$('<form style="display:none;" id="frm" method="post" action="/admin/transactions_export"></form>');$form.append($('<input type="hidden" name="from_date">').val(from_date)).append($('<input type="hidden" name="to_date">').val(to_date)).append($('<input type="hidden" name="sort_csv_col">').val('1'));$("body").append($form);$form.submit();this[namespace]('hide');}}});$.each($('#trs_from_date, #trs_to_date').livequery(function(){$(this).removeClass('hasDatepicker');$(this).datepicker({dateFormat:'dd M yy'});}),function(){});$('.default').focus();});$(root_element).delegate('.item_action_user_membership_add_note','click',function(event){event.preventDefault();var target=my.get_model_object($(this));var get_url=target.get('url')+'/manage/add_note';var save_url=target.get('url');$('<div>').ssdialog({title:'Add a Note to '+target.get('name')+'\'s Membership Record',save_url:save_url,dynamic_width:true,content:{url:get_url,refresh_on_show:true}});});$(root_element).delegate('.item_action_user_membership_plan','click',function(event){event.preventDefault();var target=my.get_model_object($(this));var get_url=target.get('url')+'/manage/membership_plan';var save_url=target.get('url');$('<div>').ssdialog({'title':'Change Membership for '+target.get('name'),'save_url':save_url,'dynamic_width':true,'content':{'url':get_url,'refresh_on_show':true}});});$(root_element).delegate('.item_action_user_membership_admin_status_give','click',function(event){event.preventDefault();var target=my.get_model_object($(this));var get_url=target.get('url')+'/manage/admin_status';var save_url=target.get('url');$('<div>').ssdialog({'title':'Give '+target.get('name')+' Admin Access?','save_url':save_url,'dynamic_width':true,'content':{'url':get_url,'refresh_on_show':true},save_button_label:'Yes',cancel_button_label:'No','success_callback':function(){var $link=$(event.target).closest('a');$link.siblings('a').show();$link.hide();}});});$(root_element).delegate('.item_action_user_membership_admin_status_remove','click',function(event){event.preventDefault();var target=my.get_model_object($(this));var get_url=target.get('url')+'/manage/admin_status';var save_url=target.get('url');$('<div>').ssdialog({'title':'Remove '+target.get('name')+'\'s Admin Access?','save_url':save_url,'dynamic_width':true,'content':{'url':get_url,'refresh_on_show':true},'success_callback':function(){var $link=$(event.target).closest('a');$link.siblings('a').show();$link.hide();}});});$(root_element).delegate('.item_action_user_membership_cancel_recurring','click',function(event){event.preventDefault();var target=my.get_model_object($(this));var get_url=target.get('url')+'/manage/cancel_recurring';var save_url=target.get('url')+'/cancel_recurring_payments';$('<div>').ssdialog({'title':'Cancel '+target.get('name')+'\'s Recurring Payment','save_url':save_url,'dynamic_width':true,'content':{'url':get_url,'refresh_on_show':true},'success_callback':function(){var $link=$(event.target).closest('a');$link.siblings('a').show();$link.hide();}});});};self.add_ui_filters=function(oTable,$table_filter_head){$("input.min_range_filter, input.max_range_filter",$table_filter_head).keyup(function(){var $th=$(this).closest('th'),min=$th.find('.min_range_filter').val(),max=$th.find('.max_range_filter').val();oTable.fnFilter(min+'-'+max,header_index($(this).closest('th')));});$("input.filter",$table_filter_head).change(function(){oTable.fnFilter(this.value,header_index($(this).closest('th')));});$("select.filter",$table_filter_head).change(function(){oTable.fnFilter(this.value,header_index($(this).closest('th')));});$(".date_input",$table_filter_head).change(function(){oTable.fnFilter(this.value,header_index($(this).closest('th')));}).focus(function(){this.select();});};self.initialize_table=function(table_config,config,$table){var data_fetches=0;var init_time=new Date();var $table_div=$table||$(root_element),data_fetching_function=function(sSource,aoData,fnCallback){var now=new Date();data_fetches+=1;var elapsed_seconds=(now-init_time)/1000;if(elapsed_seconds>0){var request_rate=(data_fetches/elapsed_seconds);if(data_fetches>100&&request_rate>1){safe_log('Data table fetches, request rate:',data_fetches,request_rate);return;}}
var json_field_data=JSON.stringify($table_div.data('config'));aoData.push({"name":"report_spec","value":json_field_data});$.ajax({url:sSource,data:aoData,success:function(json){fnCallback(json);},type:'POST'});},oTable,toolbar,$wrapper,$table_filter_head=$('thead.filter_head',$table_div).clone(),refresh_table=function(){$wrapper.replaceWith("<table class='data_table' class='display'></table>");self.initialize_table(table_config,config);};config=config||{};table_config.group_bys=table_config.group_bys||[];$table_div.data('config',table_config);$table_div.html('');var enable_fixed_columns=false;var header_callback=function(nHead,aData,iStart,iEnd,aiDisplay){var $checkbox_header=$(nHead).find('th.checkbox');if($checkbox_header.length){if(!$checkbox_header.find('input[type=checkbox]').length){var $checkbox=$('<input type="checkbox">')
$checkbox_header.find('.DataTables_sort_wrapper').append($checkbox.change(function(event){$checkbox_header.closest('.dataTables_wrapper').find('td.checkbox input[type="checkbox"]').prop('checked',$(event.target).prop('checked')).change();}));}}};var data_table_params={"bJQueryUI":true,"sPaginationType":"two_button","aaSorting":table_config.default_sorting,"aoColumns":table_config.group_bys.concat(table_config.columns),"iDisplayLength":table_config.default_row_count,"bDestroy":true,"sDom":table_config.config_params+'<"toolbar"><"filter_bar">rt"F"lip',"bProcessing":true,"bServerSide":true,"sAjaxSource":table_config.ajax_source,"fnServerData":data_fetching_function,"fnRowCallback":table_config.row_callback,"fnHeaderCallback":header_callback};var calculate_data_table_height=function(){var $wide_table_div=$table_div.closest('.wide_table');var $app_panel=$table_div.closest('#app_panel_js');var remaining_height=$app_panel.height();$wide_table_div.siblings().each(function(index,sibling){var include_margin=true;remaining_height-=$(sibling).outerHeight(include_margin);});var fudge_factor=40;remaining_height-=fudge_factor;return remaining_height;};if(table_config.enable_fixed_columns){data_table_params.sScrollX='98%';data_table_params.sScrollCollapse=false;var sScrollY='200px';data_table_params.sScrollY=sScrollY;}
oTable=$table_div.dataTable(data_table_params);var resize_table=function(){if(!$table_div.is(':visible')){return;}
var new_height=calculate_data_table_height();safe_log('Table height',new_height);safe_log(oTable.fnSettings().oScroll.sY);oTable.fnSettings().oScroll.sY=new_height+'px';safe_log(oTable.fnSettings().oScroll.sY);oTable.fnAdjustColumnSizing();var $wrapper=$table_div.closest('.dataTables_wrapper');$wrapper.height(new_height);var $scroll_body=$wrapper.find('.dataTables_scrollBody');var table_header_footer_height=80;$scroll_body.height(new_height-table_header_footer_height);safe_log('scrollbody',$scroll_body);safe_log($scroll_body.height());};$(window).bind("resize",function(){resize_table();});member_table=oTable;if($table_filter_head.length){$('thead',$table_div).last().after($table_filter_head);}
if(!table_config.enable_fixed_columns){$wrapper=$table_div.closest('.dataTables_wrapper');toolbar=$('div.toolbar');toolbar.html($('.add_person_button'));$wrapper.before(toolbar);$('div.filter_bar').html($('.title_secondary'));if(table_config.export_source&&!table_config.hide_export_button){window.add_export_button(oTable,table_config);}
$('div.toolbar').append($('.add_person_button'));}
self.add_ui_filters(oTable,$table_filter_head);$(document).trigger('ss_data_table_initialized',[$table_div,oTable]);if(config.dynamic_columns){}
return oTable;};return self;}());window.add_export_button=function(oTable,table_config){var ajax_params=function(){var oSettings=oTable.fnSettings(),iColumns=oSettings.aoColumns.length,aoData=[],i,form,csv_button=$(this);oSettings.iDraw+=1;aoData.push({"name":"sEcho","value":oSettings.iDraw});aoData.push({"name":"iColumns","value":iColumns});aoData.push({"name":"iDisplayStart","value":oSettings._iDisplayStart});aoData.push({"name":"iDisplayLength","value":oSettings.oFeatures.bPaginate!==false?oSettings._iDisplayLength:-1});if(oSettings.oFeatures.bFilter!==false)
{aoData.push({"name":"sSearch","value":oSettings.oPreviousSearch.sSearch});aoData.push({"name":"bRegex","value":oSettings.oPreviousSearch.bRegex});for(i=0;i<iColumns;i+=1)
{aoData.push({"name":"sSearch_"+i,"value":oSettings.aoPreSearchCols[i].sSearch});aoData.push({"name":"bRegex_"+i,"value":oSettings.aoPreSearchCols[i].bRegex});aoData.push({"name":"bSearchable_"+i,"value":oSettings.aoColumns[i].bSearchable});}}
if(oSettings.oFeatures.bSort!==false)
{var iFixed=oSettings.aaSortingFixed!==null?oSettings.aaSortingFixed.length:0;var iUser=oSettings.aaSorting.length;aoData.push({"name":"iSortingCols","value":iFixed+iUser});for(i=0;i<iFixed;i+=1)
{aoData.push({"name":"iSortCol_"+i,"value":oSettings.aaSortingFixed[i][0]});aoData.push({"name":"sSortDir_"+i,"value":oSettings.aaSortingFixed[i][1]});}
for(i=0;i<iUser;i+=1)
{aoData.push({"name":"iSortCol_"+(i+iFixed),"value":oSettings.aaSorting[i][0]});aoData.push({"name":"sSortDir_"+(i+iFixed),"value":oSettings.aaSorting[i][1]});}
for(i=0;i<iColumns;i+=1)
{aoData.push({"name":"bSortable_"+i,"value":oSettings.aoColumns[i].bSortable});}}
form=$('<form method="post" action="'+table_config.export_source+'"></form>');$.each(aoData,function(){form.append('<input type="hidden" name="'+this.name+'" value="'+this.value+'"');});csv_button.after(form);form.submit();};var csv_button=$('<button class="export_div button success">Export to CSV</div>').click(ajax_params);$('div.toolbar').append(csv_button);};;;SS.controllers.mailchimp=(function(){var my={},self=SS.controller(my),root_element="#main",make_submit_handler=function(){return function(){var $item_element=my.get_item_element($(this)),$form=$(this).closest('form'),item=my.get_model_object($item_element),item_type=item.get('type'),$input_element,confirm_dialog=SS.widgets.dialog({type:'confirm',content:'Would you like to add these members to Mailchimp? Adding of the members is not reversable.',title:'Add Members',buttons:{Cancel:function(){$('.confirm_dialog').trigger('dialogclose');},Ok:function(){$('.confirm_dialog').trigger('dialogclose');SS.widgets.dialog({type:'wait',content:'Adding members to MailChimp, it may take up to 20 seconds.',title:'Adding members',buttons:{},hide_close_button:true}).init();$('body').css('cursor','wait');$.ajax({type:'POST',url:$form.prop('action'),data:$form.serialize(),timeout:1000*60*60*24,success:function(){window.location.reload();},error:function(){alert("We're sorry, but there was an error processing your request. Please try again later.");window.location.reload();}});}}});if($form.valid()){if($item_element.find('.add_by_event.field_section').attr("style")==="display: block; "){if($item_element.find('.autocomplete_choice').length){confirm_dialog.init();}else{$input_element=$item_element.find('.item_edit_event_autocomplete.required.ui-autocomplete-input');if($item_element.find('.item_edit_event_autocomplete.required.ui-autocomplete-input.valid')){$input_element.parent().after('<label class="error custom"> Invalid Event Name</label>');$item_element.find('.item_edit_event_autocomplete.required.ui-autocomplete-input').attr('class','item_edit_event_autocomplete required ui-autocomplete-input error');}}}else{confirm_dialog.init();}}};};self.init=function(new_root_element){if(new_root_element!==undefined){root_element=new_root_element;}
$(root_element).delegate('.item_action_submit','click',make_submit_handler(true));};return self;}());;;SS.controllers.fields=(function(){var root_el=ss.config.THEME_CONFIG.root_element_selector;var self,my={},root_element=root_el,bind_children=function(container){$(container).find('.field, .field_section').each(function(index,field){bind_field($(field));});},bind_field=function($field){var data=SS.safe_data($field),$bound_to_inputs,bound_to_input_data,check_bound=function($bound_to_inputs){var bound_input_val=$bound_to_inputs.first().attr('type')==='radio'||$bound_to_inputs.first().attr('type')==='checkbox'?$bound_to_inputs.filter(':checked').val():$bound_to_inputs.first().val(),str_bound_to_value=String(data.bound_to_value),bound_to_value=str_bound_to_value.indexOf(',')>0?str_bound_to_value.split(','):str_bound_to_value,check_value=function(value){if(value.indexOf('!')===0){return _.string.ltrim(value,'!')!==bound_input_val;}else{return value===bound_input_val;}};if($field.parents('.disabled_by_binding').length===0&&(_.isArray(bound_to_value)?_.any(bound_to_value,function(value){return check_value(_.string.trim(value));}):check_value(bound_to_value))){$.each($field.find(':input'),function(){if(!$(this).data('disabled')){$(this).removeAttr('disabled');}});$field.show();$field.removeClass('disabled_by_binding');bind_children($field);}else{$.each($field.find(':input'),function(){$(this).attr('disabled',true);});$field.hide();$field.addClass('disabled_by_binding');bind_children($field);}};if(data&&data.bound_to){$field.hide();bound_to_input_data=data.bound_to.split('|');if(bound_to_input_data.length>1){$bound_to_inputs=$(bound_to_input_data[1],$field.closest(bound_to_input_data[0]));}else{$bound_to_inputs=$(':input[name="'+bound_to_input_data[0]+'"]');}
$bound_to_inputs.livequery('change',function(){check_bound($(this));});check_bound($bound_to_inputs);}},update_indices=function($list){$list.children('li').each(function(i,elem){var $list_item=$(this);var $index_inputs=$list_item.find('input[name$="index"]');$index_inputs.each(function(){var old_index=$(this).val();if(old_index>=0){$(this).val(i+1);}});var square_bracket_after_colon_regex=/:([^\]]+)\[([^\]]+)\]/;var square_bracket_regex=/\[([^\]]+)\]/;var $inputs_to_update=$list_item.find('input, select').filter(function(){var $this=$(this);var name=$this.attr('name');var matches=false;if(name){matches=$this.attr('name').match(square_bracket_regex);}
return matches;});$inputs_to_update.each(function(j,input){var $input=$(input);var old_name=$input.attr("name");var colon_to_end_bracket=old_name.match(square_bracket_after_colon_regex)[0];var colon_to_end_bracket_replaced=colon_to_end_bracket.replace(square_bracket_regex,'['+i+']');var new_name=old_name.replace(square_bracket_after_colon_regex,colon_to_end_bracket_replaced);$input.attr('name',new_name);});});};self=SS.controller(my);self.init=function(new_root_element){if(new_root_element!==undefined){root_element=new_root_element;}
_.each($('.location_input',root_element),function(location_input){var location_autocomplete=SS.widgets.autocomplete_location({input:$(location_input),on_select:function(location_info){$(location_input).val(location_info.address);}});location_autocomplete.init();});_.each($('.autocomplete_input',root_element),function(autocomplete_input){var generic_autocomplete=SS.widgets.autocomplete_generic({collection:$(autocomplete_input).data('autocomplete_collection'),input:$(autocomplete_input),on_select:function(autocomplete_result){$(autocomplete_input).val(autocomplete_result.label);}});generic_autocomplete.init();});$('.date_input').livequery(function(){$(this).removeClass('hasDatepicker');$(this).datepicker({dateFormat:'dd M yy',onClose:function(){try{$(this).valid();}catch(error){}}});});_.each($('.wysiwyg_input',root_element),function(input,i){$.ss.wysiwyg.create($(input));});_.each($('.color_input',root_element),function(color_input){var $color_input=$(color_input),data=$color_input.data(),hexFromRGB=function(r,g,b){var hex=[r.toString(16),g.toString(16),b.toString(16)];$.each(hex,function(nr,val){if(val.length===1){hex[nr]="0"+val;}});return hex.join("").toUpperCase();},refreshSwatch=function(){var red=$(".theme_red",$color_input).slider("value"),green=$(".theme_green",$color_input).slider("value"),blue=$(".theme_blue",$color_input).slider("value"),hex=hexFromRGB(red,green,blue);$(".theme_swatch",$color_input).css("background-color","#"+hex);$("header").css("border-color","#"+hex);$("nav:not('.reduced_prominence') a.selected").css("background-color","#"+hex);$('input[name="theme_red"]',$color_input).val(red);$('input[name="theme_green"]',$color_input).val(green);$('input[name="theme_blue"]',$color_input).val(blue);};$(".theme_red, .theme_green, .theme_blue",$color_input).slider({orientation:"horizontal",range:"min",max:255,value:127,slide:refreshSwatch,change:refreshSwatch});$(".theme_red",$color_input).slider("value",data.red);$(".theme_green",$color_input).slider("value",data.green);$(".theme_blue",$color_input).slider("value",data.blue);$('input',$color_input).change(function(){$color_input.find('.'+$(this).attr('name')).slider('value',$(this).val());});});$('.field, .field_section',root_element).livequery(function(){bind_field($(this));});$('.field, .field_section','body').livequery(function(){bind_field($(this));});$(root_element).delegate('.field_action_delete_row','click',function(){var $row=$(this).closest('.indexed_row'),delete_path=$(this).data('path'),$delete_marker=$('<input type="hidden" name="'+delete_path+'" value="Delete">');$delete_marker.insertBefore($(this));$row.hide();});$(root_element).delegate('.field_action_template_add_another','click',function(){self.render_and_add_template($(this).closest('.field_section'),$(this));});$(root_element).delegate('.field_action_category_template_add_another','click',function(){var $field_selection_div=$(this).parent();var $x_mark;if($field_selection_div.find(".short_field").length<10){if($field_selection_div.find(".short_field").length===1){$x_mark=$field_selection_div.find('.short_field').find(".reminder_remove");$x_mark.show();}
self.render_and_add_template($(this).closest('.field_section'),$(this));}
if($field_selection_div.find(".short_field").length==10){$(this).remove();}});$(root_element).delegate('.field_action_reminder_template_add_another','click',function(event){if(event){event.preventDefault();}
var $field_selection_div=$(this).parent();var $x_mark;if($field_selection_div.find(".short_field").length<10){if($field_selection_div.find(".short_field").length==1){$x_mark=$field_selection_div.find('.short_field').find(".reminder_remove");$x_mark.show();}
self.render_and_add_template($(this).closest('.field_section'),$(this));}
if($field_selection_div.find(".short_field").length==10){$(this).remove();}});$(root_element).delegate('.toggle_uncheck_banner','click',function(){var i;var $hidden_ul;var $number;if(!$(this).prop('checked')){$('.uncheck_banner').fadeIn('slow',function(){})
$hidden_ul=$(this).parent().parent().find(".field_section.reminder_ul");for(i=1;i<$hidden_ul.find('li').length+1;i++){$li=$hidden_ul.find('li:nth-of-type('+i+')');$to_delete=$li.find('.input_box.to_delete');$number=$li.find('.reminder_number');$time_unit=$li.find('.reminder_time_unit');$is_before=$li.find('.binding_day_list');if($number){if($number.val()){$number.removeAttr('disabled');}}
if($time_unit){$time_unit.removeAttr('disabled');}
if($is_before){$is_before.removeAttr('disabled');}}}
if($(this).prop('checked')){$('.uncheck_banner').fadeOut('slow',function(){})
$hidden_ul=$(this).parent().parent().find(".field_section.reminder_ul");for(i=1;i<$hidden_ul.find('li').length+1;i+=1){var $li=$hidden_ul.find('li:nth-of-type('+i+')');var $to_delete=$li.find('.input_box.to_delete');$number=$li.find('.reminder_number');var $time_unit=$li.find('.reminder_time_unit');var $is_before=$li.find('.binding_day_list');if($number){if($li.find('.binding_day_list').val()==="day_of"){$number.attr('disabled',true);}}
if($time_unit){if($li.find('.binding_day_list').val()==="day_of"){$time_unit.attr('disabled',true);}}}}});$(root_element).delegate('.field_action_add_another','click',function(){var $field_section=$(this).closest('.field_section'),$duplicate_section=$field_section.children('.field, .fields_two_column, .fields_three_column').last().clone(true);_.each($duplicate_section.find('input, select, textarea'),function(input){var $input=$(input),incrementor=function(str,num){return+num+1;},name_source=$input.attr('name')||$input.data('name'),name=name_source.replace(/([0-9])/g,incrementor);if($input.attr('name')){$input.attr('name',name).val('');}else{$input.data('name',name).val('');}});$duplicate_section.insertBefore($(this));});$('.fields_sortable',root_element).each(function(){$(this).sortable({placeholder:"ui-state-highlight",containment:$(this),forcePlaceholderSize:true,update:function(event,ui){update_indices(ui.item.closest('ul'));}});$(this).find('li').each(function(){var $fields=$(this),$index_input=$fields.find('input[name$="index"]');if(!$fields.hasClass('template')&&$index_input&&+$index_input.val()===-1){$fields.hide();}});});$(root_element).delegate('.fields_action_remove','click',function(){var $fields=$(this).closest('li'),$index_input=$fields.find('input[name$="index"]');if($index_input.length){$index_input.val(-1);$(':input',$fields).not($index_input).each(function(index,field){$(field).attr('disabled',true);});$fields.slideUp();}else{$fields.remove();}});$(root_element).delegate('.company_category_remove','click',function(){if($('.field_section').find('li:visible').length>1){$(this).closest('li').hide();$(this).closest('li').find('.to_delete').val('True');}});$(root_element).delegate('.reminder_remove','click',function(){var $fields=$(this).closest('li'),$index_input=$fields.find('input[name$="index"]'),$field_selection_div,$li,$parent_div,$first_reminder;if($index_input.length){$index_input.val(-1);$(':input',$fields).not($index_input).each(function(index,field){$(field).attr('disabled',true);});$fields.slideUp();}else{var $ul_div=$fields.parent();if($ul_div.find('.field_action_reminder_template_add_another').length===0){$ul_div.append('<button type="button" name = "add_reminder_button" class="field_action_reminder_template_add_another">Add Another Reminder</button>');}
$field_selection_div=$(this).parent().parent().parent();if($field_selection_div.find(".short_field").length>2){$li=$(this).parent();$li.remove();}
if($field_selection_div.find(".short_field").length===2){$parent_div=$(this).parent().parent().parent();$li=$(this).parent();$li.remove();$first_reminder=$parent_div.find('.reminder_remove');$first_reminder.hide();}
var $to_delete=$fields.find('.input_box.to_delete');$to_delete.val(true);}});$(root_element).delegate('.customization_menu_preexisting_options button','click',function(){var $item=$(this).closest('li'),data=$item.data(),$field_section=$('.customization_menu_items',root_element),$new_menu_item=self.render_and_add_template($field_section,$field_section.find('.field_action_template_add_another')),img_src=$item.find('img').attr('src'),img_name=$new_menu_item.find('input[name$="image"]').attr('name')+'.full_url';$new_menu_item.find('input[name$="title"]').val(data.title).end().find('input[name$="url"]').val(data.link).end().find('input[name$="image"]').attr('name',img_name).val(img_src).end().find('img').attr('src',img_src).end().find('iframe').remove();update_indices($field_section);});$(root_element).delegate('#secondary_content .save_button','click',function(event){$('#main_content form',root_element).submit();});$(document).bind('ss_file_uploaded',function(event,file_id,file_url,size_x,size_y,file){safe_log('ss_file_uploaded',event,file_id,file_url,size_x,size_y,file);var style="";var $hidden_field=$('#hidden_'+file_id);var $field=$hidden_field.closest('.field');var $image_block=$field.find('.image_block');var $temp_url_field=$hidden_field.siblings('.temp-file-url');if($temp_url_field.length){$temp_url_field.val(file_url);}
var $temp_file_name_field=$hidden_field.siblings('.temp-file-name');if($temp_file_name_field.length&&file&&file.file_name){$temp_file_name_field.prop('disabled',false).val(file.file_name);}
if(size_x&&size_y){style="style='width:"+size_x+"px;height:"+size_y+"px'";}
var $new_img=$('<img '+style+'src="'+file_url+'">');var $img=$image_block.find('img');if($img.length===1){$img.after($new_img);$img.remove();}else{$image_block.html($new_img);}
$hidden_field.prop('disabled',false);$hidden_field.attr('value',file_id);$field.attr('value',file_id);$('.file_validation').remove();$field.find('.image-exists').show();$field.find('.image-does-not-exist').hide();$(".ui-dialog-buttonset button:last-child").removeAttr('disabled');$hidden_field.change();});$('.template').livequery(function(){if($(this).data('content_as_children')&&$(this).children().length){$(this).data('content',$(this).children());$(this).children().remove();}});$('.delete_image, .delete_file').livequery('click',function(event){if(!event||!event.target)
return;event.preventDefault();var $image_block=$(event.target).closest('.image_section, .file_section');var $field=$(event.target).closest('.field');if($image_block.length===0){$image_block=$field;}
var $hidden_field=$image_block.find('input[type="hidden"]').not('.temp-file-url');$hidden_field.attr('value','delete');$hidden_field.prop('disabled',false);$hidden_field.change();var $upload_iframe=$field.find('iframe');var upload_iframe_src=$upload_iframe.prop('src');var random_letter=String.fromCharCode(97+Math.round(Math.random()*25));if(upload_iframe_src.match('&blah=')){$upload_iframe.prop('src',upload_iframe_src+random_letter);}else{$upload_iframe.prop('src',upload_iframe_src+'&blah='+random_letter);}
$field.find('.image-exists, .file-exists').hide();$field.find('.image-does-not-exist, .file-does-not-exist').show();$(".ui-dialog-buttonset button:last-child").removeAttr('disabled');});$(root_element).delegate('.submit','click',function(){var form=$(this).closest('form');$(form).submit();});$(root_element).delegate('.search_widget_submit','click',function(){var form=$(this).closest('form');var target_type=$(this).closest('.custompage_directory_widget').find('.binding_target_type').val();$(form).append("<input name='search_target' type='hidden' value="+target_type+">");$(form).validate({ignore:'hidden'});if($(form).valid()){$(form).submit();}});};self.render_and_add_template=function($field_section,$insert_location,append){var $template=$field_section.children('.template'),$template_section,next_index=+$template.data('next_index'),index_var=$template.data('index_var'),replace_template_vars=function($to_replace){_.each($to_replace.find(':input'),function(input){var $input=$(input),name_source=$input.attr('name')||$input.data('name')||'',name=name_source.replace(new RegExp('{'+index_var+'}','g'),next_index);name=name.replace('TEMPLATE-','');if($input.is('select')){var $class_source=$input.parent().parent().find('label'),class_name=$class_source.text().replace(new RegExp('{'+index_var+'}','g'),next_index);class_name=class_name.replace('TEMPLATE-','');if(!class_name){}else{$class_source.text(class_name);}}
if(!name){}else if($input.attr('name')){$input.attr('name',name);}else{$input.data('name',name);}
$input.removeAttr('disabled');});_.each($to_replace.find('.template'),function(nested_template){var content=$(nested_template).data('content');if(content){content=content.clone(true);replace_template_vars(content);$(nested_template).data('content',content);}});};if($template.data('content')){$template_section=$template.data('content').clone(true);}else{$template_section=$template.clone(true);}
replace_template_vars($template_section);$template.data('next_index',next_index+1);$template_section.removeClass('template');if(append){$template_section.appendTo($insert_location);}else{$template_section.insertBefore($insert_location);}
$template_section.show();return $template_section;};return self;}());;;SS.controllers.validations=(function(){var root_el=ss.config.THEME_CONFIG.root_element_selector;var self,my={},root_element=root_el;self=SS.controller(my);self.init=function(new_root_element){if(new_root_element!==undefined){root_element=new_root_element;}
$('form',root_element).validate({ignore:':hidden:not(.not-ignore)',focusInvalid:true,creditcard:true,email:true,phone:true,exp_month:true,cvd:true,ticket_quantity:true,check_number_of_tickets_not_zero:true,end_date_grater_then_start_date:true,start_date_less_then_end_date:true,checkbox_check:true,date:true,positiveNumber:true,not_negative:true});$(root_element).delegate('form','submit',function(event){if(!$(this).valid()){event.preventDefault();}});jQuery.validator.addMethod('positiveNumber',function(value){return Number(value)>0;},'Please enter a positive number.');jQuery.validator.addMethod('not_negative',function(value){return Number(value)>=0;},'Please enter a non-negative number.');(function(){var msg="You have selected too many tickets, please select fewer & try again";var messenger=function(){return msg;};jQuery.validator.addMethod("ticket_quantity",function(quantity,element){var total_num_of_tickets=0;$('.show_error').html("");var $container=element.closest('.ticket-container-wrapper');$($container).find('select').each(function(index,element){if($(element).value!==0){total_num_of_tickets+=parseInt($(element).val());}});var success=true;var error_showed=false;var number_tickets_available=$($container).find($(".num_of_tickets_available"))[0].value;if(number_tickets_available<total_num_of_tickets){success=false;msg="You selected "+total_num_of_tickets
+" tickets, but there's only "+number_tickets_available
+" ticket(s) available";}
return success;},messenger);})();jQuery.validator.addMethod("check_number_of_tickets_not_zero",function(ticket_num,element){var success=true;var total_num_of_tickets=0;$("#eventForm").find('select').each(function(index,element){if($(element).value!==0){total_num_of_tickets+=parseInt($(element).val());}});if(total_num_of_tickets==0){success=false;}
return success;},function(){});jQuery.validator.addMethod("end_date_grater_then_start_date",function(end_date,element){var ticket_end_date=new Date($("[name='ticket:registration_end_date']").val());if($("[name='ticket:registration_start_date']").val()&&$("[name='ticket:registration_end_date']").val()){var ticket_start_date=new Date($("[name='ticket:registration_start_date']").val());return ticket_start_date<=ticket_end_date;}
return true;},"Dates not in order");jQuery.validator.addMethod("start_date_less_then_end_date",function(end_date,element){var ticket_start_date=new Date($("[name='ticket:registration_start_date']").val());if($("[name='ticket:registration_start_date']").val()&&$("[name='ticket:registration_end_date']").val()){var ticket_end_date=new Date($("[name='ticket:registration_end_date']").val());return ticket_start_date<=ticket_end_date;}
return true;},"Dates not in order");jQuery.validator.addMethod("end_date_validation",function(end_date,element){if(end_date){var end_date=new Date(end_date)
var start_date=new Date($(element).closest('form').find('.start_date').val());if($(element).closest('form').find('.start_date').val()){return start_date<=end_date;}else{return true}}
return true;},"Please specify a valid end date");jQuery.validator.addMethod("international_phone",function(phone_number,element){phone_number=phone_number.replace(/\s+/g,"");return this.optional(element)||phone_number.length>=10;},"Please specify a valid phone number");(function(){var msg="You must select a value greater than or equal to your current employee count";var messenger=function(){return msg;}
jQuery.validator.addMethod("minimumemployeecount",function(value,element){var minValue=$(element).data('minimumemployeecount');var readValue=parseInt(value);msg="You must select a value greater than or equal to your current employee count ("+
minValue+")";return readValue>=minValue;},messenger);})();jQuery.validator.addMethod("phone",function(phone_number,element){phone_number=phone_number.replace(/\s+/g,"");return this.optional(element)||phone_number.length>9&&phone_number.match(/^(1-?)?(\([2-9]\d{2}\)|[2-9]\d{2})-?[2-9]\d{2}-?\d{4}$/);},"Please specify a valid phone number");jQuery.validator.addMethod("exp_month",function(month,element){return this.optional(element)||month.match(/^0[1-9]$|^1[012]$/);},"Please specify a valid Exp Month");jQuery.validator.addMethod("exp_year",function(year,element){return this.optional(element)||year.match(/^201[1-9]$|^202[0-9]$/);},"Please specify a valid Exp Year");jQuery.validator.addMethod("cvd",function(cvd,element){return this.optional(element)||cvd.match(/^\d{3}$|^\d{4}$/);},"Please specify a valid CVD");jQuery.validator.addMethod('place_or_address',function(value,element){var $root_form=$(element).closest('form'),$places_panel=$('.relationship_edit_panel[data-type="place"]',$root_form),places_count=$('li.item',$places_panel).length;if(!value&&!places_count){return false;}
return true;},'This item needs either an address or a place');jQuery.validator.addMethod('requiredPlaceholder',function(value,element){var $element=jQuery(element);if($element.hasClass('required')&&$element.prop('placeholder')){if($element.prop('value')===$element.prop('placeholder')){return false;}}
return true;},'Required Field');jQuery.validator.addMethod('validation_no_duplicate_field',function(value,element){var duplicate_found=false,other_custom_fields=$('.custom_field_type',$(element).closest('.custom_field_list')).not(element);if(!other_custom_fields.length){other_custom_fields=$(element).closest('ul').find(':input:visible').not(element);}
if($(element).val()==='add_a_new_field'){return true;}
other_custom_fields.each(function(index,field){var field_is_separator=ss_context["customization.separator_ids"]&&($.inArray($(field).val(),ss_context["customization.separator_ids"])!=-1);if($(field).attr('disabled')!==undefined){}else if($(element).val()===$(field).val()&&!field_is_separator){duplicate_found=true;}});return!duplicate_found;},'Each field can only be chosen once.');jQuery.validator.addMethod('validation_positive',function(value,element){var amount=parseFloat(value);if(amount<0){return false;}
return true;},'Amount must not be less than 0');jQuery.validator.addMethod('validation_password_matches',function(value,element){var $form=$(element).closest('form');var $all_passwords=$form.find('input[type="password"][name!="old_password"]');var matching=_.all($all_passwords,function(password_field){return $(password_field).val()===value;});return matching;},'Passwords must match');jQuery.validator.addMethod("valid_page_url",function(value,element){return this.optional(element)||/^[a-zA-Z0-9\-]+$/.test(value);},'Please only user letters, numbers, and hyphens.');jQuery.validator.addMethod('validation_password_length',function(value,element){return!(value.length<=5);},'Password must be at least 6 characters long');jQuery.validator.addMethod('terms_of_service_checked',function(value,element){return element.checked;},'You must accept the terms and conditions');jQuery.validator.addMethod('date-in-future',function(value,element){if(value.trim()){var current_date=new Date();current_date.setHours(0,0,0,0);return new Date(value).getTime()>=current_date.getTime();}
return true;},'Date must be in future');jQuery.validator.addMethod('numeric_comma_separated',function(value){return/^(\s*[0-9]+\s*,)*\s*[0-9]+\s*$/.test(value);},'This entered value was not a comma separated list of dollar values. Please use a format like "25,50,100"');jQuery.validator.addMethod('validation_recaptcha',function(){if(grecaptcha.getResponse()==''){return false;}else{return true;}},'You must verify you\'re not a robot');jQuery.validator.addClassRules({user_id_available:{remote:{param:{url:'/auth/user_id_available',data:{'msg':'This email address has already been taken. <a class="error_link" href="/auth/login">Sign In</a> | <a class="error_link" href="/auth/forgotten_password">Forgot your password?</a>'}}}},user_id_update_available:{remote:{depends:function(){return $(".user_id_update_available").data('value')!=$(".user_id_update_available").val()},param:{url:'/auth/user_id_available',data:{'msg':'This email address has already been taken. Please use a different email address.'}}}},company_name_available:{remote:{url:'/auth/company_name_available'}},page_url_available:{remote:{url:'/auth/page_url_available',data:{custom_url:function(){return $('.custom_url_field').val();},current_url:function(){return $('.custom_url_field').data('current_url');}}}},country:{remote:{url:'/generic/valid_country'}},postal_code:{remote:{url:'/generic/valid_postal_code'}},field_label_available:{remote:{url:'/field_info/field_name_available'}},legacyPlaceholder:{requiredPlaceholder:true}});};return self;}());;;SS.controllers.subscription=(function(){var my={},self=SS.controller(my),root_element="#main",check_for_subscription_status=function(){function append_subscribe_status(data){var $button=$(root_element).find('.check_sub_button');var $status_div=$(root_element).find('.sub_status');if(data.success.status){$button.hide();$status_div.find('.sub').hide();$status_div.append('<div class="mb1 unsub">You are currently unsubscribed and won\'t receive most notifications from '+SS.app.current_network.name+'. Would you like to resubscribe?<br></div>');$status_div.append('<button type="button" class="btn btn-success resubscribe_button">Subscribe to notifications</button>');}else{$button.hide();$status_div.find('.resubscribe_button').hide();$status_div.find('.unsub').hide();$status_div.append('<div class="sub">You are currently subscribed to the mailing list.</div>');}};$.ajax({type:'POST',url:'/user/ajax_check_sub',success:append_subscribe_status});};var resubscribe_email=function(){$.ajax({type:'POST',url:'/user/ajax_resubscribe_current_user',success:check_for_subscription_status});};self.init=function(){$(root_element).delegate('.check_sub_button','click',check_for_subscription_status);$(root_element).delegate('.resubscribe_button','click',resubscribe_email);};return self;}());;;SS.controllers.funds=(function(){var self,my={},root_element='.fund',submit_form=function($form,$this_element,submit_function){if($form.valid()){submit_function();$(root_element).html('<div class="loading"></div>');}else{$('<div />',{'class':'error'}).html('Your required fields are not valid. Please review.').insertAfter($this_element).delay(1000).fadeOut();}};self=SS.controller(my);self.init=function(new_root_element){if(new_root_element!==undefined){root_element=new_root_element;}
var dialog_width=get_dialog_width();$(document).delegate('.request_donation_for_fund','click',function(event){var $target=$(event.target);var fund_id=($target.attr("data-fund_id"));var html=$target.siblings(".html_for_popup_dialog").html();$('<div>').ssdialog({'content':{'html':html,'refresh_on_show':true},width:dialog_width,'title':'Donate','buttons':{'Save':null,'Donate':function(namespace){var $container=this.data(namespace)['container'];var amount=$container.find('.donation_amount').val();var frequency_of_donation=$container.find('.frequency-of-donation').val();var $form=$container.find('.donation_amount_form');if($form.length){$form.validate({ignore:':hidden',focusInvalid:false});if(!$form.valid()){return;}}
$.ajax({url:'/fund/request_donation_for_fund',type:'POST',data:{'fund_id':fund_id,'amount':amount,'frequency_of_donation':frequency_of_donation},success:function(payment_url){window.location=payment_url},error:function(){alert('Sorry, something went wrong')}});this[namespace]('hide');}}});});$(document).delegate('.cancel_all_recurring_donations_for_fund','click',function(event){event.preventDefault();var $target=$(event.target);var fund_id=($target.attr("data-fund_id"));var html="Warning, you are about to cancel all recurring transactions for this fund. This is not reversible. Are you sure you want to do this?"
$('<div>').ssdialog({'content':{'html':html,'refresh_on_show':true},'title':'Confirm Cancellation','cancel_button_label':'No','buttons':{'Save':null,'Yes':function(namespace){$.ajax({url:'/fund/cancel_all_recurring_donations_for_fund',type:'POST',data:{'fund_id':fund_id},success:function(num_of_successfully_canelled){location.reload();},error:function(){alert('Sorry, something went wrong');}});}}});});$(document).delegate('.cancel_recurring_donation_link','click',function(event){var $target=$(event.target);var subscription_id=($target.attr("data-subscription_id"));$.ajax({url:'/payment/cancel_recurring_donation_json',type:'POST',data:{'subscription_id':subscription_id},success:function(){location.reload();},error:function(){alert('Sorry, something went wrong');}});});};return self;}());;;SS.widget=function(spec,my){return{};};;;SS.widgets.dialog=function(spec,my){var self,dialog_class=spec.type+'_dialog',default_val={hide_close_button:false};my=my||{};spec=$.extend(default_val,spec);self=SS.widget(spec,my);self.init=function(options){var $dialog_div=$('<div class="'+dialog_class+'">'+spec.content+'</div>');var dialog_width=get_dialog_width();var settings={'focus_selector':false,};$.extend(true,settings,options);if(settings['focus_selector']){var create_callback=function(){$(this).find(settings['focus_selector']).focus();};}else{var create_callback=function(){};}
$dialog_div.dialog({modal:true,title:spec.title,width:dialog_width,dialogClass:dialog_class,buttons:spec.buttons,open:function(event,ui){if($.isFunction(create_callback)){create_callback=_.bind(create_callback,this);create_callback(event,ui);}
$(this).closest(".ui-dialog").find(".ui-dialog-buttonset .ui-button:first").removeClass().addClass('btn btn-default');$(this).closest(".ui-dialog").find(" .ui-dialog-buttonset .ui-button:last").removeClass().addClass('btn btn-primary');}});if(spec.hide_close_button){$dialog_div.find('.ui-icon.ui-icon-closethick').hide();}
$dialog_div.bind('dialogclose',function(){$(this).remove();});};return self;};;;(function(){var _dialog_message=function(spec,my){var self,params={type:'message',content:spec.content,title:spec.title,buttons:{'Cancel':function(){$('.message_dialog').trigger('dialogclose');},'Send':function(){var that=this,$message_dialog=$(this).closest('.message_dialog');var form=$(this).find('form');if(form.get().length!==0){if(!form.valid()){return;}}
$message_dialog.css({width:$message_dialog.width(),height:$message_dialog.height()});$message_dialog.closest('.ui-dialog').find('.ui-dialog-buttonset button').attr('disabled',true);var input_fields=$(this).find('input').get().concat($(this).find('textarea').get());var field_mapper={}
_.each(input_fields,function(field){field_mapper[$(field).prop('name')]=$(field).val();});spec.send_function(field_mapper);$(this).html('Sending...');_.delay(function(){$(that).html('Sent!');},1000);_.delay(function(){$(that).dialog('close');},3000);}}};my=my||{};self=SS.widgets.dialog(params,my);return self;};SS.widgets.dialog_message=function(spec,my){var content='<div class="form-group">'+'<label>Subject</label>'+'<input type="text" class="form-control message_subject" name="message_subject" value="'+spec.subject+'">'+'</div>'+'<div class="form-group">'+'<label>Message</label>'+'<textarea class="message_body form-control" name="message_body"></textarea>'+'</div>';spec['content']=content;return _dialog_message(spec,my);};SS.widgets.message_email_form=function(spec,my){var template=_.template($("#non_loggedin_contact_message").html());var content=template(spec);spec['content']=content;return _dialog_message(spec,my);};})();;;SS.widgets.autocomplete=function(spec,my){var self;my=my||{};self=SS.widget(spec,my);self.init=function(){$(spec.input).bind('keydown',function(event){if(event.keyCode===$.ui.keyCode.TAB&&$(this).data('autocomplete')&&$(this).data('autocomplete').menu.active){event.preventDefault();}}).autocomplete({source:function(request,response){$.getJSON(spec.url,{term:request.term},response);},minLength:spec.min_length||1,focus:function(){return false;},select:function(event,ui){var item={};_.each(spec.schema,function(value,key){item[key]=ui.item[value];});spec.on_select(item,event);return false;},autoFocus:true});};return self;};;;SS.widgets.autocomplete_tag=function(spec,my){var self;my=my||{};self=SS.widget(spec,my);self.init=function(){$(spec.input).bind('keydown',function(event){if(event.keyCode===$.ui.keyCode.TAB&&$(this).data('autocomplete').menu.active){event.preventDefault();}}).autocomplete({source:function(request,response){$.getJSON('/topic/auto_complete',{term:request.term},response);},minLength:1,focus:function(){return false;},select:function(event,ui){var tag_data={id:ui.item.id,name:ui.item.label,url:ui.item.url,followed:ui.item.followed,follow_title:'Follow',follow_class:'',checked:''},template_text='<div class="tag <%= follow_class %>" data-tag_id="<%= id %>">'+'<div class="tag_follow"><input title="<%= follow_title %>" type="checkbox" <%= checked %>></div>'+'<div class="tag_info"><a href="<%= url %>" title="Go to tag page: <%= name %>"><%= name %></a>',tag_template;if(!spec.hide_remove_button){template_text+='<span class="tag_action_remove" title="Remove tag">x</span>';}
template_text+='</div></div>';tag_template=_.template(template_text);if(tag_data.followed||spec.auto_follow){tag_data.follow_class='followed';tag_data.checked='checked';tag_data.follow='Unfollow';}
spec.on_select(tag_data.id,tag_template(tag_data));return false;},autoFocus:true});};return self;};;;SS.widgets.autocomplete_user=function(spec,my){var self;my=my||{};spec.url='/user/auto_complete';spec.schema={id:'value',name:'label',full_name:'full_name',email:'email',url:'url',icon:'medium_icon',phone:'phone',address:'address'};self=SS.widgets.autocomplete(spec,my);return self;};;;SS.widgets.autocomplete_company=function(spec,my){var self;my=my||{};spec.url='/company/auto_complete';spec.schema={id:'value',name:'label',icon:'icon',url:'url',address:'address'};self=SS.widgets.autocomplete(spec,my);return self;};;;SS.widgets.autocomplete_location=function(spec,my){var self;my=my||{};spec.url='/location/auto_complete';spec.schema={address:'label',info:'full',lat_long:'lat_long'};spec.min_length=5;self=SS.widgets.autocomplete(spec,my);return self;};;;SS.widgets.autocomplete_place=function(spec,my){var self;my=my||{};spec.url='/place/auto_complete';spec.schema={id:'value',name:'label',icon:'medium_icon',url:'url'};self=SS.widgets.autocomplete(spec,my);return self;};;;SS.widgets.autocomplete_generic=function(spec,my){var self;my=my||{};spec.url='/generic/autocomplete/'+spec.collection;spec.schema={label:'label'};spec.min_length=spec.min_length||2;self=SS.widgets.autocomplete(spec,my);return self;};;;SS.widgets.autocomplete_event=function(spec,my){var self;my=my||{};spec.url='/event/auto_complete';spec.schema={id:'value',name:'label',url:'url',icon:'medium_icon',attendee_count:'attendee_count'};self=SS.widgets.autocomplete(spec,my);return self;};;;SS.widgets.autocomplete_group=function(spec,my){var self;my=my||{};spec.url='/group/auto_complete';spec.schema={id:'value',name:'label',url:'url',icon:'medium_icon',member_count:'member_count'};self=SS.widgets.autocomplete(spec,my);return self;};;;SS.widgets.autocomplete_category=function(spec,my){var self;my=my||{};spec.url='/category/auto_complete';if($('#content').data('type')=='category'){spec.url=$('#content').data('url')+'/auto_complete'}
spec.schema={id:'value',name:'label',url:'url'};self=SS.widgets.autocomplete(spec,my);return self;};;;(function($){$.fn.ss_steps=function(method){var activate=function(step){$('.step_history, .step_preview',step).hide();$('.step_active',step).show();$(step).addClass('step_active').show();},preview=function(step){$(step).removeClass('step_active').hide();$('.step_history, .step_active',step).hide();$('.step_preview',step).show();},history=function(step){$(step).removeClass('step_active').show();$('.step_active, .step_preview',step).hide();$('.step_history',step).show();$(step).show();};var methods={init:function(options){var settings={'nothing':'top','more-background-color':'blue'};return this.each(function(){if(options){$.extend(settings,options);}
activate($(this).find('.step:first'));$(this).find('.step').not(':first').each(function(index,step){preview(step);});$(this).delegate('.activate_step','click',function(){var step=$(this).closest('.step'),confirm_dialog=SS.widgets.dialog({type:'confirm',title:'Warning!',content:'<center>By clicking continue your progress will be lost.<br><br>Do you wish to proceed?</center>',buttons:{Cancel:function(){$('.confirm_dialog').dialog('close');},Continue:function(){methods.activate_step(step);$('.confirm_dialog').dialog('close');}}});confirm_dialog.init();});});},activate_step:function(step){$(step).prevAll('.step').each(function(index,step){history(step);});activate($(step))
$(step).nextAll('.step').each(function(index,step){preview(step);});},next:function(){},back:function(){},update:function(content){}};if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments);}else{$.error('Method '+method+' does not exist on jQuery.ss_steps');}};})(jQuery);(function($){$.fn.ss_block=function(options){var settings={'nothing':'top','more-background-color':'blue'};return this.each(function(){if(options){$.extend(settings,options);}
$(this).block({message:null}).addClass('blocked');return this;});};$.fn.ss_unblock=function(options){var settings={'nothing':'top','more-background-color':'blue'};return this.each(function(){if(options){$.extend(settings,options);}
$(this).unblock().removeClass('blocked');return this;});};})(jQuery);;;(function($){$.fn.ss_datepicker=function(options){var settings={dateFormat:'dd M yy',onClose:function(){$(this).valid();}};$.extend(options);this.datepicker(options);};})(jQuery);function ss_format_date(date){if(!date){return;}
var months=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];return date.getUTCDate()+' '+months[date.getUTCMonth()]+' '+date.getUTCFullYear();};;!function($){$.flexslider=function(e,t){var a=$(e);a.vars=$.extend({},$.flexslider.defaults,t);var n=a.vars.namespace,i=window.navigator&&window.navigator.msPointerEnabled&&window.MSGesture,s=("ontouchstart"in window||i||window.DocumentTouch&&document instanceof DocumentTouch)&&a.vars.touch,r="click touchend MSPointerUp keyup",o="",l,c="vertical"===a.vars.direction,d=a.vars.reverse,u=a.vars.itemWidth>0,v="fade"===a.vars.animation,p=""!==a.vars.asNavFor,m={},f=!0;$.data(e,"flexslider",a),m={init:function(){a.animating=!1,a.currentSlide=parseInt(a.vars.startAt?a.vars.startAt:0,10),isNaN(a.currentSlide)&&(a.currentSlide=0),a.animatingTo=a.currentSlide,a.atEnd=0===a.currentSlide||a.currentSlide===a.last,a.containerSelector=a.vars.selector.substr(0,a.vars.selector.search(" ")),a.slides=$(a.vars.selector,a),a.container=$(a.containerSelector,a),a.count=a.slides.length,a.syncExists=$(a.vars.sync).length>0,"slide"===a.vars.animation&&(a.vars.animation="swing"),a.prop=c?"top":"marginLeft",a.args={},a.manualPause=!1,a.stopped=!1,a.started=!1,a.startTimeout=null,a.transitions=!a.vars.video&&!v&&a.vars.useCSS&&function(){var e=document.createElement("div"),t=["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective","msPerspective"];for(var n in t)if(void 0!==e.style[t[n]])return a.pfx=t[n].replace("Perspective","").toLowerCase(),a.prop="-"+a.pfx+"-transform",!0;return!1}(),a.ensureAnimationEnd="",""!==a.vars.controlsContainer&&(a.controlsContainer=$(a.vars.controlsContainer).length>0&&$(a.vars.controlsContainer)),""!==a.vars.manualControls&&(a.manualControls=$(a.vars.manualControls).length>0&&$(a.vars.manualControls)),""!==a.vars.customDirectionNav&&(a.customDirectionNav=2===$(a.vars.customDirectionNav).length&&$(a.vars.customDirectionNav)),a.vars.randomize&&(a.slides.sort(function(){return Math.round(Math.random())-.5}),a.container.empty().append(a.slides)),a.doMath(),a.setup("init"),a.vars.controlNav&&m.controlNav.setup(),a.vars.directionNav&&m.directionNav.setup(),a.vars.keyboard&&(1===$(a.containerSelector).length||a.vars.multipleKeyboard)&&$(document).bind("keyup",function(e){var t=e.keyCode;if(!a.animating&&(39===t||37===t)){var n=39===t?a.getTarget("next"):37===t?a.getTarget("prev"):!1;a.flexAnimate(n,a.vars.pauseOnAction)}}),a.vars.mousewheel&&a.bind("mousewheel",function(e,t,n,i){e.preventDefault();var s=a.getTarget(0>t?"next":"prev");a.flexAnimate(s,a.vars.pauseOnAction)}),a.vars.pausePlay&&m.pausePlay.setup(),a.vars.slideshow&&a.vars.pauseInvisible&&m.pauseInvisible.init(),a.vars.slideshow&&(a.vars.pauseOnHover&&a.hover(function(){a.manualPlay||a.manualPause||a.pause()},function(){a.manualPause||a.manualPlay||a.stopped||a.play()}),a.vars.pauseInvisible&&m.pauseInvisible.isHidden()||(a.vars.initDelay>0?a.startTimeout=setTimeout(a.play,a.vars.initDelay):a.play())),p&&m.asNav.setup(),s&&a.vars.touch&&m.touch(),(!v||v&&a.vars.smoothHeight)&&$(window).bind("resize orientationchange focus",m.resize),a.find("img").attr("draggable","false"),setTimeout(function(){a.vars.start(a)},200)},asNav:{setup:function(){a.asNav=!0,a.animatingTo=Math.floor(a.currentSlide/a.move),a.currentItem=a.currentSlide,a.slides.removeClass(n+"active-slide").eq(a.currentItem).addClass(n+"active-slide"),i?(e._slider=a,a.slides.each(function(){var e=this;e._gesture=new MSGesture,e._gesture.target=e,e.addEventListener("MSPointerDown",function(e){e.preventDefault(),e.currentTarget._gesture&&e.currentTarget._gesture.addPointer(e.pointerId)},!1),e.addEventListener("MSGestureTap",function(e){e.preventDefault();var t=$(this),n=t.index();$(a.vars.asNavFor).data("flexslider").animating||t.hasClass("active")||(a.direction=a.currentItem<n?"next":"prev",a.flexAnimate(n,a.vars.pauseOnAction,!1,!0,!0))})})):a.slides.on(r,function(e){e.preventDefault();var t=$(this),i=t.index(),s=t.offset().left-$(a).scrollLeft();0>=s&&t.hasClass(n+"active-slide")?a.flexAnimate(a.getTarget("prev"),!0):$(a.vars.asNavFor).data("flexslider").animating||t.hasClass(n+"active-slide")||(a.direction=a.currentItem<i?"next":"prev",a.flexAnimate(i,a.vars.pauseOnAction,!1,!0,!0))})}},controlNav:{setup:function(){a.manualControls?m.controlNav.setupManual():m.controlNav.setupPaging()},setupPaging:function(){var e="thumbnails"===a.vars.controlNav?"control-thumbs":"control-paging",t=1,i,s;if(a.controlNavScaffold=$('<ol class="'+n+"control-nav "+n+e+'"></ol>'),a.pagingCount>1)for(var l=0;l<a.pagingCount;l++){if(s=a.slides.eq(l),i="thumbnails"===a.vars.controlNav?'<img src="'+s.attr("data-thumb")+'"/>':"<a>"+t+"</a>","thumbnails"===a.vars.controlNav&&!0===a.vars.thumbCaptions){var c=s.attr("data-thumbcaption");""!==c&&void 0!==c&&(i+='<span class="'+n+'caption">'+c+"</span>")}a.controlNavScaffold.append("<li>"+i+"</li>"),t++}a.controlsContainer?$(a.controlsContainer).append(a.controlNavScaffold):a.append(a.controlNavScaffold),m.controlNav.set(),m.controlNav.active(),a.controlNavScaffold.delegate("a, img",r,function(e){if(e.preventDefault(),""===o||o===e.type){var t=$(this),i=a.controlNav.index(t);t.hasClass(n+"active")||(a.direction=i>a.currentSlide?"next":"prev",a.flexAnimate(i,a.vars.pauseOnAction))}""===o&&(o=e.type),m.setToClearWatchedEvent()})},setupManual:function(){a.controlNav=a.manualControls,m.controlNav.active(),a.controlNav.bind(r,function(e){if(e.preventDefault(),""===o||o===e.type){var t=$(this),i=a.controlNav.index(t);t.hasClass(n+"active")||(a.direction=i>a.currentSlide?"next":"prev",a.flexAnimate(i,a.vars.pauseOnAction))}""===o&&(o=e.type),m.setToClearWatchedEvent()})},set:function(){var e="thumbnails"===a.vars.controlNav?"img":"a";a.controlNav=$("."+n+"control-nav li "+e,a.controlsContainer?a.controlsContainer:a)},active:function(){a.controlNav.removeClass(n+"active").eq(a.animatingTo).addClass(n+"active")},update:function(e,t){a.pagingCount>1&&"add"===e?a.controlNavScaffold.append($("<li><a>"+a.count+"</a></li>")):1===a.pagingCount?a.controlNavScaffold.find("li").remove():a.controlNav.eq(t).closest("li").remove(),m.controlNav.set(),a.pagingCount>1&&a.pagingCount!==a.controlNav.length?a.update(t,e):m.controlNav.active()}},directionNav:{setup:function(){var e=$('<ul class="'+n+'direction-nav"><li class="'+n+'nav-prev"><a class="'+n+'prev" href="#">'+a.vars.prevText+'</a></li><li class="'+n+'nav-next"><a class="'+n+'next" href="#">'+a.vars.nextText+"</a></li></ul>");a.customDirectionNav?a.directionNav=a.customDirectionNav:a.controlsContainer?($(a.controlsContainer).append(e),a.directionNav=$("."+n+"direction-nav li a",a.controlsContainer)):(a.append(e),a.directionNav=$("."+n+"direction-nav li a",a)),m.directionNav.update(),a.directionNav.bind(r,function(e){e.preventDefault();var t;(""===o||o===e.type)&&(t=a.getTarget($(this).hasClass(n+"next")?"next":"prev"),a.flexAnimate(t,a.vars.pauseOnAction)),""===o&&(o=e.type),m.setToClearWatchedEvent()})},update:function(){var e=n+"disabled";1===a.pagingCount?a.directionNav.addClass(e).attr("tabindex","-1"):a.vars.animationLoop?a.directionNav.removeClass(e).removeAttr("tabindex"):0===a.animatingTo?a.directionNav.removeClass(e).filter("."+n+"prev").addClass(e).attr("tabindex","-1"):a.animatingTo===a.last?a.directionNav.removeClass(e).filter("."+n+"next").addClass(e).attr("tabindex","-1"):a.directionNav.removeClass(e).removeAttr("tabindex")}},pausePlay:{setup:function(){var e=$('<div class="'+n+'pauseplay"><a></a></div>');a.controlsContainer?(a.controlsContainer.append(e),a.pausePlay=$("."+n+"pauseplay a",a.controlsContainer)):(a.append(e),a.pausePlay=$("."+n+"pauseplay a",a)),m.pausePlay.update(a.vars.slideshow?n+"pause":n+"play"),a.pausePlay.bind(r,function(e){e.preventDefault(),(""===o||o===e.type)&&($(this).hasClass(n+"pause")?(a.manualPause=!0,a.manualPlay=!1,a.pause()):(a.manualPause=!1,a.manualPlay=!0,a.play())),""===o&&(o=e.type),m.setToClearWatchedEvent()})},update:function(e){"play"===e?a.pausePlay.removeClass(n+"pause").addClass(n+"play").html(a.vars.playText):a.pausePlay.removeClass(n+"play").addClass(n+"pause").html(a.vars.pauseText)}},touch:function(){function t(t){t.stopPropagation(),a.animating?t.preventDefault():(a.pause(),e._gesture.addPointer(t.pointerId),w=0,p=c?a.h:a.w,f=Number(new Date),l=u&&d&&a.animatingTo===a.last?0:u&&d?a.limit-(a.itemW+a.vars.itemMargin)*a.move*a.animatingTo:u&&a.currentSlide===a.last?a.limit:u?(a.itemW+a.vars.itemMargin)*a.move*a.currentSlide:d?(a.last-a.currentSlide+a.cloneOffset)*p:(a.currentSlide+a.cloneOffset)*p)}function n(t){t.stopPropagation();var a=t.target._slider;if(a){var n=-t.translationX,i=-t.translationY;return w+=c?i:n,m=w,y=c?Math.abs(w)<Math.abs(-n):Math.abs(w)<Math.abs(-i),t.detail===t.MSGESTURE_FLAG_INERTIA?void setImmediate(function(){e._gesture.stop()}):void((!y||Number(new Date)-f>500)&&(t.preventDefault(),!v&&a.transitions&&(a.vars.animationLoop||(m=w/(0===a.currentSlide&&0>w||a.currentSlide===a.last&&w>0?Math.abs(w)/p+2:1)),a.setProps(l+m,"setTouch"))))}}function s(e){e.stopPropagation();var t=e.target._slider;if(t){if(t.animatingTo===t.currentSlide&&!y&&null!==m){var a=d?-m:m,n=t.getTarget(a>0?"next":"prev");t.canAdvance(n)&&(Number(new Date)-f<550&&Math.abs(a)>50||Math.abs(a)>p/2)?t.flexAnimate(n,t.vars.pauseOnAction):v||t.flexAnimate(t.currentSlide,t.vars.pauseOnAction,!0)}r=null,o=null,m=null,l=null,w=0}}var r,o,l,p,m,f,g,h,S,y=!1,x=0,b=0,w=0;i?(e.style.msTouchAction="none",e._gesture=new MSGesture,e._gesture.target=e,e.addEventListener("MSPointerDown",t,!1),e._slider=a,e.addEventListener("MSGestureChange",n,!1),e.addEventListener("MSGestureEnd",s,!1)):(g=function(t){a.animating?t.preventDefault():(window.navigator.msPointerEnabled||1===t.touches.length)&&(a.pause(),p=c?a.h:a.w,f=Number(new Date),x=t.touches[0].pageX,b=t.touches[0].pageY,l=u&&d&&a.animatingTo===a.last?0:u&&d?a.limit-(a.itemW+a.vars.itemMargin)*a.move*a.animatingTo:u&&a.currentSlide===a.last?a.limit:u?(a.itemW+a.vars.itemMargin)*a.move*a.currentSlide:d?(a.last-a.currentSlide+a.cloneOffset)*p:(a.currentSlide+a.cloneOffset)*p,r=c?b:x,o=c?x:b,e.addEventListener("touchmove",h,!1),e.addEventListener("touchend",S,!1))},h=function(e){x=e.touches[0].pageX,b=e.touches[0].pageY,m=c?r-b:r-x,y=c?Math.abs(m)<Math.abs(x-o):Math.abs(m)<Math.abs(b-o);var t=500;(!y||Number(new Date)-f>t)&&(e.preventDefault(),!v&&a.transitions&&(a.vars.animationLoop||(m/=0===a.currentSlide&&0>m||a.currentSlide===a.last&&m>0?Math.abs(m)/p+2:1),a.setProps(l+m,"setTouch")))},S=function(t){if(e.removeEventListener("touchmove",h,!1),a.animatingTo===a.currentSlide&&!y&&null!==m){var n=d?-m:m,i=a.getTarget(n>0?"next":"prev");a.canAdvance(i)&&(Number(new Date)-f<550&&Math.abs(n)>50||Math.abs(n)>p/2)?a.flexAnimate(i,a.vars.pauseOnAction):v||a.flexAnimate(a.currentSlide,a.vars.pauseOnAction,!0)}e.removeEventListener("touchend",S,!1),r=null,o=null,m=null,l=null},e.addEventListener("touchstart",g,!1))},resize:function(){!a.animating&&a.is(":visible")&&(u||a.doMath(),v?m.smoothHeight():u?(a.slides.width(a.computedW),a.update(a.pagingCount),a.setProps()):c?(a.viewport.height(a.h),a.setProps(a.h,"setTotal")):(a.vars.smoothHeight&&m.smoothHeight(),a.newSlides.width(a.computedW),a.setProps(a.computedW,"setTotal")))},smoothHeight:function(e){if(!c||v){var t=v?a:a.viewport;e?t.animate({height:a.slides.eq(a.animatingTo).height()},e):t.height(a.slides.eq(a.animatingTo).height())}},sync:function(e){var t=$(a.vars.sync).data("flexslider"),n=a.animatingTo;switch(e){case"animate":t.flexAnimate(n,a.vars.pauseOnAction,!1,!0);break;case"play":t.playing||t.asNav||t.play();break;case"pause":t.pause()}},uniqueID:function(e){return e.filter("[id]").add(e.find("[id]")).each(function(){var e=$(this);e.attr("id",e.attr("id")+"_clone")}),e},pauseInvisible:{visProp:null,init:function(){var e=m.pauseInvisible.getHiddenProp();if(e){var t=e.replace(/[H|h]idden/,"")+"visibilitychange";document.addEventListener(t,function(){m.pauseInvisible.isHidden()?a.startTimeout?clearTimeout(a.startTimeout):a.pause():a.started?a.play():a.vars.initDelay>0?setTimeout(a.play,a.vars.initDelay):a.play()})}},isHidden:function(){var e=m.pauseInvisible.getHiddenProp();return e?document[e]:!1},getHiddenProp:function(){var e=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var t=0;t<e.length;t++)if(e[t]+"Hidden"in document)return e[t]+"Hidden";return null}},setToClearWatchedEvent:function(){clearTimeout(l),l=setTimeout(function(){o=""},3e3)}},a.flexAnimate=function(e,t,i,r,o){if(a.vars.animationLoop||e===a.currentSlide||(a.direction=e>a.currentSlide?"next":"prev"),p&&1===a.pagingCount&&(a.direction=a.currentItem<e?"next":"prev"),!a.animating&&(a.canAdvance(e,o)||i)&&a.is(":visible")){if(p&&r){var l=$(a.vars.asNavFor).data("flexslider");if(a.atEnd=0===e||e===a.count-1,l.flexAnimate(e,!0,!1,!0,o),a.direction=a.currentItem<e?"next":"prev",l.direction=a.direction,Math.ceil((e+1)/a.visible)-1===a.currentSlide||0===e)return a.currentItem=e,a.slides.removeClass(n+"active-slide").eq(e).addClass(n+"active-slide"),!1;a.currentItem=e,a.slides.removeClass(n+"active-slide").eq(e).addClass(n+"active-slide"),e=Math.floor(e/a.visible)}if(a.animating=!0,a.animatingTo=e,t&&a.pause(),a.vars.before(a),a.syncExists&&!o&&m.sync("animate"),a.vars.controlNav&&m.controlNav.active(),u||a.slides.removeClass(n+"active-slide").eq(e).addClass(n+"active-slide"),a.atEnd=0===e||e===a.last,a.vars.directionNav&&m.directionNav.update(),e===a.last&&(a.vars.end(a),a.vars.animationLoop||a.pause()),v)s?(a.slides.eq(a.currentSlide).css({opacity:0,zIndex:1}),a.slides.eq(e).css({opacity:1,zIndex:2}),a.wrapup(f)):(a.slides.eq(a.currentSlide).css({zIndex:1}).animate({opacity:0},a.vars.animationSpeed,a.vars.easing),a.slides.eq(e).css({zIndex:2}).animate({opacity:1},a.vars.animationSpeed,a.vars.easing,a.wrapup));else{var f=c?a.slides.filter(":first").height():a.computedW,g,h,S;u?(g=a.vars.itemMargin,S=(a.itemW+g)*a.move*a.animatingTo,h=S>a.limit&&1!==a.visible?a.limit:S):h=0===a.currentSlide&&e===a.count-1&&a.vars.animationLoop&&"next"!==a.direction?d?(a.count+a.cloneOffset)*f:0:a.currentSlide===a.last&&0===e&&a.vars.animationLoop&&"prev"!==a.direction?d?0:(a.count+1)*f:d?(a.count-1-e+a.cloneOffset)*f:(e+a.cloneOffset)*f,a.setProps(h,"",a.vars.animationSpeed),a.transitions?(a.vars.animationLoop&&a.atEnd||(a.animating=!1,a.currentSlide=a.animatingTo),a.container.unbind("webkitTransitionEnd transitionend"),a.container.bind("webkitTransitionEnd transitionend",function(){clearTimeout(a.ensureAnimationEnd),a.wrapup(f)}),clearTimeout(a.ensureAnimationEnd),a.ensureAnimationEnd=setTimeout(function(){a.wrapup(f)},a.vars.animationSpeed+100)):a.container.animate(a.args,a.vars.animationSpeed,a.vars.easing,function(){a.wrapup(f)})}a.vars.smoothHeight&&m.smoothHeight(a.vars.animationSpeed)}},a.wrapup=function(e){v||u||(0===a.currentSlide&&a.animatingTo===a.last&&a.vars.animationLoop?a.setProps(e,"jumpEnd"):a.currentSlide===a.last&&0===a.animatingTo&&a.vars.animationLoop&&a.setProps(e,"jumpStart")),a.animating=!1,a.currentSlide=a.animatingTo,a.vars.after(a)},a.animateSlides=function(){!a.animating&&f&&a.flexAnimate(a.getTarget("next"))},a.pause=function(){clearInterval(a.animatedSlides),a.animatedSlides=null,a.playing=!1,a.vars.pausePlay&&m.pausePlay.update("play"),a.syncExists&&m.sync("pause")},a.play=function(){a.playing&&clearInterval(a.animatedSlides),a.animatedSlides=a.animatedSlides||setInterval(a.animateSlides,a.vars.slideshowSpeed),a.started=a.playing=!0,a.vars.pausePlay&&m.pausePlay.update("pause"),a.syncExists&&m.sync("play")},a.stop=function(){a.pause(),a.stopped=!0},a.canAdvance=function(e,t){var n=p?a.pagingCount-1:a.last;return t?!0:p&&a.currentItem===a.count-1&&0===e&&"prev"===a.direction?!0:p&&0===a.currentItem&&e===a.pagingCount-1&&"next"!==a.direction?!1:e!==a.currentSlide||p?a.vars.animationLoop?!0:a.atEnd&&0===a.currentSlide&&e===n&&"next"!==a.direction?!1:a.atEnd&&a.currentSlide===n&&0===e&&"next"===a.direction?!1:!0:!1},a.getTarget=function(e){return a.direction=e,"next"===e?a.currentSlide===a.last?0:a.currentSlide+1:0===a.currentSlide?a.last:a.currentSlide-1},a.setProps=function(e,t,n){var i=function(){var n=e?e:(a.itemW+a.vars.itemMargin)*a.move*a.animatingTo,i=function(){if(u)return"setTouch"===t?e:d&&a.animatingTo===a.last?0:d?a.limit-(a.itemW+a.vars.itemMargin)*a.move*a.animatingTo:a.animatingTo===a.last?a.limit:n;switch(t){case"setTotal":return d?(a.count-1-a.currentSlide+a.cloneOffset)*e:(a.currentSlide+a.cloneOffset)*e;case"setTouch":return d?e:e;case"jumpEnd":return d?e:a.count*e;case"jumpStart":return d?a.count*e:e;default:return e}}();return-1*i+"px"}();a.transitions&&(i=c?"translate3d(0,"+i+",0)":"translate3d("+i+",0,0)",n=void 0!==n?n/1e3+"s":"0s",a.container.css("-"+a.pfx+"-transition-duration",n),a.container.css("transition-duration",n)),a.args[a.prop]=i,(a.transitions||void 0===n)&&a.container.css(a.args),a.container.css("transform",i)},a.setup=function(e){if(v)a.slides.css({width:"100%","float":"left",marginRight:"-100%",position:"relative"}),"init"===e&&(s?a.slides.css({opacity:0,display:"block",webkitTransition:"opacity "+a.vars.animationSpeed/1e3+"s ease",zIndex:1}).eq(a.currentSlide).css({opacity:1,zIndex:2}):0==a.vars.fadeFirstSlide?a.slides.css({opacity:0,display:"block",zIndex:1}).eq(a.currentSlide).css({zIndex:2}).css({opacity:1}):a.slides.css({opacity:0,display:"block",zIndex:1}).eq(a.currentSlide).css({zIndex:2}).animate({opacity:1},a.vars.animationSpeed,a.vars.easing)),a.vars.smoothHeight&&m.smoothHeight();else{var t,i;"init"===e&&(a.viewport=$('<div class="'+n+'viewport"></div>').css({overflow:"hidden",position:"relative"}).appendTo(a).append(a.container),a.cloneCount=0,a.cloneOffset=0,d&&(i=$.makeArray(a.slides).reverse(),a.slides=$(i),a.container.empty().append(a.slides))),a.vars.animationLoop&&!u&&(a.cloneCount=2,a.cloneOffset=1,"init"!==e&&a.container.find(".clone").remove(),a.container.append(m.uniqueID(a.slides.first().clone().addClass("clone")).attr("aria-hidden","true")).prepend(m.uniqueID(a.slides.last().clone().addClass("clone")).attr("aria-hidden","true"))),a.newSlides=$(a.vars.selector,a),t=d?a.count-1-a.currentSlide+a.cloneOffset:a.currentSlide+a.cloneOffset,c&&!u?(a.container.height(200*(a.count+a.cloneCount)+"%").css("position","absolute").width("100%"),setTimeout(function(){a.newSlides.css({display:"block"}),a.doMath(),a.viewport.height(a.h),a.setProps(t*a.h,"init")},"init"===e?100:0)):(a.container.width(200*(a.count+a.cloneCount)+"%"),a.setProps(t*a.computedW,"init"),setTimeout(function(){a.doMath(),a.newSlides.css({width:a.computedW,"float":"left",display:"block"}),a.vars.smoothHeight&&m.smoothHeight()},"init"===e?100:0))}u||a.slides.removeClass(n+"active-slide").eq(a.currentSlide).addClass(n+"active-slide"),a.vars.init(a)},a.doMath=function(){var e=a.slides.first(),t=a.vars.itemMargin,n=a.vars.minItems,i=a.vars.maxItems;a.w=void 0===a.viewport?a.width():a.viewport.width(),a.h=e.height(),a.boxPadding=e.outerWidth()-e.width(),u?(a.itemT=a.vars.itemWidth+t,a.minW=n?n*a.itemT:a.w,a.maxW=i?i*a.itemT-t:a.w,a.itemW=a.minW>a.w?(a.w-t*(n-1))/n:a.maxW<a.w?(a.w-t*(i-1))/i:a.vars.itemWidth>a.w?a.w:a.vars.itemWidth,a.visible=Math.floor(a.w/a.itemW),a.move=a.vars.move>0&&a.vars.move<a.visible?a.vars.move:a.visible,a.pagingCount=Math.ceil((a.count-a.visible)/a.move+1),a.last=a.pagingCount-1,a.limit=1===a.pagingCount?0:a.vars.itemWidth>a.w?a.itemW*(a.count-1)+t*(a.count-1):(a.itemW+t)*a.count-a.w-t):(a.itemW=a.w,a.pagingCount=a.count,a.last=a.count-1),a.computedW=a.itemW-a.boxPadding},a.update=function(e,t){a.doMath(),u||(e<a.currentSlide?a.currentSlide+=1:e<=a.currentSlide&&0!==e&&(a.currentSlide-=1),a.animatingTo=a.currentSlide),a.vars.controlNav&&!a.manualControls&&("add"===t&&!u||a.pagingCount>a.controlNav.length?m.controlNav.update("add"):("remove"===t&&!u||a.pagingCount<a.controlNav.length)&&(u&&a.currentSlide>a.last&&(a.currentSlide-=1,a.animatingTo-=1),m.controlNav.update("remove",a.last))),a.vars.directionNav&&m.directionNav.update()},a.addSlide=function(e,t){var n=$(e);a.count+=1,a.last=a.count-1,c&&d?void 0!==t?a.slides.eq(a.count-t).after(n):a.container.prepend(n):void 0!==t?a.slides.eq(t).before(n):a.container.append(n),a.update(t,"add"),a.slides=$(a.vars.selector+":not(.clone)",a),a.setup(),a.vars.added(a)},a.removeSlide=function(e){var t=isNaN(e)?a.slides.index($(e)):e;a.count-=1,a.last=a.count-1,isNaN(e)?$(e,a.slides).remove():c&&d?a.slides.eq(a.last).remove():a.slides.eq(e).remove(),a.doMath(),a.update(t,"remove"),a.slides=$(a.vars.selector+":not(.clone)",a),a.setup(),a.vars.removed(a)},m.init()},$(window).blur(function(e){focused=!1}).focus(function(e){focused=!0}),$.flexslider.defaults={namespace:"flex-",selector:".slides > li",animation:"fade",easing:"swing",direction:"horizontal",reverse:!1,animationLoop:!0,smoothHeight:!1,startAt:0,slideshow:!0,slideshowSpeed:7e3,animationSpeed:600,initDelay:0,randomize:!1,fadeFirstSlide:!0,thumbCaptions:!1,pauseOnAction:!0,pauseOnHover:!1,pauseInvisible:!0,useCSS:!0,touch:!0,video:!1,controlNav:!0,directionNav:!0,prevText:"Previous",nextText:"Next",keyboard:!0,multipleKeyboard:!1,mousewheel:!1,pausePlay:!1,pauseText:"Pause",playText:"Play",controlsContainer:"",manualControls:"",customDirectionNav:"",sync:"",asNavFor:"",itemWidth:0,itemMargin:0,minItems:1,maxItems:0,move:0,allowOneSlide:!0,start:function(){},before:function(){},after:function(){},end:function(){},added:function(){},removed:function(){},init:function(){}},$.fn.flexslider=function(e){if(void 0===e&&(e={}),"object"==typeof e)return this.each(function(){var t=$(this),a=e.selector?e.selector:".slides > li",n=t.find(a);1===n.length&&e.allowOneSlide===!0||0===n.length?(n.fadeIn(400),e.start&&e.start(t)):void 0===t.data("flexslider")&&new $.flexslider(this,e)});var t=$(this).data("flexslider");switch(e){case"play":t.play();break;case"pause":t.pause();break;case"stop":t.stop();break;case"next":t.flexAnimate(t.getTarget("next"),!0);break;case"prev":case"previous":t.flexAnimate(t.getTarget("prev"),!0);break;default:"number"==typeof e&&t.flexAnimate(e,!0)}}}(jQuery);;;$(function(){window.ss=window.ss||{};ss.models=ss.models||{};ss.views=ss.views||{};ss.apps=ss.apps||{};ss.constants=ss.constants||{};ss.data=ss.data||{};ss.routes=ss.routes||{};ss.fn=ss.fn||{};ss.routers=ss.routers||{};ss.lookups=ss.lookups||{};ss.helpers=ss.helpers||{};ss.require=ss.require||{};ss.require.company=['/res/js/v2/backbone/company/company.models.js','/res/js/v2/backbone/company/company.views.js','/res/js/v2/backbone/company/company_admin.views.js'];ss.require.datatable=['/res/js/os/dataTables/jquery.dataTables.min.js','/res/js/v2/ss/plugins/jquery.ss.datatables.js'];ss.require.fields=[];ss.require.ckeditor=['/res/js/os/ckeditor_4.5.7/ckeditor.js'];ss.members=ss.members||{};ss.require.grid=[];var orig=_.template;_.template=function(){try{return orig.apply(undefined,arguments);}catch(err){safe_log('Failed to compile template',arguments);}};});;;$(function(){window.safe_log=function(a,b,c,d,e,f,g,h,i,j,k,l,m){try{console.log.apply(console,arguments);}catch(err){}};ss.fn.cdn=function(relative){return ss.data.CLOUDFRONT_DOMAIN+relative;};ss.fn.compile_template=function(selector){var $element=$(selector);var render;if(!$element.length){throw'No template found for '+selector;}
try{render=_.template($element.html());}catch(err){safe_log('Failed to compile template',selector,err);throw err;}
var debug_friendly=function(){try{return render.apply(this,arguments);}catch(err){safe_log('Failed to render template',selector,err,arguments);throw err;}};return debug_friendly;};ss.fn.make_compile_template=function(parent_selector){return function(child_selector){var compiled=ss.fn.compile_template(parent_selector+' '+child_selector);return compiled;};};ss.fn.make_template_decorator=function(parent_selector){return function(child_selector){var template=ss.fn.compile_template(parent_selector+' '+child_selector);return function(template_args){var rendered=$(template(template_args));ss.fn.decorate_fields(rendered);return rendered;};};};ss.fn.fadeInOutRemove=function($element){$element.hide().fadeIn(1500).fadeOut(1500,function(){$element.remove();});};ss.fn.is_secure=function(){return window.location.protocol==="https:"||_.string.startsWith(window.location.host,'secure');};ss.fn.is_advanced=function(){return SS.app.current_user.advanced;};ss.fn.is_network_admin=function(){return SS.app.current_user.network_admin;};var s4=function(){return Math.floor((1+Math.random())*0x10000).toString(16).substring(1);};ss.fn.guid=function(){return s4()+s4()+'-'+s4()+'-'+s4()+'-'+
s4()+'-'+s4()+s4()+s4();};jQuery.fn.outerHTML=function(s){return s?this.before(s).remove():jQuery("<p>").append(this.eq(0).clone()).html();};ss.fn.freeze_height=function($element){$element.data('original_min_height',$element.css('min-height'));$element.css({'min-height':$element.css('height')});};ss.fn.restore_height=function($element){$element.css({'min-height':$element.data('original_min_height')});};ss.fn.escape_newlines=function(text){return text.replace(/\n/g,'<br>');};ss.stringify=ss.fn.stringify=function(object){return encodeURIComponent(JSON.stringify(ss.fn.toJSON(object)));};ss.fn.toJSON=function(object){if(!object){return object;}
if(_.isFunction(object.toJSON)){object=object.toJSON();}
if(_.isArray(object)){return _.map(object,ss.fn.toJSON);}
if(_.isObject(object)){var clone={};_.each(object,function(value,key){key=String(key);if(_.isFunction(value)||_.contains(['attributes','cid','changed','idAttribute'],key)){}else if(!_.string.startsWith(key,'_')){clone[key]=ss.fn.toJSON(value);}});return clone;}
return object;};ss.fn.popover=function(options){options=options||{};var link_html=options.link_html;if(!link_html){if(options.link_text){link_html=options.link_text;}else{link_html='<i class="fa fa-question-circle"></i>'}}
var placement_html=''
if(options.placement){placement_html='data-placement='+options.placement;}
if(!options.title){options.title='';}
var popover_template=_.template('<a tabindex="-1" class="popover_link" role="button" data-toggle="popover" data-trigger="hover" title="<%=title%>" <%=placement_html %> data-content="<%=content%>"><%=link_html%></a>');return popover_template({content:options.content,title:options.title,placement_html:placement_html,link_html:link_html});};ss.fn.as_collection=function(list){if(_.isArray(list)){var collection=new Backbone.Collection();_.each(list,function(item){var model=new Backbone.Model();model.attributes=item;collection.add(model);});return collection;}
return list;}
ss.fn.join=function(list,separator){return _.string.join.apply({},_.union([separator],list));};ss.fn.nice_join=function(list){if(list.length>1){var initial=_.initial(list,2);var last_two=_.last(list,2);return ss.fn.join(_.union(initial,ss.fn.join(last_two,' and ')),', ');}
return ss.fn.join(list,'');};ss.fn.fetch_network=function(success){$.ajax({url:'/network/fetch',success:function(response){var network=new ss.models.Network(response);success(network);}});};ss.pro_only=function(){return'<span class="pro-only">( Pro Only )</span>';};ss.fn.center=function($element,$parent){$parent=$parent||$(window);var width=$element.outerWidth();var height=$element.outerHeight();var parent_width=$parent.width();var parent_height=$parent.height();$element.css({position:'absolute',top:(parent_height-height)/2,left:(parent_width-width)/2});};ss.fn.escape_newlines=function(text){return text.replace(/\n/g,'<br>');};ss.show_loading=ss.fn.show_loading=function(element){$(element).html('<div class="loading_gray_background_large"></div>');};ss.full_url=function(relative){if(relative&&relative.charAt(0)==='/'){relative=relative.substr(1);}
return ss.data.base_url+relative;};});;;$(function(){ss.fn.parse_date=function(date_str,time_str){if(!date_str){return;}
safe_log('Parsing date',date_str,time_str);var m=moment(date_str);var date=new Date(m.year(),m.month(),m.date());if(time_str){var time=time_str.match(/(\d+)(:(\d\d))?\s*(p?)/i);var hours=parseInt(time[1],10);if(hours==12&&!time[4]){hours=0;}else{hours+=(hours<12&&time[4])?12:0;}
date.setHours(hours);date.setMinutes(parseInt(time[3],10)||0);date.setSeconds(0,0);}
return date;};ss.fn.days_in_month=function(date){return 32-new Date(date.getFullYear(),date.getMonth(),32).getDate();}
ss.fn.format_date=function(date){if(_.isString(date)){date=ss.fn.parse_date(date);}
return $.datepicker.formatDate('dd M yy',date);}
ss.fn.first_of_month=function(date){date=date||new Date();return new Date(date.getFullYear(),date.getMonth(),1);}
ss.fn.last_of_month=function(date){date=date||new Date();return new Date(date.getFullYear(),date.getMonth(),ss.fn.days_in_month(date));}
ss.fn.next_month=function(date){date=date||new Date();return new Date(date.getFullYear(),date.getMonth(),ss.fn.days_in_month(date)+1);}
ss.fn.datepicker=function($element){$element.datepicker({dateFormat:'dd M yy'});}
moment.fn.for_datepicker=function(){return this.format('DD MMM YYYY');};moment.fn.for_display=moment.fn.for_datepicker;});;;$(function(){ss.fn.currency_with_tax=function(price){return ss.fn.currency(price,{include_tax:true});};ss.fn.currency=function(price,options){options=options||{};if(price.price_object){price=price.attributes;}
var cents=price.cost_in_cents;if(options.tax_only){cents=price.tax_in_cents;}else if(options.include_tax){cents+=price.tax_in_cents;}
var dollars=cents/100.0;if(options.free_for_zero&&dollars===0){return'Free'}
var symbol=SS.app.current_network.currency_symbol;if(price.currency){var mappings={'GBP':'','USD':'$','C':'$','CAD':'$','AUD':'$'};symbol=mappings[price.currency]||'$';}
return ss.fn.money(dollars,symbol);};ss.fn.money=function(dollars,currencySymbol){var actualSymbol=(typeof currencySymbol==='undefined')?'$':currencySymbol;return $('<div>').text(dollars).formatCurrency({symbol:actualSymbol}).text();};ss.fn.add_prices=function(prices){var price={'cost_in_cents':0,'currency':SS.app.current_network.currency,'tax_in_cents':0}
var prices;if(arguments.length===1){prices=arguments[0];}else{prices=arguments;}
_.each(prices,function(next){safe_log('Summing prices',next);price.cost_in_cents+=next.cost_in_cents;price.tax_in_cents+=next.tax_in_cents;price.currency=next.currency;});return price;};ss.fn.update_active_cards=function(card_number,$card_images){$card_images.each(function(index,card_image){var $card_image=$(card_image);var re=RegExp('^'+$card_image.data('re_prefix'));if(re.test(card_number)){$card_image.removeClass('inactive-card');}else{$card_image.addClass('inactive-card');}});};});;;$(function(){ss.data.CLOUDFRONT_DOMAIN=ss.config.CLOUDFRONT_URL||null;ss.models.File=Backbone.Model.extend({initialize:function(options){_.bindAll(this);},build_file_url:function(){if(this.get('full_url')){return this.get('full_url');}
if(this.get('temp_url')){return this.get('temp_url');}
var bucket_name=this.get('bucket_name');var key_name=this.get('key_name');if(!(bucket_name&&key_name)){return;}
var url='http://'+bucket_name+'.s3.amazonaws.com/'+key_name;return url;}});ss.models.Image=ss.models.File.extend({build_image_url:function(options){options=options||{};var url=this.build_file_url();if(!url){return;}
var cdn_url=ss.data.CLOUDFRONT_DOMAIN+'/image_encoded/'+Base64.encode(url);if(options.width&&options.height){cdn_url+='/'+options.width+'x'+options.height;}else{cdn_url+='/x';}
return cdn_url;}});ss.models.ImageCollection=Backbone.Collection.extend({model:ss.models.Image});ss.models.PostedImage=Backbone.Model.extend({initialize:function(options){options=options||{};this.set({image:new ss.models.Image(options.image)});},build_image_url:function(options){var image=this.get('image');return image&&image.build_image_url(options);}});ss.models.PostedImageCollection=Backbone.Collection.extend({url:'/image/internal_images',model:ss.models.PostedImage});ss.models.FileMap=Backbone.Model.extend({model:ss.models.File,initialize:function(data){safe_log('Initializing FileMap with',data);var self=this;if(_.isArray(data)){_.each(data,function(file_data){safe_log('New File',file_data);var to_set={};to_set[file_data.key]=new ss.models.File(file_data);self.set(to_set);});}},get_with_default:function(key){var value=this.get(key);if(value===undefined){var value=new ss.models.File({id:key,key:key});var data={};data[key]=value;this.set(data);}
return value;}});ss.models.CollectionField=Backbone.Collection.extend({model:Backbone.Model,get:function(key){var match=this.where({key:key});if(match.length){match=match[0];}else{match=new this.model({key:key});this.add(match);}
return match;}});});;;var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@=",encode:function(input){var output="";var chr1,chr2,chr3,enc1,enc2,enc3,enc4;var i=0;input=Base64._utf8_encode(input);while(i<input.length){chr1=input.charCodeAt(i++);chr2=input.charCodeAt(i++);chr3=input.charCodeAt(i++);enc1=chr1>>2;enc2=((chr1&3)<<4)|(chr2>>4);enc3=((chr2&15)<<2)|(chr3>>6);enc4=chr3&63;if(isNaN(chr2)){enc3=enc4=64;}else if(isNaN(chr3)){enc4=64;}
output=output+
this._keyStr.charAt(enc1)+this._keyStr.charAt(enc2)+
this._keyStr.charAt(enc3)+this._keyStr.charAt(enc4);}
return output;},decode:function(input){var output="";var chr1,chr2,chr3;var enc1,enc2,enc3,enc4;var i=0;input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(i<input.length){enc1=this._keyStr.indexOf(input.charAt(i++));enc2=this._keyStr.indexOf(input.charAt(i++));enc3=this._keyStr.indexOf(input.charAt(i++));enc4=this._keyStr.indexOf(input.charAt(i++));chr1=(enc1<<2)|(enc2>>4);chr2=((enc2&15)<<4)|(enc3>>2);chr3=((enc3&3)<<6)|enc4;output=output+String.fromCharCode(chr1);if(enc3!=64){output=output+String.fromCharCode(chr2);}
if(enc4!=64){output=output+String.fromCharCode(chr3);}}
output=Base64._utf8_decode(output);return output;},_utf8_encode:function(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c);}
else if((c>127)&&(c<2048)){utftext+=String.fromCharCode((c>>6)|192);utftext+=String.fromCharCode((c&63)|128);}
else{utftext+=String.fromCharCode((c>>12)|224);utftext+=String.fromCharCode(((c>>6)&63)|128);utftext+=String.fromCharCode((c&63)|128);}}
return utftext;},_utf8_decode:function(utftext){var string="";var i=0;var c=c1=c2=0;while(i<utftext.length){c=utftext.charCodeAt(i);if(c<128){string+=String.fromCharCode(c);i++;}
else if((c>191)&&(c<224)){c2=utftext.charCodeAt(i+1);string+=String.fromCharCode(((c&31)<<6)|(c2&63));i+=2;}
else{c2=utftext.charCodeAt(i+1);c3=utftext.charCodeAt(i+2);string+=String.fromCharCode(((c&15)<<12)|((c2&63)<<6)|(c3&63));i+=3;}}
return string;}};;$(function(){ss.fn.common=ss.fn.common||{};ss.fn.common.serialize_form=function($form){var form_data=$form.serialize();$form.find('.send_unchecked_js:not(:checked)').each(function(index,checkbox){form_data+='&'+$(checkbox).attr('name')+'=';});return form_data;};ss.fn.common.form_as_json=function($form){var get_value=function($input){if($input.is(':checkbox:unchecked')){return'';}else{return $input.val();}};var data={};$form.find(':input').each(function(index,input){var $input=$(input);safe_log(index,$input);var name=$input.attr('name')||$input.attr('data-name');if(name){ss.fn.set(data,name,get_value($input),true);}});return data;};var get_value_or_default=function(func_or_value,default_value){var undefined={}.undefined;if($.isFunction(func_or_value)){return func_or_value();}else if(func_or_value===undefined){return default_value;}else{return func_or_value;}};ss.fn.get_value_or_default=get_value_or_default;ss.views.Popup=Backbone.View.extend({events:{},initialize:function(options){options=options||{};this.options=options;_.bindAll(this);this.after_initialize(options);this.rendered=false;this.render();},after_initialize:function(options){},popup_loaded:function(data){},popup_opened:function(data){},save:function(data){$.ajax({url:get_value_or_default(this.save_url),type:this.get_submit_method(),data:data.data,success:this.on_success,error:data.error});},submit:function(){this.$el.ssdialog('save');},get_submit_method:function(){return get_value_or_default(this.submit_method,'POST');},get_params:function(){return this.options.params;},get_template:function(){return this.options.template||this.template;},get_content_html:function(){return get_value_or_default(this.content_html);},get_content_url:function(){return get_value_or_default(this.content_url);},get_title:function(){return get_value_or_default(this.options.title||this.title);},get_width:function(){return get_value_or_default(this.width,400);},get_resizable:function(){return get_value_or_default(this.resizable,true);},get_save_button_label:function(){return get_value_or_default(this.save_button_label,'Save');},cancel_button_label:null,on_success:function(response){if(this.options.on_complete){this.options.on_complete(response);this.hide_dialog();}else{window.location=window.location;}},set_content:function(html){$(this.el).ssdialog('get_container').html(html);},disable_buttons:function(){var $buttons=this.find('.ui-dialog-buttonpane button');$buttons.prop('disabled',true);},enable_buttons:function(html){var $buttons=this.find('.ui-dialog-buttonpane button');$buttons.prop('disabled',false);},show_loading_indicator:function(){ss.fn.freeze_height(this.$el);this.$el.html('<center><div class="loading_gray_background_large"></div></center>');},show_done_button:function(){var self=this;var $button_set=this.find('.ui-dialog-buttonset');$button_set.html($('<button type="button" class="btn btn-sm btn-primary">Done</button>').click(function(){self.hide_dialog();}));},hide_dialog:function(options){options=options||{};if(options.html){this.set_content(options.html);}
var delay=options.delay||0;var $el=this.$el;_.delay(function(){$el.ssdialog('hide');},delay);},get_buttons:function(){return get_value_or_default(this.options.buttons||this.buttons,{});},refresh_after_save:true,render:function(){if(!this.rendered){this.rendered=true;var content={refresh_on_show:true};if(this.get_content_url()){content.url=this.get_content_url();}
if(this.get_content_html()){content.html=this.get_content_html();}else if(this.get_template()){var template=this.get_template();safe_log('rendering with ',this.get_params());content.html=template({c:this.get_params()});}
safe_log('buttons',this.get_buttons());this.$el.ssdialog({title:this.get_title(),save_callback:this.save,dynamic_width:true,width:this.get_width(),refresh_after_save:get_value_or_default(this.refresh_after_save,true),use_self:true,save_button_label:this.get_save_button_label(),cancel_button_label:this.cancel_button_label,content:content,load_callback:this.popup_loaded,open_callback:this.popup_opened,buttons:this.get_buttons(),close_callback:this.popup_closed,resizable:this.get_resizable()});if(this.after_render){this.after_render();}}},find:function(selector){return this.$el.closest('.ui-dialog').find(selector);}});ss.views.FormPopup=ss.views.Popup.extend({className:'form-popup label-beside',events:{},width:800,after_initialize:function(){this.validator=new ss.views.Validator({el:this.el});this.validator.validate();},validate:function(options){return this.validator.validate(options);}});ss.views.RowView=Backbone.View.extend({refresh_row:function(event){var el=this.el;var $table=$(this.el).closest('.data_table, .panel-data-table-js');var config=$table.data('config');$.ajax({url:config.ajax_source,type:'GET',data:{id:this.model.id},success:function(data){var row_data=data.aaData;$table.dataTable().fnUpdate(row_data[0],el,0);}});}});ss.views.ProgressButton=Backbone.View.extend({initialize:function(options){_.bindAll(this);this.after_submitting();this.render_submitting();if(options.ajax){safe_log('before ajax');safe_log('Extending',{success:this.success,failure:this.failure});safe_log('With',options.ajax);safe_log('Extended',_.extend({success:this.success,failure:this.failure},options.ajax));var ajax_params=_.extend({success:this.success,failure:this.failure,error:this.error},options.ajax);if(!options.skip_ajax){safe_log('before ajax');$.ajax(ajax_params);safe_log('after ajax');}else{this.success();}}},render_submitting:function(){var $button=this.$el;this.original_button_content=$button.html();if(!ss.config.THEME_CONFIG.has_font_awesome){$button.html((this.submitting_text||'Submitting')+'... <i class="loading"></i>');}else{$button.html((this.submitting_text||'Submitting')+'... <i class="fa fa-spinner fa-spin"></i>');}
$button.addClass('loading_button');if($('.loading-div-wrap').length>0){$('.loading-div-wrap').css('display','block');}},success:function(response){response=response||{};if(response.error_message){return this.failure(response,response.error_message);}
this.restore_button_content();this.after_success(response);if(this.options.success){this.options.success(response);}},failure:function(response,error_message){this.restore_button_content();this.after_failure(response,error_message);if(this.options.failure){this.options.failure(response);}},error:function(response){this.failure(response,'Unknown error');},restore_button_content:function(){if($('.loading-div-wrap').length>0){$('.loading-div-wrap').css('display','none');}
if(!this.options.disable_button_restore){var $button=this.$el;$button.html(this.original_button_content);$button.removeClass('loading_button');}},after_submitting:function(){},after_success:function(){},after_failure:function(){}});});;;$(function(){ss.ensure_data=function(required,func){var missing=[];_.each(required,function(requirement){if(!ss.data[requirement]){missing.push(requirement);}});var data_wrapper_classes={configurations:ss.models.NetworkConfigurationCollection,field_infos:ss.models.FieldInfoCollection,organization_types:ss.models.OrganizationTypeCollection,organization_categories:ss.models.OrganizationCategoryCollection,member_types:ss.models.MemberTypeCollection};if(missing.length){$.ajax({url:'/network/fetch_data',type:'POST',data:ss.fn.stringify({missing:missing}),success:function(response){_.each(response,function(value,key){ss.data[key]=new data_wrapper_classes[key](value);});func();}});}else{func();}};});;;$(function(){ss.forms=ss.forms||{};var panel_template=ss.fn.make_compile_template('.panel-templates');ss.views.FormView=Backbone.View.extend({initialize:function(options){_.bindAll(this);this.validator=new ss.views.Validator({el:this.el,validation_handler:this.validate.bind(this)});this.after_initialize();},base_events:{'change :input':'fields_changed',},events:function(){return _.extend({},this.base_events,this.additional_events);},additional_events:{},after_initialize:function(options){},validate:function(options){this.trigger('validation_started');return this.validator.validate(options).fail(function(event){this.trigger('validation_failed',event);}.bind(this));},get_render_params:function(){var params={model:this.model};return params;},render:function(){var params=this.get_render_params();this.$el.html(this.template({c:params}));this.fields_changed();this.validate();ss.fn.decorate_fields(this.$el);this.after_render();},after_render:function(){},fields_changed:function(){this.map_fields();this.display_conditional_fields();this.after_fields_changed();},after_fields_changed:function(){},display_conditional_fields:function(){},map_fields:function(){var modified=ss.fn.update_model(this);safe_log('Updated model',this.model);if(modified){this.trigger('change');}}});ss.forms.EditSubPanel=ss.views.FormView.extend({get_render_params:function(){var params={model:this.model};return params;}});ss.forms.BaseEditPanel=ss.views.FormView.extend({base_events:{'change :input':'fields_changed','click .save-js':'save'},initialize:function(options){_.bindAll(this);this.validator=new ss.views.Validator({el:this.el});if(this.model){this.original_raw_model=ss.fn.toJSON(this.model);}else{this.original_raw_model=null;}
this.after_initialize();},get_render_params:function(){var params={model:this.model,item_name:this.item_name};return params;},get_changes:function(){xxx_orig=this.original_raw_model;xxx_current=ss.fn.toJSON(this.model);var changes=ss.fn.changes(this.original_raw_model,ss.fn.toJSON(this.model));if(this.decorate_changes){changes=this.decorate_changes(changes);}
if(changes&&changes.files){_.each(changes.files,function(file,file_key){if(file.key==='delete'||file.temp_name){}else{delete changes.files[file_key];}});if(_.isEmpty(changes.files)){delete changes.files;}}
if(_.isEmpty(changes)){changes=undefined;}
xxx_changes=changes;return changes;},warn_before_leaving:function(){var changes=this.get_changes();if(changes){return ss.fn.onepage.DISCARD_CHANGES_MESSAGE;}},confirm_navigate:function(options){var func=options;if(options.url){func=function(){ss.fn.onepage.goto_page(options.url);};}
xxx_blah=this;var changes=this.get_changes();safe_log('Confirming a navigation away from this panel',changes,this.warn_before_leaving());if(this.warn_before_leaving()){var continue_popup=new ss.views.ContinuePopup({func:func});}else{func();}},save_and_close:function(event){return this.save(event,{close:true});},save:function(event,save_options){save_options=save_options||{};this.validate({force:true,submit_button:this.$('.save-js')}).done(function(){safe_log('saving');var data;var options={};if(this.model.id){var changes=this.get_changes();changes=this.decorate_changes(changes);if(!changes){changes={};options.skip_ajax=true;}
data=changes;}else{data=this.model;}
var encoded_data=ss.fn.stringify(data);safe_log(data,encoded_data,'data');options.el=$(event.target);options.ajax={processData:false,data:encoded_data};var url;if(this.model.id){url=this.get_save_url();_.extend(options.ajax,{type:'PUT',url:url});options.success=_.partial(this.saved,save_options);options.failure=_.partial(ss.fn.ajax_error,{message:'Failed to update'});}else{url=this.get_create_url();_.extend(options.ajax,{type:'POST',url:url});options.success=_.partial(this.created,save_options);options.failure=_.partial(ss.fn.ajax_error,{message:'Failed to create'});}
safe_log('options',options);var progress_button=new ss.views.ProgressButton(options);}.bind(this));},get_save_url:function(){var url=this.model.urlRoot;if(!url){safe_log("Can't save without a url",this.model);}
url+='/'+this.model.id;return url;},get_create_url:function(){var url=this.model.urlRoot;if(!url){safe_log("Can't create without a url",this.model);}
return url;},decorate_changes:function(changes){return changes;},created:function(options,response){ss.flash_message({content:'Settings Saved'});if(options.close&&this.close()){return;}
safe_log('Created something:',response);this.model.id=response.id;this.model.fetch({success:this.updated});this.after_created&&this.after_created();this.trigger('ss_created');},saved:function(options,response){ss.flash_message({content:'Settings Saved'});if(options.close&&this.close()){return;}
this.refresh_model(this.updated);this.after_saved&&this.after_saved();this.trigger('ss_saved');},refresh_model:function(success){this.model.fetch({success:success});},close:function(){if(this.get_listing_page()){ss.apps.admin_app.active_view=null;ss.fn.onepage.goto_page(this.get_listing_page());return true;}},updated:function(){this.original_raw_model=ss.fn.toJSON(this.model);this.trigger('updated',this.model);}});ss.forms.SecondaryEditPanel=ss.forms.BaseEditPanel.extend({after_created:function(){this.options.listing_view&&this.options.listing_view.render();this.render();},after_saved:function(){this.options.listing_view&&this.options.listing_view.render();}});ss.forms.PrimaryEditPanel=ss.forms.BaseEditPanel.extend({template:panel_template('.edit-panel'),base_events:{'change :input':'fields_changed','click .save-js':'save','click .save-close-js':'save_and_close','click .onepage-return-button':'return_button_clicked'},get_title:function(){var name=this.model.get('name');if(name){return name;}
if(!this.model.id){return'New Member';}else{return'Edit';}},include_return_button:function(){return true;},get_panel_heading:function(){return;},get_render_params:function(){var params={model:this.model,item_name:this.item_name,view:this};return params;},render:function(){safe_log(' RENDERED A PRIMARY EDIT PANEL');var params=this.get_render_params();this.$el.detach().html(this.template({c:params}));this.$('.panel-content').html(this.content_template({c:params}));if(this.extra_header_buttons){this.$('.extra-header-buttons').replaceWith(this.extra_header_buttons());}
ss.fn.decorate_fields(this.$el);this.fields_changed();this.validate();this.after_render();ss.fn.onepage.update_app_panel(this.el,this);$(document).attr('title',this.get_title());xxx_model=this.model;},created:function(options,response){ss.fn.onepage.goto_page(response.url,{replace:true,skip_confirm:true,trigger:!options.close});if(options.close&&this.close()){return;}},return_button_clicked:_.debounce(function(event){ss.fn.onepage.goto_page(this.get_listing_page());},1000,true),close:function(){ss.apps.admin_app.active_view=null;ss.fn.onepage.goto_page(this.get_listing_page());},get_listing_page:function(){return this.listing_page;}});ss.fn.update_model=function(view,model,options){var data;var modified=false;model=model||view.model;options=options||{};view.$(':input[data-name]').each(function(index,field){var $field=$(field);var value;var name=$field.data('name');if($field.hasClass('update-model-ignore'))
return;if($field.is(':disabled')){return;}
if($field.is('textarea.wysiwyg')){}else if($field.is('[type!=hidden]:hidden'&&$field.data('allow_hidden')!="true")){return;}
if($field.is('.checkbox-list, input[type="radio"]')){var values=[];view.$('input[type="radio"]:checked,.checkbox-list:checked').each(function(index,checkbox){var $checkbox=$(checkbox);if($checkbox.data('name')===name){values.push($checkbox.val());}});values.sort();if(values.length===1){value=values[0];}else{value=values;}}else if($field.is('[type="checkbox"]')){value=$field.prop('checked');className=$field.prop('className');if(className.indexOf('reverse_checkbox')>-1){value=!value;}}else{value=$field.val();}
data=data||{};data[name]=value;});if(data){safe_log('Updating',data);_.each(data,function(value,path){modified=ss.fn.set(model,path,value)||modified;});if(!options.silent){if(model.change){model.change();}}}else{safe_log('Nothing to update',data);}
return modified;};ss.fn.arrays_equal=function(orig,current){if(!(_.isArray(orig)&&_.isArray(current))){return false;}
if(orig.length!=current.length){return false;}
var i=0;while(i<orig.length){if(ss.fn.changes(orig[i],current[i])!==undefined){return false;}
i+=1;}
return true;};ss.fn.is_empty=function(val){if(val===false){return true;}
if(_.isNumber(val)||_.isBoolean(val)){return false;}
return _.isEmpty(val);};ss.fn.changes=function(orig,current){if(ss.fn.is_empty(orig)&&ss.fn.is_empty(current)){return;}
if(orig===undefined){return current;}
if(_.isFunction(current)||_.isFunction(orig)){}else if(_.isArray(current)){if(ss.fn.arrays_equal(orig,current)){return;}
return current;}else if(_.isObject(current)){var changes={};if(!_.isObject(orig)){return current;}
_.each(current,function(value,key){if(_.contains(['temp_url'],key)){return;}
var changed_value=ss.fn.changes(orig[key],value);if(changed_value!==undefined){changes[key]=changed_value;}});_.each(orig,function(value,key){if(current[key]===undefined){changes[key]=null;}});if(_.keys(changes).length){return changes;}}else{if(orig!==current){return current;}}};ss.fn.get=function(target,path){safe_log('Getting',target,path);var parts=path.split('.');_.each(parts,function(part){if(typeof target==='undefined'){safe_log('Target is undefined',path,'next part',part);return target;}
if(target.get){var next=target.get(part);if(!next&&target.at){next=target.at(part);}
target=next;}else{target=target[part];}});return target;};ss.fn.set=function(target,path,value,extend){var initial_target=target;var parts=path.split('.');var field=parts.pop();var modified;var next;_.each(parts,function(part){if(!target){safe_log('Target is null or undefined',target,part,path);xxx_set_args={target:initial_target,path:path,value:value};}
if(target.get_with_default){next=target.get_with_default(part);}
else if(target.get){next=target.get(part);if(!next&&target.at){next=target.at(part);}}else{next=target[part];}
if(extend&&!next){next={};ss.fn.set(target,part,next);}
target=next;});if(!target){xxx_initial_target=initial_target;safe_log('Target is null or undefined',initial_target,target,path);}
if(target.set){var data={};data[field]=value;modified=target.get(field)!==value;target.set(data);}else{modified=target[field]!==value;target[field]=value;}
return modified;};ss.views.MultiSectionEditPanel=ss.forms.BaseEditPanel.extend({base_events:{'click [data-section]':'section_clicked','click .save-js':'save','click .save-close-js':'save_and_close','click .onepage-return-button':'return_button_clicked','click .cancel':'cancel_clicked','click .save-and-use':'save_and_use_clicked','click [data-action]':'action'},get_title:function(){var name=this.model.get('name');if(name){return name;}
if(!this.model.id){return'New Member';}else{return'Edit';}},initialize:function(options){_.bindAll(this);this.section=options.section;if(this.model){this.original_raw_model=ss.fn.toJSON(this.model);}else{this.original_raw_model=null;}
xxx_member_edit_panel=this;this.after_initialize();},render:function(){var self=this;this.$el.html(this.template({c:{model:this.model,options:this.options}}));this.$el.attr('data-permaid',this.model.get('permaid'));ss.fn.onepage.update_app_panel(this.el,this);$(document).attr('title',this.get_title());xxx_model=this.model;this.section=this.section||this.default_section||'basic';this.section_changed(this.section);this.after_render();},after_render:function(){},section_clicked:function(event){this.section.validate({force:true}).done(function(){var section_id=$(event.target).data('section');this.section_changed(section_id);}.bind(this));},section_changed:function(section_id){xxx_model=this.model;if(this.model.id){ss.fn.onepage.goto_page(this.model.get('url')+'/sections/'+section_id,{trigger:false,replace:true});}
var old_section=this.section;if(this.section&&this.section instanceof Backbone.View){this.section.off("validation_failed");this.section.off("validation_started");this.section.remove();}
var section_class=this.get_sections()[section_id];this.section=new section_class({model:this.model});if(this.section&&this.section instanceof Backbone.View){this.section.on('validation_failed',function(event){this.trigger('validation_failed',event);}.bind(this));this.section.on('validation_started',function(event){this.trigger('validation_started',event);}.bind(this));}
this.$('.panel-content').empty().append(this.section.el);this.section.render();this.$('.section-list > li').removeClass('selected');this.$('[data-section="'+section_id+'"]').closest('li').addClass('selected');if(this.after_section_changed){this.after_section_changed(section_id);}},_save:function(event,save_options){safe_log('saving');var changes=this.get_changes();changes=this.decorate_changes(changes);if(!changes){changes={};}
var string_changes=ss.fn.stringify(changes);safe_log(changes,string_changes,'changes');var options={el:event&&$(event.target),ajax:{processData:false,data:string_changes}};if(this.model.id){_.extend(options.ajax,{type:'PUT',url:this.get_save_url()});options.success=_.partial(this.after_saved,save_options);options.failure=_.partial(this.after_error,save_options);}else{_.extend(options.ajax,{type:'POST',url:this.get_save_url()});options.success=_.partial(this.after_created,save_options);options.failure=_.partial(this.after_error,save_options);}
safe_log('options',options);this.progress_button(options);},progress_button:function(options){var progress_button=new ss.views.ProgressButton(options);},save:function(event,save_options){save_options=save_options||{};this.section.validate({force:true,submit_button:event&&$(event.target)}).done(_.partial(this._save,event,save_options));},decorate_changes:function(changes){return changes;},after_created:function(options,response){var self=this;if(this.options.on_created){safe_log('Callback for new model with id',response.id);xxx_this=this;this.with_details(response.id,function(member){self.options.on_created(member);});return;}
ss.fn.onepage.goto_page(response.url,{replace:true,skip_confirm:true,trigger:!options.close});if(options.close){this.original_raw_model=ss.fn.toJSON(this.model);this.close();}},after_saved:function(options,response){if(this.options.on_created){this.options.on_created(this.model);return;}
if(options.close){this.close();return;}
var self=this;this.with_details(this.model.id,function(member){var changes=ss.fn.changes(ss.fn.toJSON(self.model),ss.fn.toJSON(member));if('body_ready'in changes){delete changes.body_ready;}
if(!_.isEmpty(changes)){ss.fn.onepage.goto_page(member.get('url'),{replace:true,skip_confirm:true,trigger:!options.close});}
self.original_raw_model=ss.fn.toJSON(self.model);});},after_error:function(options,response){if(response.responseText.indexOf("<")<0){alert(response.responseText);return;}
if(response.status==403){alert("You do not have sufficient permissions to save this object.");}else{alert("An unknown error occurred attempting to perform the save.");}},return_button_clicked:_.debounce(function(event){if(this.options.on_cancel){this.options.on_cancel();return;}
ss.fn.onepage.goto_page(this.get_listing_page());},1000,true),close:function(){ss.apps.admin_app.active_view=null;ss.fn.onepage.goto_page(this.get_listing_page());},cancel_clicked:function(event){this.options.on_cancel();},save_and_use_clicked:function(event){this.save(event);},get_listing_page:function(){return this.listing_page;},action:function(event){var $target=$(event.target);$target=$target.closest('[data-action]');var action=$target.data('action');var method=this[action];if(!method){safe_log('No method found for action',action);}
method();}});});;;$(function(){ss.fn.validator=ss.fn.validator||{};ss.fn.validator.clear_errors=function($input){$input.next().filter('.alert-validation').remove();$input.removeClass('validation-error');};ss.fn.validator.add_error=function(options){var $input=options.input;var error_message=options.error_message;var alert_class=options.alert_class||'alert-error';var suppress_validation_class=options.suppress_validation_class;var $error=$('<span class="alert '+alert_class+' alert-validation">').text(error_message);if(!suppress_validation_class){$input.addClass('validation-error');}
var $row=$input.closest('.field');if($row.length){$row.css({'max-height':$row.height()});}
$input.after($error);$error.position({my:'left center',at:'right+5 center',of:$input});};var rules;ss.views.Validator=Backbone.View.extend({events:{"blur :input:data(validations),:input[data-validations]":"validation_fields_blurred","focus :input:data(validations),:input[data-validations]":"validation_touched"},initialize:function(options){this.options=options||{};_.bindAll(this);this.validation_handler=this.options.validation_handler||this.validate.bind(this);this.rendered=false;this.render();},validation_fields_blurred:function(event){this.validation_handler({fields:$(event.target)});},validation_touched:function(event){var $input=$(event.target);$input.focus(function(){$input.data('validation-touched',true);});},validation_fields:function(){return this.$(":input:data(validations),:input[data-validations]");},validate:function(options){var dfd=new jQuery.Deferred();options=options||{};var fields=options.fields;if(!fields){fields=this.validation_fields();}
var validator=this;this.$('[type=hidden]').each(function(index,hidden){var $hidden=$(hidden);var $editor=$hidden.data('ckeditor');if($editor){$editor.update_hidden();}});var validationPromises=[];fields.each(function(index,input){var $input=$(input);if(options.force){$input.data('validation-touched',true);}
ss.fn.validator.clear_errors($input);if(!$input.is(':visible')){return;}
_.each(_.string.words($input.data('validations')||''),function(rule_name){if(!rule_name){return;}
var rule=rules[rule_name];if(!rule){safe_log('No rule found',rule_name);}
var validationPromise=rule.validate($input);validationPromises.push(validationPromise);validationPromise.fail(function(event){ss.fn.validator.add_error({input:$input,error_message:event.error_message});});}.bind(this));});if(options.submit_button&&options.submit_button.length){dfd.fail(function(){this.show_button_error(options.submit_button);}.bind(this));}
if(options.success){dfd.done(function(){options.success;});}
$.when.apply($,validationPromises).done(function(){dfd.resolve();}).fail(function(event){dfd.reject(event);});return dfd.promise();},show_button_error:function($submit_button){$submit_button.siblings('.submit-error').remove();var $error=$('<span class="submit-error alert alert-error alert-validation">').text('Please Review Form for Errors');$('body').append($error);$error.position({my:'right center',at:'left center',of:$submit_button,offset:'-5 0'});ss.fn.fadeInOutRemove($error);}});ss.views.ValidatorRule=Backbone.View.extend({validate:function(input){var dfd=new jQuery.Deferred();var $input=$(input);try{var val=$input.val();if(val===''||this.test(val)){dfd.resolve();return dfd.promise();}}catch(error){}
dfd.reject({error_message:this.error_message,rule_name:this.ruleName,target:input});return dfd.promise();}});ss.views.RegularExpressionRule=ss.views.ValidatorRule.extend({test:function(val){return this.re.test(val);}});ss.views.NotNegativeRule=ss.views.RegularExpressionRule.extend({ruleName:'not_negative',test:function(val){return parseFloat(val)>=0;},error_message:'Amount must not be negative'});ss.views.GreaterThanZeroRule=ss.views.RegularExpressionRule.extend({ruleName:'greater_than_zero',test:function(val){return parseFloat(val)>0;},error_message:'Amount must be greater than zero'});ss.views.MoneyRule=ss.views.RegularExpressionRule.extend({ruleName:'integer',re:/^\d+(?:\.\d+|)$/,error_message:'Invalid amount'});ss.views.IntegerRule=ss.views.RegularExpressionRule.extend({ruleName:'integer',re:/^\d+$/,error_message:'Must be a number'});ss.views.UrlRule=ss.views.RegularExpressionRule.extend({ruleName:'url',re:/^https?:\/\/.+\..+$/,error_message:'Must be a valid url starting with http:// or https://'});ss.views.DateRule=ss.views.ValidatorRule.extend({ruleName:'date',test:function(value){var date=new Date(value);var months=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];var parsed=(date.getDate()+' '+months[date.getMonth()]+' '+date.getFullYear());return value===parsed||value==='0'+parsed;},error_message:'Invalid Date'});ss.views.PasswordResetRule=ss.views.ValidatorRule.extend({ruleName:'password_reset',test:function(value){if(value.length==0){return true;}else if(value.length>=6){return true;}
return false;},error_message:'Invalid Password'});ss.views.CreditCardRule=ss.views.ValidatorRule.extend({ruleName:'credit_card',test:function(value){if(/[^0-9-]+/.test(value)){return false;}
var nCheck=0,nDigit=0,bEven=false;value=value.replace(/\D/g,"");if(value.length<12){return false;}
for(var n=value.length-1;n>=0;n--){var cDigit=value.charAt(n);var nDigit=parseInt(cDigit,10);if(bEven){if((nDigit*=2)>9)
nDigit-=9;}
nCheck+=nDigit;bEven=!bEven;}
return(nCheck%10)==0;},error_message:'Invalid Card Number'});ss.views.RequiredRule=ss.views.ValidatorRule.extend({ruleName:'required',validate:function(input){var dfd=new jQuery.Deferred();var $input=$(input);if($input.data('validation-touched')&&!$input.val()){dfd.reject({error_message:'Required',rule_name:this.ruleName,target:input});}
if(dfd.state()==="pending"){dfd.resolve();}
return dfd.promise();}});ss.views.EmailRule=ss.views.ValidatorRule.extend({ruleName:'email',test:function(value){return/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i.test(value);},error_message:'Invalid Email'});ss.views.NoUnicodeEmail=ss.views.ValidatorRule.extend({ruleName:'noUnicodeEmail',test:function(value){for(var i=0;i<value.length;i++){if(value.charCodeAt(i)>255){return false;}}
return true;},error_message:'Email contains invalid characters'});ss.views.ColorRule=ss.views.ValidatorRule.extend({ruleName:'is_color',test:function(value){return/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(value)||value=='transparent';},error_message:'That is an invalid color. Please use a hexadecimal color code, like #FF0000.'});ss.views.ResourceAvailableRule=ss.views.ValidatorRule.extend({ruleName:'',dataKey:'',resourceUrl:'',errorMessage:'',validate:function(input){var dfd=new jQuery.Deferred();var error_message=this.errorMessage;var $input=$(input);var value=$input.val();var data={};data[this.dataKey]=value;if(value==""||!this.prevalidate()){dfd.resolve();return dfd.promise();}
$.ajax({url:this.resourceUrl,data:data}).done(function(data){if(data.toLowerCase()==="true"){dfd.resolve();}
else{dfd.reject({error_message:error_message,rule_name:this.ruleName,target:input});console.log("rejected in ajax done");}}.bind(this)).fail(function(){dfd.reject({error_message:error_message,rule_name:this.ruleName,target:input});console.log("rejected in ajax fail");}.bind(this));return dfd.promise();},prevalidate:function(){return true;}});ss.views.UserIDAvailableRule=ss.views.ResourceAvailableRule.extend({ruleName:'user_id_available',dataKey:'username',resourceUrl:'/auth/user_id_available',errorMessage:'User for email exists'});ss.views.UserIDAvailableNoPasswordRule=ss.views.ResourceAvailableRule.extend({ruleName:'user_id_available_no_password',dataKey:'username',resourceUrl:'/auth/user_id_available_no_password',errorMessage:'User for email exists',prevalidate:function(){$existingEmail=$('.member-edit-email').data('value');$newEmail=$('.member-edit-email').val();if($existingEmail==$newEmail){return false;}
return true;}});ss.views.CompanyNameAvailableRule=ss.views.ResourceAvailableRule.extend({ruleName:'company_name_available',dataKey:'company_name',resourceUrl:'/auth/company_name_available',errorMessage:'Company already exists'});var Validator=ss.views.Validator;rules={required:new ss.views.RequiredRule(),date:new ss.views.DateRule(),integer:new ss.views.IntegerRule(),money:new ss.views.MoneyRule(),credit_card:new ss.views.CreditCardRule(),greater_than_zero:new ss.views.GreaterThanZeroRule(),not_negative:new ss.views.NotNegativeRule(),email:new ss.views.EmailRule(),url:new ss.views.UrlRule(),user_id_available:new ss.views.UserIDAvailableRule(),user_id_available_no_password:new ss.views.UserIDAvailableNoPasswordRule(),company_name_available:new ss.views.CompanyNameAvailableRule(),is_color:new ss.views.ColorRule(),password_reset:new ss.views.PasswordResetRule(),no_unicode_mail:new ss.views.NoUnicodeEmail()};});;;$(function(){ss.analytics=ss.analytics||{};ss.analytics.track_event=function(category,action,params){safe_log('Tracking',category,action,params);try{mixpanel.track(category+'-'+action);$.ajax({url:'/analytics/track',data:{category:category,action:action}});}catch(err){safe_log('Failed to compile us analytics',err);}};ss.analytics.increment=function(key){try{mixpanel.people.increment(key);}catch(err){safe_log('Failed to compile us analytics',err);}};ss.analytics.track_admin_event=function(page){try{$.ajax({url:'/analytics/track',data:{category:'admin',action:page}});mixpanel.track(page);mixpanel.people.increment(page);}catch(err){safe_log('Failed to compile us analytics',err);}};ss.analytics.initialize=function(){try{var user=SS.app.current_user;var context;if(user&&user.id){mixpanel.identify(user.id);context={network:SS.app.current_network.permaid,network_admin:SS.app.current_user.network_admin,admin:SS.app.current_user.admin};}else{context={network:SS.app.current_network.permaid};}
mixpanel.register(context);if(user){mixpanel.name_tag(user.name);mixpanel.people.set({"$email":user.email,network:SS.app.current_network.permaid,network_admin:SS.app.current_user.network_admin,admin:SS.app.current_user.admin,"$created":SS.app.current_user.created,"$name":user.name});}}catch(err){safe_log('Failed to compile us analytics',err);}};});;;$(function(){ss.models.MiscellaneousPaymentInfo=Backbone.Model.extend({defaults:function(){return{price:new ss.models.Price(),description:'',category_id:null};},get_price:function(){return this.get('price');}});ss.models.Price=Backbone.Model.extend({defaults:function(){return{cost_in_cents:0,currency:SS.app.current_network.currency,tax_in_cents:0};},cost_in_dollars:function(){safe_log(this,this.get('cost_in_cents'));return(this.get('cost_in_cents')/100.0).toFixed(2);},total_in_dollars:function(){return((this.get('cost_in_cents')+this.get('tax_in_cents'))/100.0).toFixed(2);},format:function(options){return ss.fn.currency(this.attributes,options);},set_cost_in_dollars:function(amount){this.set({cost_in_cents:parseInt(parseFloat(amount)*100)});},set_tax_in_dollars_from_percentage:function(tax,amount){var tax_in_cents=amount*tax;this.set({tax_in_cents:parseInt(parseFloat(tax_in_cents))});},set_tax_in_dollars:function(tax){this.set({tax_in_cents:parseInt(parseFloat(tax)*100)});},is_free:function(){return!(this.get('cost_in_cents')||this.get('tax_in_cents'));},price_object:true});ss.models.Payee=Backbone.Model.extend({defaults:function(){return{user_id:null,user:null,user_details:null,company_id:null,company:null,company_details:null};},get_url:function(){if(this.get('company_id')){return'/companies/'+this.get('company_id');}
if(this.get('user_id')){return'/users/'+this.get('user_id');}
return null;},reset:function(){this.clear();this.set(this.defaults());},get_user_or_account_holder_field:function(field){var user=this.get('user_details');if(user){return user.get(field);}
try{var company=this.get('company_details');return company.get('company_summary').account_holder[field];}catch(error){}}});ss.models.PaymentTarget=Backbone.Model.extend({defaults:function(){return{invoice:null,attendees:null,membership_info:null,miscellaneous_info:null};},get_delegate:function(){return this.get('invoice')||this.get('attendees')||this.get('membership_info')||this.get('donation_info')||this.get('miscellaneous_info');},get_price:function(){var price=this.get_delegate().get_price();if(!price.attributes){price=new ss.models.Price(price);}
return price;},get_description:function(){if(this.get('event')){var event=this.get('event');return event.get('name')+' - Tickets';}
if(this.get('membership_info')){var membership_info=this.get('membership_info');return'Membership - '+membership_info.get('plan').get('name');}
var delegate=this.get_delegate();var description=delegate.get('description');return description},reset:function(){this.clear();this.set(this.defaults());}});ss.models.InvoicePaymentDetails=Backbone.Model.extend({defaults:function(){return{};}});ss.models.ComplimentaryPaymentDetails=Backbone.Model.extend({defaults:function(){return{memo:null};}});ss.models.OfflinePaymentDetails=Backbone.Model.extend({defaults:function(){return{};}});ss.models.OnlinePaymentDetails=Backbone.Model.extend({defaults:function(){return{};}});ss.models.PaymentDetails=Backbone.Model.extend({defaults:function(){return{invoice_details:null,complimentary_details:null,offline_details:null,online_details:null};},reset:function(){this.clear();this.set(this.defaults());}});ss.models.Payment=Backbone.Model.extend({defaults:function(){return{pay_in_full:true,invoice_id:null,completed:false,send_receipt:false,payment_target:new ss.models.PaymentTarget(),payee:new ss.models.Payee(),details:new ss.models.PaymentDetails()};},is_free:function(){var price=this.get('payment_target').get_price();return price.is_free();}});ss.models.PaymentMethod=Backbone.Model.extend({defaults:function(){return{logos:{}};}});ss.models.PaymentMethodCollection=Backbone.Collection.extend({url:"/v2/payment_methods",model:ss.models.PaymentMethod,is_paypal_network:function(){return _.contains(this.pluck('provider'),'paypal');}});ss.models.Transaction=Backbone.Model.extend({urlRoot:"/v2/transactions",defaults:function(){return{real_price:{}};}})});;;$(function(){ss.fields=ss.fields||{};var field_template=ss.fn.make_compile_template('.field-templates');ss.fn.error_decorator=function(func){return function(){try{return func.apply(this,arguments);}catch(err){safe_log('Caught an error calling',func,arguments);throw err;};};};ss.templates=ss.templates||{};ss.fields.build_options=function(options){if(!_.isArray(options)){if(options.map){return options.map(function(item){return{label:item.get('label'),value:item.get('value')||item.get('key')};});}
return _.map(options,function(label,key){return{label:label,value:key};});}
return _.map(options,function(option){if(_.isArray(option)&&option.length===2){return{label:option[1],value:option[0]};}else if(_.isString(option)){return{label:option,value:option};}
return option;});};ss.fields.capitalize_options=function(options){options=ss.fields.build_options(options);return _.map(options,function(option){option=_.extend({},option);option.label=_.string.titleize(option.label);return option;});};var update_options=function(options){options=_.extend({},options);options.data_name=options.data_name||options.name;if(options.item&&options.data_name&&options.value===undefined){options.value=ss.fn.get(options.item,options.data_name);if(options.currency&&_.isNumber(options.value)){options.value=options.value.toFixed(2);}}
if(options.required){options.css_class=options.css_class||'';options.css_class+=' required';}
return options;};var input_attributes_template=field_template('.input-attributes');ss.input_attributes=ss.templates.input_attributes=function(options){return input_attributes_template({c:options});};var label_template=field_template('.field-label');ss.label=ss.templates.label=function(options){return label_template({c:options});};var row_template=field_template('.generic-row');var row=function(field_func){return function(options){var options=_.extend({},options);options.field_content=field_func(options);return row_template({c:options});};};var text_field_template=field_template('.text-field');ss.text_field=ss.fn.error_decorator(ss.templates.text_field=function(options){options=update_options(options);return text_field_template({c:options});});ss.text_row=row(ss.text_field);var number_field_template=field_template('.number-field');ss.number_field=ss.fn.error_decorator(ss.templates.text_field=function(options){options=update_options(options);return number_field_template({c:options});});ss.number_row=row(ss.number_field);var color_field_template=field_template('.color-field');ss.color_field=ss.fn.error_decorator(ss.templates.text_field=function(options){options.css_class=(options.css_class||'')+' color-input';options.validations=(options.validations||'')+' is_color';options.input_wrap_class=(options.input_wrap_class||'')+' pull-left';options.allow_transparent=options.allow_transparent||false;options.css_class=(options.allow_transparent)?options.css_class+' can-transparent':options.css_class;options=update_options(options);return color_field_template({c:options});});ss.color_row=row(ss.color_field);ss.currency_field=ss.templates.currency_field=ss.fn.error_decorator(function(options){options=_.extend({},options,{prepend:SS.app.current_network.currency_symbol});options.css_class=(options.css_class||'')+' currency-field';options.currency=true;return ss.text_field(options);});ss.currency_row=row(ss.currency_field);ss.date_field=ss.templates.date_field=ss.fn.error_decorator(function(options){options=_.extend({},options);options.validations=(options.validations||'')+' date';options.css_class=(options.css_class||'')+' date-picker-field';options=update_options(options);options.value=ss.fn.format_date(options.value);return ss.text_field(options);});ss.date_row=row(ss.date_field);var text_area_field_template=field_template('.textarea-field');ss.text_area_field=ss.templates.text_area_field=ss.fn.error_decorator(function(options){options=update_options(options);return text_area_field_template({c:options});});ss.text_area_row=row(ss.text_area_field);var rich_text_field_template=field_template('.richtext-field');ss.rich_text_field=ss.templates.rich_text_field=ss.fn.error_decorator(function(options){options.css_class=options.css_class||'';options.css_class+=' ckeditor_input';options=update_options(options);return rich_text_field_template({c:options});});ss.rich_text_row=row(ss.rich_text_field);var list_field_template=field_template('.list-field');ss.checkbox_list_field=ss.templates.checkbox_list_field=ss.fn.error_decorator(function(options){options=update_options(options);options=_.extend({input_type:'checkbox'},options);return list_field_template({c:options});});ss.checkbox_list_row=row(ss.checkbox_list_field);ss.radio_list_field=ss.templates.radio_list_field=ss.fn.error_decorator(function(options){options=update_options(options);options=_.extend({input_type:'radio'},options);return list_field_template({c:options});});ss.radio_list_row=row(ss.radio_list_field);var checkbox_field_template=field_template('.checkbox-field');ss.checkbox_field=ss.templates.checkbox_field=ss.fn.error_decorator(function(options){options=update_options(options);return checkbox_field_template({c:options});});ss.checkbox_row=row(ss.checkbox_field);var pill_radio_field_template=field_template('.pill-radio-field');ss.pill_radio_field=ss.templates.pill_radio_field=ss.fn.error_decorator(function(options){options=update_options(options);return pill_radio_field_template({c:options});});ss.pill_radio_row=row(ss.pill_radio_field);var select_field_template=field_template('.select-field');ss.select_field=ss.templates.select_field=ss.fn.error_decorator(function(options){options=update_options(options);return select_field_template({c:options});});ss.select_row=row(ss.select_field);var multiselect_field_template=field_template('.multiselect-field');ss.multiselect_field=ss.templates.multiselect_field=ss.fn.error_decorator(function(options){options=update_options(options);return multiselect_field_template({c:options});});ss.multiselect_row=row(ss.multiselect_field);var address_row_template=field_template('.address-template');ss.address_block=ss.templates.address_block=ss.fn.error_decorator(function(options){return address_row_template({c:options});});var address_linear_template=field_template('.address-linear-template');ss.address_linear_block=ss.templates.address_linear_block=ss.fn.error_decorator(function(options){return address_linear_template({c:options});});var image_field_template=field_template('.image-field');ss.image_field=ss.templates.image_field=ss.fn.error_decorator(function(options){options=update_options(options);options.width=options.width||100;options.height=options.height||100;return image_field_template({c:options});});ss.image_row=row(ss.image_field);var file_field_template=field_template('.file-field');ss.file_field=ss.templates.file_field=ss.fn.error_decorator(function(options){options=update_options(options);return file_field_template({c:options});});ss.file_row=row(ss.file_field);var display_field_template=field_template('.display-field');ss.display_field=ss.templates.display_field=ss.fn.error_decorator(function(options){options=update_options(options);return display_field_template({c:options});});ss.display_row=row(ss.display_field);ss.fields.MultiItemRow=Backbone.View.extend({template:field_template('.multi-item-row'),events:{'click .add-item':'add_item','click .close-button':'remove_item'},initialize:function(){_.bindAll(this);this.render();},render:function(){var self=this;this.$el.html(this.template({c:this.options}));var $items=this.$('.multi-field-items');var selected_items=ss.fn.get(this.model,this.options.name);xxx_selected_items=selected_items;ss.fn.as_collection(selected_items).each(function(item,index){$items.append(self.render_item_row(item,index));});this.after_render();},after_render:function(){},render_item_row:function(item,index){var render_options=this.get_item_render_options(item,index);return this.item_template({c:render_options});},add_item:function(event){event.preventDefault();var items=ss.fn.get(this.model,this.options.name);if(_.isArray(items)){items.push({});}else{items.add({});}
xxx_items=items;ss.fn.as_collection(items).each(function(item,index){ss.fn.set(item,'key',String(index));});this.render();this.item_added();},item_added:function(){},remove_item:function(event){event.preventDefault();var index=$(event.target).data('index');var items=ss.fn.get(this.model,this.options.name);if(_.isArray(items)){items.splice(index,1);}else{items.remove(items.at(index));}
this.render();},get_item_render_options:function(item,index){return{item:item,index:index};}});ss.fields.MultiSelectRow=ss.fields.MultiItemRow.extend({item_template:field_template('.multi-select-item-row'),get_item_render_options:function(item,index){var name=this.options.name+'.'+index;var sub_name=this.options.sub_name;var value=item;if(sub_name){name=name+'.'+sub_name;value=ss.fn.get(item,sub_name);}
return{name:name,value:value,index:index,options:this.options.options};},item_added:function(){this.$('select').change();}});ss.custom_fields=function(criteria,model,options){var html='';var custom_fields=ss.data.configurations.where(criteria);_.each(custom_fields,function(configuration){html+=ss.custom_fields_for_configuration(configuration,model,options)||'';});return html;};ss.custom_fields_for_configuration=function(configuration,model,section_options){var html='';section_options=typeof section_options!=='undefined'?section_options:{};configuration.get('components').each(function(component){var field_info_id=component.get('field_info_id');if(!field_info_id){return;}
var field=ss.data.field_infos.get(field_info_id);if(!field){safe_log('No field found for ',field_info_id,configuration,component,model);return;}
var field_type=field.get('field_type');var options=field.get('options');options=_.sortBy(options,function(option){if(!option.value){return-1;}
try{return parseInt(option.key,10);}catch(err){return 0;}});var params={css_class:(options.css_class||'')+' form-control ',label:field.get('label'),name:field.get_field_path(),item:model,options:options};if(field_type=='multiselect'&&section_options.float_multiselect!==false){params.input_wrap_class='pull-left';}
params.row_css_class=section_options.row_css_class;var separator_row=function(){return'<hr>';};var render_map={text:ss.text_row,textarea:ss.text_area_row,select:ss.select_row,checkbox:ss.checkbox_row,checkbox_list:ss.checkbox_list_row,radio_list:ss.radio_list_row,file_upload:ss.file_row,date:ss.date_row,numeric:ss.text_row,multiselect:ss.multiselect_row,hidden:ss.text_row,separator:separator_row};var render_func=render_map[field_type];safe_log('Rendering',params.label,field_type,field.attributes,params.options);if(render_func){html+=render_func(params);}else{html+='<div class="alert alert-warning">Unknown field type: '+field_type+'</div>';}});safe_log('after',model.attributes.additional_info.requiredcheckbox,html);return html;};ss.validations=ss.fields.validation_attr=function(options){if(options.validations){return'data-validations="'+options.validations+'"';}
return'';};ss.fn.decorate_fields=function(selector){var $date_pickers=$('.date-picker-field',selector);safe_log('Decorating date pickers',$date_pickers);xxx_selector=selector;ss.fn.datepicker($date_pickers);if(true){$('.wysiwyg',selector).each(function(index,textarea){var $textarea=$(textarea);if($textarea.data('wysiwyged')){return;}
$textarea.data('wysiwyged',true);$.ss.wysiwyg.create($textarea,{callback_fun:function(){$textarea.change();}});});}};ss.fn.build_alert=function(options){var $alert_div=$('<div class="alert alert-error">');$alert_div.html(options.html);return $alert_div;};var uniqueIdCounter=0;$('.taglist').livequery(function(){var originalInput=this;var onChangeCallback=function(){$(originalInput).trigger('change');}
options={height:'100%',onChange:onChangeCallback};var defaultText=$(originalInput).data('default_text');if(defaultText){options.defaultText=defaultText;}
var pattern=$(originalInput).data('tag_validation_pattern');if(pattern){options.pattern=new RegExp(pattern);}
var id=$(originalInput).attr('id');if(!id){id='taglist'+new Date().getTime()+(uniqueIdCounter++);$(originalInput).attr('id',id);}
$(originalInput).tagsInput(options);});});;;$(function(){dialog_width=860;var editor_template=ss.fn.make_compile_template('.editor-templates');ss.views.FormImageChooser=Backbone.View.extend({no_image_template:editor_template('.base-image-template'),image_exists_template:editor_template('.form-return-values'),events:{'click .launch-image-chooser':'launch_image_chooser','click .delete-image':'delete_image'},initialize:function(){_.bindAll(this);this.render();},render:function(){this.render_image_field();},render_image_field:function(){var image_field_template=this.options.thumbnail_url!=''&&typeof this.options.thumbnail_url!=="undefined"?this.image_exists_template:this.no_image_template;$(this.$el).html(image_field_template({thumbnail_url:this.options.thumbnail_url,input_name:this.options.input_name,id:this.options.id,required:this.options.required}));},delete_image:function(){$(this.$el).html(this.no_image_template({thumbnail_url:'',input_name:this.options.input_name,id:'delete',required:this.options.required}));},launch_image_chooser:function(){var options={target:this.$el,input_name:this.options.input_name,suggest_crop:this.options.suggest_crop,image_width:this.options.image_width,image_height:this.options.image_height};if(this.options.admin_view){var image_chooser_popup=new ss.views.AdminFormImageChooserPopup(options);}else{var image_chooser_popup=new ss.views.UserFormImageChooserPopup(options);}}});ss.views.ImageChooserPopup=ss.views.Popup.extend({template:editor_template('.image-chooser-template'),image_panel_template:editor_template('.image-panel-template'),image_thumb_template:editor_template('.image-panel-image-template'),upload_section_template:editor_template('.uploader'),selected_image_display_template:editor_template('.selected-image-template'),title:'Upload an Image',width:dialog_width,show_alignment:false,resizable:false,events:{'click .img-chooser-thumbnail':'image_selected','click .edit-image':'edit_image','click .alignment':'alignment_changed'},after_initialize:function(options){this.uploading=false;this.posted_images=new ss.models.PostedImageCollection();this.images={};this.selected_image={};},popup_opened:function(data){this.render_images_panel();this.posted_images.fetch({success:this.render_images});},render_menu:function(){var $menu_section=this.$('.menu-panel');$menu_section.html(this.menu_template());},build_simple_image_obj:function(image){var thumbnail_url=image.build_image_url({width:100,height:100});var src=image.build_image_url();return{'thumbnail_url':thumbnail_url,'src':src,'id':image.id,'width':image.get('width'),'height':image.get('height')};},render_images:function(){var $image_panel=$('.image-panel-images');$image_panel.empty();if(this.posted_images.models.length<1){$image_panel.append('No images uploaded yet.');}else{_.each(this.posted_images.models,function(image){var simple_image=this.build_simple_image_obj(image);this.images[image.id]=simple_image;var $image=this.image_thumb_template(simple_image);$image_panel.append($image);}.bind(this));}
$("img.lazy").lazyload({effect:"fadeIn",container:$('.image-panel-images')});this.after_render_images();},render_upload_section:function(){var self=this;var $upload_section=this.$('.upload-section');$upload_section.html(this.upload_section_template({uploading:this.uploading}));require(['fileupload'],function(fileupload){this.$('.fileupload').fileupload({url:'/silkcon/blueimp_upload',add:function(e,data){var uploadFile=data.files[0];if(!(/\.(gif|jpg|jpeg|tiff|png)$/i).test(uploadFile.name)){alert('Tried to upload an invalid file type. Please upload an image.');return false;}
self.uploading=true;self.render_upload_section();var jqXHR=data.submit().success(self.bluimp_image_upload_success).error(self.upload_error);}});});},feather_editor_image_upload_success:function(result){this.uploading=false;this.add_image(result);},bluimp_image_upload_success:function(result){this.uploading=false;this.add_image(result);},add_image:function(result){var result=result[0];var image_id=result.id;var newImage=new ss.models.PostedImage(result);this.posted_images.add(newImage,{at:0});this.images[image_id]=this.build_simple_image_obj(newImage);this.render_images();this.render_upload_section();this.selected_image=this.images[image_id];this.display_selected_image();},image_selected:function(event){$('.selected-image').removeClass('selected-image');$(event.target).addClass('selected-image');var image_id=$(event.target).data('id');this.selected_image=this.images[image_id];this.display_selected_image();},display_selected_image:function(){var image=this.selected_image;$('.selected-image-section').html(this.selected_image_display_template({src:image.src,thumbnail_url:image.thumbnail_url,alignment:image.alignment,model:image,width:image.width,height:image.height,show_alignment:this.show_alignment,suggest_crop:this.options.suggest_crop,recommended_width:this.options.image_width,recommended_height:this.options.image_height}));},alignment_changed:function(event){var $button=$(event.target);this.selected_image.alignment=$button.val();$button.siblings().removeClass('active');$button.addClass('active');},edit_image:function(event){var image_id=$(event.target).data('image_id');var image_src=$(event.target).data('image_src');this.open_editor(image_id,image_src);},open_editor:function(image_id,image_src){var featherOptions={};if(this.options.suggest_crop){featherOptions['forceCropPreset']=['Recommended Crop',this.options.image_width+'x'+this.options.image_height];featherOptions['forceCropMessage']='Crop this picture to recommended dimensions. Regardless of how you '+'stretch out the crop, the image will still be '+
this.options.image_width+'px x '+this.options.image_height+'px.';}
featherEditorInstance(image_id,image_src,this.feather_editor_image_upload_success,featherOptions);},render_images_panel:function(){var $main_panel=$('.main-panel');$main_panel.html(this.image_panel_template());this.render_upload_section();},after_render_images:function(){return;},fetch_images:function(){this.posted_images.fetch({success:this.render_images});},get_edit_element:function(){var e=this.options.event;return e&&e.data&&e.data.element;},save:function(){},buttons:function(){return[{text:'Cancel',click:this.hide_dialog},{text:'Ok',click:this.save}];}});ss.views.AdminFormImageChooserPopup=ss.views.FormImageChooserPopup=ss.views.ImageChooserPopup.extend({return_val_template:editor_template('.form-return-values'),save:function(){this.return_form_image();},return_form_image:function(){var image=this.selected_image;var target=this.options.target;$(target).html(this.return_val_template({id:image.id,src:image.src,thumbnail_url:image.thumbnail_url,input_name:this.options.input_name}));this.hide_dialog();}});ss.views.UserFormImageChooserPopup=ss.views.FormImageChooserPopup.extend({template:editor_template('.user-image-chooser-template'),image_panel_template:editor_template('.user-image-panel-template'),return_val_template:editor_template('.form-return-values'),width:340,popup_opened:function(data){var $main_panel=$('.main-panel');var show_crop_warning=this.options.suggest_crop?true:false;$main_panel.html(this.image_panel_template({show_crop_warning:show_crop_warning,recommended_width:this.options.image_width,recommended_height:this.options.image_height}));this.render_upload_section();}});ss.views.InsertImagePopup=ss.views.ImageChooserPopup.extend({return_val_template:editor_template('.form-return-values'),alignments_to_classes:{'left':'pull-left','center':'center-block','right':'pull-right'},show_alignment:true,save:function(){this.insert_image();},insert_image:function(){var alignment=this.selected_image.alignment?this.alignments_to_classes[this.selected_image.alignment]:'pull-left';var url=this.selected_image.src;console.log('editor: ',this.options.editor);this.options.editor.insertHtml('<img class="'+alignment+' img-responsive" src="'+url+'">');this.hide_dialog();},after_render_images:function(){var element=this.get_edit_element();var alignment=this.get_element_alignment();var src=element&&element.getAttribute('src');var thumbnail_url=null;if(src){thumbnail_url=src.replace(/\/[0-9]*x[0-9]*$/,'/100x100');}
this.selected_image={id:'temp',src:src,alignment:alignment,thumbnail_url:thumbnail_url};this.display_selected_image();},get_edit_element:function(){var e=this.options.event;return e&&e.data&&e.data.element;},get_element_alignment:function(){var element=this.get_edit_element();var alignment='center';if(element&&_.string.contains(element.getAttribute('class'),'pull-right')){alignment='right';}
if(element&&_.string.contains(element.getAttribute('class'),'pull-left')){alignment='left';}
return alignment;}});});;;$(function(){ss.CKEditor=Backbone.View.extend({initialize:function(options){var self=this;options.fullPage=(typeof options.fullPage==='undefined')?false:options.fullPage;options.hiddenInput=(typeof options.hiddenInput==='undefined')?true:options.hiddenInput;options.bodyClass=(typeof options.bodyClass==='undefined')?'richtext':options.bodyClass;this.editor_ready=false;options.content=(typeof options.content==='undefined')?this.$el.html():options.content;_.bindAll(this);ss_require(ss.require.ckeditor,function(module){initialize_plugins();self.render();});},render:function(){var content=this.options.content;if(this.options.hiddenInput){this.$hidden=$('<input type="hidden" class="hidden-richtext">');this.$hidden.attr('name',this.options.name);this.$hidden.attr('data-name',this.options.name);this.$hidden.insertAfter(this.$el);this.$hidden.val(this.options.content);this.$hidden.data('ckeditor',this);}
var extra_plugins=this.$el.data('extra_plugins');if(extra_plugins&&extra_plugins.length>0)
config.extraPlugins+=','+extra_plugins;var fixed_offset=this.$el.data('fixed_offset');var id='ck_'+ss.fn.guid();var $editor=$('<div>',{id:id});$editor.insertAfter(this.$el);this.$el.remove();config.bodyClass=this.options.bodyClass;config.fullPage=this.options.fullPage;if(this.options.fullPage){this.editor=CKEDITOR.replace(id,config,content);this.editor.setData(content);}else{$editor.html(this.options.content);$editor.attr('contenteditable','true');this.editor=CKEDITOR.inline(id,config,content);this.editor.on('instanceReady',function(ev){var editor=ev.editor;editor.setReadOnly(false);});this.editor.setData(content);}
xxx_ckeditor=this.editor;CKEDITOR.on('currentInstance',this.editor_changed);this.editor.on('blur',this.editor_blur);this.editor.on('ariaWidget',function(event){xxx_ckevent=event;safe_log('ariaWidget',event);});this.editor.on('ariaWidget',this.decorate_editor);this.editor.on('change',this.update_hidden);CKEDITOR.on('ariaWidget',this.instance_ready);this.editor.on('dataReady',function(event){xxx_ckevent=event;safe_log('dataReady',event);});this.editor.on('dataReady',this.decorate_editor);this.editor.fixed_offset=fixed_offset;CKEDITOR.on('instanceReady',this.instance_ready);CKEDITOR.on('dialogDefinition',function(ev){var dialogName=ev.data.name;var dialogDefinition=ev.data.definition;if(dialogName==='table'){var info=dialogDefinition.getContents('info');info.get('txtWidth')['default']='';var addCssClass=dialogDefinition.getContents('advanced').get('advCSSClasses');addCssClass['default']='table table-bordered';}});},decorate_editor:function(event){safe_log('Decorating editor',event);if(this.editor._decorated){return;}
css_file=get_css_url();var screen_href=$('link[rel=stylesheet][href$="'+css_file+'"]').attr('href');var style_sheet='<link rel="stylesheet" href="'+screen_href.replace(css_file,'ckeditor.css')+'">';if(this.editor.document){var editor_document=this.editor.document;editor_document.getHead().appendHtml(style_sheet);if(this.options.fullPage){editor_document.getBody().addClass(this.options.bodyClass);}}else{var $iframe=$(event.data.$);xxx_$=$iframe;$iframe.contents().find('head').append(style_sheet);if(this.options.fullPage){$iframe.contents().find('body').addClass(this.options.bodyClass);}}
this.editor._decorated=true;},instance_ready:function(event){safe_log('CKEditor instance ready',event,event.editor);this.editor_ready=true;xxx_ckevent=event;if(this.editor===event.editor){safe_log('Editor matches',event,event.editor);this.decorate_editor();}},editor_changed:function(event){safe_log('Editor changed?',event,event.editor);xxx_ckevent=event;},editor_blur:function(event){safe_log('Editor blur?',event,event.editor);xxx_ckevent=event;this.update_hidden();if(this.options.on_blur){this.options.on_blur();}},get_data:function(){return this.editor.getData();},update_hidden:function(){if(this.options.hiddenInput){this.$hidden.val(this.editor.getData()).change();}
if(this.options.on_change){this.options.on_change(this.editor.getData());}},cleanup:function(){}});function get_css_url(){if($('html.admin-page').length>0){var css_name='onepage_screen.css';}else if($('html.site-creation-page').length>0){var css_name='ss_signup.css';}else{var css_name=ss.config.THEME_CONFIG.ckeditor_css_replacement;}
return css_name;}
css_file=get_css_url();var screen_href=$('link[rel=stylesheet][href$="'+css_file+'"]').attr('href');var style_sheet_css=screen_href.replace(css_file,'ckeditor.css');var config={toolbar:'Full',contentsCss:style_sheet_css,extraPlugins:'fileUpload,generic,sourcedialog,autogrow,justify,font,div,selectall,tabletools,dialogadvtab,fakeobjects,iframe',removePlugins:'image,stylescombo',justifyClasses:['align-left','align-center','align-right','align-justify'],extraAllowedContent:'img[alt,!src,width,height](pull-right,pull-left,image-center),p(align-right,align-left,align-center,align-justify)'};config.removeButtons='Scayt';config.allowedContent=true;config.autoGrow_onStartup=true;config.resize_dir='both';config.toolbar_Limited=[['Sourcedialog'],['Bold','Italic','Underline','Strike','-','Subscript','Superscript'],['Link','Unlink','Anchor'],['Styles','Format','Font','FontSize'],['FileUpload'],];config.toolbar_Full=[['Sourcedialog'],['Cut','Copy','Paste','PasteText','PasteFromWord','-','Print','SpellChecker','Scayt'],['Undo','Redo','-','Find','Replace','-','SelectAll','RemoveFormat'],['Bold','Italic','Underline','Strike','-','Subscript','Superscript'],'/',['NumberedList','BulletedList','-','Outdent','Indent','Blockquote','CreateDiv'],['JustifyLeft','JustifyCenter','JustifyRight','JustifyBlock'],['Link','Unlink','Anchor'],['Table','HorizontalRule','SpecialChar'],'/',['Format','Font'],['FileUpload','Iframe'],];config.protectedSource=[];config.protectedSource.push(/<i[^>]*><\/i>/g);var initialized=false;var initialize_plugins=function(){if(initialized){return;}
initialized=true;CKEDITOR.plugins.add('generic',{init:function(editor){editor.ui.addButton&&editor.ui.addButton('HorizontalRule',{label:editor.lang.horizontalrule.toolbar,command:'horizontalrule',toolbar:'horizontalrule'});}});CKEDITOR.plugins.add('fileUpload',{init:function(editor){editor.ui.addButton('FileUpload',{label:'Upload images',toolbar:'FileUploadGroup',command:'insertImage',icon:'image'});var allowed='img[alt,height,width,!src]{class}';var required='img[src]';var image_popup=function(editor,event){var dialog=new ss.views.InsertImagePopup({editor:editor,event:event});};editor.addCommand('insertImage',{exec:image_popup,allowedContent:allowed,requiredContent:required,});editor.on('doubleclick',function(event){var element=event.data.element;xxx_event=event;if(element.is('img')&&!element.data('cke-realelement')&&!element.isReadOnly()){event.stop();safe_log('Image clicked');image_popup(editor,event);}});}});};$('.ckeditor_input').livequery(function(){var $el=$(this);var content=$el.html();var name=$el.attr('name');new ss.CKEditor({el:$(this),content:content,name:name});});});;;$(function(){ss.navigation_bar=ss.navigation_bar||{};ss.models.AppModel=Backbone.Model.extend({defaults:function(){return{title:null,item_name:null,asset_name:null,default_sorting:null,enabled:false,banner_image:null,child_assets:[],may_be_enabled:true};},initialize:function(options){options=options||{};var banner_image=new ss.models.Image(options.banner_image);this.set({banner_image:banner_image});},is_content_app:function(){return this.get('content');},is_feed_app:function(){return this.get('feed');},is_member_app:function(){return this.get('member');},is_group_app:function(){return this.get('groupish');},is_payment_app:function(){return this.get('paymentish');},is_communication_app:function(){return this.get('communication');},is_active:function(){return this.get('enabled');},child_asset_enabled:function(asset_name){return _.indexOf(this.get('child_assets')||[],asset_name)!==-1;}});ss.models.AppCollection=Backbone.Collection.extend({model:ss.models.AppModel,fetch_by_name:function(app_name){var matching=this.where({'asset_name':app_name});if(matching.length===0){throw'No app named '+app_name+' found.';}
return matching[0];}});ss.models.MediaNavBarItem=Backbone.Model.extend({initialize:function(options){options=options||{};var image=new ss.models.Image(options.image);this.set({image:image});}});ss.models.MediaNavBarItemCollection=ss.models.CollectionField.extend({model:ss.models.MediaNavBarItem});var AUTOCOMPLETE_CURRENT_CHAPTER_ONLY='current_chapter_only';var AUTOCOMPLETE_ALL_CHAPTERS='all_chapters';ss.models.Network=Backbone.Model.extend({urlRoot:'/v2/networks',defaults:function(){return{apps:null};},initialize:function(options){options=options||{};var apps=new ss.models.AppCollection();apps.reset(options.apps);this.set({apps:apps});var media_header_links=new ss.models.CollectionField(options.media_header_link);this.set({media_header_link:media_header_links});var media_header_icons=new ss.models.MediaNavBarItemCollection(options.media_header_icons);this.set({media_header_icons:media_header_icons});var logo=new ss.models.Image(options.logo);this.set({logo:logo});var footer_logo=new ss.models.Image(options.footer_logo);this.set({footer_logo:footer_logo});var default_banner=new ss.models.Image(options.default_banner);this.set({default_banner:default_banner});var favicon_file=new ss.models.File(options.favicon_file);this.set({favicon_file:favicon_file});},individual_member_numbers_enabled:function(){return ss.data.network.get('member_number_enabled')&&ss.data.network.get('member_number_user_enabled');},organization_member_numbers_enabled:function(){return ss.data.network.get('member_number_enabled')&&ss.data.network.get('member_number_company_enabled');},app:function(app_name){return this.get('apps').where({asset_name:app_name})[0];},get_currency_name:function(){var currency=this.get('default_currency');return{'C':'Canadian Dollar','USD':'US Dollar','GBP':'United Kingdom Pound','AUD':'Australian Dollar'}[currency]||currency;},get_transaction_autocomplete_options:function(){return[{label:"Members of the Current Chapter",value:AUTOCOMPLETE_CURRENT_CHAPTER_ONLY},{label:"Members of All Chapters",value:AUTOCOMPLETE_ALL_CHAPTERS}];}});ss.models.Network.AUTOCOMPLETE_CURRENT_CHAPTER_ONLY='current_chapter_only';ss.models.Network.AUTOCOMPLETE_ALL_CHAPTERS='all_chapters';ss.models.ComponentConfiguration=Backbone.Model.extend({defaults:function(){return{field_info_id:null};}});ss.models.ComponentConfigurationCollection=Backbone.Collection.extend({model:ss.models.ComponentConfiguration});ss.models.NetworkConfiguration=Backbone.Model.extend({initialize:function(options){var components=new ss.models.ComponentConfigurationCollection();components.reset(options.components);this.set({components:components});}});ss.models.NetworkConfigurationCollection=Backbone.Collection.extend({url:'/v2/network_configurations',model:ss.models.NetworkConfiguration,get_menus:function(){return this.where({config_key:'nav_menu'});},get_field_info_ids_for_asset:function(asset_key){var subset=this.where({asset_key:asset_key});var ids=[];_.each(subset,function(configuration){configuration.get('components').each(function(component){var id=component.get('field_info_id');if(!_.contains(ids,id)){ids.push(id);}});});return ids;}});ss.models.CustomizableSection=Backbone.Model.extend({initialize:function(options){if(options.network_configuration){this.set({network_configuration:new ss.models.NetworkConfiguration(options.network_configuration)});}
if(options.subsections){var subsections=_.map(options.subsections,function(subsection){return new ss.models.CustomizableSection(subsection);});this.set({subsections:subsections});}}});ss.models.CustomizableSectionCollection=Backbone.Collection.extend({model:ss.models.CustomizableSection});ss.models.UserCategory=Backbone.Model.extend({});ss.models.UserCategoryCollection=Backbone.Collection.extend({model:ss.models.UserCategory});ss.models.MemberType=Backbone.Model.extend({});ss.models.MemberTypeCollection=Backbone.Collection.extend({model:ss.models.MemberType});ss.models.NetworkPlan=Backbone.Model.extend({initialize:function(options){_.bindAll(this);},is_feature_enabled:function(feature){if(this.get('full_access')){return true;}
return _.contains(this.get('features'),feature);},get_upgrade_plan_for_feature:function(feature){return null;},is_invoicing_enabled:function(){return this.is_feature_enabled('invoicing');},are_companies_enabled:function(){return this.is_feature_enabled('companies');},are_pages_enabled:function(){return this.is_feature_enabled('custom_pages');},are_reports_enabled:function(){return this.is_feature_enabled('reports_enabled');},is_fremium:function(){return!this.get('full_access');}});ss.models.NetworkPlanCollection=Backbone.Collection.extend({model:ss.models.NetworkPlan});ss.models.NetworkSubscription=Backbone.Model.extend({initialize:function(options){_.bindAll(this);}});ss.models.NetworkSubscriptionCollection=Backbone.Collection.extend({model:ss.models.NetworkSubscription});ss.models.NavigationBarItem=Backbone.Model.extend({defaults:function(){return{index:1,label:null,url:null,children:null,color:null,open_in_new_tab:null};},initialize:function(attributes,options){var children=_.map(attributes.children,function(element){return new ss.models.NavigationBarItem(element);});sorted_children=_.sortBy(children,function(element){return element.attributes.index;});this.attributes.children=new Backbone.Collection(sorted_children);}});ss.models.NavigationBarItemCollection=Backbone.Collection.extend({model:ss.models.NavigationBarItem});ss.models.NavigationBar=Backbone.Model.extend({urlRoot:'/v2/navigation_bars',defaults:function(){return{name:'',plan_categories:[]};},initialize:function(options){_.bindAll(this);this.fix_items();},fix_items:function(){var item_array=this.get('items');if(!_.isArray(item_array)){return;}
var items=new ss.models.NavigationBarItemCollection();items.reset(item_array);this.set({items:items});},parse:function(response){var item_array=response.items||[];var items=new ss.models.NavigationBarItemCollection();items.reset(item_array);response.items=items;return response;},save_categories:function(){var data={plan_categories:this.get('plan_categories')};var data_string=JSON.stringify(data);$.ajax({type:'PUT',url:this.url(),data:data_string});}});ss.models.NavigationBarCollection=Backbone.Collection.extend({url:'/v2/navigation_bars',model:ss.models.NavigationBar,comparator:function(item){return item.id;}});ss.navigation_bar.category_map={active_members:{label:'Active Members',child_categories:function(plans){var plan_categories=plans.pluck('id');return plan_categories;}},inactive_members:{label:'Guests, Non-members and Expired Members',child_categories:['not_logged_in','logged_in']},admins:{label:'Admins'},not_logged_in:{label:'Guests ( not signed in)'},logged_in:{label:'Non-members (signed in), Expired Members'}};ss.models.NavigationPlanCategory=Backbone.Model.extend({initialize:function(options){_.bindAll(this);},get_details:function(){return ss.navigation_bar.category_map[this.get('category')];},get_name:function(){var plan=this.get('plan');if(plan){return plan.get('name');}
var details=this.get_details();if(details){return details.label;}
return this.get('category');},can_be_split:function(){var subcategories=this.get_subcategories();return subcategories&&subcategories.length;},get_subcategories:function(){var details=this.get_details();if(!details||!details.child_categories){return;}
var child_categories=details.child_categories;if(_.isFunction(child_categories)){return child_categories(this.get('plans'));}
return child_categories;}});ss.models.Feature=Backbone.Model.extend({initialize:function(options){_.bindAll(this);},is_enabled:function(){return ss.data.network_plan.is_feature_enabled(this.get('key'));},get_upgrade_plan:function(){}});ss.features=ss.features||{};});;;$(function(){ss.models.FIELD_TYPES={text:'Text',textarea:'Multi Line Text',numeric:'Number',select:'Dropdown list',radio_list:'Radio List',checkbox_list:'Checkbox List',checkbox:'Checkbox',file_upload:'File Upload',date:'Date',multiselect:'Multiselect',hidden:'Hidden',separator:'(Separator)'};ss.models.FieldInfo=ss.models.FieldInfoModel=Backbone.Model.extend({defaults:function(){return{label:null,field_type:null,data_type:null};},get_field_path:function(){if(this.get('path')){return this.get('path');}
var field_type=this.get('field_type');var prefix='additional_info';if(field_type==='image_upload'||field_type==='file_upload'){prefix='files';}
var id=this.get('permaid')||this.get('id');return prefix+'.'+id;},requires_options:function(){return _.contains(['select','checkbox_list','radio_list','multiselect'],this.get('field_type'));},show_limit:function(){return _.contains(['multiselect'],this.get('field_type'));}});ss.models.FieldInfoCollection=Backbone.Collection.extend({url:'/field_info/all',"model":ss.models.FieldInfoModel,comparator:function(field_info){return field_info.get('label');},as_options:function(options){options=options||{};var matching=this.filter(function(field_info){if(!options.include_hidden&&field_info.get('hide_from_listing')){return false;}
if(options.asset_name){if(field_info.get('path')&&field_info.get('asset_key')!==options.asset_name){return false;}}
return true;});return _.map(matching,function(field_info){return{label:field_info.get('label'),value:field_info.get('id')};});}});});;;$(function(){ss.views.FieldListView=Backbone.View.extend({events:{'click .add-field-js':'add_field_clicked'},initialize:function(options){_.bindAll(this);this.model.bind('change add remove',this.collection_changed);},render:function(){var template=_.template($(".custom_field_templates .custom_field_list").html());var view=this;this.$el.empty().append(template());this.model.each(function(component_configuration){var field_view=new ss.views.ChooseFieldView({model:component_configuration,component_configuration_list:view.model,field_infos:view.options.field_infos});view.$('.field-list-js').append(field_view.el);field_view.render();});this.update_hidden_value();},update_hidden_value:function(){this.$('.hidden-state-js').remove();var hidden_state=$('<input class="hidden-state-js" type="hidden" name="'+this.options.hidden_field_name+'">');hidden_state.val(JSON.stringify(this.model.toJSON()));this.$el.append(hidden_state);},collection_changed:function(){safe_log('collection changed');this.update_hidden_value();},add_field_clicked:function(event){event.preventDefault();this.model.add({});this.render();safe_log(this.model);}});ss.views.ChooseFieldView=Backbone.View.extend({events:{'change select':'data_changed','click .remove-button':'remove_field'},tagName:'li',className:'field-row',initialize:function(options){_.bindAll(this);},render:function(){var template=_.template($(".custom_field_templates .custom_field_row").html());var context=this.model.toJSON();context.field_infos=this.options.field_infos;this.$el.append(template(context));safe_log('Rendered row',this.$el);safe_log(this.$el.closest('.field-list-js'));},remove_field:function(){this.options.component_configuration_list.remove(this.model);this.$el.remove();},data_changed:function(event){var $input=$(event.target);var data={};data[$input.data('field')]=$input.val();this.model.set(data);safe_log('field_info changed in model',data,this.model);}});ss.views.FieldFillView=Backbone.View.extend({events:{},tagName:'div',className:'field',initialize:function(options){_.bindAll(this);},val:function(){return this.options.target.get('fields')[this.model.get('permaid')];},render:function(){this.$el.empty();var field_type=this.model.get('field_type');var required=this.model.get('required');var required_marker=required?'<i class="required_marker"></i>':'';var $label=$('<label>'+this.model.get('label')+required_marker+':</label>');var builder=this['build_'+field_type];if(!builder){sadness.fail;}
var $input=builder();if(required){$input.addClass("required");}
this.$el.append($label).append($input);},render_validation:function(){this.$(".required").each(function(i,elem){var $elem=$(elem);if(!$elem.val()){$elem.after('<span class="alert alert-error">Required</span>');}});},build_text:function(){var $input=$('<input type="text">');var val=this.val();if(val){$input.val(val);}
$input.change(this.data_changed);return $input;},build_radio_list:function(){var $input=$('<span class="radio">');var permaid=this.model.get('permaid');var view=this;_.each(this.model.get('options'),function(option){var checked=view.val()===option.value;$input.append($('<label class="radio_label">').text(option.label).prepend($('<input type="radio">').val(option.value).prop('checked',checked).attr('name',permaid)));});$input.find('input').change(function(event){var value;$input.find('input:checked').each(function(index,checkbox){value=$(checkbox).val();});view.update_data(value);});return $input;},build_select:function(){var permaid=this.model.get('permaid');var $select=$('<select>').attr('name',permaid);_.each(this.model.get('options'),function(option){$select.append($('<option>').val(option.value).text(option.label))});$select.val(this.val());var $input=$('<span>').addClass('select_option').append($select);$input.change(this.data_changed);return $input;},build_numeric:function(){var $input=this.build_text();$input.addClass('number');return $input;},build_checkbox:function(){var $input=$('<input type="checkbox">');var val=this.val();if(val){$input.prop('checked',true);}
var view=this;$input.change(function(event){var value=$input.prop('checked')?true:false;view.update_data(value);});return $input;},build_checkbox_list:function(){var $input=$('<span class="checkbox_list">');var permaid=this.model.get('permaid');var view=this;_.each(this.model.get('options'),function(option){var checked=_.indexOf(view.val(),option.value)>=0;$input.append($('<label class="checkbox_label">').text(option.label).prepend($('<input type="checkbox">').val(option.value).prop('checked',checked).attr('name',permaid)));});$input.find('input').change(function(event){var values=[];$input.find('input:checked').each(function(index,checkbox){values.push($(checkbox).val());});view.update_data(values);});return $input;},update_data:function(value){var permaid=this.model.get('permaid');safe_log('Updating',permaid,this.val(),' to ',value);this.options.target.get('fields')[permaid]=value;},data_changed:function(event){this.update_data($(event.target).val());}});});;;$(function(){ss.models.PdfReaderModel=Backbone.Model.extend({defaults:function(){return{'can_display':true,'pdf_url':null,'pdf_download_url':null,'page_number':1,'total_pages':null,'pdf_doc':null};}});});;;$(function(){ss.views.PdfReaderView=Backbone.View.extend({template:_.template($('#pdf_reader_view').html()),turning_page:false,className:"pdf_reader",events:{"click .next":"next_page","click .previous":"previous_page"},initialize:function(options){_.bindAll(this);var context=this;var can_display=!$.browser.msie;this.model.set({"can_display":can_display});ss_require(["/res/js/os/pdf.js"],function(module){context.render();});this.model.on("change:page_number change:total_pages",this._render_page_numbers);},render:function(){var context=this;$(this.el).html(this.template(this.model.toJSON()));if(this.model.get("can_display")){PDFJS.disableWorker=true;PDFJS.getDocument(this.model.get("pdf_url")).then(function(_pdf_doc){context.model.set({'pdf_doc':_pdf_doc});context.model.set({'total_pages':_pdf_doc.numPages});context.$(".loading_dark_background_large").removeClass("loading_dark_background_large");});}},next_page:function(){if(!this.turning_page){var page_number=this.model.get("page_number");var total_pages=this.model.get("total_pages");if(page_number<total_pages){this.model.set({"page_number":page_number+1});}}},previous_page:function(){if(!this.turning_page){var page_number=this.model.get("page_number");if(page_number>1){this.model.set({"page_number":page_number-1});}}},_render_page:function(num){this.turning_page=true;var context=this;var scale=1.3;var canvas=this.$("canvas")[0];var ctx=canvas.getContext('2d');this.model.get("pdf_doc").getPage(num).then(function(page){var viewport=page.getViewport(scale);canvas.height=viewport.height;canvas.width=viewport.width;var render_context={canvasContext:ctx,viewport:viewport};page.render(render_context).then(function(){context.turning_page=false;});});},_render_page_numbers:function(){var page_number=this.model.get("page_number");var total_pages=this.model.get("total_pages");var previous_button=this.$(".previous");var next_button=this.$(".next");this._render_page(page_number);this.$(".current_page").text(page_number);this.$(".total_pages").text(total_pages);if(total_pages==1){previous_button.prop("disabled",true);next_button.prop("disabled",true);}else if(page_number==total_pages){previous_button.prop("disabled",false);next_button.prop("disabled",true);}else if(page_number==1){previous_button.prop("disabled",true);next_button.prop("disabled",false);}else{previous_button.prop("disabled",false);next_button.prop("disabled",false);}
this.$(".pages").show();this.$(".pdf_toolbar").show();}});});;;$(function(){ss.models.ItemFilters=ss.models.ItemFiltersModel=Backbone.Model.extend({defaults:function(){return{"filters":null,"field_infos":null,"all_fields":null};}});ss.models.ItemFilter=ss.models.ItemFilterModel=Backbone.Model.extend({defaults:function(){return{label:null,"key":null,"field_id":null,"filter_type":null,"min_range":null,"max_range":null,"value":null};}});ss.models.ItemFilterCollection=Backbone.Collection.extend({"model":ss.models.ItemFilterModel});});;;$(function(){var filter_template=ss.fn.make_compile_template('.filter-templates');ss.views.ItemFiltersView=Backbone.View.extend({template:filter_template('#item_filters'),events:{},initialize:function(options){this.model.bind('filter_removed',this.refresh,this);_.bindAll(this);this.needs_rendering=true;this.render();},refresh:function(){this.needs_rendering=true;this.render();},render:function(){if(!this.can_display()){$(this.el).hide();return;}
$(this.el).show();if(!this.needs_rendering){return;}
this.needs_rendering=false;var filters=this.model.get('filters');if(this.options.add_new_el){this.add_new_el=this.options.add_new_el;this.item_filters_el=this.options.item_filters_el;this.item_filters_el.empty();var $filter_wrapper=this.item_filters_el.closest('.panel-filters');if(filters.length){$filter_wrapper.show();}else{$filter_wrapper.hide();}}else{$(this.el).html(this.template());this.add_new_el=this.$('.add_new_filter_js');this.item_filters_el=this.$('.item_filters');}
this.add_new_el.off('change',this.add_new_filter);this.add_new_el.on('change',this.add_new_filter);this.fill_new_filter_options();filters.each(this.render_filter);this.trigger('filters_rendered');},fill_new_filter_options:function(){var $add_new=this.add_new_el,model=this.model;$add_new.html('');$add_new.append($('<option>').text(this.options.add_new_text||''));safe_log('Adding options',this.model.get('all_fields'));var get_label=function(field){return field.get('label');};var added_filters=[];_.each(_.sortBy(this.model.get("all_fields"),get_label),function(field,index){var field_infos=model.get('field_infos');var field_info=field_infos.get(field.get('field_id'));if(!field_info){safe_log('No field found for',field.get('field_id'),field_infos,'when adding filters');return;}
var field_id=field.get('field_id');var data_type=field_info.get('data_type');var filter_already_added=model.get('filters').any(function(filter){return filter.get('field_id')===field_id;});filter_already_added=filter_already_added||_.contains(added_filters,field_id);if($('#item_'+data_type+'_filter_options').length&&!filter_already_added){$add_new.append('<option value="'+field_id+'">'+field.get('label'));added_filters.push(field_id);}else{safe_log('skipped adding a filter for ',data_type,field_info);}});},render_filter:function(filter){var filter_view=new ss.views.ItemFilterView({model:filter,parent_model:this.model});this.item_filters_el.append(filter_view.el);},add_new_filter:function(event){var field_id=$(event.target).val();if(field_id=="...add a filter"){return;}
var filter=new ss.models.ItemFilterModel({field_id:field_id});this.model.get('filters').add(filter);this.refresh();this.model.trigger('filters_changed');},can_display:function(){if(this.options.can_display){return this.options.can_display();}else{return true;}}});ss.views.ItemFilterView=Backbone.View.extend({tagName:'li',template:filter_template('#item_filter_row'),className:'filter-list-item',events:{'change .numeric_filter_type_js':'numeric_filter_type_changed','change .date_filter_type':'date_filter_type_changed','change .date_input':'date_changed','change :input':'content_changed','click .remove_filter':'remove_filter'},initialize:function(options){_.bindAll(this);if(!options.model.get('field_id')){debugger;}
if(this.model.get('start_date')){this.model.set({filter_type:'custom'});}
this.render();},refresh:function(){this.render();},render:function(){var $el=$(this.el),field_id=this.model.get('field_id'),field_infos=this.options.parent_model.get('field_infos'),field_info=field_infos.get(field_id);if(!field_info){debugger;};var data_type=field_info.get('data_type')||'text',criteria_template=_.template($('#item_'+data_type+'_filter_options').html()),params=_.extend({},this.model.attributes,field_info.attributes),$filter_row=$(this.template(params)),criteria_section=criteria_template(params),model=this.model;safe_log('Filters, label should not equal label',params);$filter_row.find('.filter-placeholder').replaceWith(criteria_section);$el.html($filter_row);this.$(':input').each(function(index,input){var field=$(input).data('field');if(field&&model.get(field)){$(input).val(model.get(field));}});this.content_changed({target:this.$('.filter_type')});if(this.$('.date_filter_type').length){this.date_filter_type_changed();}},content_changed:function(event){var $target=$(event.target),field=$target.data('field'),data={};if(field){data[field]=$target.val();this.model.set(data);safe_log(field,'filter_type changed?',this.model);}
this.options.parent_model.trigger('filters_changed');safe_log('item filter view, filter_changed');},date_changed:function(event){this.$('.date_filter_type').val('custom');},numeric_filter_type_changed:function(event){var filter_type=this.$('.filter_type').val(),$criteria=this.$('.filter_criteria_js');$criteria.hide();$criteria.filter('.'+filter_type+'_js').show();},date_filter_type_changed:function(event){var filter_type=this.$('.date_filter_type').val(),today=new Date(),start_date,end_date=today,$start_date=this.$('.start_date'),$end_date=this.$('.end_date');var time_frames={last_year:[moment().subtract('years',1),moment()],last_month:[moment().subtract('months',1),moment()],next_month:[moment(),moment().add('months',1)],next_year:[moment(),moment().add('years',1)]};date_range=time_frames[filter_type||'last_year'];if(_.contains(['Recurring','Lifetime','blank'],filter_type)){$start_date.hide();$end_date.hide();}else{$start_date.show();$end_date.show();}
if(date_range){start_date=ss_format_date(date_range[0].startOf('day').toDate());end_date=ss_format_date(date_range[1].startOf('day').toDate());this.$('.start_date').val(start_date);this.$('.end_date').val(end_date);this.model.set({start_date:start_date,end_date:end_date});}},remove_filter:function(event){this.model.destroy();safe_log('item filter view, filter_changed/removed',this.options.parent_model);this.options.parent_model.trigger('filter_removed');this.options.parent_model.trigger('filters_changed');}});});;;$(function(){window.MultitableAppModel=Backbone.Model.extend({defaults:function(){return{selected:1,menu_items:{1:"Placeholder"}};}});});;;$(function(){window.MultitableAppView=Backbone.View.extend({template:_.template($('#multitable_view').html()),currentlyChangingTables:false,events:{"click .selectors a":"clickSelector"},initialize:function(options){_.bindAll(this,"selectedChanged","clickSelector");this.model.bind("change:selected",this.selectedChanged,this);var context=this;this.$(".data_table").each(function(){var $this=$(this);var resize_columns_and_height=function(){if(!$this.data("multitable.setting_width")&&$this.fnGetData){var $table_container=$this.closest(".table_container");var $data_table_wrapper=$this.parent();if($data_table_wrapper.outerHeight()>$table_container.height()){$table_container.css("min-height",$data_table_wrapper.outerHeight());}
$this.data("multitable.setting_width",true);var desired_width=context.$(".table").width();var headers=$this.find('th');var current_width=$this.width();if(current_width<desired_width){var needed=desired_width-current_width;var added_to_each=Math.floor(needed/headers.length);var extra_pixels=needed%headers.length;var hidden_correction=current_width?0:-(headers.outerWidth()-1);if(current_width==0){extra_pixels++;}
headers.each(function(){var div_for_width=$(this).children();var new_width=div_for_width.width()+added_to_each+hidden_correction;if(extra_pixels){new_width++;extra_pixels--;}
div_for_width.width(new_width);});}
$this.data("multitable.setting_width",false);}};var interval=200;var t=setInterval(function(){if($this.dataTableSettings){resize_columns_and_height();var data_table=$this.dataTable();data_table.fnSettings().aoDrawCallback.push({"sName":"multitable_col_and_height_fixer","fn":resize_columns_and_height});clearInterval(t);}},interval);});this.render();},render:function(){var $content=$(this.template(this.model.toJSON()));var $el=this.$el;var $tables=this.$(".table").detach();$el.html($content);$el.find(".table_container").html($tables);this.$(".dataTables_processing").hide();var keys=[];var selected=this.model.get("selected");var menu_items=this.model.get("menu_items");for(var i in menu_items){keys.push(i);}
this.$(".table").each(function(i){$(this).addClass("multitable_"+keys[i]);if(keys[i]==selected){$(this).addClass("selected");}});return this;},clickSelector:function(event){event.preventDefault();if(!this.currentlyChangingTables){var $target=$(event.target);var key=$target.prop("id");this.$(".selectors li").removeClass("selected");$target.closest("li").addClass("selected");this.model.set({"selected":key});}
return this;},selectedChanged:function(model,selected){var $el=this.$el;var context=this;context.currentlyChangingTables=true;var tempHeight=this.$(".table.selected").height();var current_min_height=$el.css("min-height")?parseInt($el.css("min-height"),10):0;if(current_min_height<tempHeight){$el.css("min-height",tempHeight);}
this.$(".table.selected").children().fadeOut("fast",function(){$(this).parent().removeClass("selected");context.$(".table.multitable_"+selected).addClass("selected");context.$(".table.multitable_"+selected).children().fadeIn("fast",function(){context.currentlyChangingTables=false;});});return this;}});});;;$(function(){window.InputOptionsAppModel=Backbone.Model.extend({defaults:function(){return{selected:0,inputs:$(),descriptions:[]};}});});;;$(function(){window.InputOptionsAppView=Backbone.View.extend({template:_.template($('#input_options_view').html()),className:"input_options_view",events:{"click .input_container":"_click_input_container"},initialize:function(options){_.bindAll(this,"_click_input_container");this.model=new InputOptionsAppModel({selected:0,inputs:this.$("input, select"),descriptions:this.$("span")});this.model.bind("change:selected",this.render,this);this.render();return this;},render:function(){$(this.el).html(this.template(this.model.toJSON()));var model=this.model;this.$(".input_container").each(function(i,elem){var $this=$(this);var $input=$(model.get("inputs").get(i));var $input_container=$this.find(".input_container_input");var $radio=$this.find("input[name=input_options_app_selected]");var selected=model.get("selected");if(selected==i){$input.prop("disabled",false);if($input.prop("type")!="select-one"){$input.addClass("required");}}else{$input.prop("disabled",true);$input.removeClass("required").removeClass("error");}
$input_container.empty();if(selected!=i){$input_container.html($("<div class='disabling_div'></div>"));}
$input_container.append($input);var radio_value="selected_"+$input.prop("name");$radio.prop("value",radio_value);});return this;},set_selected_option:function(selected){this.model.set({"selected":selected});},_click_input_container:function(event){var selected=$(event.target).closest(".input_container").index();this.set_selected_option(selected);}});});;;$(function(){ss.views.AutocompleteSelected=Backbone.View.extend({template:_.template($('#autocomplete_selected_view').html()),tagName:'li',className:'pill',events:{"click .remove":"remove"},initialize:function(options){_.bindAll(this);this.render();},render:function(options){$(this.el).html(this.template(this.model.toJSON()));},remove:function(){this.model.trigger('destroy',this.model,this.model.collection);}});ss.views.Autocomplete=Backbone.View.extend({template:_.template($('#autocomplete_view').html()),events:{},_enable_search:true,initialize:function(options){_.bindAll(this);var view=this;this.selected_views={};var default_options={'required':false};this.options=_.extend({},default_options,options);var self=this;if(!this.model){model_options={params:{extended_data:true}};if(options.autocomplete_for){model_options.params.autocomplete_for=options.autocomplete_for;}
this.model=new ss.models.Autocomplete(model_options);var target_type=this.options.initial_target_type||'user';this.model['set_'+target_type+'_defaults']();}
var context=this;var selected_collection=this.model.get('selected_collection');selected_collection.on('add',this.trigger_selection_changed);selected_collection.on('remove',this.trigger_selection_changed);selected_collection.on("add",this._render_selected_list);selected_collection.on("remove",this._render_selected_list);selected_collection.on("destroy",function(model,collection){delete context.selected_views[model.id];collection.remove(model);});this.render();},trigger_selection_changed:function(){var selected_collection=this.model.get('selected_collection');this.trigger('selection_changed',selected_collection);},render:function(options){var self=this;$(this.el).html(this.template(_.extend(this.model.toJSON(),{'options':this.options})));var $input=this.$('.autocomplete_input');var params=this.model.get('params');if(this.options.chapter_only)
params['chapter_only']=true;$input.autocomplete_v2({serviceUrl:this.model.get('serviceUrl'),autoSubmit:this.model.get('autoSubmit'),minChars:this.model.get('minChars'),maxHeight:this.model.get('maxHeight'),deferRequestBy:this.model.get('deferRequestBy'),width:this.model.get('width'),highlight:this.model.get('highlight'),delimiter:this.model.get('delimiter'),params:params,noCache:this.model.get('noCache'),zIndex:this.model.get('zIndex'),fnFormatResult:this._render_result,fnDecorateResponse:this._decorate_response,onSelect:this._value_selected});$input.blur(function(){$input.val('');self._enable_search=false;});$input.focus(function(){self._enable_search=true;});this._render_selected_list();},_decorate_response:function(response){if(!this._enable_search){return{suggestions:[],data:[]};}
if(this.options.decorate_response){return this.options.decorate_response(response);}
return response;},_render_result:function(value,data,currentValue){data.current_selected=currentValue;data.type=data.type||this.model.get("type");var $html=$(this.model.get("dropdown_template")({c:data}));$html.find(".highlightable").each(function(index,elem){var $elem=$(elem);var new_text=$elem.html().replace(RegExp(currentValue,'gi'),function(match,offset,original){return"<strong>"+match+"</strong>";});$elem.html(new_text);});return $html.html();},_render_selected_list:function(){var $container=this.$(".selected_container");var collection=this.model.get("selected_collection");var view;var context=this;if(collection.length>=this.model.get("max_selections")){this.$(".autocomplete_input").hide();}else{this.$(".autocomplete_input").show();}
$container.children().each(function(){$(this).detach();});collection.each(function(selected_model,index,list){if(context.selected_views[selected_model.get("id")]){view=context.selected_views[selected_model.get("id")];}else{view=new ss.views.AutocompleteSelected({model:selected_model});context.selected_views[selected_model.get("id")]=view;}
$container.append(view.$el);});},_value_selected:function(suggestion,data,elem){safe_log('Value selected',suggestion,data,elem);if(!data.image_url&&!data.id){safe_log('No Value to add');return;}
this.$(".autocomplete_input").prop("value","");var data_for_model=_.extend({},{title:suggestion,input_name:this.model.get("input_name")},data);safe_log('Triggering selected item');var model=new ss.models.AutocompleteSelected(data_for_model);this.trigger('item-selected',model);if(!this.options.transient_selections){safe_log('Adding to selected collection');this.model.get("selected_collection").add(data_for_model);}}});});;;$(function(){ss.models.AutocompleteSelected=Backbone.Model.extend({defaults:function(){return{id:'',title:'',image_url:'',member_number:'',name:'',plan_name:'',input_value:'',input_name:'',address_html:'',phone:'',fax:''};}});ss.models.AutocompleteSelectedCollection=Backbone.Collection.extend({model:ss.models.AutocompleteSelected});ss.models.Autocomplete=Backbone.Model.extend({defaults:function(){return{'type':'user','input_name':'','selected_collection':new ss.models.AutocompleteSelectedCollection(),'max_selections':1,'autoSubmit':false,'minChars':2,'maxHeight':324,'deferRequestBy':400,'width':268,'highlight':true,'delimiter':null,'params':{'limit':5},'noCache':false,'zIndex':9999,};},transaction_defaults:{'type':'transaction','minChars':1,'dropdown_template':_.template($('#autocomplete_item').html()),'placeholder':'Enter Invoice Number or Member Details','serviceUrl':'/transaction/autocomplete_v2'},invoice_defaults:{'type':'invoice','minChars':1,'dropdown_template':_.template($('#autocomplete_item').html()),'placeholder':'Enter Invoice Number or Member Name','serviceUrl':'/invoice/autocomplete_v2'},user_defaults:{'type':'user','dropdown_template':_.template($('#autocomplete_item').html()),'placeholder':'Enter Member Name or Number','serviceUrl':'/user/autocomplete_v2'},company_defaults:{'type':'company','dropdown_template':_.template($('#autocomplete_item').html()),'placeholder':'Enter Company Name or Number','serviceUrl':'/company/autocomplete_v2'},event_defaults:{'type':'event','dropdown_template':_.template($('#autocomplete_item').html()),'placeholder':'Enter the Event Name','serviceUrl':'/event/autocomplete_v2'},chapter_defaults:{'type':'network','dropdown_template':_.template($('#autocomplete_item').html()),'placeholder':'Enter the Chapter Name','serviceUrl':'/network/autocomplete_subnetworks'},cpage_defaults:{'type':'cpage','dropdown_template':_.template($('#autocomplete_item').html()),'placeholder':'Enter the Page Name or URL','serviceUrl':'/cpage/autocomplete_v2'},initialize:function(attributes,options){var defaults_to_use={};switch(this.get("type")){case'user':defaults_to_use=this.user_defaults;break;case'company':defaults_to_use=this.company_defaults;break;case'invoice':defaults_to_use=this.invoice_defaults;break;case'transaction':defaults_to_use=this.transaction_defaults;break;case'event':defaults_to_use=this.event_defaults;break;case'chapter':defaults_to_use=this.chapter_defaults;break;case'cpage':default_to_use=this.cpage_defaults;}
this.attributes=_.extend({},defaults_to_use,this.attributes);var self=this;_.each(['user','company','event','transaction','invoice','chapter','cpage'],function(target_type){self['set_'+target_type+'_defaults']=function(){_.extend(self.attributes,self[target_type+'_defaults']);};});},populate:function(ids){if(ids&&ids.length>0){var selected_collection=this.get('selected_collection');$.get(this.get('serviceUrl'),{ids:ids},function(response){var data=response.data;var suggestions=response.suggestions;for(var i=0;i<Math.min(data.length,suggestions.length);i++){var element=data[i];element.title=suggestions[i];selected_collection.add(element);}},'json');}}});});;;$(function(){window.ss=window.ss||{};window.ss.views=window.ss.views||{};window.ss.apps=window.ss.apps||{};var views=window.ss.views;ss.views.BreadCrumbs=Backbone.View.extend({events:{},initialize:function(options){this.el=$('ol.breadcrumb');this.render();},update:function(options){this.options=options;this.render();},render:function(){var $el=$(this.el);$el.empty();$el.parent().removeClass('hide-breadcrumbs');_.each(this.options.parents||[],function(parent){$el.append('<li><a href="'+parent.url+'">'+parent.title+'</a>')});$el.append('<li class="current_page">'+this.options.current)}});});;;$(function(){window.FileRow=Backbone.Model.extend({defaults:function(){return{'key':'','url':'','user_name':'','user_id':'','time':'','file_name':'','file_key':'','file_key_name':'','file_size':'','file_bucket_name':'','title':'','user_url':'','save_url':'','template_type':'normal','selected':false};}});});;;$(function(){window.FileCollection=Backbone.Collection.extend({model:FileRow,save_url:'',template_type:'normal'});});;;$(function(){window.FileRowView=Backbone.View.extend({events:{"click .delete_file":"delete_a_file"},initialize:function(options){_.bindAll(this);this.options=$.extend({'item_type':null,'dynamic_update':true},options);this.render();},delete_a_file:function(){var this_view=this;var template;template=_.template($('#deleteFile').html());var save_url=this.options.save_url||this.model.get('save_url')||window.location.pathname;var context=this;var success_fun=function(){this_view.model.destroy();};$('<div>').ssdialog({'title':'Delete a File','width':'200','save_url':save_url,'content':{'html':template(this.model.toJSON())},'buttons':{"Save":null,"Delete":function(namespace){if(context.options.dynamic_update){this[namespace]('save');}else{success_fun();}}},'success_callback':success_fun});$(".ui-dialog-buttonset button:last-child").addClass('danger');},render:function(){var $el=this.$el;var template;template=_.template($('#uploaded_file_single_view').html());var template_data=this.model.toJSON();template_data['item_type']=this.options.item_type;$el.html(template(template_data));return this;}});window.DocumentPanelView=Backbone.View.extend({events:{"click .upload_file_popup":"upload_file_popup"},initialize:function(options){this.collection.bind('change',this.render,this);this.collection.bind('add',this.render,this);this.collection.bind('remove',this.render,this);this.options=$.extend({'item_type':null,'dynamic_update':true,'heading_title':'Downloads'},options);may_modify=options['may_modify'];panel_icon_url=options['panel_icon_url'];target_type=options['target_type'];title_width=options['title_width'];this.render();},upload_file_popup:function(event){event.preventDefault();var url=ss_context.target_url+'/'+(this.options.upload_url_fragment||'upload_a_file');var save_url=this.options.save_url||this.collection.save_url||window.location.pathname;var template_type=this.collection.template_type;var this_view=this;$('.upload_file_popup').ssdialog({'title':'Upload a File','width':'300','save_url':save_url,'content':{'url':url,'refresh_on_show':true},'buttons':{"Save":null,"Upload":function(namespace){var $form=this.data(namespace)['container'].find('form');var valid_form=$form.valid();if(valid_form){this[namespace]('save');}}},'success_callback':function(response){var files=response.file_array
ss_context.file_info=files;var new_file;files.forEach(function(file){if(file['key']==response.new_file_key){file.selected=false;file.template_type=template_type;file.save_url=save_url;new_file=new FileRow(file,id=file['key'],dynamic_update=this_view.options.dynamic_update);}});this_view.collection.each(function(model){model.set({"selected":false},{"silent":true});});new_file.set({"selected":true},{"silent":true});this_view.collection.add(new_file,{at:0})}});$(".ui-dialog-buttonset button:last-child").attr('disabled','true');},render:function(){var $el=this.$el;var template;template=_.template($('#document_panel_view').html());$el.html(template({'files':this.collection.models,'heading_title':this.options.heading_title}));var container=this.$('.existing_file_div');var selected=this.collection.any(function(model){return model.get("selected");});if(!selected&&this.collection.length){this.collection.at(0).set({"selected":true},{"silent":true});}
var context=this;this.collection.each(function(model){var a_row=new FileRowView({'model':model,'el':'<li class="file_row">','item_type':context.options.item_type,save_url:context.options.save_url});container.append(a_row.el);$('.no_file_yet').html('');});return this;}});});;;$(function(){ss.models.ItemListModel=Backbone.Model.extend({defaults:function(){return{'html':'','current_page':1,'asset_type':'','num_per_list':5,'num_to_load':0,'filter':{},'sort_type':'RECENT','total_page':0,'start_with':'','total_loaded':-1,'allow_search':'True','allow_alpha':'True','search_for':''};}});ss.models.JobTypeModel=Backbone.Model.extend({urlRoot:'/asset_category/item_counts/job?parent=jobtype&item_field=job_type&sort_by_count=true',initialize:function(options){options=options||{};}});ss.models.JobTypeModelCollection=Backbone.Collection.extend({url:'/asset_category/item_counts/job?parent=jobtype&item_field=job_type&sort_by_count=true',model:ss.models.JobTypeModel});ss.models.JobCategoryModel=Backbone.Model.extend({urlRoot:'/asset_category/item_counts/job?parent=jobcategory&item_field=category&sort_by_count=true',initialize:function(options){options=options||{};}});ss.models.JobCategoryModelCollection=Backbone.Collection.extend({url:'/asset_category/item_counts/job?parent=jobcategory&item_field=category&sort_by_count=true',model:ss.models.JobCategoryModel});});;;$(function(){var pagination_template=ss.fn.make_compile_template('.directory-page-templates');ss.views.ItemListView=Backbone.View.extend({top_links_template:pagination_template('.pagination-top-links'),pagination_control_template:pagination_template('.pagination-control'),pagination_filter_buttons_template:pagination_template('.pagination-filter-buttons'),pagination_sort_buttons_template:pagination_template('.pagination-sort-buttons'),events:{"click .page":"load_page","click .alpha_filter":"load_alpha_filtered_page","keypress .goto":"bind_enter_key","click .go":"go_to_page","click .recent_filter":'load_recent_page',"change .company_user_filter":'load_company_user_filter_page',"click .directory-filter":'load_company_user_filter_page',"change .alpha_filter_select":"load_alpha_filtered_page","change .job-type-filter":"load_job_type_filtered_page","change .job-category-filter":"load_job_category_filtered_page","click .job-keyword-search":"load_job_keyword_filtered_page","click .remove-keyword-item":"clear_job_keyword","keypress .enter-keypress-trigger-button":"keyword_enter"},initialize:function(options){this.model.bind('change',this.render,this);var rerender_facets=this.render.bind(this);this.job_types=new ss.models.JobTypeModelCollection();this.job_types.fetch().then(rerender_facets);this.job_categories=new ss.models.JobCategoryModelCollection();this.job_categories.fetch().then(rerender_facets);this.autocomplete_model=new ss.models.Autocomplete({max_selections:Infinity,type:'company'});var f=(function(){return this.update_search_filter('company',jQuery.map(this.autocomplete_model.attributes.selected_collection.models,function(item){return item.id;}));}).bind(this);this.autocomplete_model.attributes.selected_collection.on('add',f);this.autocomplete_model.attributes.selected_collection.on('remove',f);var params={};var query_string=window.location.search;if(query_string.length>0){params=$.deparam(query_string.substring(1));if(typeof params.job_type==='string'){params.job_type=[params.job_type];}
if(typeof params.category==='string'){params.category=[params.category];}
if(params.category){this.update_search_filter('category',params.category);}
if(params.job_type){this.update_search_filter('job_type',params.job_type);}}
this.render();var hash=window.location.hash;if(hash){var letter=hash.charAt(1);this.load_alpha_filtered_page_by_value(letter);safe_log('Hash is: '+hash);}},load_page:function(e){window.scrollTo(0,0);var page_num=$(e.target).data('page');this.model.set({'current_page':page_num});return this;},load_alpha_filtered_page:function(e){var sort_by=($(e.target).val()=='')?$(e.target).data('value'):$(e.target).val();window.location.hash=sort_by;this.load_alpha_filtered_page_by_value(sort_by);},load_alpha_filtered_page_by_value:function(sort_by){this.model.set({'start_with':sort_by,'current_page':1,'sort_type':'featured'});return this;},load_job_keyword_filtered_page:function(e){var search_for=$("#job_keyword").val();return this.update_search_filter("searchable",search_for);},clear_job_keyword:function(e){return this.update_search_filter("searchable","");},load_recent_page:function(e){this.model.set({'sort_type':'RECENT','current_page':1,'start_with':''});return this;},load_company_user_filter_page:function(e){e.preventDefault();var search_for=$(e.target).val();if(search_for.length<=0){search_for=$(e.target).data('value');}
this.model.set({'search_for':search_for,'sort_type':'RECENT','current_page':1});return this;},load_job_type_filtered_page:function(e){e.preventDefault();return this.load_job_facet_helper("job-type-filter","job_type");},load_job_category_filtered_page:function(e){e.preventDefault();return this.load_job_facet_helper("job-category-filter","category");},load_job_facet_helper:function(className,facetName){var types=[];$("."+className).each(function(item){if($(this)[0].checked){types.push($(this).data('value'));}});return this.update_search_filter(facetName,types);},update_search_filter:function(filterName,items){safe_log('In update_search_filter for '+filterName+' with '+items);var existing_filter=this.model.get('filter');if(typeof existing_filter==='string'){existing_filter=JSON.parse(existing_filter);}
var new_filter={};jQuery.extend(new_filter,existing_filter);if(items.length!=0){new_filter[filterName]=items;}else{delete new_filter[filterName];}
if(jQuery.isEmptyObject(new_filter)){new_filter="{}";}
this.model.set({'filter':new_filter,'current_page':1});return this;},keyword_enter:function(e){if(e.keyCode===13){$(e.target).parent().find('.job-keyword-search').click();}},bind_enter_key:function(e){if(e.keyCode===13){$(e.target).parent().find('.go').click();}},go_to_page:function(e){var page_num=$(e.target).parent().parent().find('.goto').val();if(page_num&&!isNaN(page_num)){if(page_num>this.model.get('total_page')){page_num=this.model.get('total_page');}else if(page_num<1){page_num=1;}
window.scrollTo(0,0);this.model.set({'current_page':page_num});}
return this;},get_lists:function(page){var params={'num_per_list':this.model.get('num_per_list'),'num_to_load':this.model.get('num_to_load'),'asset_type':this.model.get('asset_type'),'sort_type':this.model.get('sort_type'),'filter':JSON.stringify(this.model.get('filter')),'current_page':this.model.get('current_page'),'start_with':this.model.get('start_with'),'search_for':this.model.get('search_for')};var this_func=this;var url;if(params.asset_type==='company_user'){url='/company/ajax_company_user_listing';}
else{url='/'+this.model.get('asset_type')+'/ajax_item_listing';}
$.ajax({url:url,data:params,type:'POST',success:function(response){this_func.model.set({'html':response.success.list_html,'total_page':response.success.total_page,'total_loaded':response.success.total_loaded});},error:'Querying for item list html'});},render_pagination_control:function(){var $pagination_control_block=this.$('.pagination_control');if($pagination_control_block.length!=0){var total_page=parseInt(this.model.get('total_page'));var current_page=parseInt(this.model.get('current_page'));if(total_page>1){$pagination_control_block.html(this.pagination_control_template({c:{model:this.model},'total_page':total_page,'current_page':current_page}));}else{$pagination_control_block.html("");}}},render_top_links:function(){var $top_link_block=this.$('.top_link');if($top_link_block.length!=0){var total_loaded=this.model.get('total_loaded');var asset_name=this.model.get('asset_type');var search_for=this.model.get('search_for');var hash=window.location.hash;var alphabet="ABCDEFGHIJKLMNOPQRSTUVWXYZ";alphabet=alphabet.split("");var all_filtered='active-filter';var people_filtered='';var company_filtered='';if(search_for=='user'){people_filtered='active-filter';all_filtered='';}else if(search_for=='company'){company_filtered='active-filter';all_filtered='';}
var pagination_filter_buttons=this.pagination_filter_buttons_template({'all_filtered':all_filtered,'people_filtered':people_filtered,'company_filtered':company_filtered});var alpha_filtered='active-filter';var recent_filtered='';if(this.model.get('sort_type')=='RECENT'){recent_filtered='active-filter';alpha_filtered='';}
var pagination_sort_buttons=this.pagination_sort_buttons_template({'alpha_filtered':alpha_filtered,'recent_filtered':recent_filtered});item_type_title=this.get_item_type_title(asset_name,search_for,total_loaded);var jobtypes=this.get_selected_facets(this.job_types.models,'job_type',this.model.get('filter'));var jobcategories=this.get_selected_facets(this.job_categories.models,'category',this.model.get('filter'));var filter=this.model.get('filter');if(typeof filter==="string"&&filter.indexOf('{')==0){filter=JSON.parse(filter);}
var keyword=filter.searchable;var total_found_string='Searching <i class="fa fa-spinner fa-spin"></i>';if(total_loaded>-1){var total_found_string=total_loaded+' '+item_type_title+' Found';}
$top_link_block.html(this.top_links_template({c:{model:this.model},'total_found_string':total_found_string,'hash':hash,'alphabet':alphabet,'job_types':jobtypes,'job_categories':jobcategories,'job_keyword':keyword,'pagination_filter_buttons':pagination_filter_buttons,'pagination_sort_buttons':pagination_sort_buttons}));}},get_selected_facets:function(models,facetName,filter){if(filter==='{}')filter={};var facets=jQuery.map(models,function(item){var result={};result.description=item.attributes.description;result.selected=(filter[facetName]&&filter[facetName].indexOf(result.description)>=0);result.count=item.attributes.count;return result;});return facets;},render:function(){var $el=this.$el;this.get_lists();this.$('.search_result').html(this.model.get('html'));this.render_pagination_control();this.render_top_links();safe_log('Rendering!!!',$el,this.el,this.$el);var autocomplete_view=new ss.views.Autocomplete({el:$("#autocomplete_company"),model:this.autocomplete_model});return this;},get_item_type_title:function(asset_name,search_for,total_loaded){var item_type_singular=_.string.titleize(_.string.humanize(asset_name));var item_type_plural=item_type_singular+'s';if(asset_name==='company'||asset_name==='company_user'&&search_for==='company'){if(this.model.get('filter').company_type_id){item_type_singular=this.model.get('filter').company_type_id.split('-')[0].replace(/_/g," ");item_type_plural=item_type_singular+'s';}else{item_type_singular="Company";item_type_plural="Companies";}}else if(asset_name==='company_user'){if(search_for==='user'){item_type_singular="Person";item_type_plural="People";}
else{item_type_singular="Company/Person";item_type_plural="Companies/People";}}
if(asset_name==='fund'){item_type_singular='Campaign';item_type_plural='Campaigns';}
if(total_loaded==1){return item_type_singular;}else{return item_type_plural;}}});});;;$(function(){ss.views.ItemEditApp=Backbone.View.extend({events:{},initialize:function(options){this.render();},render:function(){var $el=this.$el;}});});;;$(function(){window.TemplateListingRowModel=Backbone.Model.extend({defaults:function(){return{'html':'','index':''};}});});;;$(function(){window.TemplateListingRowCollection=Backbone.Collection.extend({model:TemplateListingRowModel});});;;$(function(){var controller_url;var existing_index;var template_function;var next_index=1;window.TemplateRowView=Backbone.View.extend({events:{"click .remove_list_row":"remove_row"},initialize:function(options){},render:function(){var $el=this.$el;$el.html(this.model.get('html'));return this;},remove_row:function(e){this.model.destroy();}});window.TemplateListingView=Backbone.View.extend({events:{"click .add_list_row":"add_row","click .remove_list_row":"remove_row",},initialize:function(options){controller_url=options.controller_url;existing_index=options.existing_index;template_function=options.template_function;this.get_existing_rows();},render:function(model){var $el=this.$el.find('.template_rows');$el.append("<li class='list_row'>"+model.get('html')+"</li>");return this;},add_row:function(e){this.get_row(next_index);next_index+=1;return this;},remove_row:function(e){var $el=this.$el.find('.template_rows');if($el.children(':visible').length>1){$(e.target).closest('.list_row').hide();$(e.target).closest('.list_row').find('.to_delete').val('True');}},get_row:function(index){var params={'index':index,'template_function':template_function};var this_func=this;$.ajax({url:controller_url+'/ajax_render_template_listing',data:params,type:'POST',success:function(response){var html;var new_row;html=response.success.html+"<span class='remove_list_row'>X</span>";new_row=new TemplateListingRowModel({'html':html});this_func.render(new_row);this_func.collection.add(new_row);},error:'Querying for template listing row'});},get_existing_rows:function(){var index;for(index in existing_index){this.get_row(existing_index[index]);}
if(existing_index.length==0)
next_index=1;else
next_index=existing_index.sort(this.sort_int)[0]+1;},sort_int:function(a,b){return b-a;}});});;;$(function(){var dialog_width=get_dialog_width();ss.views.UserSignupView=Backbone.View.extend({initialize:function(options){this.settings={title:'Sign Up',include_user_fields:true,company_fields_required:false,plan_id:null};$.extend(true,this.settings,options);},_build_url:function(prefix){prefix=prefix||'/auth/signup_window';var url=prefix+'?company_fields_required='+(this.settings.company_fields_required?'true':'')+'&plan_id='+this.settings.plan_id;return url},show_dialog:function(){var settings=this.settings;var url=this._build_url()
this.dialog=$('<div>').ssdialog({title:this.settings.title,width:dialog_width,content:{url:url},dynamic_width:true,save_button_label:'Get Started',save_callback:function(save_options){var $signup_form=$('.signup_form_js',save_options.container);var params={};$(':input',$signup_form).each(function(index,input){var $input=$(input);params[$input.attr('name')]=$input.val();});settings.save_callback({params:params,success:save_options.success,error:save_options.error});}});ss.apps.current_signup_dialog=this;},facebook_linked:function(){var url=this._build_url('/facebook/signup_window');this.dialog.ssdialog('load',url);},twitter_linked:function(){var url=this._build_url('/twitter/signup_window');this.dialog.ssdialog('load',url);}});ss.views.UserSignInSectionApp=Backbone.View.extend({events:{"click .signup_button_js":"signup_clicked","click .signup_no_plan_button_js":"signup"},signup_clicked:function(event){if(!(SS.app.current_network.has_custom_join_url||SS.app.current_network.has_plans)){event.preventDefault();return this.signup(event);}},signup:function(event){event.preventDefault();var signup_form_saved=function(options){var data={"signup_info_json":JSON.stringify(options.params),"using_ajax":true};if(options.params.associate_with_social_network){data["associate_with_social_network"]=options.params.associate_with_social_network;}
$.post("/auth/register",data).success(function(data){window.location=data.redirect_url;}).error(function(data){$.ss.dialog.message("Error","We're sorry, but there was an error processing your request. Please try again later.");});};ss.apps.signup_dialog=new ss.views.UserSignupView({title:'Signup',include_user_fields:true,company_fields_required:false,save_callback:signup_form_saved});ss.apps.signup_dialog.show_dialog();}});});;;$(function(){var settings_template=ss.fn.make_compile_template('.member-settings-templates');ss.views.UserEditApp=Backbone.View.extend({events:{'change .mailing_address_type':'change_mailing_address_type','click .user-change-chapter':'change_chapter_popup'},initialize:function(options){},change_mailing_address_type:function(event){var fillable_addresses=['work_address','home_address'];var target_class=$(event.target).val();var context=this;var company_address_info=this.$('.company_address_info');if(target_class=='company_address'){if(this.options.user_id){company_address_info.removeClass('alert-gray').addClass('alert-success');}else{this.choose_company_popup();}}else{if(company_address_info.data('valid')=='True'){this.$('.company_address_info').removeClass('alert-success').addClass('alert-gray');}}
$.each(fillable_addresses,function(key,value){if(value==target_class){context.change_fields_requirement(true,value);}else{context.change_fields_requirement(false,value);}});},change_fields_requirement:function(require,div_class){var required_fields=['.postal_code','.street_address','.city','.province','.country'];var target_div=this.$("."+div_class);$.each(required_fields,function(key,value){if(require){target_div.find(value).parent().find('label').append('<i class="required_marker"></i>');target_div.find(value).addClass('required');}else{target_div.find(value).parent().find('label i').remove();target_div.find(value).removeClass('required');}});},change_chapter_popup:function(){var chapter_selection=new ss.views.MoveUserToChapter();}});ss.views.MoveUserToChapter=ss.views.Popup.extend({className:'label_beside',save_url:'',title:function(){return'Move your account to another chapter.';},template:settings_template('.move-me-to-chapter'),save:function(data){var chapter_id=this.$('[name=chapter_id]').val();var data={chapter_id:chapter_id};var dialog=this;this.set_content('Moving account to chapter... <i class="fa fa-spinner fa-pulse"></i>');this.disable_buttons();$.ajax({url:'/user/move_self_to_chapter',data:data,type:'POST',success:function(response){if(response.success){dialog.set_content(response.html+' You will be redirected to your new chapter momentarily.');setTimeout(function(){window.location=response.redirect;},3000);}else{dialog.set_content(response.html);}
dialog.show_done_button();},failure:function(response){safe_log('failed to move account',response);$container.text('failed');}});},buttons:function(){return[{text:'Cancel',click:this.hide_dialog},{text:'Move',class:'success',click:this.save},];}});ss.views.UserSettingsPaymentTokensApp=Backbone.View.extend({events:{'click .disable-payment-token':'disable_payment_token'},initialize:function(options){},disable_payment_token:function(event){event.preventDefault();var $link=$(event.currentTarget);var token_id=$link.attr('data-token_id');var last_four_digits=$link.attr('data-last_four_digits');var popup=new ss.views.DisablePaymentTokenPopup({payment_token_id:token_id,last_four_digits:last_four_digits,card_row:$link.closest('li')});}});ss.views.DisablePaymentTokenPopup=ss.views.Popup.extend({template:settings_template('.delete-card-template'),title:function(){return"Delete this Card";},content_html:function(){return this.template({c:{last_four_digits:this.options.last_four_digits}});},save:function(){safe_log('Deleting');this.set_content('Deleting...');this.disable_buttons();var dialog=this;$.ajax({url:'/v2/payment_tokens/'+this.options.payment_token_id,type:'DELETE',success:function(response){dialog.set_content('Card deleted');dialog.options.card_row.slideUp();dialog.show_done_button();},failure:function(response){safe_log('failed to delete token',response);$container.text('failed');}});},buttons:function(){return[{text:'Cancel',click:this.hide_dialog},{text:'Delete','class':'danger delete-payment-token',click:this.save},];}});});;;$(function(){ss.models.PollingStatusModel=Backbone.Model.extend({defaults:function(){return{status_html:0,complete:false,validation_fail:false};}});ss.views.PollingApp=Backbone.View.extend({max_fail:3,current_fail:0,events:{},initialize:function(options){this.status=new ss.models.PollingStatusModel({id:options.id});_.bindAll(this);this.status.urlRoot=options.urlRoot;if(options.show_waiting===undefined){var show_waiting=true;}else{var show_waiting=options.show_waiting;}
this.options.show_waiting=show_waiting;if(options.primary_url){$.ajax(options.primary_url,{timeout:60*60*1000});}
this.render();this.fetch_update();},fetch_update:function(){this.status.fetch({success:this.status_updated,error:this.fetch_failed});},status_updated:function(){this.render();this.options.status_updated&&this.options.status_updated();if(!this.status.get('complete')){this.schedule_next_fetch();}else{if(this.options.complete_callback){this.options.complete_callback(this.status.toJSON());}}},fetch_failed:function(){this.current_fail++;if(this.current_fail<this.max_fail){this.schedule_next_fetch();}else{if(this.options.fail_callback){this.options.fail_callback(this.status.toJSON());}}},schedule_next_fetch:function(){setTimeout(this.fetch_update,this.options.fetch_interval||5000);},render:function(){var $el=this.$el;var html=this.status.get('status_html');if(html){$el.html(html);}else if(this.options.show_waiting){$el.html('Waiting for status?');}}});});;;$(function(){var ManageAttendeesListRowModel=Backbone.Model.extend({defaults:{"user_id":null}})
ss.views.ManageAttendeesListRowView=ss.views.RowView.extend({initialize:function(options){_.bindAll(this);var $item=this.$(".item");var user_id=$item.data("user_id");var email=$item.data("email");var attendee_id=$item.data("attendee_id");this.model=new ManageAttendeesListRowModel({"user_id":user_id,"email":email,"attendee_id":attendee_id});},events:{"click .item_action_attendee_attending":"click_attending","click .item_action_attendee_not_attending":"click_not_attending","click .item_action_attendee_invited":"click_invited","click .attended_js":"click_attended","click .attendance_info_edit_js":"click_attendance_info_edit","ss_update_row":"refresh_row"},click_attending:function(event){event.preventDefault();this.set_attending();},click_not_attending:function(event){event.preventDefault();this.set_not_attending();},click_invited:function(event){event.preventDefault();this.set_invited();},click_attended:function(event){var $target=$(event.target);var attended=$target.prop("checked");this.set_attended(attended,$target);},click_attendance_info_edit:function(event){event.preventDefault();var $target=$(event.target);var url=$target.closest('a').prop("href");this.attendance_info_edit(url);},set_attending:function(){this._set_attending(true);},set_not_attending:function(){this._set_attending(false);},set_invited:function(){var context=this;var $attending_status=this.$(".attending_status");var $attended=this.$(".attended_js");var old_status=$attending_status.text();var old_attended=$attended.prop("disabled");var attendee_id=this.model.get("attendee_id");this._start_loading_animation();$attending_status.text("Invited");$attended.prop("disabled",true);var data={"attendee_id":attendee_id};if(attendee_id){var error_fun=function(){$attending_status.text(old_status);$attended.prop("disabled",old_attended);context._stop_loading_animation();$.ss.dialog.message("Error","We're sorry, but there was an error processing your request. Please try again later.");};$.post("cancel_attendee",data).success(function(data){if(!data.success){error_fun();}else{context._stop_loading_animation();$attended.prop("checked",false);}}).error(error_fun);}},set_attended:function(attended,$target){var $updated=this.$(".attended_updated");$updated.css({'display':'inline'});$updated.fadeOut(1000,'easeInExpo');$.post("set_attended",{"attendee_id":this.model.get("attendee_id"),"attended":attended}).error(function(){$target.prop("checked",!attended);$.ss.dialog.message("Error","We're sorry, but there was an error processing your request. Please try again later.");});},attendance_info_edit:function(url){var save_url="save_attendance_info";var context=this;$('<div>').ssdialog({'title':"Record Exam Scores",'width':'auto','save_url':save_url,'content':{'url':url,'refresh_on_show':true},'save_callback':function(data){$.post(save_url,data.data).success(function(server_data,textStatus,jqXHR){data.success(server_data,textStatus,jqXHR);$(context.el).closest("tbody").find("tr").each(function(i,row){var $row=$(row);var $item=$row.find(".item");var attendee_id=$item.data("attendee_id");if(attendee_id==context.model.get("attendee_id")){$row.trigger("ss_update_row");}});}).error(data.error);}});},_set_attending:function(is_attending){var context=this;if(is_attending){var new_status="Attending";var url="rsvp_user";var id_key="curr_user:id";var email_key="new_user:email"}else{var new_status="Not Attending";var url="user_not_attending";var id_key="user_id";var email_key="user_email";}
this._start_loading_animation();var $attending_status=this.$(".attending_status");var $attended=this.$(".attended_js");var old_status=$attending_status.text();$attending_status.text(new_status);var data={};if(this.model.get("user_id")){data[id_key]=this.model.get("user_id");}else{data[email_key]=this.model.get("email");}
$.post(url,data).success(function(data){if(data.attendee_id){context.model.set({"attendee_id":data.attendee_id});}
context._stop_loading_animation();$attended.prop("disabled",false);}).error(function(){$attending_status.text(old_status);context._stop_loading_animation();$.ss.dialog.message("Error","We're sorry, but there was an error processing your request. Please try again later.");});},_start_loading_animation:function(){var $attending_status_container=this.$(".attending_status_container");$attending_status_container.addClass("loading_background_small");$attending_status_container.children().css("visibility","hidden");},_stop_loading_animation:function(new_text){var $attending_status_container=this.$(".attending_status_container");$attending_status_container.removeClass("loading_background_small");$attending_status_container.children().css("visibility","");}});});;;$(function(){ss.models.MemberModel=Backbone.Model.extend({defaults:function(){return{members:null};},initialize:function(options){}});ss.models.LoggedActivity=Backbone.Model.extend({urlRoot:'/v2/logged_activities',defaults:function(){return{title:'',body:'',date:null,type:'',user_id:null,last_modified:null};},initialize:function(){if(!this.has('date')){var date=moment().format('D MMM YYYY');this.set('date',date);}}});ss.models.LoggedActivityCollection=Backbone.Collection.extend({model:ss.models.LoggedActivity,url:'/v2/logged_activities',comparator:function(model){var last_updated=new Date(model.get('last_updated'));return-last_updated.getTime();}});});;;$(function(){ss.views.EditUserView=ss.views.RowView.extend({events:{'click .close_js':'close_panel'},initialize:function(options){this.render();},render:function(){$(this.el).append('<button type="button" class="close_js">Close</button>');},close_panel:function(){$(this.el).remove();this.options.close_panel();}});ss.views.ManageMembersRowView=ss.views.RowView.extend({initialize:function(options){_.bindAll(this);var $details=this.$('[data-type="user"]');var user_id=$details.data('id');var user_name=$details.data('name');this.model=new ss.models.MemberModel({id:user_id,name:user_name});},events:{'click .table_edit_user_js':'edit_user',"click .modify_membership_js":"modify_membership"},modify_membership:function(event){event.preventDefault();this.membership_plan_popup=new ss.views.MembershipPlanPopup({model:this.model,on_complete:this.refresh_row});},edit_user:function(event){var edit_user_view=new ss.views.EditUserView({close_panel:this.show_table});this.replace_content(edit_user_view.el);},replace_content:function(new_panel){this.hide_table();var $wrapper=this.get_wrapper();$wrapper.append(new_panel);},hide_table:function(){var $wrapper=this.get_wrapper();var $children=$wrapper.children();$children.hide();},show_table:function(){var $wrapper=this.get_wrapper();var $children=$wrapper.children();$children.show();},get_wrapper:function(){var $table_wrapper=$(this.el).closest('.wide_table');return $table_wrapper;}});});;;$(function(){ss.members=ss.members||{};ss.organizations=ss.organizations||{};ss.members.render_individual_detail_tables=function(el){var menu_items={"payment":"Transaction History","membership":"Membership History","event":"Event Attendance","outstanding":"Outstanding Balance"};if(SS.app.current_network.funds_enabled){menu_items.donations='Donations';}
var MultitableApp=new MultitableAppView({el:el,model:new MultitableAppModel({selected:"payment",menu_items:menu_items})});};ss.organizations.render_detail_tables=function(el){var menu_items={"transaction":"Transaction History","membership":"Membership History","outstanding_invoices":"Outstanding Invoices"};var MultitableApp=new MultitableAppView({el:el,model:new MultitableAppModel({selected:'membership',menu_items:menu_items})});};});;;$(function(){var EmailListRowModel=Backbone.Model.extend({defaults:{"email_list_id":null,"url":null}})
ss.helpers.email_list_dialog=function($item,row_view){var item_exists=!!$item;if(item_exists){var dialog_url='/email_lists/'+$item.data('permaid')+'/create_list_dialog';var save_url='/email_lists/'+$item.data('permaid');var save_button_text='Save';var title='Edit '+$item.data('name');var type='PUT';}else{var dialog_url='/email_list/create_list_dialog';var save_url='/email_lists';var save_button_text='Create';var title='Create a List';var type='POST';}
var buttons={'Save':null};buttons[save_button_text]=function(namespace){var context=this;context[namespace]('disable_buttons');var $container=this.data(namespace)['container'];var $filter_el=$container.find('#email_list_filter');var filters_data=$filter_el.data().item_filter.model.get("filters").toJSON();var form_array=$container.find('form').serializeArray();var form_data={};for(var i in form_array){var form_item=form_array[i];form_data[form_item['name']]=form_item['value'];}
form_data['filters']=JSON.stringify(filters_data);context[namespace]('show_loading');$.ajax({'type':type,'url':save_url,'data':form_data,'success':function(){if(false&&item_exists){if(row_view){row_view.refresh_row();}
context[namespace]('hide');}else{window.location=window.location;}},'error':function(){context[namespace]('hide');$.ss.dialog.message("Error","We're sorry, but there was an unexpected error. Please try again later.");}});};$('<div>').ssdialog({'title':title,'width':'auto','content':{'url':dialog_url,'refresh_on_show':true},'focus_input':true,'buttons':buttons});};ss.views.EmailListRowView=ss.views.RowView.extend({events:{"click .email_list_edit":"click_email_list_edit"},initialize:function(options){_.bindAll(this);var $item=this.$(".item");var user_id=$item.data("id");var url=$item.data("url");this.model=new EmailListRowModel({"email_list_id":user_id,"url":url});},click_email_list_edit:function(event){event.preventDefault();this.email_list_edit();},email_list_edit:function(){var $item=this.$(".item");ss.helpers.email_list_dialog($item,this);}});});;;$(function(){ss.views.FranchiseEmployeesRowView=Backbone.View.extend({events:{"click .on":"click_on","click .off":"click_off"},$table_input_holder:null,$input:null,initialize:function(options){_.bindAll(this,"click_on","click_off");this.$table_input_holder=$(".table_input_holder");this.$input=this.$("input");var id=this.$input.val();var $stored_input=this.$table_input_holder.find('[value="'+id+'"]');if($stored_input.length){if($stored_input.hasClass("add")){this.$input.siblings(".off").click();this.$input.prop("checked",true);}else{this.$input.siblings(".on").click();this.$input.prop("checked",false);}}
this.$(".ss_check_replace").ss_check_replace();},_remove_input_with_id:function(id){this.$table_input_holder.find('input[value="'+id+'"]').remove();},_remove_member:function(id){this._remove_input_with_id(id);this.$table_input_holder.append($('<input type="hidden" class="remove" value="'+id+'" name="franchise_member_remove">'));},_add_member:function(id){this._remove_input_with_id(id);this.$table_input_holder.append($('<input type="hidden" class="add" value="'+id+'" name="franchise_member_add">'));},click_on:function(){this._remove_member(this.$input.val());},click_off:function(){this._add_member(this.$input.val());}});ss.views.FranchisesRowView=Backbone.View.extend({events:{"click .edit":"click_edit","click .add_employees":"click_add_employees","click .details":"click_details"},$table_input_holder:null,$input:null,initialize:function(options){_.bindAll(this,"click_edit","click_add_employees","click_details");},_click_handler:function(event,fun){event.preventDefault();var $target=$(event.target);var $item=$target.closest('.item');var load_url=$target.closest('a').attr('href');var save_url=$item.attr('data-url');fun(load_url,save_url,$item.data());},click_edit:function(event){this._click_handler(event,this.edit);},click_add_employees:function(event){this._click_handler(event,this.add_employees);},click_details:function(event){this._click_handler(event,this.details);},edit:function(load_url,save_url,data){$('<div>').ssdialog({'title':'Edit '+data.name,'width':'auto','save_url':save_url,'content':{'url':load_url}});},add_employees:function(load_url,save_url,data){$('<div>').ssdialog({'title':'Employees Attached to '+data.name,'width':'auto','save_url':save_url,'content':{'url':load_url},'cancel_button_label':'OK','buttons':{"Save":null}});},details:function(load_url,save_url,data){$('<div>').ssdialog({'title':data.name+' Details','width':'auto','save_url':save_url,'content':{'url':load_url},'cancel_button_label':'OK','buttons':{"Save":null}});}});});;;$(function(){ss.views.SilkStartPricingPageApp=Backbone.View.extend({events:{'click .purchase-network-plan':'purchase_network_plan'},purchase_network_plan:function(event){var $button=$(event.target).closest('[data-plan_id]');var plan_id=$button.attr('data-plan_id');safe_log('Purchasing plan',plan_id);window.location='/account/purchase_plan/'+plan_id;}});});;$(function(){ss.views.FormFillerApp=Backbone.View.extend({events:{"click .fill_form_js":"fill_form"},initialize:function(options){var form_filler=this;ss_require(ss.require.company,function(module){form_filler.model=new ss.models.CompanyModel(ss_context.company);form_filler.render();});},render:function(){var $el=$(this.el);var button_text=this.options.button_text||'Test Fill Form';$el.html($('<button type="button" class="fill_form_js"></button>').text(button_text));},fill_form:function(){_.each(this.options.fields,this.fill_field);},fill_field:function(options){var $field;var $value=options.value.replace('##random##',Math.floor(Math.random()*100000));if(options.name){$field=this.$(':input[name="'+options.name+'"]');}else{$field=this.$(options.selector);}
$field.val($value).change();}});});;;if(!Function.prototype.bind){Function.prototype.bind=function(oThis){if(typeof this!=='function'){throw new TypeError('Function.prototype.bind - what is trying to be bound is not callable');}
var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,fNOP=function(){},fBound=function(){return fToBind.apply(this instanceof fNOP?this:oThis,aArgs.concat(Array.prototype.slice.call(arguments)));};fNOP.prototype=this.prototype;fBound.prototype=new fNOP();return fBound;};}
$(document).ready(function(){var popoverSettings;if(ss.config.THEME=='version2_classic'||ss.config.PARENT_THEME=='version2_classic'){popoverSettings={selector:'[data-toggle="popover"]',trigger:'hover',html:true};}else{popoverSettings={selector:'[data-toggle="popover"]',trigger:'hover',html:true,placement:'auto',container:'body'};}
$('body').popover(popoverSettings);$(document).on("keypress","form.no_enter_submit",function(event){var code=(event.keyCode?event.keyCode:event.which);if(!$(event.target).is('textarea')&&$.ui.keyCode.ENTER==code){event.preventDefault();}});$.validator.addMethod("no_past_date_helper",function(value,element){var input_date=new Date(value);var today_date=new Date();var before_today=input_date.getFullYear()<today_date.getFullYear()||input_date.getFullYear()==today_date.getFullYear()&&input_date.getMonth()<today_date.getMonth()||input_date.getFullYear()==today_date.getFullYear()&&input_date.getMonth()==today_date.getMonth()&&input_date.getDate()<today_date.getDate();var date_fun=_.bind($.validator.methods.date,this);return date_fun(value,element)&&!before_today;},"Cannot be in the past.");$.validator.addClassRules("no_past_date",{'date':true,'no_past_date_helper':true});$.validator.addMethod("hex_color",function(value,element){var hex_color_regex=/^([0-9a-fA-F]{6})$/;return this.optional(element)||hex_color_regex.test(value);},"Must be a hex color like ABC123");$(document).on("change","input.reverse_checkbox",function(event){var $checkbox=$(event.target);var checked=$checkbox.prop("checked");var $hidden_input=$checkbox.siblings("input.reverse_checkbox_value");$hidden_input.prop('value',checked?'':'True');});});;;$(function(){ss.models.EventRSVPModel=Backbone.Model.extend({defaults:function(){return{'invite_id':null,'going':null,'event_name':null,'user_name':null,'user_email':null,'user_id':null,'event_url':null,'event_id':null,'already_registered':null,'new_user_first_name':null,'new_user_last_name':null,'new_user_email':null,'new_user_phone':null,'event_full_url':null,'token':null,'register_by_link':null,'remaining_limit':null};}});ss.models.EventTicketModel=Backbone.Model.extend({urlRoot:"/v2/tickets",defaults:function(){return{'name':null,'description':null,'components':[],'event_id':null,'has_max_num_of_tickets_per_user':false,'has_registration_period':false,'has_total_number_of_tickets':false,'max_num_of_tickets_per_user':null,'total_number_of_tickets':null,'membership_requirement':null,'user_type_requirement':"",'price':{'currency_symbol':SS.app.current_network.currency_symbol,'cost_in_cents':0,'currency':SS.app.current_network.currency,'tax_in_cents':0},'registration_start_date':null,'registration_end_date':null,'registration_start_time':null,'registration_end_time':null,'signup_form':[],'requires_attendee_info':true,'remaining_limit':null,'gl_code':null,coupons:[],additional_info:{},files:{}};},initialize:function(options){},get_price:function(){return ss.fn.currency(this.get('price'));}});ss.models.EventTicketCollection=Backbone.Collection.extend({model:ss.models.EventTicketModel,comparator:function(model){return(model.get('sort_index')||0);}});ss.models.ComponentModel=Backbone.Model.extend({defaults:function(){return{field_info_id:null,key:1,to_delete:false};}});ss.models.ComponentCollection=Backbone.Collection.extend({model:ss.models.ComponentModel});ss.models.EventPlanDiscountModel=Backbone.Model.extend({defaults:function(){return{plan_id:'',discount:0,hidden:false};}});ss.models.EventPlanDiscountCollection=Backbone.Collection.extend({model:ss.models.EventPlanDiscountModel});ss.models.Event=ss.models.EventModel=Backbone.Model.extend({urlRoot:'/v2/events',defaults:function(){return{'basic_registration':true};},initialize:function(options){if(!this.get('start_time')){this.set({'start_time':'6:00pm'});}
if(!this.get('end_time')){this.set({'end_time':'7:00pm'});}
var day_list_collection=new ss.models.EventReminderRowCollection();if(!this.get('content_tabs')){this.set({'content_tabs':{}});}
if(!this.get('custom_sidebar_content')){this.set({'custom_sidebar_content':{}});}
var plan_discounts=new ss.models.EventPlanDiscountCollection();if(this.get('plan_discounts')){_.each(this.get('plan_discounts'),function(key,value){plan_discounts.add(new ss.models.EventPlanDiscountModel(value));});}
this.set('plan_discounts',plan_discounts);if(this.get('day_list')){$.each(this.get('day_list'),function(key,value){day_list_collection.add(new ss.models.EventReminderRowModel(value));});}else{if(this.isNew()){day_list_collection.add(new ss.models.EventReminderRowModel({'key':1,'to_delete':false,'number':1,'is_before':'before','time_util':'days'}));}}
this.set({day_list:day_list_collection});this.set({tickets:new ss.models.EventTicketCollection()});this.get('tickets').add(options.tickets);this.set({admin_components:new ss.models.ComponentCollection()});this.get('admin_components').add(options.admin_components);this.set({sessions:new ss.models.SessionCollection()});if(options.sessions){this.get('sessions').add(options.sessions);}},get_view_url:function(){return this.get('url')||('/events'+this.id);},get_time_part:function(is_start_time,part){var event_time=is_start_time?this.get('start_time'):this.get('end_time');var length=event_time.length;var value='';if(part==='hour'){value=event_time.substring(0,length-4);}else if(part==='min'){value=event_time.substring(length-3,length-2);}else if(part==='part'){value=event_time.substring(length-1,length);}
return value;},get_start_date:function(){return ss.fn.parse_date(this.get('event_date'),this.get('start_time'));},get_end_date:function(){return ss.fn.parse_date(this.get('event_end_date'),this.get('end_time'));},overlaps:function(other_event){var start1=this.get_start_date();var start2=other_event.get_start_date();var end1=this.get_end_date();var end2=other_event.get_end_date();var overlaps=(start1<end2&&start2<end1)||(end1<start1&&start1>end2);safe_log('Comparing',this,other_event,start1,'-',end1,' to ',start2,' - ',end2,overlaps?'overlap':'no overlap');return overlaps;},is_event_ticket_registration:function(){return!this.get('allows_sessions');},are_all_sessions_mandatory:function(){return SS.app.current_network.permaid==='beautycouncil';}});ss.models.EventReminderRowModel=Backbone.Model.extend({defaults:function(){return{'is_before':null,'key':null,'number':null,'time_unit':"days",'to_delete':false};}});ss.models.SessionModel=ss.models.EventModel.extend({urlRoot:'/v2/sessions'});ss.models.SessionCollection=Backbone.Collection.extend({model:ss.models.SessionModel});ss.models.EventCategory=Backbone.Model.extend({urlRoot:'/asset_categorys/event',initialize:function(options){options=options||{};}});ss.models.EventCategoryCollection=Backbone.Collection.extend({url:'/asset_categorys/event',model:ss.models.EventCategory});ss.models.EventReminderRowCollection=Backbone.Collection.extend({model:ss.models.EventReminderRowModel});ss.models.Attendee=ss.models.AttendeeModel=Backbone.Model.extend({urlRoot:'/v2/attendees',defaults:function(){return{registration_type:null,ticket_id:null,selected_sessions:[],selected_tickets:[],fields:{},first_name:'',last_name:'',email:null,phone_number:null,address1:null,address2:null,city:null,province:null,postal_code:null};},is_individual_session_ticket_registration:function(){return this.get('registration_type')==='individual';},is_all_session_registration:function(){return this.get('registration_type')==='all_session_ticket';},get_ticket_summaries:function(){safe_log('Getting ticket summaries',this);var model=this;var conference_model=this.event_model;var tickets=[];if(!conference_model){return[];}
var add_ticket=function(ticket_id){var ticket=conference_model.get('tickets').get(ticket_id);if(!ticket){conference_model.get('sessions').each(function(session){var potential=session.get('tickets').get(ticket_id);if(potential){ticket=potential;}});}
if(ticket){var attendee_text=model.id;var name=model.get('first_name')+' '+model.get('last_name');if(name===' '){name='Not Provided';}
attendee_text+=' - '+name;var attendee_number=model.id;tickets.push({attendee:attendee_text,name:ticket.get('name'),price:ticket.get('price')});}};if(this.is_individual_session_ticket_registration()||conference_model.is_event_ticket_registration()){_.each(this.get('selected_tickets'),function(ticket_id){add_ticket(ticket_id);});}else if(this.is_all_session_registration()){add_ticket(this.get('ticket_id'));}
return tickets;},get_price:function(){var ticket_summaries=this.get_ticket_summaries();return ss.fn.add_prices(_.pluck(ticket_summaries,'price'));}});ss.models.AttendeeCollection=Backbone.Collection.extend({model:ss.models.AttendeeModel,get_price:function(){var prices=this.map(function(attendee){return attendee.get_price();});return ss.fn.add_prices(prices);},can_user_attend:function(user){var matching_attendees=this.where({user_id:user.get('id')});var can_attends=_.map(matching_attendees,function(attendee){var ai=attendee.get('additional_info');return ai&&ai.can_attend;});if(_.contains(can_attends,false)){return false;}
if(can_attends.length>0){return true;}
return null;}});});;;$(function(){var ticket_template=ss.fn.make_compile_template('.ticket-templates');ss.views.EventTicketRemovePopup=ss.views.Popup.extend({get_title:function(){return"Delete "+this.model.get('name');},save_url:function(){return null;},get_content_html:function(){return"<div class='ticket_detail_dialog alert alert-danger'>Are you sure to delete the ticket \""+this.model.get('name')+'"? Clicking delete is permanent</div>'},save:function(){return null;},popup_opened:function(){$(this.el).next().find('.ui-button-text:contains("Delete")').parent().addClass('danger');},get_buttons:function(){var context=this;return{'Save':null,'Delete':function(namespace){context.model.destroy();this.next().hide()
this.html('<div class="ticket_detail_dialog alert alert-danger large_font">Deleted</div>').delay(750).queue(function(){$(context.el).ssdialog('hide')});}}}});ss.views.EventNoTicketPopup=ss.views.Popup.extend({get_title:function(){return"Create Tickets";},save_url:function(){return null;},get_content_html:function(){return"<div class='ticket_detail_dialog alert alert-danger'>Please create tickets for this event.</div>";},save:function(){return null;},popup_opened:function(){},get_buttons:function(){var context=this;return{'Save':null,'Ok':function(namespace){this[namespace]('hide');}}}});ss.views.EventTicketSignupFormPopup=ss.views.Popup.extend({custom_field_template:ticket_template('.ticket-custom-field'),events:{'click .add_field':'add_custom_field','click .remove_list_row':'remove_custom_field','change .custom_field_selection':'custom_field_selection'},get_title:function(){return'Sign up Form';},save_url:function(){return null;},popup_opened:function(data){var view=this;$(this).find('form').validate({ignore:':hidden'});var custom_field_html='';var components=this.model.get('components');if(components){$.each(components,function(key,component){custom_field_html+=view.custom_field_template(component);});}
var list=$(this.el).find('.ticket_custom_fields');list.append(custom_field_html);this.get_next_custom_field_index();},get_save_button_label:function(){return null;},get_content_html:function(){return this.options.html;},add_custom_field:function(event){var list=$(this.el).find('.ticket_custom_fields');var next_index=this.options.next_custom_field_index;this.options.next_custom_field_index+=1;var html=this.custom_field_template({'key':next_index,'field_info_id':''});list.append(html);},remove_custom_field:function(event){var $remove_button=$(event.target);var $row=$remove_button.closest('.custom_field');if(this.model.isNew()){$row.remove();}else{$row.find('[name="index"]').val('-1');$row.hide();}},custom_field_selection:function(event){$(event.target).find('option[value="'+$(event.target).val()+'"]').attr('selected',true);},get_next_custom_field_index:function(){var options=this.options;if(!options.next_custom_field_index){options.next_custom_field_index=1;}
_.each(this.model.get('components'),function(component){try{var key=parseInt(component.key,10);if(key>=options.next_custom_field_index){options.next_custom_field_index=key+1;}}catch(err){}});},done:function(namespace,dialog){var saved_form={};var signup_form_list=[];var custom_field_list=[];var field_name='';if(this.$('form').valid()){$.each(this.$('form input[name$="signup_form"]:enabled:checked'),function(key,input){signup_form_list.push($(input).val());});$.each(this.$('form .custom_field'),function(key,row){var $custom_field_selection=$(row).find('.custom_field_selection');var custom_field_object={field_info_id:$custom_field_selection.val()};custom_field_object.key=$(row).find('.key').val();custom_field_object.index=$(row).find('.index').val();if(custom_field_object.index!=='-1'){custom_field_list.push(custom_field_object);}});saved_form['signup_form']=signup_form_list;saved_form['components']=custom_field_list;if(signup_form_list.length||custom_field_list.length){saved_form['requires_attendee_info']=true}else{saved_form['requires_attendee_info']=false}
this.model.set(saved_form);dialog[namespace]('hide');}else{}},get_buttons:function(){var context=this;return{'Save':function(namespace){return context.done(namespace,this);}};}});ss.views.EventTicketSettingsPopup=ss.views.Popup.extend({events:{'change .membership_requirement':'membership_requirement','click .add-coupon-js':'add_coupon_clicked','click .remove_list_row':'remove_coupon_clicked'},get_title:function(){return'Ticket Settings';},save_url:function(){return null;},save:function(){return null;},popup_opened:function(data){$(this).find('form').validate({ignore:':hidden'});$.ss.enable_datepickers(this.el);var view=this;_.each(this.model.get('coupons')||[],function(coupon){view.add_coupon(coupon);});},get_save_button_label:function(){return null;},get_content_html:function(){var html=this.options.html;return html;},add_coupon_clicked:function(event){event.preventDefault();this.add_coupon();},remove_coupon_clicked:function(event){event.preventDefault();$(event.target).closest('li').remove();},add_coupon:function(coupon){var template=ticket_template('#coupon_row');if(!coupon){coupon={};}
coupon.code=coupon.code||'';coupon.discount=coupon.discount||'';var coupon_html=template(coupon);this.$('.coupons').append(coupon_html);},membership_requirement:function(event){if($(event.target).val()=='other'){$(this.el).find('form').find('.user_type_options').show();$(this.el).find('form').find('.user_type_options select').addClass('required');}else{$('.user_type_options').hide();$(this.el).find('form').find('.user_type_options select').removeClass('required');}},get_buttons:function(){var context=this;return{'Save':function(namespace){var saved_form={};var field_name;if($(this).find('form').valid()){saved_form['has_registration_period']=false;$.each($(this).find('form :input:enabled'),function(key,input){var name=$(input).prop('name');if(!name){return;}
field_name=name.split(':')[1];saved_form[field_name]=$(input).val();if(field_name=='max_num_of_tickets_per_user'){if($(input).val()>0){saved_form['has_max_num_of_tickets_per_user']=true;}else{saved_form['has_max_num_of_tickets_per_user']=false;}}else if(_.indexOf(['registration_start_date','registration_end_date'],field_name)!==-1){if($(input).val()){saved_form['has_registration_period']=true;}}});var coupons=[];saved_form['coupons']=coupons;context.$('.coupons li').each(function(index,row){var $row=$(row);var coupon={code:$row.find('.code-js').val(),discount:$row.find('.discount-js').val()};coupons.push(coupon);});if(saved_form['membership_requirement']!='other'){saved_form['user_type_requirement']=null;}else if(saved_form['membership_requirement']=='other'&&!saved_form['user_type_requirement']){saved_form['membership_requirement']=context.model.get('membership_requirement');}
context.model.set(saved_form);this[namespace]('hide');}}};},});ss.views.EventTicketRowApp=Backbone.View.extend({events:{'click .remove_list_row':'remove_list_row','change :input':'save_input','click .ticket_settings':'ticket_settings','click .signup_form_js':'signup_form'},initialize:function(options){this.render();},render:function(){var template=ticket_template('#event_ticket_rows');var html;var data=this.model.toJSON();var random_token=Math.random().toString(36).substring(12);data['random_token']=random_token;if(data.price){data['price_to_display']=data.price.cost_in_cents/100;}else{data['price_to_display']='';}
data['currency_symbol']=data.price.currency_symbol;this.$el.html(template(data));this.$el.data('model',this.model);},remove_list_row:function(){if(this.model.isNew()){this.model.destroy();}else{var delete_popup=new ss.views.EventTicketRemovePopup({model:this.model});}},save_input:function(event){var $input=$(event.target);var new_value=$input.val();var field_name=$input.data('name');var dict={};if(field_name=='price'){var price=this.model.get('price');if(new_value){if(isNaN(parseFloat(Number(new_value)))||parseFloat(new_value)<0){price.cost_in_cents=0;$(event.target).val(0);}
else
price.cost_in_cents=parseFloat(new_value*100);}else{price.cost_in_cents=0;$(event.target).val(0);}
dict['price']=price;}else if(field_name=='total_number_of_tickets'){if(new_value){if(isNaN(parseInt(new_value))){new_value=null;$(event.target).val(null);}else{new_value=parseInt(new_value);}}else{new_value=null;$(event.target).val(null);}
dict['total_number_of_tickets']=new_value;if(new_value>0){dict['has_total_number_of_tickets']=true;}else{dict['has_total_number_of_tickets']=false;}
this.model.set(dict);}else{dict[field_name]=new_value;}
this.model.set(dict);},ticket_settings:function(){var data=this.model.toJSON();var time_options=[];var time_string;var hours=[];var last_hour;for(var hour=1;hour<=12;hour++){hours.push(hour);}
last_hour=hours.pop();hours.unshift(last_hour);$.each(['am','pm'],function(key,time){$.each(hours,function(key,hour){$.each(['00','15','30','45'],function(key,minute){time_string=hour+':'+minute+time;time_options.push(time_string);});});});data['membership_options']=ss_context.membership_options;data['user_type_options']=ss_context.user_type_options;data['use_gl_codes']=ss_context.use_gl_codes;data['time_options']=time_options;var template=ticket_template('#ticket_settings');var html=template(data);var popup=new ss.views.EventTicketSettingsPopup({'html':html,model:this.model});},signup_form:function(){var template=ticket_template('#signup_form');var html=template(this.model.toJSON());var popup=new ss.views.EventTicketSignupFormPopup({'html':html,model:this.model});}});ss.views.EventEditTicketTableApp=Backbone.View.extend({events:{'click .add_ticket':'add_ticket_row'},initialize:function(options){var context=this;var tickets=this.model.get('tickets');this.options.row_index=0;this.ticket_collection=tickets;this.ticket_collection.bind('add',this.render,this);this.ticket_collection.bind('remove',this.render,this);_.bindAll(this);if(tickets.length>0){}else if(!this.model.basic_registration&&!this.model.id){tickets.add(new ss.models.EventTicketModel({'name':'Non-Member','price':{'currency_symbol':SS.app.current_network.currency_symbol,'cost_in_cents':10000,'currency':SS.app.current_network.currency,'tax_in_cents':0},'row_index':this.options.row_index,'signup_form':["name","email"]}));this.options.row_index+=1;tickets.add(new ss.models.EventTicketModel({'name':'Member','price':{'currency_symbol':SS.app.current_network.currency_symbol,'cost_in_cents':5000,'currency':SS.app.current_network.currency,'tax_in_cents':0},'row_index':this.options.row_index,'signup_form':["name","email"],'membership_requirement':"member"}));this.options.row_index+=1;}},render:function(){var self=this;var new_row;var $ticket_table=this.$('.ticket_table');var $last_row=$ticket_table.find('.last_row');$ticket_table.find('.ticket_row').remove();if(this.ticket_collection.length>0){$(this.el).find('.no_ticket').hide();}else{$(this.el).find('.no_ticket').show();}
this.ticket_collection.each(function(model){new_row=new ss.views.EventTicketRowApp({model:model,'el':'<tr class="ticket_row">'});$last_row.before(new_row.el);});this.$('.ticket_table > tbody').sortable({items:'.ticket_row',update:function(){self.reindex();}});this.reindex();},reindex:function(){this.$('.ticket_row').each(function(index,tr){var model=$(tr).data('model');if(model){model.set({'sort_index':index},{silent:true});safe_log('Updated sort index',model.get('name'),index,model);}else{safe_log('No model to update',index);}});this.ticket_collection.sort();},add_ticket_row:function(event){event.preventDefault();var new_row=new ss.models.EventTicketModel({row_index:this.options.row_index,signup_form:["name","email"],sort_index:100});this.options.row_index+=1;this.ticket_collection.add(new_row);this.reindex();},});});;;$(function(){var custom_content_template=ss.fn.make_compile_template('.custom-content-creator-templates');ss.views.CustomContentEditApp=Backbone.View.extend({editor_template:custom_content_template('#custom-content-creator'),edit_panel:custom_content_template('#custom-content-edit-panel'),list_item:custom_content_template('#custom-content-list-item'),events:{'click .add-custom-content':'add_custom_content','click .save-custom-content':'save_custom_content','click .custom-content-li':'edit_custom_content','click .delete-custom-content':'delete_custom_content','click .cancel-custom-content':'cancel_custom_content'},initialize:function(options){this.render();this.add_custom_content();},get_contents:function(){return this.model.get(this.options.attribute);},set_contents:function(contents){var attr=this.options.attribute;this.model.set({attr:contents});},render:function(){this.$el.html(this.editor_template({'title':this.options.title,'popovertitle':this.options.popovertitle,'popovertext':this.options.popovertext,'item_type':this.options.item_type}));this.render_list_items();},render_list_items:function(){var contents=this.get_contents();if(!$.isEmptyObject(contents)){this.$('.add-custom-content').addClass('content-exists');var $content_list=this.$('.custom-content-list');var sorted_content_ids=this.sort_contents(contents);$content_list.empty();_.each(sorted_content_ids,function(content){var content_list_item=this.list_item({'name':contents[content.id].name,'id':content.id});$content_list.append(content_list_item);}.bind(this));this.initialize_nested_sort($content_list);}},feedback:function(feedback_class,feedback_string){var $feedback_el=this.$('.feedback');$feedback_el.text(feedback_string).removeClass('alert-info alert-danger').addClass(feedback_class).animate({opacity:1},1000,function(){$(this).delay(3000).animate({opacity:0},1000);});},unsaved_changes:function(){if($('.mm-page.unsaved-custom-content-changes').length<1){$('.mm-page').addClass('unsaved-custom-content-changes');window.onbeforeunload=function(){if($('.unsaved-custom-content-changes').length){return'You haven\'t saved your changes. If you don\'t want to lose your work, be sure to save the event.';}};}},initialize_nested_sort:function(content_list){var view=this;ss_require(['/res/js/os/plugins/jquery-sortable-min.js'],function(module){content_list.nested_sort({onDrop:function(item,container,_super){view.update_content_order();_super(item,container);}});});},sort_contents:function(contents){var content_ids=_.keys(contents);var idOrder=[];_.each(content_ids,function(content_id){idOrder.push({'id':content_id,'order':contents[content_id]['order_number']});});return _.sortBy(idOrder,'order');},update_content_order:function(){var $content_list_items=this.$('.custom-content-list li');var contents=this.get_contents();var new_order={};$content_list_items.each(function(index,element){var $content_id=$(element).data('id');var content=contents[$content_id];content.order_number=index;new_order[$content_id]=content;}.bind(this));this.set_contents(new_order);},delete_custom_content:function(event){var $id=$(event.target).data('id');var contents=this.get_contents();delete contents[$id];this.render();this.feedback('alert-info',this.options.item_type+' deleted. Don\'t forget to save the event too!');this.unsaved_changes();},cancel_custom_content:function(){this.render();this.feedback('alert-info','Changes to '+this.options.item_type+' were canceled.');this.unsaved_changes();},edit_custom_content:function(event,id){if(id){var $id=id;}else{var $id=$(event.target).data('id');}
var contents=this.get_contents();var content=contents[$id];var html=this.edit_panel({'name':content.name,'content':content.content,'id':$id,'item_type':this.options.item_type});$('.custom-content-editor',this.$el).html(html);},save_custom_content:function(event){var $name=this.$('.custom-content-name').val();var $content=this.$('.custom-content input, .custom-content textarea').val();var $id=$(event.target).data('id');var contents=this.get_contents();var order_number;if($name){if(!$id){$id='xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=='x'?r:r&0x3|0x8;return v.toString(16);});order_number=Object.keys(contents).length;}else{order_number=contents[$id]['order_number'];}
var content={'name':$name,'content':$content,'order_number':order_number};}else{this.feedback('alert-danger','Content title is a required field. Please fill it out before saving.');return;}
contents[$id]=content;this.set_contents(contents);this.render_list_items();this.edit_custom_content(null,$id);this.feedback('alert-info',this.options.item_type+' was saved. Don\'t forget to save the event too!');this.unsaved_changes();},add_custom_content:function(){var html=this.edit_panel({'name':'','content':'','id':'','item_type':this.options.item_type});$('.custom-content-editor',this.$el).html(html);}});});;;$(function(){ss.views.InviteByMembershipPopup=ss.views.Popup.extend({className:'event_invite_dialog',events:{'change .show_number_of_users':'display_user_counts'},title:'Invite by Membership Plan',save_url:function(){return this.options.save_url;},content_url:function(){return this.options.url;},popup_opened:function(){$(this.el).next().find('.ui-button-text:contains("Delete")').parent().addClass('danger');},on_success:function(response){this.set_content(response.html);this.show_done_button();},get_buttons:function(){var context=this;return{Save:null,'Send Invite':this.submit}},popup_loaded:function(data){var $buttons=this.find('.ui-dialog-buttonpane button');$buttons.addClass('btn');this.disable_send_button(true);},display_user_counts:function(data){var member_count=0;this.$('.show_number_of_users:checked').each(function(index,checkbox){member_count+=$(checkbox).data('total_member');});this.$('.member_count').text(member_count);this.disable_send_button(member_count==0);},disable_send_button:function(disabled){this.find('.ui-dialog-buttonpane button:contains("Send Invite")').attr('disabled',disabled);}});});;;$(function(){ss.events=ss.events||{};ss.views.EventEditApp=Backbone.View.extend({events:{'click .location_url_switch':'toggle_location_type','click .location-tbd-switch':'toggle_location_type','click .event_reminder_check':'toggle_reminder_div','change :input[name^="event"]':'save_input','change :input[name^="session"]':'save_input','click .create_event':'save','click .no_tax':'tax_value','change :input[class^="time_selection"]':'time_changed','change .start_date':'time_changed','change .end_date':'time_changed','change .event_category':'event_category','change .event_custom_purchase_notification':'custom_purchase_notification','change .plan-discount-checkbox':'plan_discount_checkbox_clicked'},initialize:function(options){this.ticket_table_view=null;if(!this.model.basic_registration){this.ticket_table_view=new ss.views.EventEditTicketTableApp({el:this.$('.ticket_section'),model:this.model});}
if($('.event-tabs-section').length>0){this.event_tabs_view=new ss.views.CustomContentEditApp({el:this.$('.event-tabs-section'),model:this.model,attribute:'content_tabs',title:'Tabbed Content',item_type:'Tab',popovertitle:'Custom Content Tabs',popovertext:'Instead of having one big block of text describing your event, break it up into tabs! Note, tabs are displayed in place of the Event Details content.'});this.event_sidebar_view=new ss.views.CustomContentEditApp({el:this.$('.event-sidebar-section'),model:this.model,attribute:'custom_sidebar_content',title:'Custom Sidebar Content',item_type:'Sidebar Block',popovertitle:'Custom Sidebar Content',popovertext:'These content blocks appear in the right-hand column of your event page. Note, the title is not displayed, only the Sidebar Block Content section.'});}
this.event_attendance_tracking_view=new ss.views.EventAttendanceTrackingView({model:this.model,el:this.$('.attendance_tracking')});this.render();},render:function(){$('body').addClass('event_edit');if(!this.model.get('external_event')){this.hide_location_or_url();}
this.event_reminder();this.event_attendance_tracking_view.render();if(this.ticket_table_view){this.ticket_table_view.render();}},ensure_section_number:function(){$.each($('.section_number'),function(key,field){$(field).html(key+1);});},custom_purchase_notification:function(e){var $form=$(".event-custom-purchase-notification-content");if(e.target.value==='use_custom_template'){$form.show();}else{$form.hide();}},event_category:function(e){var color=$(e.target).find('option:selected').data('color');$('.color_box').css({'background-color':color});},event_reminder:function(e){var reminder_view=new ss.views.EventEditReminderApp({model:this.model,el:$('.item_edit.event .reminder_div')});if(this.model.get('event_reminder')){$('.reminder_div').show();}else{$('.reminder_div').hide();}},tax_value:function(e){if($(e.target).is(':checked')){$('.ticket_tax_rate').prop({'value':'','disabled':true});this.model.set({'ticket_tax_rate':null});}else{$('.ticket_tax_rate').prop('disabled',false);}},time_changed:function(event){var $time_container=$(event.target).parents('.time_parent');var key=$time_container.data('attribute');var value='';var time_option={};$.each($time_container.find('.time-el'),function(key,field){if($(field).is('span'))
value+=$(field).text();else
value+=$(field).val();});time_option[key]=value;this.model.set(time_option);this.is_time_valid();},is_time_valid:function(){var start_time=this.get_start_time(true);var end_time=this.get_end_time(true);var start_date_time=this.$('.start_date').val()+' '+start_time;var end_date_time=(this.$('.end_date').val()?this.$('.end_date').val():this.$('.start_date').val())+' '+end_time;var valid=Date(start_date_time)<=Date(end_date_time);if(!valid){this.$('.time_error').show();}else{this.$('.time_error').hide();}
return valid;},get_start_time:function(is_validation_format){return this._get_time(is_validation_format,true);},get_end_time:function(is_validation_format){return this._get_time(is_validation_format,false);},_get_time:function(is_validation_format,is_start_time){var time_type=is_start_time?'start':'end';var $time_container=this.$('.'+time_type+'_time');var value='';var hour=$time_container.find('select[name="'+time_type+'_hour"]').val();var min=$time_container.find('select[name="'+time_type+'_min"]').val();var part=$time_container.find('select[name="'+time_type+'_part"]').val();if(is_validation_format&&part){if(part==='pm'){hour=(parseInt(hour)===12)?parseInt(hour):(parseInt(hour)+12);}else{if(parseInt(hour)===12){hour='00';}else{hour=(parseInt(hour)<10?'0':'')+String(hour);}}
value=hour+':'+min+':00';}else{value=String(hour)+':'+min+part;}
return value;},match_up_end_time:function(){var context=this;var time_part;$.each(context.$('.end_time select'),function(index,field){time_part=$(field).prop('name').split('_')[1];$(field).val(context.model.get_time_part(true,time_part));});this.model.set({'end_time':this.model.get('start_time')});},prepare_tickets_for_saving:function(){var tax=parseFloat(this.model.get('ticket_tax_rate'));var tax_value;var price;var new_price_object;var ticket_collection=this.model.get('tickets');var model_list=[];ticket_collection.each(function(model,index){tax=tax?tax:0;new_price_object={};price=parseFloat(model.get('price').cost_in_cents);tax_value=parseFloat(price*tax/100);new_price_object={'cost_in_cents':price,currency:model.get('price').currency,'tax_in_cents':tax_value};model.set({'price':new_price_object});});},save:function(e){e.preventDefault();window.onbeforeunload=function(){};$('.item_edit_form').validate({ignore:':hidden',focusInvalid:false});if(!$('.item_edit_form').valid()||!this.is_time_valid()){$('<div />',{'class':'error'}).html('Your required fields are not valid. Please review.').insertAfter($('.create_event')).delay(1000).fadeOut();return}
var context=this;var data_to_set={};var field_name;$.each($(':input:hidden:not(:disabled):not(:checkbox)'),function(key,input){if(!$(input).next().is(':checkbox')){field_name=$(input).prop('name');if(field_name.match(/^event:/)=="event:"||field_name.match(/^session:/)=="session:"){field_name=field_name.split(":")[1];if(!(field_name in data_to_set)){data_to_set[field_name]=$(input).val();}}}});if(!parseInt($('.capacity').val())){data_to_set['has_no_ticket_limit']=true;}
data_to_set['location']=$(this.el).find('.location_input').val();data_to_set['custom_purchase_notification_type']=$('.event_custom_purchase_notification').val();data_to_set['custom_purchase_notification_template']={body_template:$("[name='event_custom_purchase_notification:body_template']").val(),subject_template:$(".event-custom-purchase-notification-content-subject").val(),};this.model.set(data_to_set);if(!ss.fn.get(this.model,'additional_info.timezone')){ss.fn.set(this.model,'additional_info.timezone',$(this.el).find('.timezone-selection').val());}
var $custom_fields=this.$('.custom-fields');if($custom_fields.length){var custom=ss.fn.common.form_as_json($custom_fields);_.each(custom['event:additional_info'],function(value,key){this.model.get('additional_info')[key]=value;},this);this.model.set({files:{}});_.each(custom['event:files'],function(value,key){this.model.get('files')[key]=value;},this);}
if(ss.config.FEATURES.plan_based_event_discounts)
this.get_plan_discounts();var promote_event_to_networks=$('.promote-event-to-network').val();promote_event_to_networks=promote_event_to_networks?promote_event_to_networks:[];this.model.set('promote_event_to_networks',promote_event_to_networks);context.prepare_tickets_for_saving();if(ss.config.THEME!='version2_classic'&&ss.config.PARENT_THEME!='version2_classic'){$('#main_content').html('<div class="loading-div-wrap"><div class="loading-div"><div class="submitting-text"></div><div class="loading-graphic"><i class="fa fa-cog fa-spin fa-5x"></i></div></div></div>');}else{$('#main_content').html('<div class="loading"></div>');}
this.model.save({},{success:function(data,response){window.location=response.url||('/events/'+response.id);},error:function(model,response){$('#main_content').html('<h2>Oops!  Something went wrong.</h2>'+'<img src="/res/img/error.jpeg">'+'<div class="notice">Please contact us at <a href="mailto:support@silkstart.com">support@silkstart.com</a></div>');}});},save_input:function(event){var data_to_set={};var value;var field_name=$(event.target).prop('name').split(':')[1];if($(event.target).is(':disabled')){return}
if(field_name.match(/^additional_info./)){var additional_object=this.model.get('additional_info');additional_object[field_name.replace('additional_info.','')]=$(event.target).val();data_to_set['additional_info']=additional_object;}else{if($(event.target).is(':checkbox')){if($(event.target).is(':checked')){if(field_name=='has_no_ticket_limit'){value=true
$(event.target).prev().prop({'value':'','disabled':true});data_to_set['total_tickets_available']=null;}else{value=$(event.target).val();}}else{if(field_name=='has_no_ticket_limit'){$(event.target).removeAttr('checked');value=false;$(event.target).prev().prop('disabled',false);}else{value=$(event.target).prev().val();}}
data_to_set[field_name]=value;}else{if(field_name=='ticket_tax_rate'||field_name=='total_tickets_available'){if(isNaN(parseInt($(event.target).val()))){$(event.target).val(null);data_to_set[field_name]=null;}else if($(event.target).val()<=0){if(field_name=='ticket_tax_rate'){$('.no_tax').prop('checked',true);$('.ticket_tax_rate').prop({'value':null,'disabled':true});}else if(field_name=='total_tickets_available'){$('.no_limit').prop('checked',true);$('.capacity').prop({'value':null,'disabled':true});}
data_to_set[field_name]=null;}else{data_to_set[field_name]=$(event.target).val();}}else if(field_name=="event_date"){if(!this.model.get('event_date')&&!this.model.get('event_end_date')){data_to_set[field_name]=$(event.target).val();data_to_set['event_end_date']=$(event.target).val();$(this.el).find('input[name="event:event_end_date"]').val($(event.target).val());}else{data_to_set[field_name]=$(event.target).val();}}else{data_to_set[field_name]=$(event.target).val();}}}
this.model.set(data_to_set);},get_plan_discounts:function(){var $discount_rows=$('.event-plan-discount-row');var updated_plan_discounts=new ss.models.EventPlanDiscountCollection();_.each($discount_rows,function($discount){var discount_percent=$('.event-plan-discount-percent',$discount).val();var plan_id=$($discount).data('plan_id');var hidden=$('.event-plan-discount-hidden',$discount).is(":checked");var plan_discount=new ss.models.EventPlanDiscountModel({plan_id:plan_id,discount:discount_percent,hidden:hidden});updated_plan_discounts.add(plan_discount);});this.model.set('plan_discounts',updated_plan_discounts);},plan_discount_checkbox_clicked:function(event){var $discount_table=$('.plan-discounts-table');if($(event.target).is(':checked')){$discount_table.show();}else{$discount_table.hide();}},hide_location_or_url:function(){var location_val=$(this.el).find('.location_input').val();var url_val=$(this.el).find('.url').val();$('.location_or_url_div').append('<div class="location_url_switch_div"><input type="checkbox" class="location_url_switch"> <span>Online Event?</span> '+'<a tabindex="-1" class="popover_link" role="button" data-toggle="popover" data-trigger="hover" title="" data-content="Check this box if the event takes place online. E.g. a virtual conference or seminar that uses video conferencing." data-original-title="Online Event"><i class="fa fa-question-circle"></i></a></div>');$('.location_or_url_div').append('<div class="location-tbd-switch-div"><input type="checkbox" class="location-tbd-switch"> <span>To Be Decided?</span> '+'<a tabindex="-1" class="popover_link" role="button" data-toggle="popover" data-trigger="hover" title="" data-content="Check this box if the event does not yet have a confirmed location." data-original-title="To Be Decided"><i class="fa fa-question-circle"></i></a></div>');if(!url_val){$(this.el).find('.url').removeClass('required');if(ss.config.THEME!='version2_classic'&&ss.config.PARENT_THEME!='version2_classic'){$('.url-group').hide();}}else{$(this.el).find('.location_input').removeClass('required').parent().hide();$('.location_url_switch').prop('checked',true);}
if(this.$('.location_input').val()==='tbd'){$('.location-tbd-switch').prop('checked',true);}},toggle_location_type:function(e){var $target=$(e.target);var checked=$target.is(':checked');var online=checked&&$target.is('.location_url_switch');var tbd=checked&&$target.is('.location-tbd-switch');var $location_field=this.$('.event_location');var $website_field=this.$('.event_website');var $tbd_field=this.$('.event-tbd');if(ss.config.THEME!='version2_classic'&&ss.config.PARENT_THEME!='version2_classic'){var $location_group=this.$('.location-group');var $url_group=this.$('.url-group');var $tbd_group=this.$('.tbd-group');}
var $old_field;var $new_field;if(ss.config.THEME=='version2_classic'||ss.config.PARENT_THEME=='version2_classic'){$location_field.removeClass('required').parent().hide();$website_field.parent().hide();$tbd_field.parent().hide();}else{$location_field.removeClass('required');$location_group.hide();$url_group.hide();$tbd_group.hide();}
if(tbd||online){$location_field.val('').change();}
if(!online){$website_field.val('').change();this.$('.location_url_switch').prop('checked',false);}
if(!tbd){this.$('.location-tbd-switch').prop('checked',false);}
if(ss.config.THEME=='version2_classic'||ss.config.PARENT_THEME=='version2_classic'){if(online){$website_field.addClass('required').parent().show();}else if(tbd){$tbd_field.parent().show();$location_field.val('tbd').change();}else{$location_field.val('').addClass('required').parent().show();}}else{if(online){$website_field.addClass('required');$url_group.show();}else if(tbd){$tbd_group.show();$location_field.val('tbd').change();}else{$location_field.val('').addClass('required');$location_group.show();}}},toggle_reminder_div:function(e){if($(e.target).prop('checked')){$(this.el).find('.reminder_div').show();$(this.el).find('.reminder_div').find('.cke_editable').attr('contenteditable',true);}else{$(this.el).find('.reminder_div').hide();}}});ss.events.with_details=function(event_id,func){$.ajax({url:'/events/'+event_id+'/full_details',success:function(response){var event=new ss.models.Event(response.event);func(event);}});};ss.views.CustomFieldSelectionView=Backbone.View.extend({template:_.template($("#custom_field_selection").html()),tagName:'li',events:{'click .remove_list_row':'remove','change .custom_field_selection':'field_changed'},initialize:function(options){this.render();this.$('.custom_field_selection').change();},render:function(){if(this.model.get('to_delete')){$(this.el).hide();}else{var content=this.template(this.model.toJSON());$(this.el).html(content);}},field_changed:function(event){this.model.set({field_info_id:$(event.target).val()});},remove:function(){this.model.set({'to_delete':true});this.render();}});ss.views.EventAttendanceTrackingView=Backbone.View.extend({template:_.template($("#custom_field_list").html()),events:{'click .add_field':'add_row'},initialize:function(options){var rows=this.rows=[];this.model.get('admin_components').each(function(component){rows.push(new ss.views.CustomFieldSelectionView({model:component}));});},render:function(){var content=this.template();$(this.el).html(content);var $custom_field_list=this.$('.custom_fields');$custom_field_list.empty();_.each(this.rows,function(custom_field_selector){custom_field_selector.render();$custom_field_list.append(custom_field_selector.el);});},add_row:function(){var next_index=this.get_next_index();var component_model=new ss.models.ComponentModel({key:next_index,index:next_index});this.model.get('admin_components').add(component_model);this.rows.push(new ss.views.CustomFieldSelectionView({model:component_model}));this.render();},get_next_index:function(){var options=this.options;var components=this.model.get('admin_components');var next_index=1;if(components){components.each(function(component){try{var key=parseInt(component.get('key'),10);if(key>=next_index){next_index=key+1;}}catch(err){}});}
return next_index;}});ss.views.EventEditReminderRowApp=Backbone.View.extend({template:_.template($("#event_reminder_row").html()),events:{'click .remove_list_row':'remove_list_row','change .is_before_selection':'is_before_selection','change :input':'save_input'},initialize:function(options){this.render();},render:function(){$(this.el).html(this.template(this.model.toJSON()));},save_input:function(event){var data_to_set={};data_to_set[$(event.target).prop('name').split('.')[1]]=$(event.target).val();this.model.set(data_to_set);},remove_list_row:function(){if(this.$el.parent().children(':visible').length>1){this.$('.to_delete').val(true);this.$('reminder_number').prop('disabled',true).val(1);this.model.set({'to_delete':true});$(this.el).hide();}},is_before_selection:function(e){if($(e.target).val()=='day_of'){$(this.el).find('.reminder_number').hide().prop('disabled',true);$(this.el).find('.reminder_time_unit').prop('disabled',true);$(this.el).find('.time_until_js').hide();}else{$(this.el).find('.reminder_number').show().prop('disabled',false);$(this.el).find('.reminder_time_unit').prop('disabled',false);$(this.el).find('.time_until_js').show();}}});ss.views.EventEditReminderApp=Backbone.View.extend({events:{'click .add_row':'add_row'},initialize:function(options){var context=this;if(this.model.isNew()){this.options.next_index=2;}else{this.get_next_reminder_index();}
this.collection=this.model.get('day_list');this.collection.bind('add',this.render,this);this.render();},add_row:function(){if(this.options.next_index){var new_model=new ss.models.EventReminderRowModel({key:this.options.next_index});this.collection.add(new_model)
this.options.next_index+=1;}},render:function(){var new_row;var container=$(this.el).find('.reminder_list');var data_to_set={};container.html("");this.collection.each(function(model){new_row=new ss.views.EventEditReminderRowApp({model:model,'el':'<li class="reminder_row">'});if(model.get('to_delete')==false){container.append(new_row.el);$.each($(new_row.el).find(':input:visible'),function(key,input){data_to_set[$(input).prop('name').split('.')[1]]=$(input).val()});model.set(data_to_set);}});},get_next_reminder_index:function(){var options=this.options;var reminder_day_list=this.model.get('day_list');if(!options.next_index){options.next_index=1;}
if(reminder_day_list){reminder_day_list.each(function(component){try{var key=parseInt(component.get('key'),10);if(key>=options.next_index){options.next_index=key+1;}}catch(err){}});}}});ss.views.EventPageApp=Backbone.View.extend({events:{'click .section_filter':'render','click .close':'dismiss_alert','change .ticket_quantity':'ticket_quantity_check','click .login_popup_js':'click_login_popup','click .detailed-registration-js':'click_detailed_registration','click .promotional-code-button-js':'click_promotional_code','click .submit-promotional-code-js':'click_submit_promotional_code','click .toggle_ticket_purchase_details':'toggle_ticket_purchase_details_clicked','click .buy_ticket_wrapper':'expand_tickets','keypress .promotional-code-js':'enter_on_promo_code'},initialize:function(options){this.secondary_nav_ellipsis();this.ensure_purchase_button_status();this.codes=[];_.bindAll(this);},ensure_purchase_button_status:function(){this.ticket_quantity_check();if(this.$('.event_tickets').length==0){this.$('.register_for_courses').prop('disabled',true);}},secondary_nav_ellipsis:function(){var $left_secondary_nav=this.$('#nav_left_part ul');if($left_secondary_nav.height()>this.$('.bootstrap_secondary_nav').height()){var visible_child=$left_secondary_nav.children().filter(function(){return $(this).position().top==$left_secondary_nav.position().top});var $right_most_child=$(visible_child[visible_child.length-1]);$right_most_child.after('<li class="nav_ellipsis"><div>...</div></li>');this.$('.nav_ellipsis').css({'top':$right_most_child.position().top,'left':$right_most_child.position().left+$right_most_child.width()});}},render:function(event){var context=this;var session_id=$(event.target).data('session_id');var tab_name=$(event.target).data('name');$(this.el).find('a.section_filter').parent().removeClass('active');$(event.target).parent().addClass('active');if(session_id){this.$('a.section_filter[data-session_id="'+session_id+'"][data-name="basic_information"]').parent().addClass('active');}else{this.$('a.section_filter[data-session_id=""][data-name="'+tab_name+'"]').parent().addClass('active');}
$('#main_content').html('<div class="loading"></div>');$('#secondary_content').html('');$.ajax({url:ss_context.target_url+'/ajax_load_view_page_section',data:{'section_id':tab_name,'session_id':session_id},type:'POST',success:function(response){$(context.el).find('#main_content').html(response.success.main_html);$(context.el).find('#secondary_content').html(response.success.secondary_html);if(ss.config.THEME=='version2_classic'||ss.config.PARENT_THEME=='version2_classic'){SS.controllers.sponsors.init();}
if(tab_name=='activity'){SS.controllers.post_new.init();var files=ss_context.file_info;if(files){var array_of_model=new Array();_.forEach(files,function(file){var temp=new FileRow(file,id=file['key']);array_of_model.push(temp);});var file_collection=new FileCollection(array_of_model);window.DocumentPanelApp=new DocumentPanelView({'collection':file_collection,'el':$('.document_panel'),'may_modify':'${may_modify}','panel_icon_url':'/res/img/v2/icons/down_16.png','target_type':'${type}'});}}else{context.ensure_purchase_button_status()}}});},dismiss_alert:function(event){event.preventDefault();$(event.target).closest('.alert').slideUp();$.ajax({url:ss_context.target_url+'/dismiss_create_new_session_alert',type:'PUT',success:null,error:null,});},ticket_quantity_check:function(event){var total_quantity=this.calculate_ticket_quantity();var $button=this.$('button.buy_ticket');if(total_quantity>0){$button.prop('disabled',false);}else{$button.prop('disabled',true);}},expand_tickets:function(event){if($('.footable.phone').length>0){var total_quantity=this.calculate_ticket_quantity();if(total_quantity==0){$(event.target).parents('.footable').trigger('footable_expand_first_row');}}},calculate_ticket_quantity:function(){var total_quantity=0;var quantity_selections=this.$('select.ticket_quantity');_.each(quantity_selections.get(),function(field){total_quantity+=Number($(field).val());});return total_quantity;},click_detailed_registration:function(event){this.detailed_registration();},detailed_registration:function(event){var registrants=this.$('.number-of-registrants-js').val();safe_log('registering',registrants,this.options.event_url);window.location=this.options.event_url+'/register_conference_attendees?registrants='+registrants;},show_promotional_error:function(message){var $error=$('<div class="alert alert-error">').text(message);var $failures=this.$('.promotional-failures-js').empty().show().append($error).delay(2000).slideUp(1000);},enter_on_promo_code:function(event){if(event.keyCode==13){event.preventDefault();var promoid=$(event.currentTarget).data('promo-id');var $promo_button=$("#"+promoid);$promo_button.click();}},click_submit_promotional_code:function(event){event.preventDefault();var promoid=$(event.currentTarget).attr('id');var $code_field=$("[data-promo-id='"+promoid+"']");var code=$code_field.val().toLowerCase().trim();var view=this;if(_.contains(this.codes,code)){this.show_promotional_error('Discount Code '+code+' already used.');return;}
this.codes.push(code);$.ajax({url:this.options.event_url+'/promotional_prices',type:'POST',data:{codes:this.codes},success:function(result){_.each(result.discounts,function(discount){var $ticket_rows=view.$('.ticket_row[data-ticket_id="'+discount.ticket_id+'"]');_.each($ticket_rows,function($ticket_row){var $price_cell=$('.ticket_price',$ticket_row);var plan_discount=$($ticket_row).data('plan_discount');var discount_price=discount.price;if(plan_discount!=0){currency=discount.price.substr(0,1);coupon_code_discount_price=Number(discount.price.substr(1));plan_discount_price=coupon_code_discount_price*((100-plan_discount)/100);discount_price=currency+plan_discount_price.toFixed(2);}
$price_cell.html($('<div class="ticket_discount_price">').text(discount_price));});this.$('#eventForm').append($('<input type="hidden" name="discount_code">').val(code));$code_field.val('');});if(_.contains(result.valid_codes,code)){view.$('.promotional-codes-js').append($('<span class="label label-success">').text(code)).append('&nbsp;');}else{view.show_promotional_error(code+' is not a valid code.');}}});},click_promotional_code:function(event){event.preventDefault();var $promotional_code_button=$(event.target);$promotional_code_button.hide();this.$('.promotional-row-js').show();},click_login_popup:function(event){this.login_popup();},login_popup:function(event){var url='/network/ajax_render_signin_form?redirect='+ss_context.target_url;var context=this;var register_button_text=ss_context.signup_related.signup_text;var register_link=ss_context.signup_related.signup_link;var buttons={"Save":null,};buttons[register_button_text]=function(namespace,event){window.location=register_link;this[namespace]('hide');};buttons['Login']=function(namespace,event){var $form=$(event.target).closest('.ui-dialog').find('form');if($form.valid()){$form.submit();this[namespace]('hide');}};$('<div>').ssdialog({'title':'Login','width':'auto','open_callback':function(){$(".ui-button-text:contains('"+register_button_text+"')").parent().removeClass('default').addClass('orange');},'content':{'url':url,'refresh_on_show':true},'buttons':buttons});},toggle_ticket_purchase_details_clicked:function(event){event.preventDefault();var detail_div=this.$('.purchased_ticket_detail');detail_div.toggle();if(detail_div.is(':visible')){$(e.target).text('Hide details');}else{$(e.target).text('Show details');}}});ss.views.SessionEditApp=ss.views.EventEditApp.extend({});});;;$(function(){ss.views.EventRSVPViewApp=Backbone.View.extend({events:{'click .item_action_get_invite_links':'get_invite_links'},initialize:function(options){if(ss_context.invite_params){this.model=new ss.models.EventRSVPModel(ss_context.invite_params);this.model.set({'token':options.token});if(this.model.get('register_by_link')){this.gather_rsvp_user_info(false,true);}else{if(this.model.get('already_registered')){this.gather_rsvp_user_info();}else{if(this.model.get('invite_id')){this.identity_check();}}}}},render:function(){},get_invite_links:function(){var top_whats_this="This link will bring a invitee directly to the event page, even if they aren't signed in. Please note, they won't be able to register for the event without signing in."
var bottom_whats_this="This link will bring a invitee to the event page and ask the invitee to fill in his or her information to register for the event. Note, the invitee does not have to be signed in to register with this link."
$('<div>').ssdialog({'title':'Invite Link for '+this.model.get('event_name'),'content':{'html':'<div class="rsvp_by_email label_beside">'+'<div class="generate_link">'+'<div class="title">Use these links to create a custom invite email.</div>'+'<div class="description">Copy and paste these into your custom email so members can go directly to your event and indicate their attending or not attending status.</div>'+'</div>'+'<div class="field"><label>Link to Event Page:</label>'+'<input class="input_box" type="text" name="event_page_link" value="'+this.model.get('event_full_link')+'?token='+this.model.get('token')+'">'+'<a tabindex="0" class="popover_link" role="button" data-toggle="popover" data-trigger="hover" data-content="'+top_whats_this+'" data-original-title="Link to Event Page" data-placement="bottom"><i class="icon-question-sign"></i></a>'+'</div>'+'<div class="field"><label>RSVP Link:</label>'+'<input class="input_box" type="text" name="event_rsvp_link" value="'+this.model.get('event_full_link')+'?token='+this.model.get('token')+'&register_by_link=True">'+'<a tabindex="0" class="popover_link" role="button" data-toggle="popover" data-trigger="hover" data-content="'+bottom_whats_this+'" data-original-title="RSVP Link" data-placement="bottom"><i class="icon-question-sign"></i></a>'+'</div>'+'</div>'},'buttons':{'Save':null,'Cancel':null,'Close':function(namespace){this[namespace]('hide');}}});},identity_check:function(){var display_info;var is_new_user=false;var model=this.model;var context=this;if(this.model.get('user_name')){display_info=this.model.get('user_name');}else{display_info=this.model.get('user_email');}
if(!this.model.get('user_id')){is_new_user=true;}
$('<div>').ssdialog({'title':"You've been invited to "+this.model.get('event_name'),'content':{'html':"<div class='rsvp_by_email'><div class='question'>Are you "+display_info+"?</div></div><div class='loading_cover'></div>"},'save_url':null,'buttons':{'Save':null,'Cancel':null,"Not Me":function(namespace){this[namespace]('hide');context.gather_rsvp_user_info();},"Yes":function(namespace,event){$(event.target).closest('.ui-dialog-buttonset').find('button').prop('disabled',true);$('.ssdialog .loading_cover').show();if(model.get('going')){if(!is_new_user){$(".ui-dialog-buttonset button:last-child").attr('disabled','disabled');context.rsvp_user(this,namespace,false);}else{context.gather_rsvp_user_info(true);this[namespace]('hide');}}else{if(!is_new_user){$(".ui-dialog-buttonset button:last-child").attr('disabled','disabled');context.user_not_attending(this,namespace,false)}else{context.gather_rsvp_user_info(true);this[namespace]('hide');}}}}});},rsvp_message:function(status){var message='';var title=''
var message_class=''
if(status=='success'){title='Success';message_class='alert alert-success';message="You've been successfully registered to "+this.model.get('event_name');}else if(status=='recorded'){message_class='alert alert-error'
title='Recorded'
message="You've successfully indicated you can't attend";}
$('<div>').ssdialog({'title':this.model.get('event_name'),'content':{'html':'<div class="rsvp_by_email display_message label_beside '+message_class+'">'+'<div class="status">'+title+'</div>'+'<div class="message">'+message+'</div>'+'</div>'},'save_url':null,'buttons':{'Save':null,'Cancel':null,"Okay":function(namespace){this[namespace]('hide');}}});},rsvp_user:function(button_context,button_namespace,is_new_user){var model=this.model;var params={};if(this.model.get('user_id')&&!is_new_user){params={'curr_user:id':this.model.get('user_id')};}else{params={'new_user:first_name':this.model.get('new_user_first_name'),'new_user:last_name':this.model.get('new_user_last_name'),'new_user:email':this.model.get('new_user_email'),'new_user:phone':this.model.get('new_user_phone')};}
var context=this;$.ajax({url:this.model.get('event_url')+'/rsvp_user',data:params,type:'POST',success:function(){button_context[button_namespace]('hide');context.rsvp_message('success');},error:'rsvp_error'});},user_not_attending:function(button_context,button_namespace,is_new_user){var model=this.model;var params={};if(this.model.get('user_id')&&!is_new_user){params={'user_id':this.model.get('user_id')};}else{params={'first_name':this.model.get('new_user_first_name'),'last_name':this.model.get('new_user_last_name'),'user_email':this.model.get('new_user_email'),'phone':this.model.get('new_user_phone')};}
var context=this;$.ajax({url:this.model.get('event_url')+'/user_not_attending',type:'PUT',data:params,success:function(response){button_context[button_namespace]('hide');context.rsvp_message('recorded');},error:'user_not_attending'});},gather_rsvp_user_info:function(prefill_email){var model=this.model
var title;var context=this;var can_or_cannot='';var buttons={'Save':null,'Cancel':null,"Close":function(namespace){this[namespace]('hide');}}
var this_model=this;var attend_helper=function(can_attend,this_button,this_button_namespace,event){if($('.rsvp_form').valid()){$(event.target).closest('.ui-dialog-buttonset').find('button').prop('disabled',true);model.set({'new_user_email':$('.rsvp_by_email').find('[name="email"]').val().toLowerCase(),'new_user_first_name':$('.rsvp_by_email').find('[name="first_name"]').val(),'new_user_last_name':$('.rsvp_by_email').find('[name="last_name"]').val(),'new_user_phone':$('.rsvp_by_email').find('[name="phone"]').val()});if(can_attend){$('.ssdialog .loading_cover').show();context.rsvp_user(this_button,this_button_namespace,true);}else{$('.ssdialog .loading_cover').show();context.user_not_attending(this_button,this_button_namespace,true);}}else{$('.rsvp_form').append('<label class="error">The required fields are not valid. Please review.</label>')}};if(this.model.get('going')){buttons['I can attend']=function(namespace,event){attend_helper(true,this,namespace,event)};title='Register to '+this.model.get('event_name');}else if(this.model.get('going')==false){buttons['I can\'t attend']=function(namespace,event){attend_helper(false,this,namespace,event)};title='RSVP unable to attend';}else if(this.model.get('register_by_link')==true){buttons['I can\'t attend']=function(namespace,event){attend_helper(false,this,namespace,event)};buttons['I can attend']=function(namespace,event){attend_helper(true,this,namespace,event)};buttons['Close']=null;title='Register to '+this.model.get('event_name');}
var invitee_registered='';var description='Did you receive this as a forward? Please enter your email and name to register for this event.';var display_info='';if(this.model.get('user_name')){display_info=this.model.get('user_name');}else{display_info=this.model.get('user_email');}
if(this.model.get('already_registered')){invitee_registered='<div class="registered">'+'<div class="already_registered">'+display_info+' has already registered to the event.</div>'+'<div class="description">'+description+'</div>'+'</div>';}
var email_input_value='';if(prefill_email){email_input_value=this.model.get('user_email');}
var html='<div class="rsvp_by_email label_beside"><form class="rsvp_form">'+
invitee_registered+'<div class="name">'+title+'</div>'+'<div class="field">'+'<label class="semi_short_label">Email:<div class="" style="color:red;display:inline;"> *</div> </label><input type="text" class="email required semi_long" name="email" value="'+email_input_value+'">'+'</div><div class="field">'+'<label class="semi_short_label">First Name:<div class="" style="color:red;display:inline;"> *</div> </label><input type="text" class="required semi_long" name="first_name">'+'</div><div class="field">'+'<label class="semi_short_label">Last Name:<div class="" style="color:red;display:inline;"> *</div> </label><input type="text" class="required semi_long" name="last_name">'+'</div><div class="field">'+'<label class="semi_short_label">Phone Number:<div class="" style="color:red;display:inline;"> *</div> </label><input type="text" class="phone required semi_long" name="phone">'+'</div>'+'</form></div></div><div class="loading_cover"></div>';$('<div>').ssdialog({'title':this.model.get('event_name'),'content':{'html':html},'open_callback':function(){$(".ui-button-text:contains('I can't attend')").parent().removeClass('default').addClass('danger');$(".ui-button-text:contains('I can't attend')").parent().addClass('need_validation');$(".ui-button-text:contains('I can attend')").parent().addClass('need_validation success');$('.rsvp_form').validate({ignore:':hidden',focusInvalid:false});},'save_url':null,'buttons':buttons});}});});;;$(function(){ss.models.JobType=Backbone.Model.extend({defaults:{"description":"","name":"",},urlRoot:'/asset_categorys/job?parent=jobtype',initialize:function(options){options=options||{};}});ss.models.JobTypeCollection=Backbone.Collection.extend({url:'/asset_categorys/job?parent=jobtype',model:ss.models.JobType});ss.models.JobCategory=Backbone.Model.extend({defaults:{"description":"","name":"",},urlRoot:'/asset_categorys/job?parent=jobcategory',initialize:function(options){options=options||{};}});ss.models.JobCategoryCollection=Backbone.Collection.extend({url:'/asset_categorys/job?parent=jobcategory',model:ss.models.JobCategory});});;;$(function(){var org_template=ss.fn.make_compile_template('.organization-edit-templates');var member_admin_template=ss.fn.make_compile_template('.member-admin-templates');ss.organizations=ss.organizations||{};ss.organizations.sections=ss.organizations.sections||{};ss.views.OrganizationEditPanel=ss.views.MultiSectionEditPanel.extend({className:'onepage-panel organization-edit-panel multi-edit-panel',template:org_template('.organization-edit-panel'),get_sections:function(){return ss.organizations.sections;},get_save_url:function(){if(this.model.id){return'/v2'+this.model.get('url');}else{return'/v2/companies';}},with_details:function(organization_id,func){return ss.members.with_organization_details(organization_id,func);},decorate_changes:function(changes){safe_log('Decorating changes');if(changes&&changes.members){delete changes.members;}
return changes;},get_listing_page:function(){var entry=ss.onepage.latest_from_history(/^\/?organizations$|\/?organization\/listing.*/);return entry||'/organizations';},enter_payment:function(){var url='/payment/enter_payment/company/'+this.model.id;this.confirm_navigate({url:url});},after_render:function(){if(!this.model.id){this.$('.actions button').not('.onepage-return-button').prop('disabled',true);}
this.update_action_buttons();this.on('validation_started',this.validation_started.bind(this));this.on('validation_failed',this.validation_failed.bind(this));},update_action_buttons:function(){},validation_started:function(){this.$(".goto-company-button").remove();},validation_failed:function(event){if(event.rule_name==="company_name_available"){var $target=$(event.target).parent().find('.alert-validation:last');var $import_button=$('<button class="goto-company-button">Go To Company</button>');var $row=$target.closest('.field');if($row.length){$row.css({'max-height':$row.height()});}
$target.after($import_button);$import_button.position({my:'left center',at:'right+5 center',of:$target});$import_button.click(this.goto_company_clicked.bind(this));}},goto_company_clicked:function(){var name=this.model.get("name");$.ajax({url:"/company/for_name",data:{name:name}}).done(function(data){if(data.success&&data.permaid){ss.onepage.goto_page('/companies/'+data.permaid+'/sections/basic');}}.bind(this));},delete_selected:function(options){options=options||{};safe_log('Deleting member');var confirmation_message='Are you sure you want to delete this organization';if(options.perma_delete){confirmation_message+="  <br><div class='alert alert-danger'>PERMA DELETE MODE ENABLED.<br>THIS WILL BE VERY HARD TO UNDO.<br>DON'T PANIC</div>";}
var dialog=new ss.listing.DeletePopup({item_name:'member',delete_url:'/company/delete_multiple',ids:[this.model.id],perma_delete:options.perma_delete,confirmation_message:confirmation_message,after_delete:function(){safe_log('deleted');ss.onepage.update_app_panel('<div class="alert alert-danger">Deleted</div>');}});dialog.render();}});ss.organizations.EditSubPanel=ss.forms.EditSubPanel;ss.organizations.sections.basic=ss.organizations.EditSubPanel.extend({template:org_template('.basic-section'),after_render:function(){if(ss.data.member_types.length){var options=ss.data.member_types.map(function(member_type){return{value:member_type.get('id'),label:member_type.get('name')};});options.push({label:'Other'});this.$('.member-type').html(ss.select_row({label:'Member Type',name:'member_type_id',css_class:'form-control',item:this.model,row_css_class:'form-group',label_css_class:'col-md-3 col-lg-2',input_wrap_class:'col-md-9 col-lg-10',options:options}));}},after_fields_changed:function(){var company_type_id=this.model.get('company_type_id');var email_domains=this.model.get('email_domains');if(typeof email_domains==="string"){email_domains=email_domains.split(',').map(function(domain){return domain.trim();});this.model.set('email_domains',email_domains);}
var types=ss.data.organization_types;var $type=this.$('.organization-type');if(types.length){var type_options=types.map(function(type){return{value:type.get('id'),label:type.get('name')};});type_options.push({label:'Other',value:''});$type.html(ss.select_row({label:'Organization Type',name:'company_type_id',css_class:'form-control',item:this.model,row_css_class:'form-group',label_css_class:'col-md-3 col-lg-2',input_wrap_class:'col-md-9 col-lg-10',options:type_options}));}else{$type.empty();}
var categories=ss.data.organization_categories.get_categories_for_type(company_type_id);var $category_block=this.$('.organization-categories');var category_options=categories.map(function(category){return{label:category.get('name'),value:category.id};});$category_block.empty();if(!categories.length){this.model.set({company_categories:[]});}else{var multi=new ss.fields.MultiSelectRow({label:'Categories',model:this.model,name:'company_categories',css_class:'form-control',row_css_class:'form-group',label_css_class:'col-md-3 col-lg-2',input_wrap_class:'col-md-9 col-lg-10',sub_name:'parent_category_id',options:category_options});$category_block.append(multi.el);}
return;}});ss.organizations.sections.membership=ss.organizations.EditSubPanel.extend({template:member_admin_template('.membership-section'),additional_events:{'click .uncancel':'uncancel','click .cancel-membership':'cancel','click .change-plan':'change_plan','click .offer-plan':'offer_plan','click .cancel-offer':'cancel_offer'},render:function(){var self=this;if(!this.model.id){this.$el.html($('<div>').html('Please save your changes before applying membership'));return;}
$.ajax({url:this.model.get('url')+'/full_details',success:function(response){self.model=new ss.models.Company(response.company);self.rerender();}});},rerender:function(){var self=this;var data={user_id:this.model.id};var url='/plan/get_potential_plans';$.ajax({url:url,data:data,success:function(response){var plans=new ss.models.PlanCollection();plans.add(response.plans);var offered_plan=null;if(response.offered_plan){offered_plan=new ss.models.Plan(response.offered_plan);}
var params=self.get_render_params();params.plans=plans;params.offered_plan=offered_plan;self.$el.html(self.template({c:params}));self.fields_changed();self.validator.validate();}});},uncancel:function(event){event.preventDefault();var dialog=new ss.members.RemoveCancelPopup({recipient:this.model.get('name'),url:this.model.get('url')+'/uncancel',after:this.render});dialog.render();},cancel:function(event){event.preventDefault();var dialog=new ss.members.CancelPopup({recipient:this.model.get('name'),url:this.model.get('url')+'/cancel',after:this.render});dialog.render();},change_plan:function(event){event.preventDefault();ss.members.change_organization_membership(this.model.id,this.render);},offer_plan:function(event){event.preventDefault();ss.members.offer_organization_plan(this.model.id,this.render);},cancel_offer:function(event){event.preventDefault();var dialog=new ss.members.CancelOfferPopup({model:this.model,params:{model:this.model},after:this.render});dialog.render();}});ss.organizations.sections.custom=ss.organizations.EditSubPanel.extend({template:org_template('.custom-section')});ss.organizations.sections.privacy=ss.organizations.EditSubPanel.extend({template:org_template('.privacy-section')});ss.organizations.sections.history=ss.organizations.EditSubPanel.extend({template:org_template('.history-section'),additional_events:{'click .history-filter-type':'history_filter_clicked'},history_filter_clicked:function(event){event.stopPropagation();this.$('.history-filter-type').removeClass('active');$(event.target).addClass('active');this.history_filter_changed();},history_filter_changed:function(){var filter_type=this.$('.history-filter-type.active').val();this.$('[bound_to="form|.history_filter"]').hide();this.$('[bound_to="form|.history_filter"][bound_to_value="'+filter_type+'"]').show();},render:function(){var self=this;if(!this.model.id){this.$el.html($('<div>').html('No history available yet. Please save this user first.'));return;}
self.$el.html(self.template());var url=this.model.get('url')+'/history_html';safe_log('URL',url);$.ajax({url:url,success:function(response){self.$('.history').html(response.html.replace(/data-bound_to/g,'bound_to'));self.history_filter_changed();}});}});ss.organizations.sections['public']=ss.organizations.EditSubPanel.extend({template:org_template('.public-section')});ss.organizations.sections.overview=ss.organizations.EditSubPanel.extend({render:function(){var self=this;if(!this.model.id){this.$el.html($('<div>').html('No details available yet. Please save this person\'s profile first'));return;}
var url=this.model.get('url')+'/detailed_panel';safe_log('URL',url);$.ajax({url:url,success:function(response){var $panel=$('<div>');self.$el.html('<div>'+response+'</div>');ss.organizations.render_detail_tables(self.$('.multitable'))}});}});});;;$(function(){var organization_template=ss.fn.make_compile_template('.organization-selection-templates');ss.views.OrganizationSelectionView=Backbone.View.extend({events:{'click .register-company':'register_company'},initialize:function(options){_.bindAll(this);},all_organizations:function(){return[].concat(this.options.organizations.models,this.options.pending_organizations.models);},render:function(){var organizations=this.all_organizations();var first_organization=organizations.length&&organizations[0];safe_log(organizations.length,first_organization);if(organizations.length===1&&first_organization.may_edit()){this.render_organization_edit(first_organization);}else if(organizations.length){this.render_organization_listing();}else{this.render_organization_selection();}},render_params:function(){return this.options;},register_company:function(){var organization=new ss.models.Company();this.render_organization_edit(organization);},render_organization_edit:function(organization){var self=this;ss.ensure_data(['field_infos','configurations','organization_types','organization_categories','member_types',],function(){var next_url;var SingleEdit=ss.views.OrganizationEditPanel.extend({after_created:function(){safe_log('after_created xx',next_url);window.location=next_url;},after_saved:function(){safe_log('after_saved xx',next_url);window.location=next_url;}});var edit_wrapping_view=new SingleEdit({model:organization});var edit_view=new ss.organizations.sections.basic({model:organization});edit_wrapping_view.section=edit_view;self.$el.html(edit_view.el);edit_view.render();var class_to_add=((ss.config.THEME!='version2_classic'&&ss.config.PARENT_THEME!='version2_classic')?'form-horizontal':'label_beside');edit_view.$el.addClass(class_to_add);if(!organization.id){edit_view.$el.prepend('<h3>My Company Information <a class="header-link" href="/setup/company">[Join a company]</a></h3>');}
$('.setup_next, .setup_previous').on('click',function(event){event.preventDefault();var $target=$(event.target);next_url=$target.attr('href');safe_log('Save');edit_wrapping_view.save(event);xxx_section=edit_view;});if(!organization.id){organization.add_creator(SS.app.current_user.id);}});},render_organization_listing:function(){var self=this;var template=organization_template('.organization-listing-template');this.$el.html(template({c:this.render_params()}));var $pending_organization_listing=this.$('.pending-organization-listing');this.options.pending_organizations.each(function(organization){var organization_view=new ss.views.OrganizationListingRow({model:organization,selection_view:self});$pending_organization_listing.append(organization_view.el);organization_view.render();});var $organization_listing=this.$('.organization-listing');this.options.organizations.each(function(organization){var organization_view=new ss.views.OrganizationListingRow({model:organization,selection_view:self});$organization_listing.append(organization_view.el);organization_view.render();});},render_organization_selection:function(){var template=organization_template('.organization-selection-template');this.$el.html(template({c:this.render_params()}));this.auto_complete=new ss.views.Autocomplete({el:this.$('.company-autocomplete'),initial_target_type:'company',chapter_only:ss.config.FEATURES.members_limited_join_company});this.auto_complete.on('selection_changed',this.company_chosen);},company_chosen:function(selected_organizations,options){var self=this;options=options||{};safe_log('Company chosen',selected_organizations);var type=null;if(selected_organizations.length){var organization=selected_organizations.at(0);var id=organization.get('id');ss.fn.show_loading(this.$el);$.ajax({url:'/companies/'+id+'/join',type:'POST',success:function(){window.location=window.location;}});}},organization_left:function(organization){this.options.organizations.remove(organization);this.options.pending_organizations.remove(organization);}});ss.views.OrganizationListingRow=Backbone.View.extend({events:{'click .edit-organization':'edit_clicked','click .leave-organization':'leave_clicked'},tagName:'li',className:'list-group-item',template:organization_template('.organization-listing-item'),initialize:function(){_.bindAll(this);},render:function(){this.$el.html(this.template({c:{model:this.model}}));},edit_clicked:function(event){event.preventDefault();this.options.selection_view.render_organization_edit(this.model);},leave_clicked:function(event){var self=this;var selection_view=this.options.selection_view;event.preventDefault();this.model.remove_member(SS.app.current_user.id,function(response){selection_view.organization_left(self.model);self.$el.fadeOut(function(){safe_log('Faded out');if(selection_view.all_organizations().length===0){selection_view.render();}});});}});});;;(function(i,aa,k,l){var j=function(e){function o(a,b){var c=j.defaults.columns,d=a.aoColumns.length,c=i.extend({},j.models.oColumn,c,{sSortingClass:a.oClasses.sSortable,sSortingClassJUI:a.oClasses.sSortJUI,nTh:b?b:k.createElement("th"),sTitle:c.sTitle?c.sTitle:b?b.innerHTML:"",aDataSort:c.aDataSort?c.aDataSort:[d],mDataProp:c.mDataProp?c.oDefaults:d});a.aoColumns.push(c);if(a.aoPreSearchCols[d]===l||null===a.aoPreSearchCols[d])a.aoPreSearchCols[d]=i.extend({},j.models.oSearch);else{c=a.aoPreSearchCols[d];if(c.bRegex===l)c.bRegex=!0;if(c.bSmart===l)c.bSmart=!0;if(c.bCaseInsensitive===l)c.bCaseInsensitive=!0}E(a,d,null)}function E(a,b,c){b=a.aoColumns[b];if(c!==l&&null!==c){if(c.sType!==l)b.sType=c.sType,b._bAutoType=!1;i.extend(b,c);n(b,c,"sWidth","sWidthOrig");if(c.iDataSort!==l)b.aDataSort=[c.iDataSort];n(b,c,"aDataSort")}b.fnGetData=V(b.mDataProp);b.fnSetData=sa(b.mDataProp);if(!a.oFeatures.bSort)b.bSortable=!1;if(!b.bSortable||-1==i.inArray("asc",b.asSorting)&&-1==i.inArray("desc",b.asSorting))b.sSortingClass=a.oClasses.sSortableNone,b.sSortingClassJUI="";else if(b.bSortable||-1==i.inArray("asc",b.asSorting)&&-1==i.inArray("desc",b.asSorting))b.sSortingClass=a.oClasses.sSortable,b.sSortingClassJUI=a.oClasses.sSortJUI;else if(-1!=i.inArray("asc",b.asSorting)&&-1==i.inArray("desc",b.asSorting))b.sSortingClass=a.oClasses.sSortableAsc,b.sSortingClassJUI=a.oClasses.sSortJUIAscAllowed;else if(-1==i.inArray("asc",b.asSorting)&&-1!=i.inArray("desc",b.asSorting))b.sSortingClass=a.oClasses.sSortableDesc,b.sSortingClassJUI=a.oClasses.sSortJUIDescAllowed}function r(a){if(!1===a.oFeatures.bAutoWidth)return!1;ba(a);for(var b=0,c=a.aoColumns.length;b<c;b++)a.aoColumns[b].nTh.style.width=a.aoColumns[b].sWidth}function s(a,b){for(var c=-1,d=0;d<a.aoColumns.length;d++)if(!0===a.aoColumns[d].bVisible&&c++,c==b)return d;return null}function t(a,b){for(var c=-1,d=0;d<a.aoColumns.length;d++)if(!0===a.aoColumns[d].bVisible&&c++,d==b)return!0===a.aoColumns[d].bVisible?c:null;return null}function v(a){for(var b=0,c=0;c<a.aoColumns.length;c++)!0===a.aoColumns[c].bVisible&&b++;return b}function B(a){for(var b=j.ext.aTypes,c=b.length,d=0;d<c;d++){var f=b[d](a);if(null!==f)return f}return"string"}function D(a,b){for(var c=b.split(","),d=[],f=0,h=a.aoColumns.length;f<h;f++)for(var g=0;g<h;g++)if(a.aoColumns[f].sName==c[g]){d.push(g);break}return d}function x(a){for(var b="",c=0,d=a.aoColumns.length;c<d;c++)b+=a.aoColumns[c].sName+",";return b.length==d?"":b.slice(0,-1)}function I(a,b,c,d){var f,h,g,e,q;if(b)for(f=b.length-1;0<=f;f--){var m=b[f].aTargets;i.isArray(m)||F(a,1,"aTargets must be an array of targets, not a "+typeof m);for(h=0,g=m.length;h<g;h++)if("number"===typeof m[h]&&0<=m[h]){for(;a.aoColumns.length<=m[h];)o(a);d(m[h],b[f])}else if("number"===typeof m[h]&&0>m[h])d(a.aoColumns.length+m[h],b[f]);else if("string"===typeof m[h])for(e=0,q=a.aoColumns.length;e<q;e++)("_all"==m[h]||i(a.aoColumns[e].nTh).hasClass(m[h]))&&d(e,b[f])}if(c)for(f=0,a=c.length;f<a;f++)d(f,c[f])}function G(a,b){var c;c=i.isArray(b)?b.slice():i.extend(!0,{},b);var d=a.aoData.length;c=i.extend(!0,{},j.models.oRow,{_aData:c});a.aoData.push(c);for(var f,h=0,g=a.aoColumns.length;h<g;h++)if(c=a.aoColumns[h],"function"===typeof c.fnRender&&c.bUseRendered&&null!==c.mDataProp&&J(a,d,h,R(a,d,h)),c._bAutoType&&"string"!=c.sType&&(f=w(a,d,h,"type"),null!==f&&""!==f))if(f=B(f),null===c.sType)c.sType=f;else if(c.sType!=f&&"html"!=c.sType)c.sType="string";a.aiDisplayMaster.push(d);a.oFeatures.bDeferRender||ca(a,d);return d}function ta(a){var b,c,d,f,h,g,e,q,m;if(a.bDeferLoading||null===a.sAjaxSource){e=a.nTBody.childNodes;for(b=0,c=e.length;b<c;b++)if("TR"==e[b].nodeName.toUpperCase()){q=a.aoData.length;e[b]._DT_RowIndex=q;a.aoData.push(i.extend(!0,{},j.models.oRow,{nTr:e[b]}));a.aiDisplayMaster.push(q);g=e[b].childNodes;h=0;for(d=0,f=g.length;d<f;d++)if(m=g[d].nodeName.toUpperCase(),"TD"==m||"TH"==m)J(a,q,h,i.trim(g[d].innerHTML)),h++}}e=S(a);g=[];for(b=0,c=e.length;b<c;b++)for(d=0,f=e[b].childNodes.length;d<f;d++)h=e[b].childNodes[d],m=h.nodeName.toUpperCase(),("TD"==m||"TH"==m)&&g.push(h);for(f=0,e=a.aoColumns.length;f<e;f++){m=a.aoColumns[f];if(null===m.sTitle)m.sTitle=m.nTh.innerHTML;h=m._bAutoType;q="function"===typeof m.fnRender;var o=null!==m.sClass,r=m.bVisible,l,n;if(h||q||o||!r)for(b=0,c=a.aoData.length;b<c;b++){d=a.aoData[b];l=g[b*e+f];if(h&&"string"!=m.sType&&(n=w(a,b,f,"type"),""!==n))if(n=B(n),null===m.sType)m.sType=n;else if(m.sType!=n&&"html"!=m.sType)m.sType="string";if("function"===typeof m.mDataProp)l.innerHTML=w(a,b,f,"display");if(q)n=R(a,b,f),l.innerHTML=n,m.bUseRendered&&J(a,b,f,n);o&&(l.className+=" "+m.sClass);r?d._anHidden[f]=null:(d._anHidden[f]=l,l.parentNode.removeChild(l));m.fnCreatedCell&&m.fnCreatedCell.call(a.oInstance,l,w(a,b,f,"display"),d._aData,b,f)}}if(0!==a.aoRowCreatedCallback.length)for(b=0,c=a.aoData.length;b<c;b++)d=a.aoData[b],C(a,"aoRowCreatedCallback",null,[d.nTr,d._aData,b])}function K(a,b){return b._DT_RowIndex!==l?b._DT_RowIndex:null}function da(a,b,c){for(var b=L(a,b),d=0,a=a.aoColumns.length;d<a;d++)if(b[d]===c)return d;return-1}function W(a,b,c){for(var d=[],f=0,h=a.aoColumns.length;f<h;f++)d.push(w(a,b,f,c));return d}function w(a,b,c,d){var f=a.aoColumns[c];if((c=f.fnGetData(a.aoData[b]._aData,d))===l){if(a.iDrawError!=a.iDraw&&null===f.sDefaultContent)F(a,0,"Requested unknown parameter '"+f.mDataProp+"' from the data source for row "+b),a.iDrawError=a.iDraw;return f.sDefaultContent}if(null===c&&null!==f.sDefaultContent)c=f.sDefaultContent;else if("function"===typeof c)return c();return"display"==d&&null===c?"":c}function J(a,b,c,d){a.aoColumns[c].fnSetData(a.aoData[b]._aData,d)}function V(a){if(null===a)return function(){return null};if("function"===typeof a)return function(b,d){return a(b,d)};if("string"===typeof a&&-1!=a.indexOf(".")){var b=a.split(".");return function(a){for(var d=0,f=b.length;d<f;d++)if(a=a[b[d]],a===l)return l;return a}}return function(b){return b[a]}}function sa(a){if(null===a)return function(){};if("function"===typeof a)return function(b,d){a(b,"set",d)};if("string"===typeof a&&-1!=a.indexOf(".")){var b=a.split(".");return function(a,d){for(var f=0,h=b.length-1;f<h;f++)a=a[b[f]];a[b[b.length-1]]=d}}return function(b,d){b[a]=d}}function X(a){for(var b=[],c=a.aoData.length,d=0;d<c;d++)b.push(a.aoData[d]._aData);return b}function ea(a){a.aoData.splice(0,a.aoData.length);a.aiDisplayMaster.splice(0,a.aiDisplayMaster.length);a.aiDisplay.splice(0,a.aiDisplay.length);z(a)}function fa(a,b){for(var c=-1,d=0,f=a.length;d<f;d++)a[d]==b?c=d:a[d]>b&&a[d]--;-1!=c&&a.splice(c,1)}function R(a,b,c){var d=a.aoColumns[c];return d.fnRender({iDataRow:b,iDataColumn:c,oSettings:a,aData:a.aoData[b]._aData,mDataProp:d.mDataProp},w(a,b,c,"display"))}function ca(a,b){var c=a.aoData[b],d;if(null===c.nTr){c.nTr=k.createElement("tr");c.nTr._DT_RowIndex=b;if(c._aData.DT_RowId)c.nTr.id=c._aData.DT_RowId;c._aData.DT_RowClass&&i(c.nTr).addClass(c._aData.DT_RowClass);for(var f=0,h=a.aoColumns.length;f<h;f++){var g=a.aoColumns[f];d=k.createElement("td");d.innerHTML="function"===typeof g.fnRender&&(!g.bUseRendered||null===g.mDataProp)?R(a,b,f):w(a,b,f,"display");if(null!==g.sClass)d.className=g.sClass;g.bVisible?(c.nTr.appendChild(d),c._anHidden[f]=null):c._anHidden[f]=d;g.fnCreatedCell&&g.fnCreatedCell.call(a.oInstance,d,w(a,b,f,"display"),c._aData,b,f)}C(a,"aoRowCreatedCallback",null,[c.nTr,c._aData,b])}}function ua(a){var b,c,d;if(0!==a.nTHead.getElementsByTagName("th").length)for(b=0,d=a.aoColumns.length;b<d;b++){if(c=a.aoColumns[b].nTh,c.setAttribute("role","columnheader"),a.aoColumns[b].bSortable&&(c.setAttribute("tabindex",a.iTabIndex),c.setAttribute("aria-controls",a.sTableId)),null!==a.aoColumns[b].sClass&&i(c).addClass(a.aoColumns[b].sClass),a.aoColumns[b].sTitle!=c.innerHTML)c.innerHTML=a.aoColumns[b].sTitle}else{var f=k.createElement("tr");for(b=0,d=a.aoColumns.length;b<d;b++)c=a.aoColumns[b].nTh,c.innerHTML=a.aoColumns[b].sTitle,c.setAttribute("tabindex","0"),null!==a.aoColumns[b].sClass&&i(c).addClass(a.aoColumns[b].sClass),f.appendChild(c);i(a.nTHead).html("")[0].appendChild(f);T(a.aoHeader,a.nTHead)}i(a.nTHead).children("tr").attr("role","row");if(a.bJUI)for(b=0,d=a.aoColumns.length;b<d;b++){c=a.aoColumns[b].nTh;f=k.createElement("div");f.className=a.oClasses.sSortJUIWrapper;i(c).contents().appendTo(f);var h=k.createElement("span");h.className=a.oClasses.sSortIcon;f.appendChild(h);c.appendChild(f)}if(a.oFeatures.bSort)for(b=0;b<a.aoColumns.length;b++)!1!==a.aoColumns[b].bSortable?ga(a,a.aoColumns[b].nTh,b):i(a.aoColumns[b].nTh).addClass(a.oClasses.sSortableNone);""!==a.oClasses.sFooterTH&&i(a.nTFoot).children("tr").children("th").addClass(a.oClasses.sFooterTH);if(null!==a.nTFoot){c=O(a,null,a.aoFooter);for(b=0,d=a.aoColumns.length;b<d;b++)if(c[b])a.aoColumns[b].nTf=c[b],a.aoColumns[b].sClass&&i(c[b]).addClass(a.aoColumns[b].sClass)}}function U(a,b,c){var d,f,h,g=[],e=[],i=a.aoColumns.length,m;c===l&&(c=!1);for(d=0,f=b.length;d<f;d++){g[d]=b[d].slice();g[d].nTr=b[d].nTr;for(h=i-1;0<=h;h--)!a.aoColumns[h].bVisible&&!c&&g[d].splice(h,1);e.push([])}for(d=0,f=g.length;d<f;d++){if(a=g[d].nTr)for(;h=a.firstChild;)a.removeChild(h);for(h=0,b=g[d].length;h<b;h++)if(m=i=1,e[d][h]===l){a.appendChild(g[d][h].cell);for(e[d][h]=1;g[d+i]!==l&&g[d][h].cell==g[d+i][h].cell;)e[d+i][h]=1,i++;for(;g[d][h+m]!==l&&g[d][h].cell==g[d][h+m].cell;){for(c=0;c<i;c++)e[d+c][h+m]=1;m++}g[d][h].cell.rowSpan=i;g[d][h].cell.colSpan=m}}}function y(a){var b,c,d=[],f=0,h=a.asStripeClasses.length;b=a.aoOpenRows.length;c=C(a,"aoPreDrawCallback","preDraw",[a]);if(-1===i.inArray(!1,c)){a.bDrawing=!0;if(a.iInitDisplayStart!==l&&-1!=a.iInitDisplayStart)a._iDisplayStart=a.oFeatures.bServerSide?a.iInitDisplayStart:a.iInitDisplayStart>=a.fnRecordsDisplay()?0:a.iInitDisplayStart,a.iInitDisplayStart=-1,z(a);if(a.bDeferLoading)a.bDeferLoading=!1,a.iDraw++;else if(a.oFeatures.bServerSide){if(!a.bDestroying&&!va(a))return}else a.iDraw++;if(0!==a.aiDisplay.length){var g=a._iDisplayStart;c=a._iDisplayEnd;if(a.oFeatures.bServerSide)g=0,c=a.aoData.length;for(;g<c;g++){var e=a.aoData[a.aiDisplay[g]];null===e.nTr&&ca(a,a.aiDisplay[g]);var q=e.nTr;if(0!==h){var m=a.asStripeClasses[f%h];if(e._sRowStripe!=m)i(q).removeClass(e._sRowStripe).addClass(m),e._sRowStripe=m}C(a,"aoRowCallback",null,[q,a.aoData[a.aiDisplay[g]]._aData,f,g]);d.push(q);f++;if(0!==b)for(e=0;e<b;e++)if(q==a.aoOpenRows[e].nParent){d.push(a.aoOpenRows[e].nTr);break}}}else{d[0]=k.createElement("tr");if(a.asStripeClasses[0])d[0].className=a.asStripeClasses[0];h=a.oLanguage.sZeroRecords.replace("_MAX_",a.fnFormatNumber(a.fnRecordsTotal()));if(1==a.iDraw&&null!==a.sAjaxSource&&!a.oFeatures.bServerSide)h=a.oLanguage.sLoadingRecords;else if(a.oLanguage.sEmptyTable&&0===a.fnRecordsTotal())h=a.oLanguage.sEmptyTable;b=k.createElement("td");b.setAttribute("valign","top");b.colSpan=v(a);b.className=a.oClasses.sRowEmpty;b.innerHTML=h;d[f].appendChild(b)}C(a,"aoHeaderCallback","header",[i(a.nTHead).children("tr")[0],X(a),a._iDisplayStart,a.fnDisplayEnd(),a.aiDisplay]);C(a,"aoFooterCallback","footer",[i(a.nTFoot).children("tr")[0],X(a),a._iDisplayStart,a.fnDisplayEnd(),a.aiDisplay]);f=k.createDocumentFragment();b=k.createDocumentFragment();if(a.nTBody){h=a.nTBody.parentNode;b.appendChild(a.nTBody);if(!a.oScroll.bInfinite||!a._bInitComplete||a.bSorted||a.bFiltered)for(;b=a.nTBody.firstChild;)a.nTBody.removeChild(b);for(b=0,c=d.length;b<c;b++)f.appendChild(d[b]);a.nTBody.appendChild(f);null!==h&&h.appendChild(a.nTBody)}C(a,"aoDrawCallback","draw",[a]);a.bSorted=!1;a.bFiltered=!1;a.bDrawing=!1;a.oFeatures.bServerSide&&(H(a,!1),a._bInitComplete||Y(a))}}function Z(a){a.oFeatures.bSort?P(a,a.oPreviousSearch):a.oFeatures.bFilter?M(a,a.oPreviousSearch):(z(a),y(a))}function wa(a){var b=i("<div></div>")[0];a.nTable.parentNode.insertBefore(b,a.nTable);a.nTableWrapper=i('<div id="'+a.sTableId+'_wrapper" class="'+a.oClasses.sWrapper+'" role="grid"></div>')[0];a.nTableReinsertBefore=a.nTable.nextSibling;for(var c=a.nTableWrapper,d=a.sDom.split(""),f,h,g,e,q,m,o,l=0;l<d.length;l++){h=0;g=d[l];if("<"==g){e=i("<div></div>")[0];q=d[l+1];if("'"==q||'"'==q){m="";for(o=2;d[l+o]!=q;)m+=d[l+o],o++;"H"==m?m="fg-toolbar ui-toolbar ui-widget-header ui-corner-tl ui-corner-tr ui-helper-clearfix":"F"==m&&(m="fg-toolbar ui-toolbar ui-widget-header ui-corner-bl ui-corner-br ui-helper-clearfix");-1!=m.indexOf(".")?(q=m.split("."),e.id=q[0].substr(1,q[0].length-1),e.className=q[1]):"#"==m.charAt(0)?e.id=m.substr(1,m.length-1):e.className=m;l+=o}c.appendChild(e);c=e}else if(">"==g)c=c.parentNode;else if("l"==g&&a.oFeatures.bPaginate&&a.oFeatures.bLengthChange)f=xa(a),h=1;else if("f"==g&&a.oFeatures.bFilter)f=ya(a),h=1;else if("r"==g&&a.oFeatures.bProcessing)f=za(a),h=1;else if("t"==g)f=Aa(a),h=1;else if("i"==g&&a.oFeatures.bInfo)f=Ba(a),h=1;else if("p"==g&&a.oFeatures.bPaginate)f=Ca(a),h=1;else if(0!==j.ext.aoFeatures.length){e=j.ext.aoFeatures;o=0;for(q=e.length;o<q;o++)if(g==e[o].cFeature){(f=e[o].fnInit(a))&&(h=1);break}}1==h&&null!==f&&("object"!==typeof a.aanFeatures[g]&&(a.aanFeatures[g]=[]),a.aanFeatures[g].push(f),c.appendChild(f))}b.parentNode.replaceChild(a.nTableWrapper,b)}function T(a,b){var c=i(b).children("tr"),d,f,h,g,e,q,m,j;a.splice(0,a.length);for(f=0,q=c.length;f<q;f++)a.push([]);for(f=0,q=c.length;f<q;f++)for(h=0,m=c[f].childNodes.length;h<m;h++)if(d=c[f].childNodes[h],"TD"==d.nodeName.toUpperCase()||"TH"==d.nodeName.toUpperCase()){var o=1*d.getAttribute("colspan"),l=1*d.getAttribute("rowspan"),o=!o||0===o||1===o?1:o,l=!l||0===l||1===l?1:l;for(g=0;a[f][g];)g++;j=g;for(e=0;e<o;e++)for(g=0;g<l;g++)a[f+g][j+e]={cell:d,unique:1==o?!0:!1},a[f+g].nTr=c[f]}}function O(a,b,c){var d=[];if(!c)c=a.aoHeader,b&&(c=[],T(c,b));for(var b=0,f=c.length;b<f;b++)for(var h=0,g=c[b].length;h<g;h++)if(c[b][h].unique&&(!d[h]||!a.bSortCellsTop))d[h]=c[b][h].cell;return d}function va(a){if(a.bAjaxDataGet){a.iDraw++;H(a,!0);var b=Da(a);ha(a,b);a.fnServerData.call(a.oInstance,a.sAjaxSource,b,function(b){Ea(a,b)},a);return!1}return!0}function Da(a){var b=a.aoColumns.length,c=[],d,f;c.push({name:"sEcho",value:a.iDraw});c.push({name:"iColumns",value:b});c.push({name:"sColumns",value:x(a)});c.push({name:"iDisplayStart",value:a._iDisplayStart});c.push({name:"iDisplayLength",value:!1!==a.oFeatures.bPaginate?a._iDisplayLength:-1});for(f=0;f<b;f++)d=a.aoColumns[f].mDataProp,c.push({name:"mDataProp_"+f,value:"function"===typeof d?"function":d});if(!1!==a.oFeatures.bFilter){c.push({name:"sSearch",value:a.oPreviousSearch.sSearch});c.push({name:"bRegex",value:a.oPreviousSearch.bRegex});for(f=0;f<b;f++)c.push({name:"sSearch_"+f,value:a.aoPreSearchCols[f].sSearch}),c.push({name:"bRegex_"+f,value:a.aoPreSearchCols[f].bRegex}),c.push({name:"bSearchable_"+f,value:a.aoColumns[f].bSearchable})}if(!1!==a.oFeatures.bSort){d=null!==a.aaSortingFixed?a.aaSortingFixed.length:0;var h=a.aaSorting.length;c.push({name:"iSortingCols",value:d+h});for(f=0;f<d;f++)c.push({name:"iSortCol_"+f,value:a.aaSortingFixed[f][0]}),c.push({name:"sSortDir_"+f,value:a.aaSortingFixed[f][1]});for(f=0;f<h;f++)c.push({name:"iSortCol_"+(f+d),value:a.aaSorting[f][0]}),c.push({name:"sSortDir_"+(f+d),value:a.aaSorting[f][1]});for(f=0;f<b;f++)c.push({name:"bSortable_"+
f,value:a.aoColumns[f].bSortable})}return c}function ha(a,b){C(a,"aoServerParams","serverParams",[b])}function Ea(a,b){if(b.sEcho!==l){if(1*b.sEcho<a.iDraw)return;a.iDraw=1*b.sEcho}(!a.oScroll.bInfinite||a.oScroll.bInfinite&&(a.bSorted||a.bFiltered))&&ea(a);a._iRecordsTotal=parseInt(b.iTotalRecords,10);a._iRecordsDisplay=parseInt(b.iTotalDisplayRecords,10);var c=x(a),c=b.sColumns!==l&&""!==c&&b.sColumns!=c,d;c&&(d=D(a,b.sColumns));for(var f=V(a.sAjaxDataProp)(b),h=0,g=f.length;h<g;h++)if(c){for(var e=[],i=0,m=a.aoColumns.length;i<m;i++)e.push(f[h][d[i]]);G(a,e)}else G(a,f[h]);a.aiDisplay=a.aiDisplayMaster.slice();a.bAjaxDataGet=!1;y(a);a.bAjaxDataGet=!0;H(a,!1)}function ya(a){var b=a.oPreviousSearch,c=a.oLanguage.sSearch,c=-1!==c.indexOf("_INPUT_")?c.replace("_INPUT_",'<input type="text" />'):""===c?'<input type="text" />':c+' <input type="text" />',d=k.createElement("div");d.className=a.oClasses.sFilter;d.innerHTML="<label>"+c+"</label>";if(!a.aanFeatures.f)d.id=a.sTableId+"_filter";c=i("input",d);c.val(b.sSearch.replace('"',"&quot;"));c.bind("keyup.DT",function(){for(var c=a.aanFeatures.f,d=0,g=c.length;d<g;d++)c[d]!=i(this).parents("div.dataTables_filter")[0]&&i("input",c[d]).val(this.value);this.value!=b.sSearch&&M(a,{sSearch:this.value,bRegex:b.bRegex,bSmart:b.bSmart,bCaseInsensitive:b.bCaseInsensitive})});c.attr("aria-controls",a.sTableId).bind("keypress.DT",function(a){if(13==a.keyCode)return!1});return d}function M(a,b,c){var d=a.oPreviousSearch,f=a.aoPreSearchCols,h=function(a){d.sSearch=a.sSearch;d.bRegex=a.bRegex;d.bSmart=a.bSmart;d.bCaseInsensitive=a.bCaseInsensitive};if(a.oFeatures.bServerSide)h(b);else{Fa(a,b.sSearch,c,b.bRegex,b.bSmart,b.bCaseInsensitive);h(b);for(b=0;b<a.aoPreSearchCols.length;b++)Ga(a,f[b].sSearch,b,f[b].bRegex,f[b].bSmart,f[b].bCaseInsensitive);Ha(a)}a.bFiltered=!0;i(a.oInstance).trigger("filter",a);a._iDisplayStart=0;z(a);y(a);ia(a,0)}function Ha(a){for(var b=j.ext.afnFiltering,c=0,d=b.length;c<d;c++)for(var f=0,h=0,g=a.aiDisplay.length;h<g;h++){var e=a.aiDisplay[h-
f];b[c](a,W(a,e,"filter"),e)||(a.aiDisplay.splice(h-f,1),f++)}}function Ga(a,b,c,d,f,h){if(""!==b)for(var g=0,b=ja(b,d,f,h),d=a.aiDisplay.length-1;0<=d;d--)f=ka(w(a,a.aiDisplay[d],c,"filter"),a.aoColumns[c].sType),b.test(f)||(a.aiDisplay.splice(d,1),g++)}function Fa(a,b,c,d,f,h){d=ja(b,d,f,h);f=a.oPreviousSearch;c||(c=0);0!==j.ext.afnFiltering.length&&(c=1);if(0>=b.length)a.aiDisplay.splice(0,a.aiDisplay.length),a.aiDisplay=a.aiDisplayMaster.slice();else if(a.aiDisplay.length==a.aiDisplayMaster.length||f.sSearch.length>b.length||1==c||0!==b.indexOf(f.sSearch)){a.aiDisplay.splice(0,a.aiDisplay.length);ia(a,1);for(b=0;b<a.aiDisplayMaster.length;b++)d.test(a.asDataSearch[b])&&a.aiDisplay.push(a.aiDisplayMaster[b])}else for(b=c=0;b<a.asDataSearch.length;b++)d.test(a.asDataSearch[b])||(a.aiDisplay.splice(b-c,1),c++)}function ia(a,b){if(!a.oFeatures.bServerSide){a.asDataSearch.splice(0,a.asDataSearch.length);for(var c=b&&1===b?a.aiDisplayMaster:a.aiDisplay,d=0,f=c.length;d<f;d++)a.asDataSearch[d]=la(a,W(a,c[d],"filter"))}}function la(a,b){var c="";if(a.__nTmpFilter===l)a.__nTmpFilter=k.createElement("div");for(var d=a.__nTmpFilter,f=0,h=a.aoColumns.length;f<h;f++)a.aoColumns[f].bSearchable&&(c+=ka(b[f],a.aoColumns[f].sType)+"  ");if(-1!==c.indexOf("&"))d.innerHTML=c,c=d.textContent?d.textContent:d.innerText,c=c.replace(/\n/g," ").replace(/\r/g,"");return c}function ja(a,b,c,d){if(c)return a=b?a.split(" "):ma(a).split(" "),a="^(?=.*?"+a.join(")(?=.*?")+").*$",RegExp(a,d?"i":"");a=b?a:ma(a);return RegExp(a,d?"i":"")}function ka(a,b){return"function"===typeof j.ext.ofnSearch[b]?j.ext.ofnSearch[b](a):"html"==b?a.replace(/[\r\n]/g," ").replace(/<.*?>/g,""):"string"===typeof a?a.replace(/[\r\n]/g," "):null===a?"":a}function ma(a){return a.replace(RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\|\\$|\\^)","g"),"\\$1")}function Ba(a){var b=k.createElement("div");b.className=a.oClasses.sInfo;if(!a.aanFeatures.i)a.aoDrawCallback.push({fn:Ia,sName:"information"}),b.id=a.sTableId+"_info";a.nTable.setAttribute("aria-describedby",a.sTableId+"_info");return b}function Ia(a){if(a.oFeatures.bInfo&&0!==a.aanFeatures.i.length){var b=a._iDisplayStart+1,c=a.fnDisplayEnd(),d=a.fnRecordsTotal(),f=a.fnRecordsDisplay(),h=a.fnFormatNumber(b),g=a.fnFormatNumber(c),e=a.fnFormatNumber(d),q=a.fnFormatNumber(f);a.oScroll.bInfinite&&(h=a.fnFormatNumber(1));h=0===a.fnRecordsDisplay()&&a.fnRecordsDisplay()==a.fnRecordsTotal()?a.oLanguage.sInfoEmpty+a.oLanguage.sInfoPostFix:0===a.fnRecordsDisplay()?a.oLanguage.sInfoEmpty+" "+a.oLanguage.sInfoFiltered.replace("_MAX_",e)+a.oLanguage.sInfoPostFix:a.fnRecordsDisplay()==a.fnRecordsTotal()?a.oLanguage.sInfo.replace("_START_",h).replace("_END_",g).replace("_TOTAL_",q)+a.oLanguage.sInfoPostFix:a.oLanguage.sInfo.replace("_START_",h).replace("_END_",g).replace("_TOTAL_",q)+" "+a.oLanguage.sInfoFiltered.replace("_MAX_",a.fnFormatNumber(a.fnRecordsTotal()))+a.oLanguage.sInfoPostFix;null!==a.oLanguage.fnInfoCallback&&(h=a.oLanguage.fnInfoCallback.call(a.oInstance,a,b,c,d,f,h));a=a.aanFeatures.i;b=0;for(c=a.length;b<c;b++)i(a[b]).html(h)}}
function $(a){var b,c,d=a.iInitDisplayStart;if(!1===a.bInitialised)setTimeout(function(){$(a)},200);else{wa(a);ua(a);U(a,a.aoHeader);a.nTFoot&&U(a,a.aoFooter);H(a,!0);a.oFeatures.bAutoWidth&&ba(a);for(b=0,c=a.aoColumns.length;b<c;b++)if(null!==a.aoColumns[b].sWidth)a.aoColumns[b].nTh.style.width=p(a.aoColumns[b].sWidth);a.oFeatures.bSort?P(a):a.oFeatures.bFilter?M(a,a.oPreviousSearch):(a.aiDisplay=a.aiDisplayMaster.slice(),z(a),y(a));null!==a.sAjaxSource&&!a.oFeatures.bServerSide?(c=[],ha(a,c),a.fnServerData.call(a.oInstance,a.sAjaxSource,c,function(c){var h=""!==a.sAjaxDataProp?V(a.sAjaxDataProp)(c):c;for(b=0;b<h.length;b++)G(a,h[b]);a.iInitDisplayStart=d;a.oFeatures.bSort?P(a):(a.aiDisplay=a.aiDisplayMaster.slice(),z(a),y(a));H(a,!1);Y(a,c)},a)):a.oFeatures.bServerSide||(H(a,!1),Y(a))}}function Y(a,b){a._bInitComplete=!0;C(a,"aoInitComplete","init",[a,b])}function na(a){!a.sEmptyTable&&a.sZeroRecords&&n(a,a,"sZeroRecords","sEmptyTable");!a.sLoadingRecords&&a.sZeroRecords&&n(a,a,"sZeroRecords","sLoadingRecords")}function xa(a){if(a.oScroll.bInfinite)return null;var b='<select size="1" '+('name="'+a.sTableId+'_length"')+">",c,d,f=a.aLengthMenu;if(2==f.length&&"object"===typeof f[0]&&"object"===typeof f[1])for(c=0,d=f[0].length;c<d;c++)b+='<option value="'+f[0][c]+'">'+f[1][c]+"</option>";else for(c=0,d=f.length;c<d;c++)b+='<option value="'+f[c]+'">'+f[c]+"</option>";b+="</select>";f=k.createElement("div");if(!a.aanFeatures.l)f.id=a.sTableId+"_length";f.className=a.oClasses.sLength;f.innerHTML="<label>"+a.oLanguage.sLengthMenu.replace("_MENU_",b)+"</label>";i('select option[value="'+a._iDisplayLength+'"]',f).attr("selected",!0);i("select",f).bind("change.DT",function(){var b=i(this).val(),f=a.aanFeatures.l;for(c=0,d=f.length;c<d;c++)f[c]!=this.parentNode&&i("select",f[c]).val(b);a._iDisplayLength=parseInt(b,10);z(a);if(a.fnDisplayEnd()==a.fnRecordsDisplay()&&(a._iDisplayStart=a.fnDisplayEnd()-a._iDisplayLength,0>a._iDisplayStart))a._iDisplayStart=0;if(-1==a._iDisplayLength)a._iDisplayStart=0;y(a)});i("select",f).attr("aria-controls",a.sTableId);return f}
function z(a){a._iDisplayEnd=!1===a.oFeatures.bPaginate?a.aiDisplay.length:a._iDisplayStart+a._iDisplayLength>a.aiDisplay.length||-1==a._iDisplayLength?a.aiDisplay.length:a._iDisplayStart+a._iDisplayLength}function Ca(a){if(a.oScroll.bInfinite)return null;var b=k.createElement("div");b.className=a.oClasses.sPaging+a.sPaginationType;j.ext.oPagination[a.sPaginationType].fnInit(a,b,function(a){z(a);y(a)});a.aanFeatures.p||a.aoDrawCallback.push({fn:function(a){j.ext.oPagination[a.sPaginationType].fnUpdate(a,function(a){z(a);y(a)})},sName:"pagination"});return b}function oa(a,b){var c=a._iDisplayStart;if("number"===typeof b){if(a._iDisplayStart=b*a._iDisplayLength,a._iDisplayStart>a.fnRecordsDisplay())a._iDisplayStart=0}else if("first"==b)a._iDisplayStart=0;else if("previous"==b){if(a._iDisplayStart=0<=a._iDisplayLength?a._iDisplayStart-a._iDisplayLength:0,0>a._iDisplayStart)a._iDisplayStart=0}else if("next"==b)0<=a._iDisplayLength?a._iDisplayStart+a._iDisplayLength<a.fnRecordsDisplay()&&(a._iDisplayStart+=a._iDisplayLength):a._iDisplayStart=0;else if("last"==b)if(0<=a._iDisplayLength){var d=parseInt((a.fnRecordsDisplay()-1)/a._iDisplayLength,10)+1;a._iDisplayStart=(d-1)*a._iDisplayLength}else a._iDisplayStart=0;else F(a,0,"Unknown paging action: "+b);i(a.oInstance).trigger("page",a);return c!=a._iDisplayStart}function za(a){var b=k.createElement("div");if(!a.aanFeatures.r)b.id=a.sTableId+"_processing";b.innerHTML=a.oLanguage.sProcessing;b.className=a.oClasses.sProcessing;a.nTable.parentNode.insertBefore(b,a.nTable);return b}function H(a,b){if(a.oFeatures.bProcessing)for(var c=a.aanFeatures.r,d=0,f=c.length;d<f;d++)c[d].style.visibility=b?"visible":"hidden";i(a.oInstance).trigger("processing",[a,b])}function Aa(a){if(""===a.oScroll.sX&&""===a.oScroll.sY)return a.nTable;var b=k.createElement("div"),c=k.createElement("div"),d=k.createElement("div"),f=k.createElement("div"),h=k.createElement("div"),g=k.createElement("div"),e=a.nTable.cloneNode(!1),q=a.nTable.cloneNode(!1),m=a.nTable.getElementsByTagName("thead")[0],j=0===a.nTable.getElementsByTagName("tfoot").length?null:a.nTable.getElementsByTagName("tfoot")[0],o=a.oClasses;c.appendChild(d);h.appendChild(g);f.appendChild(a.nTable);b.appendChild(c);b.appendChild(f);d.appendChild(e);e.appendChild(m);null!==j&&(b.appendChild(h),g.appendChild(q),q.appendChild(j));b.className=o.sScrollWrapper;c.className=o.sScrollHead;d.className=o.sScrollHeadInner;f.className=o.sScrollBody;h.className=o.sScrollFoot;g.className=o.sScrollFootInner;if(a.oScroll.bAutoCss)c.style.overflow="hidden",c.style.position="relative",h.style.overflow="hidden",f.style.overflow="auto";c.style.border="0";c.style.width="100%";h.style.border="0";d.style.width="150%";e.removeAttribute("id");e.style.marginLeft="0";a.nTable.style.marginLeft="0";if(null!==j)q.removeAttribute("id"),q.style.marginLeft="0";d=i(a.nTable).children("caption");g=0;for(q=d.length;g<q;g++)e.appendChild(d[g]);if(""!==a.oScroll.sX){c.style.width=p(a.oScroll.sX);f.style.width=p(a.oScroll.sX);if(null!==j)h.style.width=p(a.oScroll.sX);i(f).scroll(function(){c.scrollLeft=this.scrollLeft;if(null!==j)h.scrollLeft=this.scrollLeft})}if(""!==a.oScroll.sY)f.style.height=p(a.oScroll.sY);a.aoDrawCallback.push({fn:Ja,sName:"scrolling"});a.oScroll.bInfinite&&i(f).scroll(function(){!a.bDrawing&&0!==i(this).scrollTop()&&i(this).scrollTop()+i(this).height()>i(a.nTable).height()-a.oScroll.iLoadGap&&a.fnDisplayEnd()<a.fnRecordsDisplay()&&(oa(a,"next"),z(a),y(a))});a.nScrollHead=c;a.nScrollFoot=h;return b}function Ja(a){var b=a.nScrollHead.getElementsByTagName("div")[0],c=b.getElementsByTagName("table")[0],d=a.nTable.parentNode,f,h,g,e,j,m,o,l,r=[],n=null!==a.nTFoot?a.nScrollFoot.getElementsByTagName("div")[0]:null,E=null!==a.nTFoot?n.getElementsByTagName("table")[0]:null,k=i.browser.msie&&7>=i.browser.version;g=a.nTable.getElementsByTagName("thead");0<g.length&&a.nTable.removeChild(g[0]);null!==a.nTFoot&&(j=a.nTable.getElementsByTagName("tfoot"),0<j.length&&a.nTable.removeChild(j[0]));g=a.nTHead.cloneNode(!0);a.nTable.insertBefore(g,a.nTable.childNodes[0]);null!==a.nTFoot&&(j=a.nTFoot.cloneNode(!0),a.nTable.insertBefore(j,a.nTable.childNodes[1]));if(""===a.oScroll.sX)d.style.width="100%",b.parentNode.style.width="100%";var t=O(a,g);for(f=0,h=t.length;f<h;f++)o=s(a,f),t[f].style.width=a.aoColumns[o].sWidth;null!==a.nTFoot&&N(function(a){a.style.width=""},j.getElementsByTagName("tr"));f=i(a.nTable).outerWidth();if(""===a.oScroll.sX){if(a.nTable.style.width="100%",k&&(i("tbody",d).height()>d.offsetHeight||"scroll"==i(d).css("overflow-y")))a.nTable.style.width=p(i(a.nTable).outerWidth()-a.oScroll.iBarWidth)}else if(""!==a.oScroll.sXInner)a.nTable.style.width=p(a.oScroll.sXInner);else if(f==i(d).width()&&i(d).height()<i(a.nTable).height()){if(a.nTable.style.width=p(f-a.oScroll.iBarWidth),i(a.nTable).outerWidth()>f-a.oScroll.iBarWidth)a.nTable.style.width=p(f)}else a.nTable.style.width=p(f);f=i(a.nTable).outerWidth();h=a.nTHead.getElementsByTagName("tr");g=g.getElementsByTagName("tr");N(function(a,b){m=a.style;m.paddingTop="0";m.paddingBottom="0";m.borderTopWidth="0";m.borderBottomWidth="0";m.height=0;l=i(a).width();b.style.width=p(l);r.push(l)},g,h);i(g).height(0);null!==a.nTFoot&&(e=j.getElementsByTagName("tr"),j=a.nTFoot.getElementsByTagName("tr"),N(function(a,b){m=a.style;m.paddingTop="0";m.paddingBottom="0";m.borderTopWidth="0";m.borderBottomWidth="0";m.height=0;l=i(a).width();b.style.width=p(l);r.push(l)},e,j),i(e).height(0));N(function(a){a.innerHTML="";a.style.width=p(r.shift())},g);null!==a.nTFoot&&N(function(a){a.innerHTML="";a.style.width=p(r.shift())},e);if(i(a.nTable).outerWidth()<f){e=d.scrollHeight>d.offsetHeight||"scroll"==i(d).css("overflow-y")?f+a.oScroll.iBarWidth:f;if(k&&(d.scrollHeight>d.offsetHeight||"scroll"==i(d).css("overflow-y")))a.nTable.style.width=p(e-a.oScroll.iBarWidth);d.style.width=p(e);b.parentNode.style.width=p(e);if(null!==a.nTFoot)n.parentNode.style.width=p(e);""===a.oScroll.sX?F(a,1,"The table cannot fit into the current element which will cause column misalignment. The table has been drawn at its minimum possible width."):""!==a.oScroll.sXInner&&F(a,1,"The table cannot fit into the current element which will cause column misalignment. Increase the sScrollXInner value or remove it to allow automatic calculation")}else if(d.style.width=p("100%"),b.parentNode.style.width=p("100%"),null!==a.nTFoot)n.parentNode.style.width=p("100%");if(""===a.oScroll.sY&&k)d.style.height=p(a.nTable.offsetHeight+a.oScroll.iBarWidth);if(""!==a.oScroll.sY&&a.oScroll.bCollapse&&(d.style.height=p(a.oScroll.sY),k=""!==a.oScroll.sX&&a.nTable.offsetWidth>d.offsetWidth?a.oScroll.iBarWidth:0,a.nTable.offsetHeight<d.offsetHeight))d.style.height=p(i(a.nTable).height()+k);k=i(a.nTable).outerWidth();c.style.width=p(k);b.style.width=p(k);if(null!==a.nTFoot)n.style.width=p(a.nTable.offsetWidth),E.style.width=p(a.nTable.offsetWidth);if(a.bSorted||a.bFiltered)d.scrollTop=0}function N(a,b,c){for(var d=0,f=b.length;d<f;d++)for(var h=0,g=b[d].childNodes.length;h<g;h++)1==b[d].childNodes[h].nodeType&&(c?a(b[d].childNodes[h],c[d].childNodes[h]):a(b[d].childNodes[h]))}
function Ka(a,b){if(!a||null===a||""===a)return 0;b||(b=k.getElementsByTagName("body")[0]);var c,d=k.createElement("div");d.style.width=p(a);b.appendChild(d);c=d.offsetWidth;b.removeChild(d);return c}function ba(a){var b=0,c,d=0,f=a.aoColumns.length,h,g=i("th",a.nTHead),e=a.nTable.getAttribute("width");for(h=0;h<f;h++)if(a.aoColumns[h].bVisible&&(d++,null!==a.aoColumns[h].sWidth)){c=Ka(a.aoColumns[h].sWidthOrig,a.nTable.parentNode);if(null!==c)a.aoColumns[h].sWidth=p(c);b++}if(f==g.length&&0===b&&d==f&&""===a.oScroll.sX&&""===a.oScroll.sY)for(h=0;h<a.aoColumns.length;h++){if(c=i(g[h]).width(),null!==c)a.aoColumns[h].sWidth=p(c)}else{b=a.nTable.cloneNode(!1);h=a.nTHead.cloneNode(!0);d=k.createElement("tbody");c=k.createElement("tr");b.removeAttribute("id");b.appendChild(h);null!==a.nTFoot&&(b.appendChild(a.nTFoot.cloneNode(!0)),N(function(a){a.style.width=""},b.getElementsByTagName("tr")));b.appendChild(d);d.appendChild(c);d=i("thead th",b);0===d.length&&(d=i("tbody tr:eq(0)>td",b));g=O(a,h);for(h=d=0;h<f;h++){var j=a.aoColumns[h];j.bVisible&&null!==j.sWidthOrig&&""!==j.sWidthOrig?g[h-d].style.width=p(j.sWidthOrig):j.bVisible?g[h-d].style.width="":d++}for(h=0;h<f;h++)a.aoColumns[h].bVisible&&(d=La(a,h),null!==d&&(d=d.cloneNode(!0),""!==a.aoColumns[h].sContentPadding&&(d.innerHTML+=a.aoColumns[h].sContentPadding),c.appendChild(d)));f=a.nTable.parentNode;f.appendChild(b);if(""!==a.oScroll.sX&&""!==a.oScroll.sXInner)b.style.width=p(a.oScroll.sXInner);else if(""!==a.oScroll.sX){if(b.style.width="",i(b).width()<f.offsetWidth)b.style.width=p(f.offsetWidth)}else if(""!==a.oScroll.sY)b.style.width=p(f.offsetWidth);else if(e)b.style.width=p(e);b.style.visibility="hidden";Ma(a,b);f=i("tbody tr:eq(0)",b).children();0===f.length&&(f=O(a,i("thead",b)[0]));if(""!==a.oScroll.sX){for(h=d=c=0;h<a.aoColumns.length;h++)a.aoColumns[h].bVisible&&(c=null===a.aoColumns[h].sWidthOrig?c+i(f[d]).outerWidth():c+(parseInt(a.aoColumns[h].sWidth.replace("px",""),10)+(i(f[d]).outerWidth()-i(f[d]).width())),d++);b.style.width=p(c);a.nTable.style.width=p(c)}for(h=d=0;h<a.aoColumns.length;h++)if(a.aoColumns[h].bVisible){c=i(f[d]).width();if(null!==c&&0<c)a.aoColumns[h].sWidth=p(c);d++}f=i(b).css("width");a.nTable.style.width=-1!==f.indexOf("%")?f:p(i(b).outerWidth());b.parentNode.removeChild(b)}if(e)a.nTable.style.width=p(e)}function Ma(a,b){if(""===a.oScroll.sX&&""!==a.oScroll.sY)i(b).width(),b.style.width=p(i(b).outerWidth()-a.oScroll.iBarWidth);else if(""!==a.oScroll.sX)b.style.width=p(i(b).outerWidth())}function La(a,b){var c=Na(a,b);if(0>c)return null;if(null===a.aoData[c].nTr){var d=k.createElement("td");d.innerHTML=w(a,c,b,"");return d}return L(a,c)[b]}function Na(a,b){for(var c=-1,d=-1,f=0;f<a.aoData.length;f++){var h=w(a,f,b,"display")+"",h=h.replace(/<.*?>/g,"");if(h.length>c)c=h.length,d=f}return d}function p(a){if(null===a)return"0px";if("number"==typeof a)return 0>a?"0px":a+"px";var b=a.charCodeAt(a.length-1);return 48>b||57<b?a:a+"px"}function Oa(){var a=k.createElement("p"),b=a.style;b.width="100%";b.height="200px";b.padding="0px";var c=k.createElement("div"),b=c.style;b.position="absolute";b.top="0px";b.left="0px";b.visibility="hidden";b.width="200px";b.height="150px";b.padding="0px";b.overflow="hidden";c.appendChild(a);k.body.appendChild(c);b=a.offsetWidth;c.style.overflow="scroll";a=a.offsetWidth;if(b==a)a=c.clientWidth;k.body.removeChild(c);return b-a}function P(a,b){var c,d,f,h,g,e,o=[],m=[],r=j.ext.oSort,n=a.aoData,k=a.aoColumns,E=a.oLanguage.oAria;if(!a.oFeatures.bServerSide&&(0!==a.aaSorting.length||null!==a.aaSortingFixed)){o=null!==a.aaSortingFixed?a.aaSortingFixed.concat(a.aaSorting):a.aaSorting.slice();for(c=0;c<o.length;c++)if(d=o[c][0],f=t(a,d),h=a.aoColumns[d].sSortDataType,j.ext.afnSortData[h]){g=j.ext.afnSortData[h](a,d,f);for(f=0,h=n.length;f<h;f++)J(a,f,d,g[f])}for(c=0,d=a.aiDisplayMaster.length;c<d;c++)m[a.aiDisplayMaster[c]]=c;var p=o.length,s;for(c=0,d=n.length;c<d;c++)for(f=0;f<p;f++){s=k[o[f][0]].aDataSort;for(g=0,e=s.length;g<e;g++)h=k[s[g]].sType,h=r[(h?h:"string")+"-pre"],n[c]._aSortData[s[g]]=h?h(w(a,c,s[g],"sort")):w(a,c,s[g],"sort")}a.aiDisplayMaster.sort(function(a,b){var c,d,f,h,g;for(c=0;c<p;c++){g=k[o[c][0]].aDataSort;for(d=0,f=g.length;d<f;d++)if(h=k[g[d]].sType,h=r[(h?h:"string")+"-"+o[c][1]](n[a]._aSortData[g[d]],n[b]._aSortData[g[d]]),0!==h)return h}return r["numeric-asc"](m[a],m[b])})}(b===l||b)&&!a.oFeatures.bDeferRender&&Q(a);for(c=0,d=a.aoColumns.length;c<d;c++)f=k[c].nTh,f.removeAttribute("aria-sort"),f.removeAttribute("aria-label"),k[c].bSortable?0<o.length&&o[0][0]==c?(f.setAttribute("aria-sort","asc"==o[0][1]?"ascending":"descending"),f.setAttribute("aria-label",k[c].sTitle+("asc"==(k[c].asSorting[o[0][2]+1]?k[c].asSorting[o[0][2]+1]:k[c].asSorting[0])?E.sSortAscending:E.sSortDescending))):f.setAttribute("aria-label",k[c].sTitle+("asc"==k[c].asSorting[0]?E.sSortAscending:E.sSortDescending)):f.setAttribute("aria-label",k[c].sTitle);a.bSorted=!0;i(a.oInstance).trigger("sort",a);a.oFeatures.bFilter?M(a,a.oPreviousSearch,1):(a.aiDisplay=a.aiDisplayMaster.slice(),a._iDisplayStart=0,z(a),y(a))}function ga(a,b,c,d){Pa(b,{},function(b){if(!1!==a.aoColumns[c].bSortable){var h=function(){var d,h;if(b.shiftKey){for(var e=!1,i=0;i<a.aaSorting.length;i++)if(a.aaSorting[i][0]==c){e=!0;d=a.aaSorting[i][0];h=a.aaSorting[i][2]+1;a.aoColumns[d].asSorting[h]?(a.aaSorting[i][1]=a.aoColumns[d].asSorting[h],a.aaSorting[i][2]=h):a.aaSorting.splice(i,1);break}!1===e&&a.aaSorting.push([c,a.aoColumns[c].asSorting[0],0])}else 1==a.aaSorting.length&&a.aaSorting[0][0]==c?(d=a.aaSorting[0][0],h=a.aaSorting[0][2]+1,a.aoColumns[d].asSorting[h]||(h=0),a.aaSorting[0][1]=a.aoColumns[d].asSorting[h],a.aaSorting[0][2]=h):(a.aaSorting.splice(0,a.aaSorting.length),a.aaSorting.push([c,a.aoColumns[c].asSorting[0],0]));P(a)};a.oFeatures.bProcessing?(H(a,!0),setTimeout(function(){h();a.oFeatures.bServerSide||H(a,!1)},0)):h();"function"==typeof d&&d(a)}})}function Q(a){var b,c,d,f,h,g=a.aoColumns.length,e=a.oClasses;for(b=0;b<g;b++)a.aoColumns[b].bSortable&&i(a.aoColumns[b].nTh).removeClass(e.sSortAsc+" "+e.sSortDesc+" "+a.aoColumns[b].sSortingClass);f=null!==a.aaSortingFixed?a.aaSortingFixed.concat(a.aaSorting):a.aaSorting.slice();for(b=0;b<a.aoColumns.length;b++)if(a.aoColumns[b].bSortable){h=a.aoColumns[b].sSortingClass;d=-1;for(c=0;c<f.length;c++)if(f[c][0]==b){h="asc"==f[c][1]?e.sSortAsc:e.sSortDesc;d=c;break}i(a.aoColumns[b].nTh).addClass(h);a.bJUI&&(c=i("span."+e.sSortIcon,a.aoColumns[b].nTh),c.removeClass(e.sSortJUIAsc+" "+e.sSortJUIDesc+" "+e.sSortJUI+" "+e.sSortJUIAscAllowed+" "+e.sSortJUIDescAllowed),c.addClass(-1==d?a.aoColumns[b].sSortingClassJUI:"asc"==f[d][1]?e.sSortJUIAsc:e.sSortJUIDesc))}else i(a.aoColumns[b].nTh).addClass(a.aoColumns[b].sSortingClass);h=e.sSortColumn;if(a.oFeatures.bSort&&a.oFeatures.bSortClasses){d=L(a);if(a.oFeatures.bDeferRender)i(d).removeClass(h+"1 "+h+"2 "+h+"3");else if(d.length>=g)for(b=0;b<g;b++)if(-1!=d[b].className.indexOf(h+"1"))for(c=0,a=d.length/g;c<a;c++)d[g*c+b].className=i.trim(d[g*c+b].className.replace(h+"1",""));else if(-1!=d[b].className.indexOf(h+"2"))for(c=0,a=d.length/g;c<a;c++)d[g*c+b].className=i.trim(d[g*c+b].className.replace(h+"2",""));else if(-1!=d[b].className.indexOf(h+"3"))for(c=0,a=d.length/g;c<a;c++)d[g*c+b].className=i.trim(d[g*c+b].className.replace(" "+h+"3",""));var e=1,j;for(b=0;b<f.length;b++){j=parseInt(f[b][0],10);for(c=0,a=d.length/g;c<a;c++)d[g*c+j].className+=" "+h+e;3>e&&e++}}}function pa(a){if(a.oFeatures.bStateSave&&!a.bDestroying){var b,c;b=a.oScroll.bInfinite;var d={iCreate:(new Date).getTime(),iStart:b?0:a._iDisplayStart,iEnd:b?a._iDisplayLength:a._iDisplayEnd,iLength:a._iDisplayLength,aaSorting:i.extend(!0,[],a.aaSorting),oSearch:i.extend(!0,{},a.oPreviousSearch),aoSearchCols:i.extend(!0,[],a.aoPreSearchCols),abVisCols:[]};for(b=0,c=a.aoColumns.length;b<c;b++)d.abVisCols.push(a.aoColumns[b].bVisible);C(a,"aoStateSaveParams","stateSaveParams",[a,d]);a.fnStateSave.call(a.oInstance,a,d)}}function Qa(a,b){if(a.oFeatures.bStateSave){var c=a.fnStateLoad.call(a.oInstance,a);if(c){var d=C(a,"aoStateLoadParams","stateLoadParams",[a,c]);if(-1===i.inArray(!1,d)){a.oLoadedState=i.extend(!0,{},c);a._iDisplayStart=c.iStart;a.iInitDisplayStart=c.iStart;a._iDisplayEnd=c.iEnd;a._iDisplayLength=c.iLength;a.aaSorting=c.aaSorting.slice();a.saved_aaSorting=c.aaSorting.slice();i.extend(a.oPreviousSearch,c.oSearch);i.extend(!0,a.aoPreSearchCols,c.aoSearchCols);b.saved_aoColumns=[];for(d=0;d<c.abVisCols.length;d++)b.saved_aoColumns[d]={},b.saved_aoColumns[d].bVisible=c.abVisCols[d];C(a,"aoStateLoaded","stateLoaded",[a,c])}}}}function Ra(a){for(var b=aa.location.pathname.split("/"),a=a+"_"+b[b.length-1].replace(/[\/:]/g,"").toLowerCase()+"=",b=k.cookie.split(";"),c=0;c<b.length;c++){for(var d=b[c];" "==d.charAt(0);)d=d.substring(1,d.length);if(0===d.indexOf(a))return decodeURIComponent(d.substring(a.length,d.length))}return null}function u(a){for(var b=0;b<j.settings.length;b++)if(j.settings[b].nTable===a)return j.settings[b];return null}function S(a){for(var b=[],a=a.aoData,c=0,d=a.length;c<d;c++)null!==a[c].nTr&&b.push(a[c].nTr);return b}function L(a,b){var c=[],d,f,h,e,i,j;f=0;var o=a.aoData.length;b!==l&&(f=b,o=b+1);for(h=f;h<o;h++)if(j=a.aoData[h],null!==j.nTr){f=[];for(e=0,i=j.nTr.childNodes.length;e<i;e++)d=j.nTr.childNodes[e].nodeName.toLowerCase(),("td"==d||"th"==d)&&f.push(j.nTr.childNodes[e]);d=0;for(e=0,i=a.aoColumns.length;e<i;e++)a.aoColumns[e].bVisible?c.push(f[e-d]):(c.push(j._anHidden[e]),d++)}return c}function F(a,b,c){a=null===a?"DataTables warning: "+c:"DataTables warning (table id = '"+a.sTableId+"'): "+c;if(0===b)if("alert"==j.ext.sErrMode)alert(a);else throw a;else console!==l&&console.log&&console.log(a)}function n(a,b,c,d){d===l&&(d=c);b[c]!==l&&(a[d]=b[c])}function Sa(a,b){for(var c in a)a.hasOwnProperty(c)&&b[c]!==l&&("object"===typeof e[c]&&!1===i.isArray(b[c])?i.extend(!0,a[c],b[c]):a[c]=b[c]);return a}function Pa(a,b,c){i(a).bind("click.DT",b,function(b){c(b);a.blur()}).bind("keypress.DT",b,function(a){13===a.which&&c(a)}).bind("selectstart.DT",function(){return!1})}function A(a,b,c,d){c&&a[b].push({fn:c,sName:d})}
function C(a,b,c,d){for(var b=a[b],f=[],h=b.length-1;0<=h;h--)f.push(b[h].fn.apply(a.oInstance,d));null!==c&&i(a.oInstance).trigger(c,d);return f}function Ta(a){return function(){var b=[u(this[j.ext.iApiIndex])].concat(Array.prototype.slice.call(arguments));return j.ext.oApi[a].apply(this,b)}}var Ua=aa.JSON?JSON.stringify:function(a){var b=typeof a;if("object"!==b||null===a)return"string"===b&&(a='"'+a+'"'),a+"";var c,d,f=[],h=i.isArray(a);for(c in a)d=a[c],b=typeof d,"string"===b?d='"'+d+'"':"object"===b&&null!==d&&(d=Ua(d)),f.push((h?"":'"'+c+'":')+d);return(h?"[":"{")+f+(h?"]":"}")};this.$=function(a,b){var c,d,f=[],h=u(this[j.ext.iApiIndex]);b||(b={});b=i.extend({},{filter:"none",order:"current",page:"all"},b);if("current"==b.page)for(c=h._iDisplayStart,d=h.fnDisplayEnd();c<d;c++)f.push(h.aoData[h.aiDisplay[c]].nTr);else if("current"==b.order&&"none"==b.filter)for(c=0,d=h.aiDisplayMaster.length;c<d;c++)f.push(h.aoData[h.aiDisplayMaster[c]].nTr);else if("current"==b.order&&"applied"==b.filter)for(c=0,d=h.aiDisplay.length;c<d;c++)f.push(h.aoData[h.aiDisplay[c]].nTr);else if("original"==b.order&&"none"==b.filter)for(c=0,d=h.aoData.length;c<d;c++)f.push(h.aoData[c].nTr);else if("original"==b.order&&"applied"==b.filter)for(c=0,d=h.aoData.length;c<d;c++)-1!==i.inArray(c,h.aiDisplay)&&f.push(h.aoData[c].nTr);else F(h,1,"Unknown selection options");d=i(f);c=d.filter(a);d=d.find(a);return i([].concat(i.makeArray(c),i.makeArray(d)))};this._=function(a,b){var c=[],d,f,h=this.$(a,b);for(d=0,f=h.length;d<f;d++)c.push(this.fnGetData(h[d]));return c};this.fnAddData=function(a,b){if(0===a.length)return[];var c=[],d,f=u(this[j.ext.iApiIndex]);if("object"===typeof a[0]&&null!==a[0])for(var h=0;h<a.length;h++){d=G(f,a[h]);if(-1==d)return c;c.push(d)}else{d=G(f,a);if(-1==d)return c;c.push(d)}f.aiDisplay=f.aiDisplayMaster.slice();(b===l||b)&&Z(f);return c};this.fnAdjustColumnSizing=function(a){var b=u(this[j.ext.iApiIndex]);r(b);a===l||a?this.fnDraw(!1):(""!==b.oScroll.sX||""!==b.oScroll.sY)&&this.oApi._fnScrollDraw(b)};this.fnClearTable=function(a){var b=u(this[j.ext.iApiIndex]);ea(b);(a===l||a)&&y(b)};this.fnClose=function(a){for(var b=u(this[j.ext.iApiIndex]),c=0;c<b.aoOpenRows.length;c++)if(b.aoOpenRows[c].nParent==a)return(a=b.aoOpenRows[c].nTr.parentNode)&&a.removeChild(b.aoOpenRows[c].nTr),b.aoOpenRows.splice(c,1),0;return 1};this.fnDeleteRow=function(a,b,c){var d=u(this[j.ext.iApiIndex]),f,h,a="object"===typeof a?K(d,a):a,e=d.aoData.splice(a,1);for(f=0,h=d.aoData.length;f<h;f++)if(null!==d.aoData[f].nTr)d.aoData[f].nTr._DT_RowIndex=f;f=i.inArray(a,d.aiDisplay);d.asDataSearch.splice(f,1);fa(d.aiDisplayMaster,a);fa(d.aiDisplay,a);"function"===typeof b&&b.call(this,d,e);if(d._iDisplayStart>=d.aiDisplay.length&&(d._iDisplayStart-=d._iDisplayLength,0>d._iDisplayStart))d._iDisplayStart=0;if(c===l||c)z(d),y(d);return e};this.fnDestroy=function(a){var b=u(this[j.ext.iApiIndex]),c=b.nTableWrapper.parentNode,d=b.nTBody,f,e,a=a===l?!1:!0;b.bDestroying=!0;for(f=0,e=b.aoDestroyCallback.length;f<e;f++)b.aoDestroyCallback[f].fn();for(f=0,e=b.aoColumns.length;f<e;f++)!1===b.aoColumns[f].bVisible&&this.fnSetColumnVis(f,!0);i(b.nTableWrapper).find("*").andSelf().unbind(".DT");i("tbody>tr>td."+b.oClasses.sRowEmpty,b.nTable).parent().remove();b.nTable!=b.nTHead.parentNode&&(i(b.nTable).children("thead").remove(),b.nTable.appendChild(b.nTHead));b.nTFoot&&b.nTable!=b.nTFoot.parentNode&&(i(b.nTable).children("tfoot").remove(),b.nTable.appendChild(b.nTFoot));b.nTable.parentNode.removeChild(b.nTable);i(b.nTableWrapper).remove();b.aaSorting=[];b.aaSortingFixed=[];Q(b);i(S(b)).removeClass(b.asStripeClasses.join(" "));i("th, td",b.nTHead).removeClass([b.oClasses.sSortable,b.oClasses.sSortableAsc,b.oClasses.sSortableDesc,b.oClasses.sSortableNone].join(" "));b.bJUI&&(i("th span."+b.oClasses.sSortIcon+", td span."+b.oClasses.sSortIcon,b.nTHead).remove(),i("th, td",b.nTHead).each(function(){var a=i("div."+b.oClasses.sSortJUIWrapper,this),c=a.contents();i(this).append(c);a.remove()}));!a&&b.nTableReinsertBefore?c.insertBefore(b.nTable,b.nTableReinsertBefore):a||c.appendChild(b.nTable);for(f=0,e=b.aoData.length;f<e;f++)null!==b.aoData[f].nTr&&d.appendChild(b.aoData[f].nTr);if(!0===b.oFeatures.bAutoWidth)b.nTable.style.width=p(b.sDestroyWidth);i(d).children("tr:even").addClass(b.asDestroyStripes[0]);i(d).children("tr:odd").addClass(b.asDestroyStripes[1]);for(f=0,e=j.settings.length;f<e;f++)j.settings[f]==b&&j.settings.splice(f,1);b=null};this.fnDraw=function(a){var b=u(this[j.ext.iApiIndex]);a?(z(b),y(b)):Z(b)};this.fnFilter=function(a,b,c,d,f,e){var g=u(this[j.ext.iApiIndex]);if(g.oFeatures.bFilter){if(c===l||null===c)c=!1;if(d===l||null===d)d=!0;if(f===l||null===f)f=!0;if(e===l||null===e)e=!0;if(b===l||null===b){if(M(g,{sSearch:a+"",bRegex:c,bSmart:d,bCaseInsensitive:e},1),f&&g.aanFeatures.f){b=g.aanFeatures.f;c=0;for(d=b.length;c<d;c++)i("input",b[c]).val(a)}}else i.extend(g.aoPreSearchCols[b],{sSearch:a+"",bRegex:c,bSmart:d,bCaseInsensitive:e}),M(g,g.oPreviousSearch,1)}};this.fnGetData=function(a,b){var c=u(this[j.ext.iApiIndex]);if(a!==l){var d=a;if("object"===typeof a){var f=a.nodeName.toLowerCase();"tr"===f?d=K(c,a):"td"===f&&(d=K(c,a.parentNode),b=da(c,d,a))}return b!==l?w(c,d,b,""):c.aoData[d]!==l?c.aoData[d]._aData:null}return X(c)};this.fnGetNodes=function(a){var b=u(this[j.ext.iApiIndex]);return a!==l?b.aoData[a]!==l?b.aoData[a].nTr:null:S(b)};this.fnGetPosition=function(a){var b=u(this[j.ext.iApiIndex]),c=a.nodeName.toUpperCase();if("TR"==c)return K(b,a);return"TD"==c||"TH"==c?(c=K(b,a.parentNode),a=da(b,c,a),[c,t(b,a),a]):null};this.fnIsOpen=function(a){for(var b=u(this[j.ext.iApiIndex]),c=0;c<b.aoOpenRows.length;c++)if(b.aoOpenRows[c].nParent==a)return!0;return!1};this.fnOpen=function(a,b,c){var d=u(this[j.ext.iApiIndex]),f=S(d);if(-1!==i.inArray(a,f)){this.fnClose(a);var f=k.createElement("tr"),e=k.createElement("td");f.appendChild(e);e.className=c;e.colSpan=v(d);"string"===typeof b?e.innerHTML=b:i(e).html(b);b=i("tr",d.nTBody);-1!=i.inArray(a,b)&&i(f).insertAfter(a);d.aoOpenRows.push({nTr:f,nParent:a});return f}};this.fnPageChange=function(a,b){var c=u(this[j.ext.iApiIndex]);oa(c,a);z(c);(b===l||b)&&y(c)};this.fnSetColumnVis=function(a,b,c){var d=u(this[j.ext.iApiIndex]),f,e,g=d.aoColumns,i=d.aoData,o,m;if(g[a].bVisible!=b){if(b){for(f=e=0;f<a;f++)g[f].bVisible&&e++;m=e>=v(d);if(!m)for(f=a;f<g.length;f++)if(g[f].bVisible){o=f;break}for(f=0,e=i.length;f<e;f++)null!==i[f].nTr&&(m?i[f].nTr.appendChild(i[f]._anHidden[a]):i[f].nTr.insertBefore(i[f]._anHidden[a],L(d,f)[o]))}else for(f=0,e=i.length;f<e;f++)null!==i[f].nTr&&(o=L(d,f)[a],i[f]._anHidden[a]=o,o.parentNode.removeChild(o));g[a].bVisible=b;U(d,d.aoHeader);d.nTFoot&&U(d,d.aoFooter);for(f=0,e=d.aoOpenRows.length;f<e;f++)d.aoOpenRows[f].nTr.colSpan=v(d);if(c===l||c)r(d),y(d);pa(d)}};this.fnSettings=function(){return u(this[j.ext.iApiIndex])};this.fnSort=function(a){var b=u(this[j.ext.iApiIndex]);b.aaSorting=a;P(b)};this.fnSortListener=function(a,b,c){ga(u(this[j.ext.iApiIndex]),a,b,c)};this.fnUpdate=function(a,b,c,d,f){var e=u(this[j.ext.iApiIndex]),b="object"===typeof b?K(e,b):b;if(e.__fnUpdateDeep===l&&i.isArray(a)&&"object"===typeof a){e.aoData[b]._aData=a.slice();e.__fnUpdateDeep=!0;for(c=0;c<e.aoColumns.length;c++)this.fnUpdate(w(e,b,c),b,c,!1,!1);e.__fnUpdateDeep=l}else if(e.__fnUpdateDeep===l&&null!==a&&"object"===typeof a){e.aoData[b]._aData=i.extend(!0,{},a);e.__fnUpdateDeep=!0;for(c=0;c<e.aoColumns.length;c++)this.fnUpdate(w(e,b,c),b,c,!1,!1);e.__fnUpdateDeep=l}else{J(e,b,c,a);var a=w(e,b,c,"display"),g=e.aoColumns[c];null!==g.fnRender&&(a=R(e,b,c),g.bUseRendered&&J(e,b,c,a));if(null!==e.aoData[b].nTr)L(e,b)[c].innerHTML=a}c=i.inArray(b,e.aiDisplay);e.asDataSearch[c]=la(e,W(e,b,"filter"));(f===l||f)&&r(e);(d===l||d)&&Z(e);return 0};this.fnVersionCheck=j.ext.fnVersionCheck;this.oApi={_fnExternApiFunc:Ta,_fnInitialise:$,_fnInitComplete:Y,_fnLanguageCompat:na,_fnAddColumn:o,_fnColumnOptions:E,_fnAddData:G,_fnCreateTr:ca,_fnGatherData:ta,_fnBuildHead:ua,_fnDrawHead:U,_fnDraw:y,_fnReDraw:Z,_fnAjaxUpdate:va,_fnAjaxParameters:Da,_fnAjaxUpdateDraw:Ea,_fnServerParams:ha,_fnAddOptionsHtml:wa,_fnFeatureHtmlTable:Aa,_fnScrollDraw:Ja,_fnAdjustColumnSizing:r,_fnFeatureHtmlFilter:ya,_fnFilterComplete:M,_fnFilterCustom:Ha,_fnFilterColumn:Ga,_fnFilter:Fa,_fnBuildSearchArray:ia,_fnBuildSearchRow:la,_fnFilterCreateSearch:ja,_fnDataToSearch:ka,_fnSort:P,_fnSortAttachListener:ga,_fnSortingClasses:Q,_fnFeatureHtmlPaginate:Ca,_fnPageChange:oa,_fnFeatureHtmlInfo:Ba,_fnUpdateInfo:Ia,_fnFeatureHtmlLength:xa,_fnFeatureHtmlProcessing:za,_fnProcessingDisplay:H,_fnVisibleToColumnIndex:s,_fnColumnIndexToVisible:t,_fnNodeToDataIndex:K,_fnVisbleColumns:v,_fnCalculateEnd:z,_fnConvertToWidth:Ka,_fnCalculateColumnWidths:ba,_fnScrollingWidthAdjust:Ma,_fnGetWidestNode:La,_fnGetMaxLenString:Na,_fnStringToCss:p,_fnDetectType:B,_fnSettingsFromNode:u,_fnGetDataMaster:X,_fnGetTrNodes:S,_fnGetTdNodes:L,_fnEscapeRegex:ma,_fnDeleteIndex:fa,_fnReOrderIndex:D,_fnColumnOrdering:x,_fnLog:F,_fnClearTable:ea,_fnSaveState:pa,_fnLoadState:Qa,_fnCreateCookie:function(a,b,c,d,e){var h=new Date;h.setTime(h.getTime()+
1E3*c);var c=aa.location.pathname.split("/"),a=a+"_"+c.pop().replace(/[\/:]/g,"").toLowerCase(),g;null!==e?(g="function"===typeof i.parseJSON?i.parseJSON(b):eval("("+b+")"),b=e(a,g,h.toGMTString(),c.join("/")+"/")):b=a+"="+encodeURIComponent(b)+"; expires="+h.toGMTString()+"; path="+c.join("/")+"/";e="";h=9999999999999;if(4096<(null!==Ra(a)?k.cookie.length:b.length+k.cookie.length)+10){for(var a=k.cookie.split(";"),j=0,o=a.length;j<o;j++)if(-1!=a[j].indexOf(d)){var m=a[j].split("=");try{g=eval("("+
decodeURIComponent(m[1])+")")}catch(l){continue}if(g.iCreate&&g.iCreate<h)e=m[0],h=g.iCreate}if(""!==e)k.cookie=e+"=; expires=Thu, 01-Jan-1970 00:00:01 GMT; path="+c.join("/")+"/"}k.cookie=b},_fnReadCookie:Ra,_fnDetectHeader:T,_fnGetUniqueThs:O,_fnScrollBarWidth:Oa,_fnApplyToChildren:N,_fnMap:n,_fnGetRowData:W,_fnGetCellData:w,_fnSetCellData:J,_fnGetObjectDataFn:V,_fnSetObjectDataFn:sa,_fnApplyColumnDefs:I,_fnBindAction:Pa,_fnExtend:Sa,_fnCallbackReg:A,_fnCallbackFire:C,_fnJsonString:Ua,_fnRender:R,_fnNodeToColumnIndex:da};i.extend(j.ext.oApi,this.oApi);for(var qa in j.ext.oApi)qa&&(this[qa]=Ta(qa));var ra=this;return this.each(function(){var a=0,b,c,d;c=this.getAttribute("id");var f=!1,h=!1;if("table"!=this.nodeName.toLowerCase())F(null,0,"Attempted to initialise DataTables on a node which is not a table: "+this.nodeName);else{for(a=0,b=j.settings.length;a<b;a++){if(j.settings[a].nTable==this){if(e===l||e.bRetrieve)return j.settings[a].oInstance;if(e.bDestroy){j.settings[a].oInstance.fnDestroy();break}else{F(j.settings[a],0,"Cannot reinitialise DataTable.\n\nTo retrieve the DataTables object for this table, pass no arguments or see the docs for bRetrieve and bDestroy");return}}if(j.settings[a].sTableId==this.id){j.settings.splice(a,1);break}}if(null===c)this.id=c="DataTables_Table_"+j.ext._oExternConfig.iNextUnique++;var g=i.extend(!0,{},j.models.oSettings,{nTable:this,oApi:ra.oApi,oInit:e,sDestroyWidth:i(this).width(),sInstance:c,sTableId:c});j.settings.push(g);g.oInstance=1===ra.length?ra:i(this).dataTable();e||(e={});e.oLanguage&&na(e.oLanguage);e=Sa(i.extend(!0,{},j.defaults),e);n(g.oFeatures,e,"bPaginate");n(g.oFeatures,e,"bLengthChange");n(g.oFeatures,e,"bFilter");n(g.oFeatures,e,"bSort");n(g.oFeatures,e,"bInfo");n(g.oFeatures,e,"bProcessing");n(g.oFeatures,e,"bAutoWidth");n(g.oFeatures,e,"bSortClasses");n(g.oFeatures,e,"bServerSide");n(g.oFeatures,e,"bDeferRender");n(g.oScroll,e,"sScrollX","sX");n(g.oScroll,e,"sScrollXInner","sXInner");n(g.oScroll,e,"sScrollY","sY");n(g.oScroll,e,"bScrollCollapse","bCollapse");n(g.oScroll,e,"bScrollInfinite","bInfinite");n(g.oScroll,e,"iScrollLoadGap","iLoadGap");n(g.oScroll,e,"bScrollAutoCss","bAutoCss");n(g,e,"asStripClasses","asStripeClasses");n(g,e,"asStripeClasses");n(g,e,"fnServerData");n(g,e,"fnFormatNumber");n(g,e,"sServerMethod");n(g,e,"aaSorting");n(g,e,"aaSortingFixed");n(g,e,"aLengthMenu");n(g,e,"sPaginationType");n(g,e,"sAjaxSource");n(g,e,"sAjaxDataProp");n(g,e,"iCookieDuration");n(g,e,"sCookiePrefix");n(g,e,"sDom");n(g,e,"bSortCellsTop");n(g,e,"iTabIndex");n(g,e,"oSearch","oPreviousSearch");n(g,e,"aoSearchCols","aoPreSearchCols");n(g,e,"iDisplayLength","_iDisplayLength");n(g,e,"bJQueryUI","bJUI");n(g,e,"fnCookieCallback");n(g,e,"fnStateLoad");n(g,e,"fnStateSave");n(g.oLanguage,e,"fnInfoCallback");A(g,"aoDrawCallback",e.fnDrawCallback,"user");A(g,"aoServerParams",e.fnServerParams,"user");A(g,"aoStateSaveParams",e.fnStateSaveParams,"user");A(g,"aoStateLoadParams",e.fnStateLoadParams,"user");A(g,"aoStateLoaded",e.fnStateLoaded,"user");A(g,"aoRowCallback",e.fnRowCallback,"user");A(g,"aoRowCreatedCallback",e.fnCreatedRow,"user");A(g,"aoHeaderCallback",e.fnHeaderCallback,"user");A(g,"aoFooterCallback",e.fnFooterCallback,"user");A(g,"aoInitComplete",e.fnInitComplete,"user");A(g,"aoPreDrawCallback",e.fnPreDrawCallback,"user");g.oFeatures.bServerSide&&g.oFeatures.bSort&&g.oFeatures.bSortClasses?A(g,"aoDrawCallback",Q,"server_side_sort_classes"):g.oFeatures.bDeferRender&&A(g,"aoDrawCallback",Q,"defer_sort_classes");if(e.bJQueryUI){if(i.extend(g.oClasses,j.ext.oJUIClasses),e.sDom===j.defaults.sDom&&"lfrtip"===j.defaults.sDom)g.sDom='<"H"lfr>t<"F"ip>'}else i.extend(g.oClasses,j.ext.oStdClasses);i(this).addClass(g.oClasses.sTable);if(""!==g.oScroll.sX||""!==g.oScroll.sY)g.oScroll.iBarWidth=Oa();if(g.iInitDisplayStart===l)g.iInitDisplayStart=e.iDisplayStart,g._iDisplayStart=e.iDisplayStart;if(e.bStateSave)g.oFeatures.bStateSave=!0,Qa(g,e),A(g,"aoDrawCallback",pa,"state_save");if(null!==e.iDeferLoading)g.bDeferLoading=!0,g._iRecordsTotal=e.iDeferLoading,g._iRecordsDisplay=e.iDeferLoading;null!==e.aaData&&(h=!0);""!==e.oLanguage.sUrl?(g.oLanguage.sUrl=e.oLanguage.sUrl,i.getJSON(g.oLanguage.sUrl,null,function(a){na(a);i.extend(!0,g.oLanguage,e.oLanguage,a);$(g)}),f=!0):i.extend(!0,g.oLanguage,e.oLanguage);c=!1;d=i(this).children("tbody").children("tr");for(a=0,b=g.asStripeClasses.length;a<b;a++)if(d.filter(":lt(2)").hasClass(g.asStripeClasses[a])){c=!0;break}if(c)g.asDestroyStripes=["",""],i(d[0]).hasClass(g.oClasses.sStripeOdd)&&(g.asDestroyStripes[0]+=g.oClasses.sStripeOdd+" "),i(d[0]).hasClass(g.oClasses.sStripeEven)&&(g.asDestroyStripes[0]+=g.oClasses.sStripeEven),i(d[1]).hasClass(g.oClasses.sStripeOdd)&&(g.asDestroyStripes[1]+=g.oClasses.sStripeOdd+" "),i(d[1]).hasClass(g.oClasses.sStripeEven)&&(g.asDestroyStripes[1]+=g.oClasses.sStripeEven),d.removeClass(g.asStripeClasses.join(" "));c=[];a=this.getElementsByTagName("thead");0!==a.length&&(T(g.aoHeader,a[0]),c=O(g));if(null===e.aoColumns){d=[];for(a=0,b=c.length;a<b;a++)d.push(null)}else d=e.aoColumns;for(a=0,b=d.length;a<b;a++){if(e.saved_aoColumns!==l&&e.saved_aoColumns.length==b)null===d[a]&&(d[a]={}),d[a].bVisible=e.saved_aoColumns[a].bVisible;o(g,c?c[a]:null)}I(g,e.aoColumnDefs,d,function(a,b){E(g,a,b)});for(a=0,b=g.aaSorting.length;a<b;a++){g.aaSorting[a][0]>=g.aoColumns.length&&(g.aaSorting[a][0]=0);var r=g.aoColumns[g.aaSorting[a][0]];g.aaSorting[a][2]===l&&(g.aaSorting[a][2]=0);e.aaSorting===l&&g.saved_aaSorting===l&&(g.aaSorting[a][1]=r.asSorting[0]);for(c=0,d=r.asSorting.length;c<d;c++)if(g.aaSorting[a][1]==r.asSorting[c]){g.aaSorting[a][2]=c;break}}Q(g);a=i(this).children("thead");0===a.length&&(a=[k.createElement("thead")],this.appendChild(a[0]));g.nTHead=a[0];a=i(this).children("tbody");0===a.length&&(a=[k.createElement("tbody")],this.appendChild(a[0]));g.nTBody=a[0];g.nTBody.setAttribute("role","alert");g.nTBody.setAttribute("aria-live","polite");g.nTBody.setAttribute("aria-relevant","all");a=i(this).children("tfoot");if(0<a.length)g.nTFoot=a[0],T(g.aoFooter,g.nTFoot);if(h)for(a=0;a<e.aaData.length;a++)G(g,e.aaData[a]);else ta(g);g.aiDisplay=g.aiDisplayMaster.slice();g.bInitialised=!0;!1===f&&$(g)}})};j.version="1.9.0";j.settings=[];j.models={};j.models.ext={afnFiltering:[],afnSortData:[],aoFeatures:[],aTypes:[],fnVersionCheck:function(e){for(var i=function(e,i){for(;e.length<i;)e+="0";return e},l=j.ext.sVersion.split("."),e=e.split("."),r="",k="",t=0,v=e.length;t<v;t++)r+=i(l[t],3),k+=i(e[t],3);return parseInt(r,10)>=parseInt(k,10)},iApiIndex:0,ofnSearch:{},oApi:{},oStdClasses:{},oJUIClasses:{},oPagination:{},oSort:{},sVersion:j.version,sErrMode:"alert",_oExternConfig:{iNextUnique:0}};j.models.oSearch={bCaseInsensitive:!0,sSearch:"",bRegex:!1,bSmart:!0};j.models.oRow={nTr:null,_aData:[],_aSortData:[],_anHidden:[],_sRowStripe:""};j.models.oColumn={aDataSort:null,asSorting:null,bSearchable:null,bSortable:null,bUseRendered:null,bVisible:null,_bAutoType:!0,fnCreatedCell:null,fnGetData:null,fnRender:null,fnSetData:null,mDataProp:null,nTh:null,nTf:null,sClass:null,sContentPadding:null,sDefaultContent:null,sName:null,sSortDataType:"std",sSortingClass:null,sSortingClassJUI:null,sTitle:null,sType:null,sWidth:null,sWidthOrig:null};j.defaults={aaData:null,aaSorting:[[0,"asc"]],aaSortingFixed:null,aLengthMenu:[10,25,50,100],aoColumns:null,aoColumnDefs:null,aoSearchCols:[],asStripeClasses:["odd","even"],bAutoWidth:!0,bDeferRender:!1,bDestroy:!1,bFilter:!0,bInfo:!0,bJQueryUI:!1,bLengthChange:!0,bPaginate:!0,bProcessing:!1,bRetrieve:!1,bScrollAutoCss:!0,bScrollCollapse:!1,bScrollInfinite:!1,bServerSide:!1,bSort:!0,bSortCellsTop:!1,bSortClasses:!0,bStateSave:!1,fnCookieCallback:null,fnCreatedRow:null,fnDrawCallback:null,fnFooterCallback:null,fnFormatNumber:function(e){if(1E3>e)return e;for(var i=e+"",e=i.split(""),j="",i=i.length,l=0;l<i;l++)0===l%3&&0!==l&&(j=this.oLanguage.sInfoThousands+j),j=e[i-l-1]+j;return j},fnHeaderCallback:null,fnInfoCallback:null,fnInitComplete:null,fnPreDrawCallback:null,fnRowCallback:null,fnServerData:function(e,j,l,k){k.jqXHR=i.ajax({url:e,data:j,success:function(e){i(k.oInstance).trigger("xhr",k);l(e)},dataType:"json",cache:!1,type:k.sServerMethod,error:function(e,i){"parsererror"==i&&alert("DataTables warning: JSON data from server could not be parsed. This is caused by a JSON formatting error.")}})},fnServerParams:null,fnStateLoad:function(e){var e=this.oApi._fnReadCookie(e.sCookiePrefix+e.sInstance),j;try{j="function"===typeof i.parseJSON?i.parseJSON(e):eval("("+e+")")}catch(l){j=null}return j},fnStateLoadParams:null,fnStateLoaded:null,fnStateSave:function(e,i){this.oApi._fnCreateCookie(e.sCookiePrefix+e.sInstance,this.oApi._fnJsonString(i),e.iCookieDuration,e.sCookiePrefix,e.fnCookieCallback)},fnStateSaveParams:null,iCookieDuration:7200,iDeferLoading:null,iDisplayLength:10,iDisplayStart:0,iScrollLoadGap:100,iTabIndex:0,oLanguage:{oAria:{sSortAscending:": activate to sort column ascending",sSortDescending:": activate to sort column descending"},oPaginate:{sFirst:"First",sLast:"Last",sNext:"Next",sPrevious:"Previous"},sEmptyTable:"No data available in table",sInfo:"Showing _START_ to _END_ of _TOTAL_ entries",sInfoEmpty:"Showing 0 to 0 of 0 entries",sInfoFiltered:"(filtered from _MAX_ total entries)",sInfoPostFix:"",sInfoThousands:",",sLengthMenu:"Show _MENU_ entries",sLoadingRecords:"Loading...",sProcessing:"Processing...",sSearch:"Search:",sUrl:"",sZeroRecords:"No matching records found"},oSearch:i.extend({},j.models.oSearch),sAjaxDataProp:"aaData",sAjaxSource:null,sCookiePrefix:"SpryMedia_DataTables_",sDom:"lfrtip",sPaginationType:"two_button",sScrollX:"",sScrollXInner:"",sScrollY:"",sServerMethod:"GET"};j.defaults.columns={aDataSort:null,asSorting:["asc","desc"],bSearchable:!0,bSortable:!0,bUseRendered:!0,bVisible:!0,fnCreatedCell:null,fnRender:null,iDataSort:-1,mDataProp:null,sClass:"",sContentPadding:"",sDefaultContent:null,sName:"",sSortDataType:"std",sTitle:null,sType:null,sWidth:null};j.models.oSettings={oFeatures:{bAutoWidth:null,bDeferRender:null,bFilter:null,bInfo:null,bLengthChange:null,bPaginate:null,bProcessing:null,bServerSide:null,bSort:null,bSortClasses:null,bStateSave:null},oScroll:{bAutoCss:null,bCollapse:null,bInfinite:null,iBarWidth:0,iLoadGap:null,sX:null,sXInner:null,sY:null},oLanguage:{fnInfoCallback:null},aanFeatures:[],aoData:[],aiDisplay:[],aiDisplayMaster:[],aoColumns:[],aoHeader:[],aoFooter:[],asDataSearch:[],oPreviousSearch:{},aoPreSearchCols:[],aaSorting:null,aaSortingFixed:null,asStripeClasses:null,asDestroyStripes:[],sDestroyWidth:0,aoRowCallback:[],aoHeaderCallback:[],aoFooterCallback:[],aoDrawCallback:[],aoRowCreatedCallback:[],aoPreDrawCallback:[],aoInitComplete:[],aoStateSaveParams:[],aoStateLoadParams:[],aoStateLoaded:[],sTableId:"",nTable:null,nTHead:null,nTFoot:null,nTBody:null,nTableWrapper:null,bDeferLoading:!1,bInitialised:!1,aoOpenRows:[],sDom:null,sPaginationType:"two_button",iCookieDuration:0,sCookiePrefix:"",fnCookieCallback:null,aoStateSave:[],aoStateLoad:[],oLoadedState:null,sAjaxSource:null,sAjaxDataProp:null,bAjaxDataGet:!0,jqXHR:null,fnServerData:null,aoServerParams:[],sServerMethod:null,fnFormatNumber:null,aLengthMenu:null,iDraw:0,bDrawing:!1,iDrawError:-1,_iDisplayLength:10,_iDisplayStart:0,_iDisplayEnd:10,_iRecordsTotal:0,_iRecordsDisplay:0,bJUI:null,oClasses:{},bFiltered:!1,bSorted:!1,bSortCellsTop:null,oInit:null,aoDestroyCallback:[],fnRecordsTotal:function(){return this.oFeatures.bServerSide?parseInt(this._iRecordsTotal,10):this.aiDisplayMaster.length},fnRecordsDisplay:function(){return this.oFeatures.bServerSide?parseInt(this._iRecordsDisplay,10):this.aiDisplay.length},fnDisplayEnd:function(){return this.oFeatures.bServerSide?!1===this.oFeatures.bPaginate||-1==this._iDisplayLength?this._iDisplayStart+this.aiDisplay.length:Math.min(this._iDisplayStart+this._iDisplayLength,this._iRecordsDisplay):this._iDisplayEnd},oInstance:null,sInstance:null,iTabIndex:0};j.ext=i.extend(!0,{},j.models.ext);i.extend(j.ext.oStdClasses,{sTable:"dataTable",sPagePrevEnabled:"paginate_enabled_previous",sPagePrevDisabled:"paginate_disabled_previous",sPageNextEnabled:"paginate_enabled_next",sPageNextDisabled:"paginate_disabled_next",sPageJUINext:"",sPageJUIPrev:"",sPageButton:"paginate_button",sPageButtonActive:"paginate_active",sPageButtonStaticDisabled:"paginate_button paginate_button_disabled",sPageFirst:"first",sPagePrevious:"previous",sPageNext:"next",sPageLast:"last",sStripeOdd:"odd",sStripeEven:"even",sRowEmpty:"dataTables_empty",sWrapper:"dataTables_wrapper",sFilter:"dataTables_filter",sInfo:"dataTables_info",sPaging:"dataTables_paginate paging_",sLength:"dataTables_length",sProcessing:"dataTables_processing",sSortAsc:"sorting_asc",sSortDesc:"sorting_desc",sSortable:"sorting",sSortableAsc:"sorting_asc_disabled",sSortableDesc:"sorting_desc_disabled",sSortableNone:"sorting_disabled",sSortColumn:"sorting_",sSortJUIAsc:"",sSortJUIDesc:"",sSortJUI:"",sSortJUIAscAllowed:"",sSortJUIDescAllowed:"",sSortJUIWrapper:"",sSortIcon:"",sScrollWrapper:"dataTables_scroll",sScrollHead:"dataTables_scrollHead",sScrollHeadInner:"dataTables_scrollHeadInner",sScrollBody:"dataTables_scrollBody",sScrollFoot:"dataTables_scrollFoot",sScrollFootInner:"dataTables_scrollFootInner",sFooterTH:""});i.extend(j.ext.oJUIClasses,j.ext.oStdClasses,{sPagePrevEnabled:"fg-button ui-button ui-state-default ui-corner-left",sPagePrevDisabled:"fg-button ui-button ui-state-default ui-corner-left ui-state-disabled",sPageNextEnabled:"fg-button ui-button ui-state-default ui-corner-right",sPageNextDisabled:"fg-button ui-button ui-state-default ui-corner-right ui-state-disabled",sPageJUINext:"ui-icon ui-icon-circle-arrow-e",sPageJUIPrev:"ui-icon ui-icon-circle-arrow-w",sPageButton:"fg-button ui-button ui-state-default",sPageButtonActive:"fg-button ui-button ui-state-default ui-state-disabled",sPageButtonStaticDisabled:"fg-button ui-button ui-state-default ui-state-disabled",sPageFirst:"first ui-corner-tl ui-corner-bl",sPageLast:"last ui-corner-tr ui-corner-br",sPaging:"dataTables_paginate fg-buttonset ui-buttonset fg-buttonset-multi ui-buttonset-multi paging_",sSortAsc:"ui-state-default",sSortDesc:"ui-state-default",sSortable:"ui-state-default",sSortableAsc:"ui-state-default",sSortableDesc:"ui-state-default",sSortableNone:"ui-state-default",sSortJUIAsc:"css_right ui-icon ui-icon-triangle-1-n",sSortJUIDesc:"css_right ui-icon ui-icon-triangle-1-s",sSortJUI:"css_right ui-icon ui-icon-carat-2-n-s",sSortJUIAscAllowed:"css_right ui-icon ui-icon-carat-1-n",sSortJUIDescAllowed:"css_right ui-icon ui-icon-carat-1-s",sSortJUIWrapper:"DataTables_sort_wrapper",sSortIcon:"DataTables_sort_icon",sScrollHead:"dataTables_scrollHead ui-state-default",sScrollFoot:"dataTables_scrollFoot ui-state-default",sFooterTH:"ui-state-default"});i.extend(j.ext.oPagination,{two_button:{fnInit:function(e,j,l){var k=e.oLanguage.oPaginate,s=function(i){e.oApi._fnPageChange(e,i.data.action)&&l(e)},k=!e.bJUI?'<a class="'+e.oClasses.sPagePrevDisabled+'" tabindex="'+e.iTabIndex+'" role="button">'+k.sPrevious+'</a><a class="'+e.oClasses.sPageNextDisabled+'" tabindex="'+e.iTabIndex+'" role="button">'+k.sNext+"</a>":'<a class="'+e.oClasses.sPagePrevDisabled+'" tabindex="'+e.iTabIndex+'" role="button"><span class="'+e.oClasses.sPageJUIPrev+'"></span></a><a class="'+e.oClasses.sPageNextDisabled+'" tabindex="'+e.iTabIndex+'" role="button"><span class="'+e.oClasses.sPageJUINext+'"></span></a>';i(j).append(k);var t=i("a",j),k=t[0],t=t[1];e.oApi._fnBindAction(k,{action:"previous"},s);e.oApi._fnBindAction(t,{action:"next"},s);if(!e.aanFeatures.p)j.id=e.sTableId+"_paginate",k.id=e.sTableId+"_previous",t.id=e.sTableId+"_next",k.setAttribute("aria-controls",e.sTableId),t.setAttribute("aria-controls",e.sTableId)},fnUpdate:function(e){if(e.aanFeatures.p)for(var i=e.oClasses,j=e.aanFeatures.p,l=0,k=j.length;l<k;l++)if(0!==j[l].childNodes.length)j[l].childNodes[0].className=0===e._iDisplayStart?i.sPagePrevDisabled:i.sPagePrevEnabled,j[l].childNodes[1].className=e.fnDisplayEnd()==e.fnRecordsDisplay()?i.sPageNextDisabled:i.sPageNextEnabled}},iFullNumbersShowPages:5,full_numbers:{fnInit:function(e,j,l){var k=e.oLanguage.oPaginate,s=e.oClasses,t=function(i){e.oApi._fnPageChange(e,i.data.action)&&l(e)};i(j).append('<a  tabindex="'+e.iTabIndex+'" class="'+s.sPageButton+" "+s.sPageFirst+'">'+k.sFirst+'</a><a  tabindex="'+e.iTabIndex+'" class="'+s.sPageButton+" "+s.sPagePrevious+'">'+k.sPrevious+'</a><span></span><a tabindex="'+e.iTabIndex+'" class="'+s.sPageButton+" "+s.sPageNext+'">'+k.sNext+'</a><a tabindex="'+e.iTabIndex+'" class="'+s.sPageButton+" "+s.sPageLast+'">'+k.sLast+"</a>");var v=i("a",j),k=v[0],s=v[1],B=v[2],v=v[3];e.oApi._fnBindAction(k,{action:"first"},t);e.oApi._fnBindAction(s,{action:"previous"},t);e.oApi._fnBindAction(B,{action:"next"},t);e.oApi._fnBindAction(v,{action:"last"},t);if(!e.aanFeatures.p)j.id=e.sTableId+"_paginate",k.id=e.sTableId+"_first",s.id=e.sTableId+"_previous",B.id=e.sTableId+"_next",v.id=e.sTableId+"_last"},fnUpdate:function(e,l){if(e.aanFeatures.p){var k=j.ext.oPagination.iFullNumbersShowPages,r=Math.floor(k/2),s=Math.ceil(e.fnRecordsDisplay()/e._iDisplayLength),t=Math.ceil(e._iDisplayStart/e._iDisplayLength)+1,v="",B,D=e.oClasses,x,I=e.aanFeatures.p,G=function(i){e.oApi._fnBindAction(this,{page:i+B-1},function(i){e.oApi._fnPageChange(e,i.data.page);l(e);i.preventDefault()})};s<k?(B=1,r=s):t<=r?(B=1,r=k):t>=s-r?(B=s-k+1,r=s):(B=t-Math.ceil(k/2)+1,r=B+k-1);for(k=B;k<=r;k++)v+=t!==k?'<a tabindex="'+e.iTabIndex+'" class="'+D.sPageButton+'">'+e.fnFormatNumber(k)+"</a>":'<a tabindex="'+e.iTabIndex+'" class="'+D.sPageButtonActive+'">'+e.fnFormatNumber(k)+"</a>";for(k=0,r=I.length;k<r;k++)0!==I[k].childNodes.length&&(i("span:eq(0)",I[k]).html(v).children("a").each(G),x=I[k].getElementsByTagName("a"),x=[x[0],x[1],x[x.length-2],x[x.length-1]],i(x).removeClass(D.sPageButton+" "+D.sPageButtonActive+" "+D.sPageButtonStaticDisabled),i([x[0],x[1]]).addClass(1==t?D.sPageButtonStaticDisabled:D.sPageButton),i([x[2],x[3]]).addClass(0===s||t===s||-1===e._iDisplayLength?D.sPageButtonStaticDisabled:D.sPageButton))}}}});i.extend(j.ext.oSort,{"string-pre":function(e){"string"!=typeof e&&(e="");return e.toLowerCase()},"string-asc":function(e,i){return e<i?-1:e>i?1:0},"string-desc":function(e,i){return e<i?1:e>i?-1:0},"html-pre":function(e){return e.replace(/<.*?>/g,"").toLowerCase()},"html-asc":function(e,i){return e<i?-1:e>i?1:0},"html-desc":function(e,i){return e<i?1:e>i?-1:0},"date-pre":function(e){e=Date.parse(e);if(isNaN(e)||""===e)e=Date.parse("01/01/1970 00:00:00");return e},"date-asc":function(e,i){return e-i},"date-desc":function(e,i){return i-e},"numeric-pre":function(e){return"-"==e||""===e?0:1*e},"numeric-asc":function(e,i){return e-i},"numeric-desc":function(e,i){return i-e}});i.extend(j.ext.aTypes,[function(e){if("number"===typeof e)return"numeric";if("string"!==typeof e)return null;var i,j=!1;i=e.charAt(0);if(-1=="0123456789-".indexOf(i))return null;for(var k=1;k<e.length;k++){i=e.charAt(k);if(-1=="0123456789.".indexOf(i))return null;if("."==i){if(j)return null;j=!0}}return"numeric"},function(e){var i=Date.parse(e);return null!==i&&!isNaN(i)||"string"===typeof e&&0===e.length?"date":null},function(e){return"string"===typeof e&&-1!=e.indexOf("<")&&-1!=e.indexOf(">")?"html":null}]);i.fn.DataTable=j;i.fn.dataTable=j;i.fn.dataTableSettings=j.settings;i.fn.dataTableExt=j.ext})(jQuery,window,document,void 0);;;(function($){$.extend($.ss,{"datatable":{"csv_dialog":function(datatable,url){var table_data=datatable._fnAjaxParameters(datatable.DataTable.settings[datatable.DataTable.settings.length-1]);var qs='';for(var i in table_data){var param=table_data[i];var param_str=param.name+'='+param.value+'&';qs+=param_str;}
var insert_qs=function(url,qs){var qs_index=url.indexOf('?');if(qs_index==-1){url+=('?'+qs);}else{url=(url.substr(0,qs_index+1)+qs+url.substr(qs_index+1));}
return url;};var csv_url=insert_qs(url,qs);var dialog_url=insert_qs(url,"csv_dialog=true&");$('<div>').ssdialog({'title':"Download CSV",'width':'auto','content':{'url':dialog_url,'refresh_on_show':true},'buttons':{'Save':null,'Download':function(namespace){var $container=this.data(namespace)['container'];var $form=$container.find('form');var form_data=$form.serialize();if(form_data.length){form_data+="&";}
csv_url=insert_qs(csv_url,form_data);document.location.href=csv_url;this[namespace]('hide');}}});}}});})(jQuery);;;$(function(){ss.models.FileWrapper=Backbone.Model.extend({initialize:function(options){options=options||{};_.bindAll(this);safe_log('Initializing wrapper',options.file);this.set({file:new ss.models.File(options.file)});safe_log('Initialized wrapper',this.get('file'));this.id=options.key;},defaults:function(){return{file:new ss.models.File()};}});ss.models.FileTemplate=Backbone.Model.extend({idAttribute:'key',initialize:function(options){options=options||{};_.bindAll(this);safe_log('Initializing wrapper',options.file);this.set({file:new ss.models.FileWrapper(options.file)});safe_log('Initialized template',this.get('file'));this.id=options.key;},defaults:function(){return{file:new ss.models.FileWrapper()};}});ss.models.AdminFileCollection=Backbone.Collection.extend({model:ss.models.FileTemplate,new_file:function(){var keys=this.pluck('key');safe_log('keys',keys);var max=0;keys=_.map(keys,function(key){return parseInt(key);});keys=_.filter(keys,Boolean);if(keys.length){max=_.max(keys);}
this.add({key:String(max+1)});safe_log('New key',max+1);var xxx_files=this;}});ss.models.Profile=Backbone.Model.extend({initialize:function(options){_.bindAll(this);this.set({image:new ss.models.Image(this.get('image'))});},defaults:function(){return{home_address:{},work_address:{}};}});ss.models.User=Backbone.Model.extend({initialize:function(options){options=options||{};_.bindAll(this);safe_log('New User');var profile=this.get('profile');if(!(profile&&profile.attributes)){profile=new ss.models.Profile(profile);}
this.set({profile:profile});this.set({image:new ss.models.Image(this.get('image'))});var admin_files=new ss.models.AdminFileCollection(options.admin_uploader_files||[]);this.set({admin_uploader_files:admin_files});this.set({files:new ss.models.FileMap(options.files||[])});},get_summary:function(){return this.get('user_summary');},get_expiry_date:function(){return this.get_summary().membership_expiry_date;},get_plan_id:function(){return this.get_summary().plan_id;},defaults:function(){return{files:new ss.models.FileMap(),additional_info:{}};},as_autocomplete_selection:function(){var auto_data={type:'user',name:this.get('name'),member_number:this.get('member_number'),email:this.get('email'),image_url:ss.config.CLOUDFRONT_URL+"/res/img/v2/placeholder.png",url:this.get('url'),id:this.id};var xxx_auto_data=auto_data;return auto_data;}});});;;$(function(){ss.models.CompanyMemberSummary=Backbone.Model.extend({defaults:function(){return{name:null,email:null,image:new ss.models.Image()};},initialize:function(options){options=options||{};this.set({image:new ss.models.Image(options.image)});}});ss.models.CompanyMember=Backbone.Model.extend({defaults:function(){return{user_id:null,status:null,title:null,member_name:null,member_title:null,primary_contact:null,account_holder:null,company_admin:null};},initialize:function(options){options=options||{};this.set({summary:new ss.models.CompanyMemberSummary(options.summary)});},pending:function(){return this.get('status')==='pending';},active:function(){return this.get('status')==='normal'||this.get('status')==='admin';},admin:function(){return this.get('status')==='admin';},build_image_url:function(options){var image=this.get('summary').get('image');var image_url=image&&image.build_image_url(options);if(!image_url){image_url=ss.data.CLOUDFRONT_DOMAIN+'/res/img/v2/placeholder.png';}
return image_url;}});ss.models.CompanyMemberCollection=Backbone.Collection.extend({initialize:function(options){},model:ss.models.CompanyMember,member_for_id:function(user_id){var users=this.where({user_id:user_id});return users.length?users[0]:null;}});ss.models.Company=ss.models.CompanyModel=Backbone.Model.extend({defaults:function(){return{mailing_address:{},address:{},additional_info:{},members:null};},initialize:function(options){options=options||{};var members=new ss.models.CompanyMemberCollection();members.reset(options.members);this.set({members:members});this.set({image:new ss.models.Image(this.get('image'))});this.set({files:new ss.models.FileMap(options.files||[])});this.set({company_categories:this.get('company_categories')||[]});},update_members:function(company_info){var model=this;var members=this.get('members');var member_ids={};var members_added=false;_.each(company_info.members,function(member){member_ids[member.id]=true;var existing_member=members.get(member.id);if(existing_member){existing_member.set(member);}else{members.add(member);members_added=true;}});var members_removed=false;members.each(function(member){if(!member_ids[member.id]){members.remove(member);members_removed=true;}});if(members_added){}},member_for_id:function(user_id){return this.get('members').member_for_id(user_id);},is_admin:function(user_id){var member=this.member_for_id(user_id);return member&&member.admin();},is_pending:function(user_id){var member=this.member_for_id(user_id);return member&&member.pending();},may_edit:function(){var user=SS.app.current_user;if(!user){return false;}
if(user.network_admin){return true;}
return this.is_admin(user.id);},get_summary:function(){return this.get('company_summary');},get_expiry_date:function(){return this.get_summary().membership_expiry_date;},get_plan_id:function(){return this.get_summary().plan_id;},build_image_url:function(options){var image=this.get('image');var image_url=image&&image.build_image_url(options);if(!image_url){image_url=ss.data.CLOUDFRONT_DOMAIN+'/res/img/v2/placeholder.png';}
return image_url;},remove_member:function(user_id,success,error){var self=this;$.ajax({url:this.get('url')+'/remove_member',data:{user_id:user_id},type:'POST',success:function(response){var members=self.get('members');members.remove(self.member_for_id(user_id));success(response);},error:error});},add_creator:function(user_id){var member=this.member_for_id(user_id);if(!member){member=new ss.models.CompanyMember({key:user_id,user_id:user_id});this.get('members').add(member);}
member.set({status:'admin',primary_contact:true,account_holder:true,company_admin:true});},as_autocomplete_selection:function(){var auto_data={type:'company',name:this.get('name'),member_number:this.get('member_number'),image_url:"https://d3lut3gzcpx87s.cloudfront.net/res/img/v2/placeholder.png",url:this.get('url'),id:this.id};return auto_data;},update_primary_contact:function(user_id){this.get('members').each(function(member){if(member.get('user_id')!==user_id&&member.get('primary_contact')){member.set({primary_contact:false});}});var member=this.member_for_id(user_id);member.set({primary_contact:true});},update_account_holder:function(user_id){this.get('members').each(function(member){if(member.get('user_id')!==user_id&&member.get('account_holder')){member.set({account_holder:false});}});var member=this.member_for_id(user_id);member.set({account_holder:true});}});ss.models.CompanyCollection=Backbone.Collection.extend({model:ss.models.Company});ss.models.CompanyType=ss.models.OrganizationType=Backbone.Model.extend({defaults:function(){return{key:''};}});ss.models.OrganizationTypeCollection=ss.models.CompanyTypeCollection=Backbone.Collection.extend({url:'/v2/company_types',model:ss.models.OrganizationType});ss.models.OrganizationCategory=ss.models.CompanyCategory=Backbone.Model.extend({defaults:function(){return{key:'',parent_category_id:'',sub_category_id:'',parent_options:[],sub_options:[],to_delete:'false'};}});ss.models.OrganizationCategoryCollection=ss.models.CompanyCategoryCollection=Backbone.Collection.extend({url:'/v2/company_categories',model:ss.models.OrganizationCategory,get_categories_for_type:function(type_id){var categories=this.where({company_type_id:type_id});return _.filter(categories,function(category){return!category.get('parent_category_id');});},get_categories_for_parent_id:function(parent_category_id){return this.where({parent_category_id:parent_category_id});}});});;;$(function(){var header_height=$('.site-header').height();var banner_height=$('.header-banner').height();$('.sidebar-affixed').affix({offset:{top:header_height+banner_height+25}});});;;$(function(){if($('.message_list').length>0){$('#main_content').addClass('received-messages');$('ul.asset_type > li a').click(function(){currentMessageListView();});}});function currentMessageListView(){active=$('ul.asset_type > li.active a').text();if(active=='Sent'){$('#main_content').addClass('received-messages').removeClass('sent-messages');}else{$('#main_content').addClass('sent-messages').removeClass('received-messages');}};;$(function(){$('.multi-select-target:visible').livequery(function(){if($('.admin-page').length>0){$(this).chosen({width:'100%'});}else{if(!$("link[href='/res/js/os/plugins/chosen/chosen.min.css']").length)
$('<link href="/res/js/os/plugins/chosen/chosen.min.css" media="screen" rel="stylesheet" type="text/css">').appendTo("head");var limit=$(this).data('limit');ss_require(['/res/js/os/plugins/chosen.jquery.min.js'],function(){$(this).attr('disabled',false);$(this).chosen({width:'100%',max_selected_options:limit});}.bind(this));}});});;;!function(a,b,c,d){var e=a(b);a.fn.lazyload=function(f){function g(){var b=0;i.each(function(){var c=a(this);if(!j.skip_invisible||c.is(":visible"))if(a.abovethetop(this,j)||a.leftofbegin(this,j));else if(a.belowthefold(this,j)||a.rightoffold(this,j)){if(++b>j.failure_limit)return!1}else c.trigger("appear"),b=0})}var h,i=this,j={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:b,data_attribute:"original",skip_invisible:!1,appear:null,load:null,placeholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC"};return f&&(d!==f.failurelimit&&(f.failure_limit=f.failurelimit,delete f.failurelimit),d!==f.effectspeed&&(f.effect_speed=f.effectspeed,delete f.effectspeed),a.extend(j,f)),h=j.container===d||j.container===b?e:a(j.container),0===j.event.indexOf("scroll")&&h.bind(j.event,function(){return g()}),this.each(function(){var b=this,c=a(b);b.loaded=!1,(c.attr("src")===d||c.attr("src")===!1)&&c.is("img")&&c.attr("src",j.placeholder),c.one("appear",function(){if(!this.loaded){if(j.appear){var d=i.length;j.appear.call(b,d,j)}a("<img />").bind("load",function(){var d=c.attr("data-"+j.data_attribute);c.hide(),c.is("img")?c.attr("src",d):c.css("background-image","url('"+d+"')"),c[j.effect](j.effect_speed),b.loaded=!0;var e=a.grep(i,function(a){return!a.loaded});if(i=a(e),j.load){var f=i.length;j.load.call(b,f,j)}}).attr("src",c.attr("data-"+j.data_attribute))}}),0!==j.event.indexOf("scroll")&&c.bind(j.event,function(){b.loaded||c.trigger("appear")})}),e.bind("resize",function(){g()}),/(?:iphone|ipod|ipad).*os 5/gi.test(navigator.appVersion)&&e.bind("pageshow",function(b){b.originalEvent&&b.originalEvent.persisted&&i.each(function(){a(this).trigger("appear")})}),a(c).ready(function(){g()}),this},a.belowthefold=function(c,f){var g;return g=f.container===d||f.container===b?(b.innerHeight?b.innerHeight:e.height())+e.scrollTop():a(f.container).offset().top+a(f.container).height(),g<=a(c).offset().top-f.threshold},a.rightoffold=function(c,f){var g;return g=f.container===d||f.container===b?e.width()+e.scrollLeft():a(f.container).offset().left+a(f.container).width(),g<=a(c).offset().left-f.threshold},a.abovethetop=function(c,f){var g;return g=f.container===d||f.container===b?e.scrollTop():a(f.container).offset().top,g>=a(c).offset().top+f.threshold+a(c).height()},a.leftofbegin=function(c,f){var g;return g=f.container===d||f.container===b?e.scrollLeft():a(f.container).offset().left,g>=a(c).offset().left+f.threshold+a(c).width()},a.inviewport=function(b,c){return!(a.rightoffold(b,c)||a.leftofbegin(b,c)||a.belowthefold(b,c)||a.abovethetop(b,c))},a.extend(a.expr[":"],{"below-the-fold":function(b){return a.belowthefold(b,{threshold:0})},"above-the-top":function(b){return!a.belowthefold(b,{threshold:0})},"right-of-screen":function(b){return a.rightoffold(b,{threshold:0})},"left-of-screen":function(b){return!a.rightoffold(b,{threshold:0})},"in-viewport":function(b){return a.inviewport(b,{threshold:0})},"above-the-fold":function(b){return!a.belowthefold(b,{threshold:0})},"right-of-fold":function(b){return a.rightoffold(b,{threshold:0})},"left-of-fold":function(b){return!a.rightoffold(b,{threshold:0})}})}(jQuery,window,document);;;$(function(){$("div#search-toggle a").click(function(event){var panel=$(event.target).parents('#search-toggle').siblings('#slide-search-field');if(panel.hasClass("visible")){panel.removeClass('visible').animate({'width':'0px'});}else{panel.addClass('visible').animate({'width':'160px'});}
return false;});});;;$(function(){$(".search-toggle-button").click(function(event){var input=$(event.target).parents('.input-group-btn').siblings('input');if(!input.hasClass('opened-search-input')){var input_group=$(event.target).parents('.input-group');var input_width=140;var search_button_width=35;input_group.addClass('opened-input-group');$('#slide-search-field .btn').addClass('opened-search-button');$('#slide-search-field').animate({'width':input_width+search_button_width+'px'});input.addClass('opened-search-input').animate({'width':input_width+'px','padding-left':'7px'});return false;}});});;